/*! For license information please see LICENSES */
(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{0:function(t,e,n){"use strict";(function(t,r,o,c){n.d(e,"a",(function(){return Ti})),n.d(e,"b",(function(){return Ai})),n.d(e,"c",(function(){return St})),n.d(e,"d",(function(){return ar})),n.d(e,"e",(function(){return sr})),n.d(e,"f",(function(){return ur})),n.d(e,"g",(function(){return nr})),n.d(e,"h",(function(){return Xs})),n.d(e,"i",(function(){return Pc})),n.d(e,"j",(function(){return Fc})),n.d(e,"k",(function(){return Bc})),n.d(e,"l",(function(){return zc})),n.d(e,"m",(function(){return cr})),n.d(e,"n",(function(){return lr})),n.d(e,"o",(function(){return pr})),n.d(e,"p",(function(){return Hr})),n.d(e,"q",(function(){return dr})),n.d(e,"r",(function(){return Ec})),n.d(e,"s",(function(){return Cc})),n.d(e,"t",(function(){return ji})),n.d(e,"u",(function(){return $s})),n.d(e,"v",(function(){return Pn})),n.d(e,"w",(function(){return Mp})),n.d(e,"x",(function(){return kn})),n.d(e,"y",(function(){return Fn})),n.d(e,"z",(function(){return fr})),n.d(e,"A",(function(){return mr})),n.d(e,"B",(function(){return dn})),n.d(e,"C",(function(){return In})),n.d(e,"D",(function(){return On})),n.d(e,"E",(function(){return ic})),n.d(e,"F",(function(){return dl})),n.d(e,"G",(function(){return pc})),n.d(e,"H",(function(){return oc})),n.d(e,"I",(function(){return gr})),n.d(e,"J",(function(){return vr})),n.d(e,"K",(function(){return zn})),n.d(e,"L",(function(){return uc})),n.d(e,"M",(function(){return oi})),n.d(e,"N",(function(){return vu})),n.d(e,"O",(function(){return qc})),n.d(e,"P",(function(){return We})),n.d(e,"Q",(function(){return i})),n.d(e,"R",(function(){return Uu})),n.d(e,"S",(function(){return yr})),n.d(e,"T",(function(){return xr})),n.d(e,"U",(function(){return Un})),n.d(e,"V",(function(){return wr})),n.d(e,"W",(function(){return sl})),n.d(e,"X",(function(){return En})),n.d(e,"Y",(function(){return _r})),n.d(e,"Z",(function(){return Wr})),n.d(e,"ab",(function(){return eh})),n.d(e,"bb",(function(){return $u})),n.d(e,"cb",(function(){return ml})),n.d(e,"db",(function(){return si})),n.d(e,"eb",(function(){return Gu})),n.d(e,"fb",(function(){return Hu})),n.d(e,"gb",(function(){return cl})),n.d(e,"hb",(function(){return mn})),n.d(e,"ib",(function(){return ql})),n.d(e,"jb",(function(){return wp})),n.d(e,"kb",(function(){return hl})),n.d(e,"lb",(function(){return Xc})),n.d(e,"mb",(function(){return qu})),n.d(e,"nb",(function(){return Xu})),n.d(e,"ob",(function(){return Tn})),n.d(e,"pb",(function(){return Qc})),n.d(e,"qb",(function(){return Sr})),n.d(e,"rb",(function(){return Mr})),n.d(e,"sb",(function(){return Mi})),n.d(e,"tb",(function(){return hu})),n.d(e,"ub",(function(){return pu})),n.d(e,"vb",(function(){return du})),n.d(e,"wb",(function(){return fc})),n.d(e,"xb",(function(){return Vc})),n.d(e,"yb",(function(){return Mc})),n.d(e,"zb",(function(){return Ac})),n.d(e,"Ab",(function(){return Rc})),n.d(e,"Bb",(function(){return qr})),n.d(e,"Cb",(function(){return Gc})),n.d(e,"Db",(function(){return Hc})),n.d(e,"Eb",(function(){return Yr})),n.d(e,"Fb",(function(){return Jr})),n.d(e,"Gb",(function(){return Qr})),n.d(e,"Hb",(function(){return bu})),n.d(e,"Ib",(function(){return Tr})),n.d(e,"Jb",(function(){return Ju})),n.d(e,"Kb",(function(){return wu})),n.d(e,"Lb",(function(){return Sn})),n.d(e,"Mb",(function(){return Cn})),n.d(e,"Nb",(function(){return _u})),n.d(e,"Ob",(function(){return ti})),n.d(e,"Pb",(function(){return Yc})),n.d(e,"Qb",(function(){return Wc})),n.d(e,"Rb",(function(){return Pu})),n.d(e,"Sb",(function(){return An})),n.d(e,"Tb",(function(){return fn})),n.d(e,"Ub",(function(){return Ar})),n.d(e,"Vb",(function(){return Ke})),n.d(e,"Wb",(function(){return _})),n.d(e,"Xb",(function(){return Kc})),n.d(e,"Yb",(function(){return Vn})),n.d(e,"Zb",(function(){return vc})),n.d(e,"ac",(function(){return ll})),n.d(e,"bc",(function(){return Cr})),n.d(e,"cc",(function(){return Rr})),n.d(e,"dc",(function(){return yn})),n.d(e,"ec",(function(){return al})),n.d(e,"fc",(function(){return di})),n.d(e,"gc",(function(){return Zc})),n.d(e,"hc",(function(){return Ye})),n.d(e,"ic",(function(){return Wn})),n.d(e,"jc",(function(){return Ir})),n.d(e,"kc",(function(){return Nr})),n.d(e,"lc",(function(){return kr})),n.d(e,"mc",(function(){return Pr})),n.d(e,"nc",(function(){return Ic})),n.d(e,"oc",(function(){return wi})),n.d(e,"pc",(function(){return Si})),n.d(e,"qc",(function(){return Fr})),n.d(e,"rc",(function(){return Gn})),n.d(e,"sc",(function(){return fl})),n.d(e,"tc",(function(){return tr})),n.d(e,"uc",(function(){return Br})),n.d(e,"vc",(function(){return Fu})),n.d(e,"wc",(function(){return Bu})),n.d(e,"xc",(function(){return Hn})),n.d(e,"yc",(function(){return hr})),n.d(e,"zc",(function(){return rl})),n.d(e,"Ac",(function(){return ri})),n.d(e,"Bc",(function(){return th})),n.d(e,"Cc",(function(){return Ur})),n.d(e,"Dc",(function(){return Vr})),n.d(e,"Ec",(function(){return gn})),n.d(e,"Fc",(function(){return xn})),n.d(e,"Gc",(function(){return bn})),n.d(e,"Hc",(function(){return qe})),n.d(e,"Ic",(function(){return yu})),n.d(e,"Jc",(function(){return il})),n.d(e,"Kc",(function(){return Ei})),n.d(e,"Lc",(function(){return zu})),n.d(e,"Mc",(function(){return jn})),n.d(e,"Nc",(function(){return pt})),n.d(e,"Oc",(function(){return mu})),n.d(e,"Pc",(function(){return gu})),n.d(e,"Qc",(function(){return Mn})),n.d(e,"Rc",(function(){return Rn}));var l=function(t,e){return(l=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function h(t,e){function n(){this.constructor=t}l(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function d(t,e,n,r){return new(n||(n=Promise))((function(o,a){function i(t){try{u(r.next(t))}catch(t){a(t)}}function s(t){try{u(r.throw(t))}catch(t){a(t)}}function u(t){t.done?o(t.value):new n((function(e){e(t.value)})).then(i,s)}u((r=r.apply(t,e||[])).next())}))}function f(t,e){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return i.label++,{value:a[1],done:!1};case 5:i.label++,r=a[1],a=[0];continue;case 7:a=i.ops.pop(),i.trys.pop();continue;default:if(!(o=(o=i.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){i=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){i.label=a[1];break}if(6===a[0]&&i.label<o[1]){i.label=o[1],o=a;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(a);break}o[2]&&i.ops.pop(),i.trys.pop();continue}a=e.call(t,i)}catch(t){a=[6,t],r=0}finally{n=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}var m=function(){function t(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return t.prototype.setPlatform=function(t,e){null!=this.platform&&console.warn("Platform "+this.platformName+" has already been set. Overwriting the platform with "+e+"."),this.platformName=t,this.platform=e},t.prototype.registerFlag=function(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){var r=this.urlFlags[t];console.warn("Setting feature override from URL "+t+": "+r+"."),this.set(t,r)}},t.prototype.get=function(t){return t in this.flags||(this.flags[t]=this.evaluateFlag(t)),this.flags[t]},t.prototype.getNumber=function(t){return this.get(t)},t.prototype.getBool=function(t){return this.get(t)},t.prototype.getFlags=function(){return this.flags},Object.defineProperty(t.prototype,"features",{get:function(){return this.flags},enumerable:!0,configurable:!0}),t.prototype.set=function(t,e){if(null==this.flagRegistry[t])throw new Error("Cannot set flag "+t+" as it has not been registered.");this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)},t.prototype.evaluateFlag=function(t){if(null==this.flagRegistry[t])throw new Error("Cannot evaluate flag '"+t+"': no evaluation function found.");return this.flagRegistry[t].evaluationFn()},t.prototype.setFlags=function(t){this.flags=Object.assign({},t)},t.prototype.reset=function(){this.flags={},this.urlFlags={},this.populateURLFlags()},t.prototype.populateURLFlags=function(){var t=this;if(void 0!==this.global&&void 0!==this.global.location&&void 0!==this.global.location.search){var e,n,r=(e=this.global.location.search,n={},e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];return a(n,e[0],e[1]),e.join("=")})),n);"tfjsflags"in r&&r.tfjsflags.split(",").forEach((function(e){var n=e.split(":"),r=n[0],o=n[1];t.urlFlags[r]=function(t,e){if("true"===(e=e.toLowerCase())||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error("Could not parse value flag value "+e+" for flag "+t+".")}(r,o)}))}},t}();function a(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function i(){return s}var s=null,u=new Map,v=new Map;function y(t,e){var n=S(t,e);return u.get(n)}function x(t){return v.get(t)}function w(t){for(var e=u.entries(),n=[];;){var r=e.next(),o=r.done,a=r.value;if(o)break;var i=a[0],s=a[1];i.split("_")[0]===t&&n.push(s)}return n}function _(t){var e=t.kernelName,n=t.backendName,r=S(e,n);if(u.has(r))throw new Error("The kernel '"+e+"' for backend '"+n+"' is already registered");u.set(r,t)}function p(t){var e=t.kernelName;v.has(e)&&console.warn("Overriding the gradient for '"+e+"'"),v.set(e,t)}function S(t,e){return e+"_"+t}function M(t){for(var e=t.length,n=0,r=0;e>0;)r=Math.random()*e|0,n=t[--e],t[e]=t[r],t[r]=n}function E(t,e,n){return Math.max(t,Math.min(e,n))}function b(t){return t%2==0?t:t+1}function T(t){for(var e=0,n=0;n<t.length;n++)e+=t[n];return e}function A(t,e){if(!t)throw new Error("string"==typeof e?e:e())}function C(t,e,n){void 0===n&&(n=""),A(O(t,e),(function(){return n+" Shapes "+t+" and "+e+" must match"}))}function R(t){A(null!=t,(function(){return"The input to the tensor constructor must be a non-null value."}))}function I(t,e,n){if(void 0===e&&(e=[]),void 0===n&&(n=!1),null==e&&(e=[]),Array.isArray(t)||X(t)&&!n)for(var r=0;r<t.length;++r)I(t[r],e,n);else e.push(t);return e}function N(t){if(0===t.length)return 1;for(var e=t[0],n=1;n<t.length;n++)e*=t[n];return e}function O(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function D(t){return t%1==0}function L(t){if(null!=Math.tanh)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;var e=Math.exp(2*t);return(e-1)/(e+1)}function k(t){var e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function P(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function F(t,e,n){return void 0===e&&(e=function(t){return 0}),new Promise((function(r,o){var a=0,i=function(){if(t())r();else{a++;var s=e(a);null!=n&&a>=n?o():setTimeout(i,s)}};i()}))}function B(t,e){for(var n=1,r=-1,o=0;o<t.length;++o)if(t[o]>=0)n*=t[o];else if(-1===t[o]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. Found -1 at dim "+r+" and dim "+o);r=o}else if(t[o]<0)throw Error("Shapes can not be < 0. Found "+t[o]+" at dim "+o);if(-1===r){if(e>0&&e!==n)throw Error("Size("+e+") must match the product of shape "+t);return t}if(0===n)throw Error("Cannot infer the missing size in ["+t+"] when there are 0 elements");if(e%n!=0)throw Error("The implicit shape can't be a fractional number. Got "+e+" / "+n);var a=t.slice();return a[r]=e/n,a}function z(t,e){var n=e.length;return A((t=null==t?e.map((function(t,e){return e})):[].concat(t)).every((function(t){return t>=-n&&t<n})),(function(){return"All values in axis param must be in range [-"+n+", "+n+") but got axis "+t})),A(t.every((function(t){return D(t)})),(function(){return"All values in axis param must be integers but got axis "+t})),t.map((function(t){return t<0?n+t:t}))}function U(t,e){for(var n=[],r=[],o=null!=e&&Array.isArray(e)&&0===e.length,a=null==e||o?null:z(e,t).sort(),i=0,s=0;s<t.length;++s){if(null!=a){if(a[i]===s&&1!==t[s])throw new Error("Can't squeeze axis "+s+" since its dim '"+t[s]+"' is not 1");(null==a[i]||a[i]>s)&&1===t[s]&&(n.push(t[s]),r.push(s)),a[i]<=s&&i++}1!==t[s]&&(n.push(t[s]),r.push(s))}return{newShape:n,keptDims:r}}function V(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error("Unknown data type "+t);n=new Uint8Array(e)}return n}function G(t,e){var n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error("Unknown data type "+t);n=new Array(e)}return n}function H(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type "+e+" being uploaded contains "+r+".")}}function j(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function W(t,e){return!("complex64"===e||"float32"===e&&"complex64"!==t||"int32"===e&&"float32"!==t&&"complex64"!==t||"bool"===e&&"bool"===t)}function X(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function Y(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error("Unknown dtype "+t)}function K(t){if(null==t)return 0;var e=0;return t.forEach((function(t){return e+=t.length})),e}function J(t){return"string"==typeof t||t instanceof String}function q(t){return"boolean"==typeof t}function Z(t){return"number"==typeof t}function Q(t){return Array.isArray(t)?Q(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":Z(t)?"float32":J(t)?"string":q(t)?"bool":"float32"}function $(t){return!!(t&&t.constructor&&t.call&&t.apply)}function tt(t,e){for(var n=e;n<t;++n)if(t%n==0)return n;return t}function et(t){var e=t.length;if(e<2)return[];var n=new Array(e-1);n[e-2]=t[e-1];for(var r=e-3;r>=0;--r)n[r]=n[r+1]*t[r+1];return n}function nt(t,e,n){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=I(t)),n&&H(t,e),function(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){for(var r=new Uint8Array(t.length),o=0;o<r.length;++o)0!==Math.round(t[o])&&(r[o]=1);return r}throw new Error("Unknown data type "+e)}function it(t,e){if(0===t.length)return e[0];var n=t.reduce((function(t,e){return t*e}));if(0===n)return[];if(n!==e.length)throw new Error("["+t+"] does not match the input size.");return function t(e,n,r){var o=new Array;if(1===n.length)for(var a=n[0],i=0;i<a;i++)o[i]=r[e+i];else{a=n[0];var s=n.slice(1),u=s.reduce((function(t,e){return t*e}));for(i=0;i<a;i++)o[i]=t(e+i*u,s,r)}return o}(0,t,e)}function ot(t,e){for(var n=at(t,e),r=0;r<n.length;r++)n[r]=1;return n}function at(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error("Unknown data type "+e)}function st(){return i().platform.now()}function ut(t){t.forEach((function(e){A(Number.isInteger(e)&&e>=0,(function(){return"Tensor must have a shape comprised of positive integers but got shape ["+t+"]."}))}))}function rt(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",i().platform.encode(t,e)}function ct(t,e){return void 0===e&&(e="utf-8"),e=e||"utf-8",i().platform.decode(t,e)}function lt(t,e,n){if(0===e)return 0;if(1===e)return t[0];for(var r=t[t.length-1],o=0;o<t.length-1;++o)r+=n[o]*t[o];return r}function ht(t,e,n){if(0===e)return[];if(1===e)return[t];for(var r=new Array(e),o=0;o<r.length-1;++o)r[o]=Math.floor(t/n[o]),t-=r[o]*n[o];return r[r.length-1]=t,r}var pt=Object.freeze({shuffle:M,clamp:E,nearestLargerEven:b,sum:T,randUniform:function(t,e){var n=Math.random();return e*n+(1-n)*t},distSquared:function(t,e){for(var n=0,r=0;r<t.length;r++){var o=Number(t[r])-Number(e[r]);n+=o*o}return n},assert:A,assertShapesMatch:C,assertNonNull:R,flatten:I,sizeFromShape:N,isScalarShape:function(t){return 0===t.length},arraysEqual:O,isInt:D,tanh:L,sizeToSquarishShape:k,createShuffledIndices:function(t){for(var e=new Uint32Array(t),n=0;n<t;++n)e[n]=n;return M(e),e},rightPad:P,repeatedTry:F,inferFromImplicitShape:B,parseAxisParam:z,squeezeShape:U,getTypedArrayFromDType:V,getArrayFromDType:G,checkConversionForErrors:H,isValidDtype:j,hasEncodingLoss:W,isTypedArray:X,bytesPerElement:Y,bytesFromStringArray:K,isString:J,isBoolean:q,isNumber:Z,inferDtype:Q,isFunction:$,nearestDivisor:tt,computeStrides:et,toTypedArray:nt,toNestedArray:it,makeOnesTypedArray:ot,makeZerosTypedArray:at,now:st,assertNonNegativeIntegerDimensions:ut,fetch:function(t,e){return i().platform.fetch(t,e)},encodeString:rt,decodeString:ct,locToIndex:lt,indexToLoc:ht}),ft=function(){function t(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new mt)}return t.prototype.profileKernel=function(t,e,n){var r,o=this,a=this.backendTimer.time((function(){r=n()}));return r.forEach((function(n){n.data().then((function(r){!function(t,e,n){if("float32"!==e)return!1;for(var r=0;r<t.length;r++){var o=t[r];if(isNaN(o)||!isFinite(o))return console.warn("Found "+o+" in the result of '"+n+"'"),!0}}(r,n.dtype,t),a.then((function(a){var i="";null!=a.getExtraProfileInfo&&(i=a.getExtraProfileInfo()),o.logger.logKernelProfile(t,n,r,a.kernelMs,e,i)}))}))})),r},t}(),mt=function(){function t(){}return t.prototype.logKernelProfile=function(t,e,n,r,o,a){var i="number"==typeof r?P(r+"ms",9):r.error,s=P(t,25),u=e.rank,c=e.size,l=P(e.shape.toString(),14),h="";for(var d in o){var f=o[d].shape||e.shape,p=f.length;h+=d+": "+p+"D "+(p>0?f:"")+" "}console.log("%c"+s+"\t%c"+i+"\t%c"+u+"D "+l+"\t%c"+c+"\t%c"+h+"\t%c"+a,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")},t}();function gt(t,e,n){return P(Array.isArray(t)?parseFloat(t[0].toFixed(7))+" + "+parseFloat(t[1].toFixed(7))+"j":J(t)?"'"+t+"'":"bool"===n?vt(t):parseFloat(t.toFixed(7)).toString(),e)}function vt(t){return 0===t?"false":"true"}function yt(t){for(var e=[],n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}var xt=function(){function t(t,e,n){var r=this;if(this.dtype=e,this.shape=t.slice(),this.size=N(t),null!=n){var o=n.length;A(o===this.size,(function(){return"Length of values '"+o+"' does not match the size inferred by the shape '"+r.size+"'."}))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||G(e,this.size),this.strides=et(t)}return t.prototype.set=function(t){for(var e=this,n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];0===n.length&&(n=[0]),A(n.length===this.rank,(function(){return"The number of provided coordinates ("+n.length+") must match the rank ("+e.rank+")"}));var o=this.locToIndex(n);this.values[o]=t},t.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];0===t.length&&(t=[0]);for(var n=0,r=0,o=t;r<o.length;r++){var a=o[r];if(a<0||a>=this.shape[n]){var i="Requested out of range element at "+t+".   Buffer shape="+this.shape;throw new Error(i)}n++}for(var s=t[t.length-1],u=0;u<t.length-1;++u)s+=this.strides[u]*t[u];return this.values[s]},t.prototype.locToIndex=function(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];for(var e=t[t.length-1],n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e},t.prototype.indexToLoc=function(t){if(0===this.rank)return[];if(1===this.rank)return[t];for(var e=new Array(this.shape.length),n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.toTensor=function(){return bt().makeTensor(this.values,this.shape,this.dtype)},t}(),bt=null,wt=null,_t=null,St=function(){function t(t,e,n,r){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=N(t),this.strides=et(t),this.dataId=n,this.id=r,this.rankType=this.rank<5?this.rank.toString():"higher"}return t.prototype.flatten=function(){return this.throwIfDisposed(),this.as1D()},t.prototype.asScalar=function(){return this.throwIfDisposed(),A(1===this.size,(function(){return"The array must have only 1 element."})),this.reshape([])},t.prototype.as1D=function(){return this.throwIfDisposed(),this.reshape([this.size])},t.prototype.as2D=function(t,e){return this.throwIfDisposed(),this.reshape([t,e])},t.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),this.reshape([t,e,n])},t.prototype.as4D=function(t,e,n,r){return this.throwIfDisposed(),this.reshape([t,e,n,r])},t.prototype.as5D=function(t,e,n,r,o){return this.throwIfDisposed(),this.reshape([t,e,n,r,o])},t.prototype.asType=function(t){return this.throwIfDisposed(),wt.cast(this,t)},Object.defineProperty(t.prototype,"rank",{get:function(){return this.shape.length},enumerable:!0,configurable:!0}),t.prototype.buffer=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,wt.buffer(this.shape,this.dtype,t)]}}))}))},t.prototype.bufferSync=function(){return wt.buffer(this.shape,this.dtype,this.dataSync())},t.prototype.array=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return[4,this.data()];case 1:return t=e.sent(),[2,it(this.shape,t)]}}))}))},t.prototype.arraySync=function(){return it(this.shape,this.dataSync())},t.prototype.data=function(){return d(this,void 0,void 0,(function(){var t,e;return f(this,(function(n){switch(n.label){case 0:return this.throwIfDisposed(),t=bt().read(this.dataId),"string"!==this.dtype?[3,2]:[4,t];case 1:e=n.sent();try{return[2,e.map((function(t){return ct(t)}))]}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}n.label=2;case 2:return[2,t]}}))}))},t.prototype.dataSync=function(){this.throwIfDisposed();var t=bt().readSync(this.dataId);if("string"===this.dtype)try{return t.map((function(t){return ct(t)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t},t.prototype.bytes=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return this.throwIfDisposed(),[4,bt().read(this.dataId)];case 1:return t=e.sent(),"string"===this.dtype?[2,t]:[2,new Uint8Array(t.buffer)]}}))}))},t.prototype.dispose=function(){this.isDisposed||(bt().disposeTensor(this),this.isDisposedInternal=!0)},Object.defineProperty(t.prototype,"isDisposed",{get:function(){return this.isDisposedInternal},enumerable:!0,configurable:!0}),t.prototype.throwIfDisposed=function(){if(this.isDisposed)throw new Error("Tensor is disposed.")},t.prototype.toFloat=function(){return this.asType("float32")},t.prototype.toInt=function(){return this.asType("int32")},t.prototype.toBool=function(){return this.asType("bool")},t.prototype.print=function(t){return void 0===t&&(t=!1),wt.print(this,t)},t.prototype.reshape=function(t){return this.throwIfDisposed(),wt.reshape(this,t)},t.prototype.reshapeAs=function(t){return this.throwIfDisposed(),this.reshape(t.shape)},t.prototype.expandDims=function(t){return void 0===t&&(t=0),wt.expandDims(this,t)},t.prototype.cumsum=function(t,e,n){return void 0===t&&(t=0),void 0===e&&(e=!1),void 0===n&&(n=!1),wt.cumsum(this,t,e,n)},t.prototype.squeeze=function(t){return this.throwIfDisposed(),wt.squeeze(this,t)},t.prototype.clone=function(){return this.throwIfDisposed(),wt.clone(this)},t.prototype.toString=function(t){return void 0===t&&(t=!1),function(t,e,n,r){var o=et(e),a=function(t,e,n,r){var o=N(e),a=r[r.length-1],i=new Array(a).fill(0),s=e.length,u="complex64"===n?yt(t):t;if(s>1)for(var c=0;c<o/a;c++)for(var l=c*a,h=0;h<a;h++)i[h]=Math.max(i[h],gt(u[l+h],0,n).length);return i}(t,e,n,o),i=e.length,s=function t(e,n,r,o,a,i){void 0===i&&(i=!0);var s="complex64"===r?2:1,u=n[0],c=n.length;if(0===c)return"complex64"===r?[gt(yt(e)[0],0,r)]:"bool"===r?[vt(e[0])]:[e[0].toString()];if(1===c){if(u>20){var l=3*s,h=Array.from(e.slice(0,l)),d=Array.from(e.slice((u-3)*s,u*s));return"complex64"===r&&(h=yt(h),d=yt(d)),["["+h.map((function(t,e){return gt(t,a[e],r)})).join(", ")+", ..., "+d.map((function(t,e){return gt(t,a[u-3+e],r)})).join(", ")+"]"]}return["["+("complex64"===r?yt(e):Array.from(e)).map((function(t,e){return gt(t,a[e],r)})).join(", ")+"]"]}var f=n.slice(1),p=o.slice(1),m=o[0]*s,g=[];if(u>20){for(var v=0;v<3;v++){var y=(x=v*m)+m;g.push.apply(g,t(e.slice(x,y),f,r,p,a,!1))}for(g.push("..."),v=u-3;v<u;v++)y=(x=v*m)+m,g.push.apply(g,t(e.slice(x,y),f,r,p,a,v===u-1))}else for(v=0;v<u;v++){var x;y=(x=v*m)+m,g.push.apply(g,t(e.slice(x,y),f,r,p,a,v===u-1))}var b=2===c?",":"";for(g[0]="["+g[0]+b,v=1;v<g.length-1;v++)g[v]=" "+g[v]+b;var w=",\n";for(v=2;v<c;v++)w+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":w),g}(t,e,n,o,a),u=["Tensor"];return r&&(u.push("  dtype: "+n),u.push("  rank: "+i),u.push("  shape: ["+e+"]"),u.push("  values:")),u.push(s.map((function(t){return"    "+t})).join("\n")),u.join("\n")}(this.dataSync(),this.shape,this.dtype,t)},t.prototype.gather=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wt.gather(this,t,e)},t.prototype.matMul=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n=!1),this.throwIfDisposed(),wt.matMul(this,t,e,n)},t.prototype.dot=function(t){return this.throwIfDisposed(),wt.dot(this,t)},t.prototype.norm=function(t,e,n){return void 0===t&&(t="euclidean"),void 0===e&&(e=null),void 0===n&&(n=!1),this.throwIfDisposed(),wt.norm(this,t,e,n)},t.prototype.slice=function(t,e){return this.throwIfDisposed(),wt.slice(this,t,e)},t.prototype.reverse=function(t){return this.throwIfDisposed(),wt.reverse(this,t)},t.prototype.concat=function(e,n){return void 0===n&&(n=0),this.throwIfDisposed(),e instanceof t&&(e=[e]),wt.concat([this].concat(e),n)},t.prototype.split=function(t,e){return void 0===e&&(e=0),this.throwIfDisposed(),wt.split(this,t,e)},t.prototype.stack=function(t,e){return void 0===e&&(e=0),wt.stack([this,t],e)},t.prototype.unstack=function(t){return void 0===t&&(t=0),wt.unstack(this,t)},t.prototype.batchNormalization=function(t,e,n,r,o){return void 0===n&&(n=.001),_t("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon"),this.batchNorm(t,e,o,r,n)},t.prototype.all=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.all(this,t,e)},t.prototype.any=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.any(this,t,e)},t.prototype.logSumExp=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.logSumExp(this,t,e)},t.prototype.sum=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.sum(this,t,e)},t.prototype.prod=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.prod(this,t,e)},t.prototype.mean=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.mean(this,t,e)},t.prototype.min=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.min(this,t,e)},t.prototype.max=function(t,e){return void 0===t&&(t=null),void 0===e&&(e=!1),this.throwIfDisposed(),wt.max(this,t,e)},t.prototype.argMin=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wt.argMin(this,t)},t.prototype.argMax=function(t){return void 0===t&&(t=null),this.throwIfDisposed(),wt.argMax(this,t)},t.prototype.cast=function(t){return this.throwIfDisposed(),wt.cast(this,t)},t.prototype.addStrict=function(t){return this.throwIfDisposed(),wt.addStrict(this,t)},t.prototype.atan2=function(t){return this.throwIfDisposed(),wt.atan2(this,t)},t.prototype.sub=function(t){return this.throwIfDisposed(),wt.sub(this,t)},t.prototype.subStrict=function(t){return this.throwIfDisposed(),wt.subStrict(this,t)},t.prototype.pow=function(t){return this.throwIfDisposed(),wt.pow(this,t)},t.prototype.powStrict=function(t){return this.throwIfDisposed(),wt.powStrict(this,t)},t.prototype.mul=function(t){return this.throwIfDisposed(),wt.mul(this,t)},t.prototype.mulStrict=function(t){return this.throwIfDisposed(),wt.mulStrict(this,t)},t.prototype.floorDiv=function(t){return this.throwIfDisposed(),wt.floorDiv(this,t)},t.prototype.divStrict=function(t){return this.throwIfDisposed(),wt.divStrict(this,t)},t.prototype.minimum=function(t){return this.throwIfDisposed(),wt.minimum(this,t)},t.prototype.minimumStrict=function(t){return this.throwIfDisposed(),wt.minimumStrict(this,t)},t.prototype.maximum=function(t){return this.throwIfDisposed(),wt.maximum(this,t)},t.prototype.maximumStrict=function(t){return this.throwIfDisposed(),wt.maximumStrict(this,t)},t.prototype.mod=function(t){return this.throwIfDisposed(),wt.mod(this,t)},t.prototype.modStrict=function(t){return this.throwIfDisposed(),wt.modStrict(this,t)},t.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),wt.squaredDifferenceStrict(this,t)},t.prototype.notEqual=function(t){return this.throwIfDisposed(),wt.notEqual(this,t)},t.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),wt.notEqualStrict(this,t)},t.prototype.less=function(t){return this.throwIfDisposed(),wt.less(this,t)},t.prototype.lessStrict=function(t){return this.throwIfDisposed(),wt.lessStrict(this,t)},t.prototype.equal=function(t){return this.throwIfDisposed(),wt.equal(this,t)},t.prototype.equalStrict=function(t){return this.throwIfDisposed(),wt.equalStrict(this,t)},t.prototype.lessEqual=function(t){return this.throwIfDisposed(),wt.lessEqual(this,t)},t.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),wt.lessEqualStrict(this,t)},t.prototype.greater=function(t){return this.throwIfDisposed(),wt.greater(this,t)},t.prototype.greaterStrict=function(t){return this.throwIfDisposed(),wt.greaterStrict(this,t)},t.prototype.greaterEqual=function(t){return this.throwIfDisposed(),wt.greaterEqual(this,t)},t.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),wt.greaterEqualStrict(this,t)},t.prototype.logicalAnd=function(t){return this.throwIfDisposed(),wt.logicalAnd(this,t)},t.prototype.logicalOr=function(t){return this.throwIfDisposed(),wt.logicalOr(this,t)},t.prototype.logicalNot=function(){return this.throwIfDisposed(),wt.logicalNot(this)},t.prototype.logicalXor=function(t){return this.throwIfDisposed(),wt.logicalXor(this,t)},t.prototype.where=function(t,e){return this.throwIfDisposed(),wt.where(t,this,e)},t.prototype.neg=function(){return this.throwIfDisposed(),wt.neg(this)},t.prototype.ceil=function(){return this.throwIfDisposed(),wt.ceil(this)},t.prototype.floor=function(){return this.throwIfDisposed(),wt.floor(this)},t.prototype.sign=function(){return this.throwIfDisposed(),wt.sign(this)},t.prototype.isNaN=function(){return this.throwIfDisposed(),wt.isNaN(this)},t.prototype.isInf=function(){return this.throwIfDisposed(),wt.isInf(this)},t.prototype.isFinite=function(){return this.throwIfDisposed(),wt.isFinite(this)},t.prototype.exp=function(){return this.throwIfDisposed(),wt.exp(this)},t.prototype.expm1=function(){return this.throwIfDisposed(),wt.expm1(this)},t.prototype.log=function(){return this.throwIfDisposed(),wt.log(this)},t.prototype.log1p=function(){return this.throwIfDisposed(),wt.log1p(this)},t.prototype.sqrt=function(){return this.throwIfDisposed(),wt.sqrt(this)},t.prototype.rsqrt=function(){return this.throwIfDisposed(),wt.rsqrt(this)},t.prototype.square=function(){return this.throwIfDisposed(),wt.square(this)},t.prototype.reciprocal=function(){return this.throwIfDisposed(),wt.reciprocal(this)},t.prototype.abs=function(){return this.throwIfDisposed(),wt.abs(this)},t.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),wt.clipByValue(this,t,e)},t.prototype.relu=function(){return this.throwIfDisposed(),wt.relu(this)},t.prototype.relu6=function(){return this.throwIfDisposed(),wt.relu6(this)},t.prototype.elu=function(){return this.throwIfDisposed(),wt.elu(this)},t.prototype.selu=function(){return this.throwIfDisposed(),wt.selu(this)},t.prototype.leakyRelu=function(t){return void 0===t&&(t=.2),this.throwIfDisposed(),wt.leakyRelu(this,t)},t.prototype.prelu=function(t){return this.throwIfDisposed(),wt.prelu(this,t)},t.prototype.sigmoid=function(){return this.throwIfDisposed(),wt.sigmoid(this)},t.prototype.logSigmoid=function(){return this.throwIfDisposed(),wt.logSigmoid(this)},t.prototype.softplus=function(){return this.throwIfDisposed(),wt.softplus(this)},t.prototype.zerosLike=function(){return this.throwIfDisposed(),wt.zerosLike(this)},t.prototype.onesLike=function(){return this.throwIfDisposed(),wt.onesLike(this)},t.prototype.sin=function(){return this.throwIfDisposed(),wt.sin(this)},t.prototype.cos=function(){return this.throwIfDisposed(),wt.cos(this)},t.prototype.tan=function(){return this.throwIfDisposed(),wt.tan(this)},t.prototype.asin=function(){return this.throwIfDisposed(),wt.asin(this)},t.prototype.acos=function(){return this.throwIfDisposed(),wt.acos(this)},t.prototype.atan=function(){return this.throwIfDisposed(),wt.atan(this)},t.prototype.sinh=function(){return this.throwIfDisposed(),wt.sinh(this)},t.prototype.cosh=function(){return this.throwIfDisposed(),wt.cosh(this)},t.prototype.tanh=function(){return this.throwIfDisposed(),wt.tanh(this)},t.prototype.asinh=function(){return this.throwIfDisposed(),wt.asinh(this)},t.prototype.acosh=function(){return this.throwIfDisposed(),wt.acosh(this)},t.prototype.atanh=function(){return this.throwIfDisposed(),wt.atanh(this)},t.prototype.erf=function(){return this.throwIfDisposed(),wt.erf(this)},t.prototype.round=function(){return this.throwIfDisposed(),wt.round(this)},t.prototype.step=function(t){return void 0===t&&(t=0),this.throwIfDisposed(),wt.step(this,t)},t.prototype.softmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wt.softmax(this,t)},t.prototype.logSoftmax=function(t){return void 0===t&&(t=-1),this.throwIfDisposed(),wt.logSoftmax(this,t)},t.prototype.resizeBilinear=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wt.image.resizeBilinear(this,t,e)},t.prototype.resizeNearestNeighbor=function(t,e){return void 0===e&&(e=!1),this.throwIfDisposed(),wt.image.resizeNearestNeighbor(this,t,e)},t.prototype.conv1d=function(t,e,n,r,o,a){return void 0===r&&(r="NWC"),void 0===o&&(o=1),this.throwIfDisposed(),wt.conv1d(this,t,e,n,r,o,a)},t.prototype.conv2d=function(t,e,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wt.conv2d(this,t,e,n,r,o,a)},t.prototype.conv2dTranspose=function(t,e,n,r,o){return this.throwIfDisposed(),wt.conv2dTranspose(this,t,e,n,r,o)},t.prototype.depthwiseConv2D=function(t,e,n,r,o,a){return void 0===r&&(r="NHWC"),void 0===o&&(o=[1,1]),this.throwIfDisposed(),wt.depthwiseConv2d(this,t,e,n,r,o,a)},t.prototype.separableConv2d=function(t,e,n,r,o,a){return void 0===o&&(o=[1,1]),void 0===a&&(a="NHWC"),this.throwIfDisposed(),wt.separableConv2d(this,t,e,n,r,o,a)},t.prototype.avgPool=function(t,e,n,r){return this.throwIfDisposed(),wt.avgPool(this,t,e,n,r)},t.prototype.maxPool=function(t,e,n,r){return this.throwIfDisposed(),wt.maxPool(this,t,e,n,r)},t.prototype.localResponseNormalization=function(t,e,n,r){return void 0===t&&(t=5),void 0===e&&(e=1),void 0===n&&(n=1),void 0===r&&(r=.5),wt.localResponseNormalization(this,t,e,n,r)},t.prototype.pool=function(t,e,n,r,o){return this.throwIfDisposed(),wt.pool(this,t,e,n,r,o)},t.prototype.variable=function(t,e,n){return void 0===t&&(t=!0),this.throwIfDisposed(),bt().makeVariable(this,t,e,n)},t.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),wt.unsortedSegmentSum(this,t,e)},t.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),wt.batchToSpaceND(this,t,e)},t.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),wt.spaceToBatchND(this,t,e)},t.prototype.topk=function(t,e){return void 0===t&&(t=1),void 0===e&&(e=!0),this.throwIfDisposed(),wt.topk(this,t,e)},t.prototype.stridedSlice=function(t,e,n,r,o,a,i,s){return void 0===r&&(r=0),void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),this.throwIfDisposed(),wt.stridedSlice(this,t,e,n,r,o,a,i,s)},t.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),wt.depthToSpace(this,t,e)},t.prototype.fft=function(){return this.throwIfDisposed(),wt.spectral.fft(this)},t.prototype.ifft=function(){return this.throwIfDisposed(),wt.spectral.ifft(this)},t.prototype.rfft=function(){return this.throwIfDisposed(),wt.spectral.rfft(this)},t.prototype.irfft=function(){return this.throwIfDisposed(),wt.spectral.irfft(this)},t}();Object.defineProperty(St,Symbol.hasInstance,{value:function(t){return!!t&&null!=t.dataId&&null!=t.shape&&null!=t.dtype}});var Mt,Et,Tt,At,Ct,Rt=function(t){function e(e,n,r,o){var a=t.call(this,e.shape,e.dtype,e.dataId,o)||this;return a.trainable=n,a.name=r,a}return h(e,t),e.prototype.assign=function(t){if(t.dtype!==this.dtype)throw new Error("dtype of the new value ("+t.dtype+") and previous value ("+this.dtype+") must match");if(!O(t.shape,this.shape))throw new Error("shape of the new value ("+t.shape+") and previous value ("+this.shape+") must match");bt().disposeTensor(this),this.dataId=t.dataId,bt().incRef(this,null)},e.prototype.dispose=function(){bt().disposeVariable(this),this.isDisposedInternal=!0},e}(St);Object.defineProperty(Rt,Symbol.hasInstance,{value:function(t){return t instanceof St&&null!=t.assign&&t.assign instanceof Function}}),function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"}(Mt||(Mt={})),function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"}(Et||(Et={})),function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"}(Tt||(Tt={})),function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"}(At||(At={})),function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"}(Ct||(Ct={}));var It={float32:At,int32:Et,bool:Tt,complex64:Ct};function Nt(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error("Can not upcast "+t+" with "+e)}return It[t][e]}function Ot(t){return Nt(t,"int32")}function Dt(t,e){if(t.dtype===e.dtype)return[t,e];var n=Nt(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function Lt(t,e){A(t.dtype===e.dtype,(function(){return"The dtypes of the first("+t.dtype+") and second("+e.dtype+") input must match"}))}function kt(t){var e=[];return function t(e,n,r){if(null!=e)if(e instanceof St)n.push(e);else if(o=e,Array.isArray(o)||"object"==typeof o){var o,a=e;for(var i in a){var s=a[i];r.has(s)||(r.add(s),t(s,n,r))}}}(t,e,new Set),e}Object.freeze({makeTypesMatch:Dt,assertTypesMatch:Lt,isTensorInList:function(t,e){return e.some((function(e){return e.id===t.id}))},getTensorsInContainer:kt});var Pt,Ft=function(){function t(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null}}return t.prototype.dispose=function(){for(var t in this.registeredVariables)this.registeredVariables[t].dispose()},t}(),Bt=function(){function t(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Ft}return t.prototype.ready=function(){return d(this,void 0,void 0,(function(){var t,e,n;return f(this,(function(r){switch(r.label){case 0:if(null!=this.pendingBackendInit)return[2,this.pendingBackendInit.then((function(){}))];if(null!=this.backendInstance)return[2];t=this.getSortedBackends(),e=0,r.label=1;case 1:return e<t.length?(n=t[e],[4,this.initializeBackend(n).success]):[3,5];case 2:return r.sent()?[4,this.setBackend(n)]:[3,4];case 3:return r.sent(),[2];case 4:return e++,[3,1];case 5:throw new Error("Could not initialize any backends, all backend initializations failed.")}}))}))},Object.defineProperty(t.prototype,"backend",{get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '"+this.backendName+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var t=this.initializeBackendsAndReturnBest(),e=t.name;if(t.asyncInit)throw new Error("The highest priority backend '"+e+"' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(e)}return this.backendInstance},enumerable:!0,configurable:!0}),t.prototype.backendNames=function(){return Object.keys(this.registryFactory)},t.prototype.findBackend=function(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;if(this.initializeBackend(t).asyncInit)return null}return this.registry[t]},t.prototype.findBackendFactory=function(t){return t in this.registryFactory?this.registryFactory[t].factory:null},t.prototype.registerBackend=function(t,e,n){return void 0===n&&(n=1),t in this.registryFactory?(console.warn(t+" backend was already registered. Reusing existing backend factory."),!1):(this.registryFactory[t]={factory:e,priority:n},!0)},t.prototype.setBackend=function(t){return d(this,void 0,void 0,(function(){var e,n,r;return f(this,(function(o){switch(o.label){case 0:if(null==this.registryFactory[t])throw new Error("Backend name '"+t+"' not found in registry");return this.backendName=t,null!=this.registry[t]?[3,4]:(this.backendInstance=null,e=this.initializeBackend(t),n=e.success,e.asyncInit?[4,n]:[3,2]);case 1:return r=o.sent(),[3,3];case 2:r=n,o.label=3;case 3:if(!r)return[2,!1];o.label=4;case 4:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ft(this.backendInstance),[2,!0]}}))}))},t.prototype.setupRegisteredKernels=function(){var t=this;w(this.backendName).forEach((function(e){null!=e.setupFunc&&e.setupFunc(t.backendInstance)}))},t.prototype.disposeRegisteredKernels=function(t){var e=this;w(t).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(e.registry[t])}))},t.prototype.initializeBackend=function(t){var e=this,n=this.registryFactory[t];if(null==n)throw new Error("Cannot initialize backend "+t+", no registration found.");try{var r=n.factory();if(Promise.resolve(r)===r){var o=++this.pendingBackendInitId,a=r.then((function(n){return!(o<e.pendingBackendInitId||(e.registry[t]=n,e.pendingBackendInit=null,0))})).catch((function(n){return!(o<e.pendingBackendInitId||(e.pendingBackendInit=null,console.warn("Initialization of backend "+t+" failed"),console.warn(n.stack||n.message),1))}));return this.pendingBackendInit=a,{success:a,asyncInit:!0}}return this.registry[t]=r,{success:!0,asyncInit:!1}}catch(e){return console.warn("Initialization of backend "+t+" failed"),console.warn(e.stack||e.message),{success:!1,asyncInit:!1}}},t.prototype.removeBackend=function(t){if(!(t in this.registryFactory))throw new Error(t+" backend not found in registry");this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)},t.prototype.getSortedBackends=function(){var t=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(e,n){return t.registryFactory[n].priority-t.registryFactory[e].priority}))},t.prototype.initializeBackendsAndReturnBest=function(){for(var t=this.getSortedBackends(),e=0;e<t.length;e++){var n=t[e],r=this.initializeBackend(n),o=r.success,a=r.asyncInit;if(a||o)return{name:n,asyncInit:a}}throw new Error("Could not initialize any backends, all backend initializations failed.")},t.prototype.moveData=function(t,e){var n=this.state.tensorInfo.get(e),r=n.backend,o=this.readSync(e);r.disposeData(e),n.backend=t,t.move(e,o,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++},t.prototype.tidy=function(t,e){var n,r=this,o=null;if(null==e){if("function"!=typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!=typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!=typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");o=t}return this.scopedRun((function(){return r.startScope(o)}),(function(){return r.endScope(n)}),(function(){return(n=e())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))},t.prototype.scopedRun=function(t,e,n){t();try{var r=n();return e(),r}catch(t){throw e(),t}},t.prototype.nextTensorId=function(){return t.nextTensorId++},t.prototype.nextVariableId=function(){return t.nextVariableId++},t.prototype.clone=function(t){var e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t};return this.addTapeNode(this.state.activeScope.name,n,[e],(function(t){return{x:function(){return t.toFloat()}}}),[],{}),e},t.prototype.runKernel=function(t,e,n,r,o){return this.runKernelFunc(null,e,null,t,n,r,o)},t.prototype.shouldCheckForMemLeaks=function(){return this.ENV.getBool("IS_TEST")},t.prototype.checkKernelForMemLeak=function(t,e,n){var r=this.backend.numDataIds(),o=0;n.forEach((function(t){o+="complex64"===t.dtype?3:1}));var a=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],i=r-e-o-a;if(i>0)throw new Error("Backend '"+this.backendName+"' has an internal memory leak ("+i+" data ids) after running '"+t+"'")},t.prototype.runKernelFunc=function(t,e,n,r,o,a,i){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,d=this.state.numBytes,p=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);var f,g=y(r,this.backendName);if(null!=g)h=function(){var t=u.backend.numDataIds();f=g.kernelFunc({inputs:e,attrs:o,backend:u.backend});var n=Array.isArray(f)?f:[f];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n);var s=n.map((function(t){var e=t.dataId,n=t.shape,r=t.dtype;return u.makeTensorFromDataId(e,n,r)}));if(l){var h=u.getTensorsForGradient(r,e,s);if(null==h){null==i&&(i=[]);var d=s.filter((function(t,e){return i[e]}));h=(a||[]).slice().concat(d)}c=u.saveTensorsForBackwardMode(h)}return s};else{var m=function(t){l&&(c=t.map((function(t){return u.keep(u.clone(t))})))};h=function(){var e=u.backend.numDataIds();f=u.tidy((function(){return t(u.backend,m)}));var n=Array.isArray(f)?f:[f];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){s=u.ENV.getBool("DEBUG")?u.profiler.profileKernel(r,e,(function(){return h()})):h()})),l&&this.addTapeNode(r,e,s,n,c,o),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-d,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-p,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map((function(t){return e[t].shape})),outputShapes:s.map((function(t){return t.shape}))}),Array.isArray(f)?s:s[0]},t.prototype.saveTensorsForBackwardMode=function(t){var e=this;return t.map((function(t){return e.keep(e.clone(t))}))},t.prototype.getTensorsForGradient=function(t,e,n){var r=x(t);if(null!=r){var o=r.inputsToSave||[],a=r.outputsToSave||[],i=void 0;r.saveAllInputs?(A(Array.isArray(e),(function(){return"saveAllInputs is true, expected inputs to be an array."})),i=Object.keys(e).map((function(t){return e[t]}))):i=o.map((function(t){return e[t]}));var s=n.filter((function(t,e){return a[e]}));return i.concat(s)}return null},t.prototype.makeTensor=function(t,e,n,r){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var o=t;"string"===n&&J(t[0])&&(o=t.map((function(t){return rt(t)})));var a=r.write(o,e,n),i=new St(e,n,a,this.nextTensorId());if(this.incRef(i,r),"string"===n){var s=this.state.tensorInfo.get(a),u=K(o);this.state.numBytes+=u-s.bytes,s.bytes=u}return i},t.prototype.makeTensorFromDataId=function(t,e,n,r){var o=new St(e,n=n||"float32",t,this.nextTensorId());return this.incRef(o,r),o},t.prototype.makeVariable=function(t,e,n,r){void 0===e&&(e=!0),n=n||this.nextVariableId().toString(),null!=r&&r!==t.dtype&&(t=t.asType(r));var o=new Rt(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[o.name])throw new Error("Variable with name "+o.name+" was already registered");return this.state.registeredVariables[o.name]=o,this.incRef(o,this.backend),o},t.prototype.incRef=function(t,e){var n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(r=t.size*Y(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Rt||this.track(t)},t.prototype.disposeTensor=function(t){if(this.state.tensorInfo.has(t.dataId)){this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;var e=this.state.tensorInfo.get(t.dataId);e.refCount<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):this.state.tensorInfo.get(t.dataId).refCount--}},t.prototype.disposeVariables=function(){for(var t in this.state.registeredVariables){var e=this.state.registeredVariables[t];this.disposeVariable(e)}},t.prototype.disposeVariable=function(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]},t.prototype.memory=function(){var t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t},t.prototype.profile=function(t){return d(this,void 0,void 0,(function(){var e,n;return f(this,(function(r){return this.state.profiling=!0,e=this.state.numBytes,n=this.state.numTensors,this.state.activeProfile.kernels=[],this.state.activeProfile.result=t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,this.state.activeProfile.kernels.map((function(t){return t.totalBytesSnapshot}))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n,[2,this.state.activeProfile]}))}))},t.prototype.isTapeOn=function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth},t.prototype.addTapeNode=function(t,e,n,r,o,a){var i=this,s={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:o},u=x(t);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(t){return t=t.map((function(t,e){if(null==t){var r=n[e],o=at(r.size,r.dtype);return i.makeTensor(o,r.shape,r.dtype)}return t})),r(t.length>1?t:t[0],o,a)}),this.state.activeTape.push(s)},t.prototype.keep=function(t){return t.kept=!0,t},t.prototype.startTape=function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++},t.prototype.endTape=function(){this.state.gradientDepth--},t.prototype.startScope=function(t){var e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e},t.prototype.endScope=function(t){for(var e=this,n=kt(t),r=new Set(n.map((function(t){return t.id}))),o=0;o<this.state.activeScope.track.length;o++){var a=this.state.activeScope.track[o];a.kept||r.has(a.id)||a.dispose()}var i=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(t){t.kept||t.scopeId!==i.id||e.track(t)}))},t.prototype.gradients=function(t,e,n,r){var o=this;if(void 0===r&&(r=!1),A(e.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '"+n.dtype+"'");var a=this.scopedRun((function(){return o.startTape()}),(function(){return o.endTape()}),(function(){return o.tidy("forward",t)}));A(a instanceof St,(function(){return"The result y returned by f() must be a tensor."}));var i=function(t,e,n){for(var r={},o={},a=0;a<e.length;a++)r[e[a].id]=!0;for(a=0;a<t.length;a++){var i=(p=t[a]).inputs;for(var s in i){for(var u=i[s],c=!1,l=0;l<e.length;l++)if(r[u.id]){p.outputs.forEach((function(t){return r[t.id]=!0})),c=!0,o[p.id]=!0;break}if(c)break}}var h={};h[n.id]=!0;var d={};for(a=t.length-1;a>=0;a--)for(i=(p=t[a]).inputs,l=0;l<p.outputs.length;l++)if(h[p.outputs[l].id]){for(var s in i)h[i[s].id]=!0,d[p.id]=!0;break}var f=[];for(a=0;a<t.length;a++){var p;if(o[(p=t[a]).id]&&d[p.id]){var m={};for(var s in p.inputs){var g=p.inputs[s];r[g.id]&&(m[s]=g)}var v=Object.assign({},p);v.inputs=m,v.outputs=p.outputs,f.push(v)}}return f}(this.state.activeTape,e,a);if(!r&&0===i.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var t,r,s={};s[a.id]=null==n?(r=ot(N(t=a.shape),"float32"),zt.makeTensor(r,t,"float32")):n,function(t,e,n){for(var r=function(r){var o=e[r],a=[];if(o.outputs.forEach((function(e){var n=t[e.id];null!=n?a.push(n):a.push(null)})),null==o.gradient)throw new Error("Cannot compute gradient: gradient function not found for "+o.kernelName+".");var i=o.gradient(a),s=function(e){if(!(e in i))throw new Error("Cannot backprop through input "+e+". Available gradients found: "+Object.keys(i)+".");var r=n((function(){return i[e]()}));if("float32"!==r.dtype)throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input "+e+" must have 'float32' dtype, but has '"+r.dtype+"'");var a=o.inputs[e];if(!O(r.shape,a.shape))throw new Error("Error in gradient for op "+o.kernelName+". The gradient of input '"+e+"' has shape '"+r.shape+"', which does not match the shape of the input '"+a.shape+"'");if(null==t[a.id])t[a.id]=r;else{var s=t[a.id];t[a.id]=s.add(r),s.dispose()}};for(var u in o.inputs)s(u)},o=e.length-1;o>=0;o--)r(o)}(s,i,(function(t){return o.tidy(t)}));var u=e.map((function(t){return s[t.id]}));return 0===o.state.gradientDepth&&(o.state.activeTape.forEach((function(t){for(var e=0,n=t.saved;e<n.length;e++)n[e].dispose()})),o.state.activeTape=null),{value:a,grads:u}}))},t.prototype.customGrad=function(t){var e=this;return A($(t),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n,r=[],o=0;o<arguments.length;o++)r[o]=arguments[o];A(r.every((function(t){return t instanceof St})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var a={};return r.forEach((function(t,e){a[e]=t})),e.runKernelFunc((function(e,o){return A((n=t.apply(void 0,r.concat([o]))).value instanceof St,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),A($(n.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),n.value}),a,(function(t,e){var o=n.gradFunc(t,e),a=Array.isArray(o)?o:[o];A(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),A(a.every((function(t){return t instanceof St})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var i={};return a.forEach((function(t,e){i[e]=function(){return t}})),i}))}},t.prototype.readSync=function(t){return this.state.tensorInfo.get(t).backend.readSync(t)},t.prototype.read=function(t){return this.state.tensorInfo.get(t).backend.read(t)},t.prototype.time=function(t){return d(this,void 0,void 0,(function(){var e,n;return f(this,(function(r){switch(r.label){case 0:return e=st(),[4,this.backend.time(t)];case 1:return(n=r.sent()).wallMs=st()-e,[2,n]}}))}))},t.prototype.track=function(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t},Object.defineProperty(t.prototype,"registeredVariables",{get:function(){return this.state.registeredVariables},enumerable:!0,configurable:!0}),t.prototype.reset=function(){for(var t in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Ft,this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null},t.nextTensorId=0,t.nextVariableId=0,t}(),zt=function(){var e=function(){if(null==Pt){var e=void 0;if("undefined"!=typeof window)e=window;else if(void 0!==t)e=t;else if(void 0!==r)e=r;else{if("undefined"==typeof self)throw new Error("Could not find a global object");e=self}Pt=e}return Pt}();if(null==e._tfengine){var n=new m(e);e._tfengine=new Bt(n)}return function(t){s=t}(e._tfengine.ENV),bt=function(){return e._tfengine},e._tfengine}();function Ut(){return"undefined"!=typeof window&&null!=window.document||"undefined"!=typeof WorkerGlobalScope}var Vt=i();Vt.registerFlag("DEBUG",(function(){return!1}),(function(t){t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Vt.registerFlag("IS_BROWSER",(function(){return Ut()})),Vt.registerFlag("IS_NODE",(function(){return void 0!==r&&void 0!==r.versions&&void 0!==r.versions.node})),Vt.registerFlag("IS_CHROME",(function(){return"undefined"!=typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Vt.registerFlag("PROD",(function(){return!1})),Vt.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Vt.getBool("DEBUG")})),Vt.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Vt.registerFlag("IS_TEST",(function(){return!1}));var Gt,Ht,jt,Wt={},qt={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Xt(t,e){Wt[t]=e}function Yt(t){t in Wt||(Wt[t]=function(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var e=function(t){if("undefined"!=typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!=typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(t);return e.addEventListener("webglcontextlost",(function(e){e.preventDefault(),delete Wt[t]}),!1),1===t?e.getContext("webgl",qt)||e.getContext("experimental-webgl",qt):e.getContext("webgl2",qt)}(t));var e=Wt[t];return e.isContextLost()?(delete Wt[t],Yt(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),Wt[t])}function Kt(t,e){return[e,t]}function Jt(t){var e=N(t);return k(Math.ceil(e/4))}function Zt(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function Qt(t,e){var n,r,o,a,s,u,c,l,h,d=t;return 2===i().getNumber("WEBGL_VERSION")?(n=d.R32F,r=d.R16F,o=d.RGBA16F,a=d.RGBA32F,s=d.RED,u=4,c=1,l=d.HALF_FLOAT,h=d.FLOAT):(n=t.RGBA,r=t.RGBA,o=t.RGBA,a=d.RGBA,s=t.RGBA,u=4,c=4,l=null!=e?e.HALF_FLOAT_OES:null,h=t.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:o,internalFormatPackedFloat:a,textureFormatFloat:s,downloadTextureFormat:t.RGBA,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:h}}function $t(t,e,n){var r=n();return e&&function(t){var e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+ee(t,e))}(t),r}!function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"}(Gt||(Gt={})),function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"}(Ht||(Ht={})),function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(jt||(jt={}));function te(t){return!!(i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||5.96e-8<Math.abs(t)&&Math.abs(t)<65504)}function ee(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code "+e}}function ne(t,e,n){return Ee(t,e,(function(){return t.getExtension(n)}),'Extension "'+n+'" not supported on this browser.')}function re(t,e,n){var r=Ee(t,e,(function(){return t.createShader(t.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if($t(t,e,(function(){return t.shaderSource(r,n)})),$t(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function ie(t,e,n){var r=Ee(t,e,(function(){return t.createShader(t.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if($t(t,e,(function(){return t.shaderSource(r,n)})),$t(t,e,(function(){return t.compileShader(r)})),!1===t.getShaderParameter(r,t.COMPILE_STATUS))throw function(t,e){var n=se.exec(e);if(null==n)return console.log("Couldn't parse line number in error: "+e),void console.log(t);for(var r=+n[1],o=t.split("\n"),a=o.length.toString().length+2,i=o.map((function(t,e){return P((e+1).toString(),a)+t})),s=0,u=0;u<i.length;u++)s=Math.max(i[u].length,s);var c=i.slice(0,r-1),l=i.slice(r-1,r),h=i.slice(r);console.log(c.join("\n")),console.log(e.split("\n")[0]),console.log("%c "+P(l[0],s),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(n,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var oe,ae,se=/ERROR: [0-9]+:([0-9]+):/g;function ue(t,e){return Ee(t,e,(function(){return t.createProgram()}),"Unable to create WebGLProgram.")}function ce(t,e,n){if($t(t,e,(function(){return t.linkProgram(n)})),!1===t.getProgramParameter(n,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Failed to link vertex and fragment shaders.")}function le(t,e,n){if($t(t,e,(function(){return t.validateProgram(n)})),!1===t.getProgramParameter(n,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(n)),new Error("Shader program validation failed.")}function he(t,e,n){var r=Ee(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return $t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),$t(t,e,(function(){return t.bufferData(t.ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function pe(t,e,n){var r=Ee(t,e,(function(){return t.createBuffer()}),"Unable to create WebGLBuffer");return $t(t,e,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)})),$t(t,e,(function(){return t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,t.STATIC_DRAW)})),r}function de(t,e){return Ee(t,e,(function(){return t.createTexture()}),"Unable to create WebGLTexture.")}function fe(t,e){var n=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){var r="["+t+"x"+e+"]";throw new Error("Requested texture size "+r+" is invalid.")}if(t>n||e>n)throw r="["+t+"x"+e+"]",new Error("Requested texture size "+r+" greater than WebGL maximum on this browser / GPU ["+n+"x"+n+"].")}function me(t,e){return Ee(t,e,(function(){return t.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}function ge(t,e,n,r,o,a,i,s){var u=t.getAttribLocation(n,r);return-1!==u&&($t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,o)})),$t(t,e,(function(){return t.vertexAttribPointer(u,a,t.FLOAT,!1,i,s)})),$t(t,e,(function(){return t.enableVertexAttribArray(u)})),!0)}function ve(t,e,n,r){Te(t,r),$t(t,e,(function(){return t.activeTexture(t.TEXTURE0+r)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)}))}function ye(t,e,n,r){return Ee(t,e,(function(){return t.getUniformLocation(n,r)}),'uniform "'+r+'" not present in program.')}function xe(t,e,n){return t.getUniformLocation(e,n)}function be(t,e,n,r,o,a){$t(t,e,(function(){return ve(t,e,r,a)})),$t(t,e,(function(){return t.uniform1i(o,a)}))}function we(t,e,n,r){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,r)})),$t(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}))}function _e(t,e,n){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,n)})),$t(t,e,(function(){return t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)}))}function Se(t){var e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Me(t,e))}function Me(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error "+e}}function Ee(t,e,n,r){var o=$t(t,e,(function(){return n()}));if(null==o)throw new Error(r);return o}function Te(t,e){var n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=e+t.TEXTURE0;if(r<t.TEXTURE0||r>n)throw new Error("textureUnit must be in [gl.TEXTURE0, gl.TEXTURE"+n+"].")}function Ae(t,e){return void 0===e&&(e=2),N(t.slice(0,t.length-e))}function Ce(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function Re(t){var e=[1,1,1];return 0===t.length||1===t.length&&1===t[0]||(e=[Ae(t)].concat(Ce(t))),e}function Ie(t,e){var n;void 0===e&&(e=!1);var r=i().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(r*=2,1===(t=t.map((function(e,n){return n>=t.length-2?b(t[n]):t[n]}))).length&&(t=[2,t[0]])),2!==t.length){var o=U(t);t=o.newShape}var a=N(t);if(t.length<=1&&a<=r)return[1,a];if(2===t.length&&t[0]<=r&&t[1]<=r)return t;if(3===t.length&&t[0]*t[1]<=r&&t[2]<=r)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=r&&t[1]*t[2]<=r)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=r&&t[3]<=r)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=r&&t[1]*t[2]*t[3]<=r)return[t[0],t[1]*t[2]*t[3]];if(e){var s=Ae(t),u=2,c=2;return t.length&&(u=(n=Ce(t))[0],c=n[1]),k(a=s*(u/2)*(c/2)).map((function(t){return 2*t}))}return k(a)}function Ne(t){return t%2==0}function Oe(t,e){if(O(t=t.slice(-2),e=e.slice(-2)))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){var n=t.slice(-1)[0],r=e.slice(-1)[0];if(n===r)return!0;if(Ne(n)&&Ne(r)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&Ne(t[0])&&Ne(e[0])}function De(t){if(null==oe){var e=Yt(t);oe=e.getParameter(e.MAX_TEXTURE_SIZE)}return oe}function Le(t){if(null==ae){var e=Yt(t);ae=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,ae)}function ke(t){if(0===t)return 0;var e=Yt(t);return Pe(e,"EXT_disjoint_timer_query_webgl2")&&2===t?2:Pe(e,"EXT_disjoint_timer_query")?1:0}function Pe(t,e){return null!=t.getExtension(e)}function Fe(t){try{if(null!=Yt(t))return!0}catch(t){return!1}return!1}function Be(t){if(0===t)return!1;var e=Yt(t);if(1===t){if(!Pe(e,"OES_texture_float"))return!1}else if(!Pe(e,"EXT_color_buffer_float"))return!1;return Ue(e)}function ze(t){if(0===t)return!1;var e=Yt(t);if(1!==t){if(Pe(e,"EXT_color_buffer_float"))return Ue(e);if(Pe(e,"EXT_color_buffer_half_float")){var n=e.getExtension("EXT_color_buffer_half_float");return function(t,e){var n=Qt(t,e),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r),t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,1,1,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(o),a}(e,n)}return!1}return!!Pe(e,"OES_texture_float")&&!!Pe(e,"WEBGL_color_buffer_float")&&Ue(e)}function Ue(t){var e=Qt(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,1,1,0,e.textureFormatFloat,e.textureTypeFloat,null);var r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function Ve(t){return 2===t&&null!=Yt(t).fenceSync}var Ge=Object.freeze({callAndCheck:$t,canBeRepresented:te,getWebGLErrorMessage:ee,getExtensionOrThrow:ne,createVertexShader:re,createFragmentShader:ie,createProgram:ue,linkProgram:ce,validateProgram:le,createStaticVertexBuffer:he,createStaticIndexBuffer:pe,getNumChannels:function(){return 2===i().getNumber("WEBGL_VERSION")?1:4},createTexture:de,validateTextureSize:fe,createFramebuffer:me,bindVertexBufferToProgramAttribute:ge,bindTextureUnit:ve,unbindTextureUnit:function(t,e,n){Te(t,n),$t(t,e,(function(){return t.activeTexture(t.TEXTURE0+n)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))},getProgramUniformLocationOrThrow:ye,getProgramUniformLocation:xe,bindTextureToProgramUniformSampler:be,bindCanvasToFramebuffer:function(t,e){$t(t,e,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),$t(t,e,(function(){return t.viewport(0,0,t.canvas.width,t.canvas.height)})),$t(t,e,(function(){return t.scissor(0,0,t.canvas.width,t.canvas.height)}))},bindColorTextureToFramebuffer:we,unbindColorTextureFromFramebuffer:_e,validateFramebuffer:Se,getFramebufferErrorMessage:Me,getBatchDim:Ae,getRowsCols:Ce,getShapeAs3D:Re,getTextureShapeFromLogicalShape:Ie,isReshapeFree:Oe,getWebGLMaxTextureSize:De,resetMaxTextureSize:function(){oe=null},resetMaxTexturesInShader:function(){ae=null},getMaxTexturesInShader:Le,getWebGLDisjointQueryTimerVersion:ke,hasExtension:Pe,isWebGLVersionEnabled:Fe,isCapableOfRenderingToFloatTexture:Be,isDownloadFloatTextureEnabled:ze,isWebGLFenceEnabled:Ve}),He=i();function je(t){i().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function We(){return zt}function qe(t,e){return zt.tidy(t,e)}function Xe(t){kt(t).forEach((function(t){return t.dispose()}))}function Ye(t){return zt.setBackend(t)}function Ke(t,e,n){return void 0===n&&(n=1),zt.registerBackend(t,e,n)}function Je(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];i().getBool("IS_TEST")||console.warn.apply(console,t)}function Ze(t,e){var n=t;if(X(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];for(var r=[];Array.isArray(n)||X(n)&&"string"!==e;)r.push(n.length),n=n[0];return Array.isArray(t)&&i().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&function t(e,n,r){if(r=r||[],Array.isArray(e)||X(e)){A(n.length>0,(function(){return"Element arr["+r.join("][")+"] should be a primitive, but is an array of "+e.length+" elements"})),A(e.length===n[0],(function(){return"Element arr["+r.join("][")+"] should have "+n[0]+" elements, but has "+e.length+" elements"}));for(var o=n.slice(1),a=0;a<e.length;++a)t(e[a],o,r.concat(a))}else A(0===n.length,(function(){return"Element arr["+r.join("][")+"] is a primitive, but should be an array/TypedArray of "+n[0]+" elements"}))}(t,r,[]),r}function Qe(t,e,n,r){if(null!=t&&("numeric"!==t&&t!==e||"numeric"===t&&"string"===e))throw new Error("Argument '"+n+"' passed to '"+r+"' must be "+t+" tensor, but got "+e+" tensor")}function $e(t,e,n,r){if(void 0===r&&(r="numeric"),t instanceof St)return Qe(r,t.dtype,e,n),t;var o=Q(t);if("string"!==o&&["bool","int32","float32"].indexOf(r)>=0&&(o=r),Qe(r,o,e,n),null==t||!X(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t){var a=null==t?"null":t.constructor.name;throw new Error("Argument '"+e+"' passed to '"+n+"' must be a Tensor or TensorLike, but got '"+a+"'")}var s=Ze(t,o);X(t)||Array.isArray(t)||(t=[t]);var u="string"!==o?nt(t,o,i().getBool("DEBUG")):I(t,[],!0);return zt.makeTensor(u,s,o)}function tn(t,e,n,r){if(void 0===r&&(r="numeric"),!Array.isArray(t))throw new Error("Argument "+e+" passed to "+n+" must be a `Tensor[]` or `TensorLike[]`");return t.map((function(t,r){return $e(t,e+"["+r+"]",n)}),r)}function en(t,e){for(var n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function nn(t,e,n){for(var r=t.length+e.length,o=[],a=0,i=0,s=0;s<r;s++)-1===n.indexOf(s)?o.push(t[a++]):o.push(e[i++]);return o}function rn(t,e){for(var n=[],r=t.length,o=0;o<r;o++)-1===e.indexOf(o)&&n.push(t[o]);return[n,e.map((function(e){return t[e]}))]}function on(t,e){return nn(t,e.map((function(t){return 1})),e)}function an(t,e,n){A(en(e,n),(function(){return t+" supports only inner-most axes for now. Got axes "+e+" and rank-"+n+" input."}))}function sn(t,e){if(en(t,e))return null;for(var n=[],r=0;r<e;++r)-1===t.indexOf(r)&&n.push(r);return t.forEach((function(t){return n.push(t)})),n}function un(t){return t.map((function(t,e){return[e,t]})).sort((function(t,e){return t[1]-e[1]})).map((function(t){return t[0]}))}function cn(t,e){for(var n=[],r=e-t;r<e;++r)n.push(r);return n}function ln(t,e){var n=t[0].length;t.forEach((function(t,e){A(t.length===n,(function(){return"Error in concat"+n+"D: rank of tensors["+e+"] must be the same as the rank of the rest ("+n+")"}))})),A(e>=0&&e<n,(function(){return"Error in concat"+n+"D: axis must be between 0 and "+(n-1)+"."}));var r=t[0];t.forEach((function(t,o){for(var a=0;a<n;a++)A(a===e||t[a]===r[a],(function(){return"Error in concat"+n+"D: Shape of tensors["+o+"] ("+t+") does not match the shape of the rest ("+r+") along the non-concatenated axis "+o+"."}))}))}function hn(t,e){for(var n=t[0].slice(),r=1;r<t.length;r++)n[e]+=t[r][e];return n}function pn(t){var e=Object.keys(t);if(1!==e.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+e.length+" keys.");var n=e[0],r=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1));var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];zt.startScope(n);try{var o=r.apply(void 0,t);return o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),zt.endScope(o),o}catch(t){throw zt.endScope(null),t}};return Object.defineProperty(o,"name",{value:n,configurable:!0}),o}He.registerFlag("HAS_WEBGL",(function(){return He.getNumber("WEBGL_VERSION")>0})),He.registerFlag("WEBGL_VERSION",(function(){return Fe(2)?2:Fe(1)?1:0})),He.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===He.get("WEBGL_VERSION")})),He.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),He.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),He.registerFlag("WEBGL_PACK",(function(){return He.getBool("HAS_WEBGL")})),He.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_CLIP",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),He.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_PACK_REDUCE",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_CONV_IM2COL",(function(){return He.getBool("WEBGL_PACK")})),He.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return De(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return Le(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var t=He.getNumber("WEBGL_VERSION");return 0===t?0:ke(t)})),He.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return He.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&(t=navigator.userAgent||navigator.vendor||window.opera,!(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))));var t})),He.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return Be(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!He.getBool("WEBGL_FORCE_F16_TEXTURES")&&He.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),He.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return ze(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return Ve(He.getNumber("WEBGL_VERSION"))})),He.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return He.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),_t=je;var dn=pn({complex_:function(t,e){var n=$e(t,"real","complex"),r=$e(e,"imag","complex");return C(n.shape,r.shape,"real and imag shapes, "+n.shape+" and "+r.shape+", must match in call to tf.complex()."),zt.runKernelFunc((function(t){return t.complex(n,r)}),{$real:n,$imag:r})}}),fn=pn({real_:function(t){var e=$e(t,"input","real");return zt.runKernelFunc((function(t){return t.real(e)}),{$input:e})}}),mn=pn({imag_:function(t){var e=$e(t,"input","imag");return zt.runKernelFunc((function(t){return t.imag(e)}),{$input:e})}});function gn(t,e,n){return vn(t,e,Ze(t,n),n)}function vn(t,e,n,r){if(null==r&&(r=Q(t)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!X(t)&&!Array.isArray(t)&&"number"!=typeof t&&"boolean"!=typeof t&&"string"!=typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){ut(e);var o=N(e),a=N(n);A(o===a,(function(){return"Based on the provided shape, ["+e+"], the tensor should have "+o+" values but has "+a}));for(var s=0;s<n.length;++s){var u=n[s],c=s!==n.length-1||u!==N(e.slice(s));A(n[s]===e[s]||!c,(function(){return"Error creating a new Tensor. Inferred shape ("+n+") does not match the provided shape ("+e+"). "}))}}return X(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==r?nt(t,r,i().getBool("DEBUG")):I(t,[],!0),zt.makeTensor(t,e,r)}function yn(t,e){if((X(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&X(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return vn(t,[],[],e)}function xn(t,e){R(t);var n=Ze(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return vn(t,null,n,e)}function bn(t,e,n){if(R(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ze(t,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return vn(t,e,r,n)}function wn(t,e,n){if(R(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");var r=Ze(t,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)}function _n(t,e,n){if(R(t),null!=e&&4!==e.length)throw new Error("tensor4d() requires shape to have four numbers");var r=Ze(t,n);if(4!==r.length&&1!==r.length)throw new Error("tensor4d() requires values to be number[][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor4d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)}function Sn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Sn(t,"float32"),r=Mn(t,"float32");return dn(n,r)}var o=ot(N(t),e);return zt.makeTensor(o,t,e)}function Mn(t,e){if(void 0===e&&(e="float32"),"complex64"===e){var n=Mn(t,"float32"),r=Mn(t,"float32");return dn(n,r)}var o=at(N(t),e);return zt.makeTensor(o,t,e)}function En(t,e,n){return zt.runKernelFunc((function(r){return r.fill(t,e,n)}),{})}function Tn(t,e,n){if(n<=0)throw new Error("The number of values should be positive.");return zt.runKernelFunc((function(r){return r.linspace(t,e,n)}),{})}function An(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r="float32"),0===n)throw new Error("Cannot have a step of zero");if(t===e||t<e&&n<0||e<t&&n>1)return Mn([0],r);var o=at(Math.abs(Math.ceil((e-t)/n)),r);e<t&&1===n&&(n=-1),o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+n;return xn(o,r)}var Cn=pn({onesLike_:function(t){var e=$e(t,"x","onesLike");if("complex64"===e.dtype){var n=Cn(fn(e)),r=Rn(mn(e));return dn(n,r)}return zt.runKernelFunc((function(t){return t.onesLike(e)}),{x:e},(function(t,e){return{x:function(){return Rn(t)}}}),"OnesLike")}}),Rn=pn({zerosLike_:function(t){var e=$e(t,"x","zerosLike");return zt.runKernelFunc((function(t){return t.zerosLike(e)}),{x:e},(function(t,e){return{x:function(){return Rn(t)}}}),"ZerosLike")}}),In=pn({concat_:function(t,e){void 0===e&&(e=0),A(t.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=tn(t,"tensors","concat");"complex64"===n[0].dtype&&n.forEach((function(t){if("complex64"!==t.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype "+t.dtype+". ")})),e=z(e,n[0].shape)[0];var r=hn(n.map((function(t){return t.shape})),e);if(0===N(r))return gn([],r);if(1===(n=n.filter((function(t){return t.size>0}))).length)return n[0];var o=n.map((function(t){return t.shape}));ln(o,e);var a=n,i={axis:e};return zt.runKernelFunc((function(t){return t.concat(n,e)}),a,(function(t){var n=o.map((function(t){return t[e]}));return tr(t,n,e).map((function(t){return function(){return t}}))}),"Concat",i)}}),Nn=pn({concat1d_:function(t){return In(t,0)}}),On=pn({concat2d_:function(t,e){return In(t,e)}}),Dn=pn({concat3d_:function(t,e){return In(t,e)}}),Ln=pn({concat4d_:function(t,e){return In(t,e)}}),tr=pn({split_:function(t,e,n){void 0===n&&(n=0);var r,o=$e(t,"x","split");return n=z(n,o.shape)[0],"number"==typeof e?(A(o.shape[n]%e==0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(e).fill(o.shape[n]/e)):(A(o.shape[n]===e.reduce((function(t,e){return t+e})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=e),zt.runKernelFunc((function(t){return t.split(o,r,n)}),{$x:o},(function(t){return{$x:function(){return In(t,n)}}}))}});function kn(t,e,n){return void 0===e&&(e="float32"),e=e||"float32",ut(t),new xt(t,e,n)}var Pn=pn({batchToSpaceND_:function(t,e,n){var r=$e(t,"x","batchToSpaceND"),o=e.reduce((function(t,e){return t*e}));return A(r.rank>=1+e.length,(function(){return"input rank is "+r.rank+" but should be > than blockShape.length "+e.length})),A(n.length===e.length,(function(){return"crops.length is "+n.length+" but should be equal to blockShape.length  "+e.length})),A(r.shape[0]%o==0,(function(){return"input tensor batch is "+r.shape[0]+" but is not divisible by the product of the elements of blockShape "+e.join(" * ")+" === "+o})),zt.runKernelFunc((function(t){return t.batchToSpaceND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.spaceToBatchND(e,n)}}}))}}),Fn=pn({cast_:function(t,e){var n=$e(t,"x","cast");if(!j(e))throw new Error("Failed to cast to unknown dtype "+e);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={dtype:e};return zt.runKernelFunc((function(t){return t.cast(n,e)}),{x:n},(function(t){return{x:function(){return t.clone()}}}),"Cast",r)}}),Bn=pn({cumsum_:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=!1),void 0===r&&(r=!1);var o=$e(t,"x","cumsum"),a=sn([e|=0],o.rank),i=o;null!=a&&(i=o.transpose(a));var s=cn(1,o.rank)[0],u=zt.runKernelFunc((function(t){return t.cumsum(i,s,n,r)}),{permutedX:i},(function(t){return{permutedX:function(){return t.cumsum(e,n,!r)}}}));return null!=a&&(u=u.transpose(a)),u}}),zn=pn({depthToSpace_:function(t,e,n){void 0===n&&(n="NHWC");var r=$e(t,"x","depthToSpace"),o="NHWC"===n?r.shape[1]:r.shape[2],a="NHWC"===n?r.shape[2]:r.shape[3],i="NHWC"===n?r.shape[3]:r.shape[1];return A(o*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+o+" and "+e+"  for depthToSpace with input shape\n      "+r.shape})),A(a*e>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n      "+a+" and "+e+" for depthToSpace with input shape\n          "+r.shape})),A(i%(e*e)==0,(function(){return"Dimension size must be evenly divisible by "+e*e+" but is "+i+" for depthToSpace with input shape "+r.shape})),zt.runKernelFunc((function(t){return t.depthToSpace(r,e,n)}),{$x:r})}}),Un=pn({expandDims_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","expandDims",null);A(e<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n.shape.slice();return e<0&&(A(-(n.rank+1)<=e,(function(){return"Axis must be in the interval ["+-(n.rank+1)+", "+n.rank+"]"})),e=n.rank+e+1),r.splice(e,0,1),Vn(n,r)}}),Vn=pn({reshape_:function(t,e){var n=$e(t,"x","reshape",null);e=B(e,n.size),A(n.size===N(e),(function(){return"new shape and old shape must have the same number of elements."}));var r={shape:e};return zt.runKernelFunc((function(t){return t.reshape(n,e)}),{x:n},(function(t){return{x:function(){return t.reshape(n.shape)}}}),"Reshape",r)}}),Gn=pn({spaceToBatchND_:function(t,e,n){var r=$e(t,"x","spaceToBatchND");return A(r.rank>=1+e.length,(function(){return"input rank "+r.rank+" should be > than [blockShape] "+e.length})),A(n.length===e.length,(function(){return"paddings.shape[0] "+n.length+" must be equal to [blockShape] "+e.length})),A(r.shape.reduce((function(t,r,o){return o>0&&o<=e.length?t&&(r+n[o-1][0]+n[o-1][1])%e[o-1]==0:t}),!0),(function(){return"input spatial dimensions "+r.shape.slice(1)+" with paddings "+n.toString()+" must be divisible by blockShapes "+e.toString()})),zt.runKernelFunc((function(t){return t.spaceToBatchND(r,e,n)}),{$x:r},(function(t){return{$x:function(){return t.batchToSpaceND(e,n)}}}))}}),Hn=pn({squeeze_:function(t,e){var n=$e(t,"x","squeeze");return Vn(n,U(n.shape,e).newShape)}}),hr=pn({stack_:function(t,e){void 0===e&&(e=0);var n=tn(t,"tensors","stack");if(A(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),1===n.length)return n[0].expandDims(e);var r=n[0].rank,o=n[0].shape,a=n[0].dtype;A(e<=r,(function(){return"Axis must be <= rank of the tensor"})),n.forEach((function(t){C(o,t.shape,"All tensors passed to stack must have matching shapes")})),n.forEach((function(t){A(a===t.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var i=n.map((function(t){return t.expandDims(e)}));return In(i,e)}}),jn=pn({unstack_:function(t,e){void 0===e&&(e=0),e=e||0;var n=$e(t,"x","unstack");A(e>=-n.shape.length&&e<n.shape.length,(function(){return"Axis = "+e+" is not in [-"+n.shape.length+", "+n.shape.length+")"})),e<0&&(e+=n.shape.length);var r={axis:e};return zt.runKernelFunc((function(t){return t.unstack(n,e)}),{x:n},(function(t){return{x:function(){return hr(t,e)}}}),"Unpack",r)}}),Wn=function(t,e){return d(this,void 0,void 0,(function(){var n,r,a,i,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:return n=$e(t,"x","setdiff1d"),r=$e(e,"y","setdiff1d"),A(n.dtype===r.dtype,(function(){return"x and y should have the same dtype, but got x ("+n.dtype+") and y ("+r.dtype+")."})),A(1===n.rank,(function(){return"x should be 1D tensor, but got x ("+n.shape+")."})),A(1===r.rank,(function(){return"y should be 1D tensor, but got y ("+r.shape+")."})),[4,n.data()];case 1:return a=d.sent(),[4,r.data()];case 2:for(i=d.sent(),s=new Set(i),u=0,l=0;l<a.length;l++)s.has(a[l])||u++;for(o=new xt([u],n.dtype),c=new xt([u],"int32"),l=0,h=0;l<a.length;l++)s.has(a[l])||(o.values[h]=a[l],c.values[h]=l,h++);return[2,[o.toTensor(),c.toTensor()]]}}))}))};function qn(t,e,n,r){void 0===r&&(r=!0);var o=[];if(r)(o=o.concat(e.slice(0))).push(t[0]/n),o=o.concat(t.slice(1));else{o=o.concat(t[0]);for(var a=e.length,i=0;i<a;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(a+1))}return o}function Xn(t,e,n){void 0===n&&(n=!0);var r=[];if(n){r.push(e);for(var o=e+1;o<t;++o)o<=2*e?(r.push(o),r.push(o-(e+1))):r.push(o)}else{var a=[],i=[];for(o=1;o<t;++o)o>=2*e+1||o%2==1?i.push(o):a.push(o);r.push.apply(r,a),r.push(0),r.push.apply(r,i)}return r}function Yn(t,e,n,r){void 0===r&&(r=!0);var o=[];r?o.push(t[0]/n):o.push(t[0]*n);for(var a=1;a<t.length;++a)a<=e.length?r?o.push(e[a-1]*t[a]):o.push(t[a]/e[a-1]):o.push(t[a]);return o}function Kn(t,e){for(var n=[0],r=0;r<e;++r)n.push(t[r][0]);return n}function Jn(t,e,n){for(var r=t.slice(0,1),o=0;o<n;++o)r.push(t[o+1]-e[o][0]-e[o][1]);return r}var Zn="Div",Qn="SquaredDifference",$n="BroadcastTo",er="Identity",nr=pn({add_:function(t,e){var n,r=$e(t,"a","add"),o=$e(e,"b","add");n=Dt(r,o),r=n[0],o=n[1];var a={a:r,b:o};return zt.runKernelFunc((function(t,e){var n=t.add(r,o);return e([r,o]),n}),a,null,"Add")}});function rr(t,e){for(var n=t.length,r=[],o=0;o<n;o++){var a=n-1-o,i=t[a]||1;(e[e.length-1-o]||1)>1&&1===i&&r.unshift(a)}return r}function ir(t,e){for(var n=[],r=0;r<e.length;r++){var o=t[t.length-r-1],a=e.length-r-1,i=e[a];(null==o||1===o&&i>1)&&n.unshift(a)}return n}function or(t,e){for(var n=[],r=Math.max(t.length,e.length),o=0;o<r;o++){var a=t[t.length-o-1];null==a&&(a=1);var i=e[e.length-o-1];if(null==i&&(i=1),1===a)n.unshift(i);else if(1===i)n.unshift(a);else{if(a!==i)throw Error("Operands could not be broadcast together with shapes "+t+" and "+e+".");n.unshift(a)}}return n}var ar=pn({abs_:function(t){var e=$e(t,"x","abs");return"complex64"===e.dtype?zt.runKernelFunc((function(t){return t.complexAbs(e)}),{$x:e}):zt.runKernelFunc((function(t,n){var r=t.abs(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().step(-1))}}}),"Abs")}}),sr=pn({acos_:function(t){var e=$e(t,"x","acos");return zt.runKernelFunc((function(t,n){var r=t.acos(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(yn(1).sub(n.toFloat().square()).sqrt()).neg()}}}))}}),ur=pn({acosh_:function(t){var e=$e(t,"x","acosh");return zt.runKernelFunc((function(t,n){var r=t.acosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(n.toFloat().square().sub(1).sqrt())}}}))}}),cr=pn({asin_:function(t){var e=$e(t,"x","asin");return zt.runKernelFunc((function(t,n){var r=t.asin(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(yn(1).sub(n.toFloat().square()).sqrt())}}}))}}),lr=pn({asinh_:function(t){var e=$e(t,"x","asinh");return zt.runKernelFunc((function(t,n){var r=t.asinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.divStrict(yn(1).add(n.toFloat().square()).sqrt())}}}))}}),pr=pn({atan_:function(t){var e=$e(t,"x","atan");return zt.runKernelFunc((function(t,n){var r=t.atan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().square().add(1))}}}))}}),dr=pn({atanh_:function(t){var e=$e(t,"x","atanh");return zt.runKernelFunc((function(t,n){var r=t.atanh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(yn(1).sub(n.toFloat().square()))}}}))}}),fr=pn({ceil_:function(t){var e=$e(t,"x","ceil");return zt.runKernelFunc((function(t){return t.ceil(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),mr=pn({clipByValue_:function(t,e,n){var r=$e(t,"x","clipByValue");A(e<=n,(function(){return"Error in clip: min ("+e+") must be less than or equal to max ("+n+")."}));var o=[r],a={min:e,max:n};return zt.runKernelFunc((function(t,o){var a=t.clip(r,e,n);return o([r]),a}),{x:r},(function(t,r){var o=r[0];return{x:function(){return t.where(o.greaterEqual(e).logicalAnd(o.lessEqual(n)),Rn(t))}}}),"ClipByValue",a,o)}}),gr=pn({cos_:function(t){var e=$e(t,"x","cos"),n=[e];return zt.runKernelFunc((function(t,n){var r=t.cos(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().sin().neg().mul(t)}}}),"Cos",{},n)}}),vr=pn({cosh_:function(t){var e=$e(t,"x","cosh");return zt.runKernelFunc((function(t,n){var r=t.cosh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().sinh().mulStrict(t)}}}))}}),yr=pn({erf_:function(t){var e=$e(t,"x","erf");return A("int32"===e.dtype||"float32"===e.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===e.dtype&&(e=e.toFloat()),zt.runKernelFunc((function(t,n){var r=t.erf(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.square().neg().exp().mul(2/Math.sqrt(Math.PI)))}}}))}}),xr=pn({exp_:function(t){var e=$e(t,"x","exp");return zt.runKernelFunc((function(t,n){var r=t.exp(e);return n([r]),r}),{x:e},(function(t,e){return{x:function(){return t.mulStrict(e[0])}}}),"Exp",{},[],[!0])}}),wr=pn({expm1_:function(t){var e=$e(t,"x","expm1");return zt.runKernelFunc((function(t,n){var r=t.expm1(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.exp())}}}))}}),_r=pn({floor_:function(t){var e=$e(t,"x","floor");return zt.runKernelFunc((function(t){return t.floor(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),Sr=pn({log_:function(t){var e=$e(t,"x","log"),n=[e];return zt.runKernelFunc((function(t,n){var r=t.log(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.toFloat())}}}),"Log",{},n)}}),Mr=pn({log1p_:function(t){var e=$e(t,"x","log1p");return zt.runKernelFunc((function(t,n){var r=t.log1p(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.add(1))}}}))}}),Er=pn({logSigmoid_:function(t){var e=$e(t,"x","logSigmoid");return zt.runKernelFunc((function(t,n){var r=t.softplus(e.neg()).neg();return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.neg().sigmoid())}}}))}}),Tr=pn({neg_:function(t){var e=$e(t,"x","neg"),n=[e];return zt.runKernelFunc((function(t){return t.neg(e)}),{x:e},(function(t){return{x:function(){return t.neg()}}}),"Neg",{},n)}}),Ar=pn({reciprocal_:function(t){var e=$e(t,"x","reciprocal");return zt.runKernelFunc((function(t,n){var r=t.reciprocal(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.square().neg())}}}))}}),Cr=pn({round_:function(t){var e=$e(t,"x","round");return zt.runKernelFunc((function(t){return t.round(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),Rr=pn({rsqrt_:function(t){var e=$e(t,"x","rsqrt"),n=[e];return zt.runKernelFunc((function(t,n){var r=t.rsqrt(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.div(n.pow(1.5).mul(2)).neg()}}}),"Rsqrt",{},n)}}),Ir=pn({sigmoid_:function(t){var e=$e(t,"x","sigmoid");return zt.runKernelFunc((function(t,n){var r=t.sigmoid(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mul(n.mul(yn(1).sub(n)))}}}),"Sigmoid")}}),Nr=pn({sign_:function(t){var e=$e(t,"x","sign");return zt.runKernelFunc((function(t){return t.sign(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),Or=pn({isNaN_:function(t){var e=$e(t,"x","isNaN");return zt.runKernelFunc((function(t){return t.isNaN(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),Dr=pn({isInf_:function(t){var e=$e(t,"x","isInf");return zt.runKernelFunc((function(t){return t.isInf(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),Lr=pn({isFinite_:function(t){var e=$e(t,"x","isFinite");return zt.runKernelFunc((function(t){return t.isFinite(e)}),{$x:e},(function(t){return{$x:function(){return Rn(t)}}}))}}),kr=pn({sin_:function(t){var e=$e(t,"x","sin"),n=[e];return zt.runKernelFunc((function(t,n){var r=t.sin(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return n.toFloat().cos().mul(t)}}}),"Sin",{},n)}}),Pr=pn({sinh_:function(t){var e=$e(t,"x","sinh");return zt.runKernelFunc((function(t,n){var r=t.sinh(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return n.toFloat().cosh().mulStrict(t)}}}))}}),Fr=pn({softplus_:function(t){var e=$e(t,"x","softplus");return zt.runKernelFunc((function(t,n){var r=t.softplus(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.mul(n.sigmoid())}}}))}}),Br=pn({sqrt_:function(t){var e=$e(t,"x","sqrt");return zt.runKernelFunc((function(t,n){var r=t.sqrt(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.toFloat().sqrt().mul(2))}}}))}}),zr=pn({step_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","step");return zt.runKernelFunc((function(t){return t.step(n,e)}),{$x:n},(function(t){return{$x:function(){return Rn(t)}}}))}}),Ur=pn({tan_:function(t){var e=$e(t,"x","tan");return zt.runKernelFunc((function(t,n){var r=t.tan(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return t.div(n.cos().square())}}}))}}),Vr=pn({tanh_:function(t){var e=$e(t,"x","tanh");return zt.runKernelFunc((function(t,n){var r=t.tanh(e);return n([r]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return yn(1).sub(n.square()).mulStrict(t)}}}),"Tanh",{},null,[!0])}}),Gr=pn({addStrict_:function(t,e){var n=$e(t,"a","addStrict"),r=$e(e,"b","addStrict");return C(n.shape,r.shape,"Error in addStrict: "),n.add(r)}}),Hr=pn({atan2_:function(t,e){var n,r=$e(t,"a","atan2"),o=$e(e,"b","atan2");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape);return zt.runKernelFunc((function(t,e){var n=t.atan2(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=nr(n.square(),r.square()),o=t.mul(r.div(e)),i=ir(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},$b:function(){var e=nr(n.square(),r.square()),o=Tr(t.mul(n.div(e))),i=ir(r.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(r.shape)}}}))}}),jr=pn({divStrict_:function(t,e){var n=$e(t,"a","div"),r=$e(e,"b","div");return C(n.shape,r.shape,"Error in divideStrict: "),n.div(r)}}),Wr=pn({floorDiv_:function(t,e){var n,r=$e(t,"a","floorDiv"),o=$e(e,"b","floorDiv");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape);return zt.runKernelFunc((function(t,e){var n=t.floorDiv(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.div(r.toFloat()),o=ir(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=ir(r.shape,a);o.length>0&&(e=e.sum(o).reshape(r.shape));var i=r.square();return e.div(i.toFloat()).neg()}}}),"FloorDiv")}}),qr=pn({maximum_:function(t,e){var n,r=$e(t,"a","maximum"),o=$e(e,"b","maximum");return n=Dt(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),or(r.shape,o.shape),zt.runKernelFunc((function(t,e){var n=t.maximum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.greaterEqual(r).toFloat())},b:function(){return t.mul(n.less(r).toFloat())}}}),"Maximum")}}),Xr=pn({maximumStrict_:function(t,e){var n=$e(t,"a","maximumStrict"),r=$e(e,"b","maximumStrict");return C(n.shape,r.shape,"Error in maximumStrict: "),n.maximum(r)}}),Yr=pn({minimum_:function(t,e){var n,r=$e(t,"a","minimum"),o=$e(e,"b","minimum");return n=Dt(r,o),r=n[0],o=n[1],"bool"===r.dtype&&(r=r.toInt(),o=o.toInt()),or(r.shape,o.shape),zt.runKernelFunc((function(t,e){var n=t.minimum(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return t.mul(n.lessEqual(r).toFloat())},b:function(){return t.mul(n.greater(r).toFloat())}}}),"Minimum")}}),Kr=pn({minimumStrict_:function(t,e){var n=$e(t,"a","minimumStrict"),r=$e(e,"b","minimumStrict");return C(n.shape,r.shape,"Error in minimumStrict: "),n.minimum(r)}}),Jr=pn({mod_:function(t,e){var n,r=$e(t,"a","mod"),o=$e(e,"b","mod");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape);return zt.runKernelFunc((function(t,e){var n=t.mod(r,o);return e([r,o]),n}),{$a:r,$b:o},(function(t,e){var n=e[0],r=e[1];return{$a:function(){var e=ir(n.shape,a);return e.length>0?t.sum(e).reshape(n.shape):t},$b:function(){var e=t.mul(n.div(r).floor().neg()),o=ir(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e}}}))}}),Zr=pn({modStrict_:function(t,e){var n=$e(t,"a","modStrict"),r=$e(e,"b","modStrict");return C(n.shape,r.shape,"Error in modStrict: "),n.mod(r)}}),Qr=pn({mul_:function(t,e){var n,r=$e(t,"a","mul"),o=$e(e,"b","mul");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape);return zt.runKernelFunc((function(t,e){var n=t.multiply(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){var e=t.mul(r.toFloat()),o=ir(n.shape,a);return o.length>0?e.sum(o).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),o=ir(r.shape,a);return o.length>0?e.sum(o).reshape(r.shape):e}}}),"Mul")}}),$r=pn({mulStrict_:function(t,e){var n=$e(t,"a","mul"),r=$e(e,"b","mul");return C(n.shape,r.shape,"Error in multiplyStrict: "),n.mul(r)}}),ti=pn({pow_:function(t,e){var n,r=$e(t,"base","pow"),o=$e(e,"exp","pow");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape),i=[r,o];return zt.runKernelFunc((function(t,e){var n=t.pow(r,o);return e([r,o,n]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1],o=e[2];return{a:function(){var e=r.toFloat(),o=t.mul(e.mul(n.pow(e.sub(yn(1))))),i=ir(n.shape,a);return i.length>0&&(o=o.sum(i)),o.reshape(n.shape)},b:function(){var e=n.greater(0),i=n.log().where(e,Rn(n)),s=t.mul(o.mul(i)),u=ir(r.shape,a);return u.length>0&&(s=s.sum(u)),s.reshape(r.shape)}}}),"Pow",{},i,[!0])}}),ei=pn({powStrict_:function(t,e){return C(t.shape,e.shape,"Error in powStrict: "),t.pow(e)}}),ni=pn({squaredDifferenceStrict_:function(t,e){var n=$e(t,"a","squaredDifferenceStrict"),r=$e(e,"b","squaredDifferenceStrict");return C(n.shape,r.shape,"Error in squaredDifferenceStrict: "),n.squaredDifference(r)}}),ri=pn({sub_:function(t,e){var n,r=$e(t,"a","sub"),o=$e(e,"b","sub");n=Dt(r,o),r=n[0],o=n[1];var a=or(r.shape,o.shape);return zt.runKernelFunc((function(t){return t.subtract(r,o)}),{a:r,b:o},(function(t){return{a:function(){var e=t,n=ir(r.shape,a);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)},b:function(){var e=t,n=ir(o.shape,a);return n.length>0&&(e=e.sum(n)),e.neg().reshape(o.shape)}}}),"Sub")}}),ii=pn({subStrict_:function(t,e){var n=$e(t,"a","subStrict"),r=$e(e,"b","subStrict");return C(n.shape,r.shape,"Error in subStrict: "),n.sub(r)}}),oi=pn({div_:function(t,e){var n,r=$e(t,"a","div"),o=$e(e,"b","div");if(n=Dt(r,o),r=n[0],o=n[1],"int32"===r.dtype&&"int32"===o.dtype)return Wr(r,o);var a={a:r,b:o};return zt.runKernelFunc((function(t,e){var n=t.realDivide(r,o);return e([r,o]),n}),a,null,Zn,{})}});function ai(t,e){if(t.rank<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher, but the rank was "+t.rank+".");if(e.rank<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if("int32"!==e.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type, but the dtype was "+e.dtype+".");if(e.shape[e.rank-1]>t.rank)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+e.shape[e.rank-1]+" vs. "+t.rank);if(0===t.size)throw new Error("Requested more than 0 entries, but input is empty. Input shape: "+t.shape+".");for(var n=e.shape,r=n[n.length-1],o=1,a=0;a<n.length-1;++a)o*=n[a];var i=t.shape,s=n.slice();s.pop();var u=1;for(a=r;a<t.rank;++a)u*=i[a],s.push(i[a]);var c=et(t.shape).map((function(t){return t/u})).concat([1]).slice(0,r);return[s,o,u,c]}var si=Object.freeze({prepareAndValidate:ai});function ui(t){return t<=30?t:tt(t,Math.floor(Math.sqrt(t)))}function ci(t,e,n){var r=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,a="Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: "+n.shape+", indices.shape: "+e.shape+", shape: "+t+", sliceDim: "+r+", and batchDim: "+o+".";if(n.rank<o)throw new Error(a+" update.rank < "+o+". ");if(t.length<r+(n.rank-o))throw new Error(a+" Output shape length < "+(r+(n.rank-o)));if(n.rank!==o+t.length-r)throw new Error(a+" update.rank != "+(o+t.length-r));for(var i=0;i<o;++i)if(n.shape[i]!==e.shape[i])throw new Error(a+" updates.shape["+i+"] ("+n.shape[i]+") != indices.shape["+i+"] ("+e.shape[i]+").");for(i=0;i<n.rank-o;++i)if(n.shape[i+o]!==t[i+r])throw new Error(a+" updates.shape["+(i+o)+"] ("+n.shape[i+o]+") != shape["+(i+o)+"] ("+t[i+o]+")")}function hi(t,e,n){if(e.rank<1)throw new Error("tf.scatterND() expects the indices to be rank 1 or higher, but the rank was "+e.rank+".");if(t.rank<1)throw new Error("tf.scatterND() expects the updates to be rank 1 or higher, but the rank was "+t.rank+".");if("int32"!==e.dtype)throw new Error("The dtype of 'indices' should be int32, but got dtype: "+e.dtype);if(n.length<1)throw new Error("Output rank must be greater or equal to 1, but got shape: "+n);if(0===n.length){if(0===e.size)throw new Error("Indices specified for empty output. indices shape: "+e.shape);if(0===t.size)throw new Error("Updates specified for empty output. updates shape: "+t.shape)}ci(n,e,t)}function pi(t,e,n){for(var r=e.shape.length,o=r>1?e.shape[r-1]:1,a=n.length,i=1,s=o;s<a;++s)i*=n[s];var u=o<1?1:o;return{sliceRank:o,numUpdates:N(e.shape)/u,sliceSize:i,strides:et(n.slice(0,o)).concat([1]),outputSize:N(n)}}var di=Object.freeze({validateUpdateShape:ci,validateInput:hi,calculateShapes:pi});function fi(t,e,n){A(t.rank===e.length,(function(){return"Error in slice"+t.rank+"D: Length of begin "+e+" must match the rank of the array ("+t.rank+")."})),A(t.rank===n.length,(function(){return"Error in slice"+t.rank+"D: Length of size "+n+" must match the rank of the array ("+t.rank+")."}));for(var r=function(r){A(e[r]+n[r]<=t.shape[r],(function(){return"Error in slice"+t.rank+"D: begin["+r+"] + size["+r+"] ("+(e[r]+n[r])+") would overflow input.shape["+r+"] ("+t.shape[r]+")"}))},o=0;o<t.rank;++o)r(o)}function mi(t){for(var e=[],n=0;t>0;)1&t&&e.push(n),t/=2,n++;return e}function gi(t,e,n){for(var r=[],o=0;o<t.length;o++)r[o]=Math.ceil((e[o]-t[o])/n[o]);return r}function vi(t,e,n,r,o){var a=e[o],i=n[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),E(0,a,s-1)}function yi(t,e,n,r,o){var a=e[o],i=n[o]||1;(t&1<<o||null==a)&&(a=i>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var s=r[o];return a<0&&(a+=s),i>0?E(0,a,s):E(-1,a,s-1)}function xi(t,e,n){for(var r=n.length,o=0;o<n.length;o++)if(n[o]>1){r=o;break}for(o=r+1;o<n.length;o++)if(e[o]>0||n[o]!==t[o])return!1;return!0}function bi(t,e){for(var n=t.length>0?t[t.length-1]:1,r=0;r<t.length-1;r++)n+=t[r]*e[r];return n}var wi=Object.freeze({assertParamsValid:fi,maskToAxes:mi,computeOutShape:gi,startForAxis:vi,stopForAxis:yi,isSliceContinous:xi,computeFlatOffset:bi});function _i(t){return zt.customGrad(t)}var Si=pn({softmax_:function(t,e){void 0===e&&(e=-1);var n=$e(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and dim was "+e);return zt.runKernelFunc((function(t,r){var o=t.softmax(n,e);return r([o]),o}),{logits:n},(function(t,n){var r=n[0],o=t.mul(r);return{logits:function(){return o.sub(o.sum([e],!0).mul(r))}}}),"Softmax",{dim:e},[],[!0])}}),Mi=pn({logSoftmax_:function(t,e){void 0===e&&(e=-1);var n=$e(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. Logits was rank "+n.rank+" and axis was "+e);return _i((function(t,n){var r=t.max(e,!0),o=t.sub(r),a=o.toFloat().sub(o.exp().sum(e,!0).log());return n([a]),{value:a,gradFunc:function(t,n){var r=n[0].exp();return t.sub(t.sum(e,!0).mul(r))}}}))(n)}}),Ei=pn({transpose_:function(t,e){var n=$e(t,"x","transpose");if(null==e&&(e=n.shape.map((function(t,e){return e})).reverse()),A(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of perm "+e+"."})),e.forEach((function(t){A(t>=0&&t<n.rank,(function(){return"All entries in 'perm' must be between 0 and "+(n.rank-1)+" but got "+e}))})),n.rank<=1)return n.clone();var r={perm:e};return zt.runKernelFunc((function(t){return t.transpose(n,e)}),{x:n},null,"Transpose",r)}}),Ti=function(){function t(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}return t.prototype.get=function(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)},t.prototype.set=function(t,e){this.dataIdsCount++,this.data.set(t,e)},t.prototype.has=function(t){return this.data.has(t)},t.prototype.delete=function(t){return this.dataIdsCount--,this.data.delete(t)},t.prototype.numDataIds=function(){return this.dataIdsCount},t}(),Ai=function(){function t(){}return t.prototype.time=function(t){return Ci("time")},t.prototype.read=function(t){return Ci("read")},t.prototype.readSync=function(t){return Ci("readSync")},t.prototype.numDataIds=function(){return Ci("numDataIds")},t.prototype.disposeData=function(t){return Ci("disposeData")},t.prototype.write=function(t,e,n){return Ci("write")},t.prototype.move=function(t,e,n,r){return Ci("move")},t.prototype.memory=function(){return Ci("memory")},t.prototype.floatPrecision=function(){return Ci("floatPrecision")},t.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},t.prototype.batchMatMul=function(t,e,n,r){return Ci("batchMatMul")},t.prototype.fusedBatchMatMul=function(t){return t.a,t.b,t.transposeA,t.transposeB,t.bias,t.activation,t.preluActivationWeights,Ci("fusedBatchMatMul")},t.prototype.slice=function(t,e,n){return Ci("slice")},t.prototype.stridedSlice=function(t,e,n,r){return Ci("stridedSlice")},t.prototype.unstack=function(t,e){return Ci("unstack")},t.prototype.reverse=function(t,e){return Ci("reverse")},t.prototype.concat=function(t,e){return Ci("concat")},t.prototype.neg=function(t){return Ci("neg")},t.prototype.add=function(t,e){return Ci("add")},t.prototype.addN=function(t){return Ci("addN")},t.prototype.subtract=function(t,e){return Ci("subtract")},t.prototype.multiply=function(t,e){return Ci("multiply")},t.prototype.realDivide=function(t,e){return Ci("realDivide")},t.prototype.floorDiv=function(t,e){return Ci("floorDiv")},t.prototype.sum=function(t,e){return Ci("sum")},t.prototype.prod=function(t,e){return Ci("prod")},t.prototype.unsortedSegmentSum=function(t,e,n){return Ci("unsortedSegmentSum")},t.prototype.argMin=function(t,e){return Ci("argMin")},t.prototype.argMax=function(t,e){return Ci("argMax")},t.prototype.equal=function(t,e){return Ci("equal")},t.prototype.notEqual=function(t,e){return Ci("notEqual")},t.prototype.less=function(t,e){return Ci("less")},t.prototype.lessEqual=function(t,e){return Ci("lessEqual")},t.prototype.greater=function(t,e){return Ci("greater")},t.prototype.greaterEqual=function(t,e){return Ci("greaterEqual")},t.prototype.logicalNot=function(t){return Ci("logicalNot")},t.prototype.logicalAnd=function(t,e){return Ci("logicalAnd")},t.prototype.logicalOr=function(t,e){return Ci("logicalOr")},t.prototype.where=function(t){return Ci("where")},t.prototype.select=function(t,e,n){return Ci("select")},t.prototype.topk=function(t,e,n){return Ci("topk")},t.prototype.min=function(t,e){return Ci("min")},t.prototype.minimum=function(t,e){return Ci("minimum")},t.prototype.mod=function(t,e){return Ci("mod")},t.prototype.max=function(t,e){return Ci("max")},t.prototype.maximum=function(t,e){return Ci("maximum")},t.prototype.all=function(t,e){return Ci("all")},t.prototype.any=function(t,e){return Ci("any")},t.prototype.squaredDifference=function(t,e){return Ci("squaredDifference")},t.prototype.ceil=function(t){return Ci("ceil")},t.prototype.floor=function(t){return Ci("floor")},t.prototype.round=function(t){return Ci("round")},t.prototype.sign=function(t){return Ci("sign")},t.prototype.isNaN=function(t){return Ci("isNaN")},t.prototype.isInf=function(t){return Ci("isInf")},t.prototype.isFinite=function(t){return Ci("isFinite")},t.prototype.pow=function(t,e){return Ci("pow")},t.prototype.exp=function(t){return Ci("exp")},t.prototype.expm1=function(t){return Ci("expm1")},t.prototype.softmax=function(t,e){return Ci("softmax")},t.prototype.log=function(t){return Ci("log")},t.prototype.log1p=function(t){return Ci("log1p")},t.prototype.sqrt=function(t){return Ci("sqrt")},t.prototype.rsqrt=function(t){return Ci("rsqrt")},t.prototype.square=function(t){return Ci("square")},t.prototype.reciprocal=function(t){return Ci("reciprocal")},t.prototype.relu=function(t){return Ci("relu")},t.prototype.relu6=function(t){return Ci("relu6")},t.prototype.prelu=function(t,e){return Ci("prelu")},t.prototype.elu=function(t){return Ci("elu")},t.prototype.eluDer=function(t,e){return Ci("eluDer")},t.prototype.selu=function(t){return Ci("selu")},t.prototype.int=function(t){return Ci("int")},t.prototype.clip=function(t,e,n){return Ci("clip")},t.prototype.abs=function(t){return Ci("abs")},t.prototype.complexAbs=function(t){return Ci("complexAbs")},t.prototype.sigmoid=function(t){return Ci("sigmoid")},t.prototype.softplus=function(t){return Ci("softplus")},t.prototype.sin=function(t){return Ci("sin")},t.prototype.cos=function(t){return Ci("cos")},t.prototype.tan=function(t){return Ci("tan")},t.prototype.asin=function(t){return Ci("asin")},t.prototype.acos=function(t){return Ci("acos")},t.prototype.atan=function(t){return Ci("atan")},t.prototype.atan2=function(t,e){return Ci("atan2")},t.prototype.sinh=function(t){return Ci("sinh")},t.prototype.cosh=function(t){return Ci("cosh")},t.prototype.tanh=function(t){return Ci("tanh")},t.prototype.asinh=function(t){return Ci("asinh")},t.prototype.acosh=function(t){return Ci("acosh")},t.prototype.atanh=function(t){return Ci("atanh")},t.prototype.erf=function(t){return Ci("erf")},t.prototype.step=function(t,e){return Ci("step")},t.prototype.fusedConv2d=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Ci("fusedConv2d")},t.prototype.conv2d=function(t,e,n){return Ci("conv2d")},t.prototype.conv2dDerInput=function(t,e,n){return Ci("conv2dDerInput")},t.prototype.conv2dDerFilter=function(t,e,n){return Ci("conv2dDerFilter")},t.prototype.fusedDepthwiseConv2D=function(t){return t.input,t.filter,t.convInfo,t.bias,t.activation,t.preluActivationWeights,Ci("fusedDepthwiseConv2D")},t.prototype.depthwiseConv2D=function(t,e,n){return Ci("depthwiseConv2D")},t.prototype.depthwiseConv2DDerInput=function(t,e,n){return Ci("depthwiseConv2DDerInput")},t.prototype.depthwiseConv2DDerFilter=function(t,e,n){return Ci("depthwiseConv2DDerFilter")},t.prototype.conv3d=function(t,e,n){return Ci("conv3d")},t.prototype.conv3dDerInput=function(t,e,n){return Ci("conv3dDerInput")},t.prototype.conv3dDerFilter=function(t,e,n){return Ci("conv3dDerFilter")},t.prototype.maxPool=function(t,e){return Ci("maxPool")},t.prototype.maxPoolBackprop=function(t,e,n,r){return Ci("maxPoolBackprop")},t.prototype.avgPool=function(t,e){return Ci("avgPool")},t.prototype.avgPoolBackprop=function(t,e,n){return Ci("avgPoolBackprop")},t.prototype.avgPool3d=function(t,e){return Ci("avgPool3d")},t.prototype.avgPool3dBackprop=function(t,e,n){return Ci("avgPool3dBackprop")},t.prototype.maxPool3d=function(t,e){return Ci("maxPool3d")},t.prototype.maxPool3dBackprop=function(t,e,n,r){return Ci("maxPool3dBackprop")},t.prototype.reshape=function(t,e){return Ci("reshape")},t.prototype.cast=function(t,e){return Ci("cast")},t.prototype.tile=function(t,e){return Ci("tile")},t.prototype.pad=function(t,e,n){return Ci("pad")},t.prototype.transpose=function(t,e){return Ci("transpose")},t.prototype.gather=function(t,e,n){return Ci("gather")},t.prototype.gatherND=function(t,e){return Ci("gatherND")},t.prototype.scatterND=function(t,e,n){return Ci("scatterND")},t.prototype.batchToSpaceND=function(t,e,n){return Ci("batchToSpaceND")},t.prototype.spaceToBatchND=function(t,e,n){return Ci("spaceToBatchND")},t.prototype.resizeBilinear=function(t,e,n,r){return Ci("resizeBilinear")},t.prototype.resizeBilinearBackprop=function(t,e,n){return Ci("resizeBilinearBackprop")},t.prototype.resizeNearestNeighbor=function(t,e,n,r){return Ci("resizeNearestNeighbor")},t.prototype.resizeNearestNeighborBackprop=function(t,e,n){return Ci("resizeNearestNeighborBackprop")},t.prototype.batchNormalization=function(t,e,n,r,o,a){return Ci("batchNormalization")},t.prototype.localResponseNormalization4D=function(t,e,n,r,o){return Ci("localResponseNormalization4D")},t.prototype.LRNGrad=function(t,e,n,r,o,a,i){return Ci("LRNGrad")},t.prototype.multinomial=function(t,e,n,r){return Ci("multinomial")},t.prototype.oneHot=function(t,e,n,r){return Ci("oneHot")},t.prototype.cumsum=function(t,e,n,r){return Ci("cumsum")},t.prototype.nonMaxSuppression=function(t,e,n,r,o){return Ci("nonMaxSuppression")},t.prototype.fft=function(t){return Ci("fft")},t.prototype.ifft=function(t){return Ci("ifft")},t.prototype.complex=function(t,e){return Ci("complex")},t.prototype.real=function(t){return Ci("real")},t.prototype.imag=function(t){return Ci("imag")},t.prototype.cropAndResize=function(t,e,n,r,o,a){return Ci("cropAndResize")},t.prototype.depthToSpace=function(t,e,n){return Ci("depthToSpace")},t.prototype.split=function(t,e,n){return Ci("split")},t.prototype.sparseToDense=function(t,e,n,r){return Ci("sparseToDense")},t.prototype.diag=function(t){return Ci("diag")},t.prototype.fill=function(t,e,n){return Ci("fill")},t.prototype.onesLike=function(t){return Ci("onesLike")},t.prototype.zerosLike=function(t){return Ci("zerosLike")},t.prototype.linspace=function(t,e,n){return Ci("linspace")},t.prototype.dispose=function(){return Ci("dispose")},t}();function Ci(t){throw new Error("'"+t+"' not yet implemented or not found in the registry. Did you forget to import the kernel?")}function Ri(t,e,n,r,o,a,i){void 0===i&&(i="channelsLast");var s,u=Li(e),c=u[0],l=u[1];if("channelsLast"===i)s=[c,l,t[3],t[3]];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);s=[c,l,t[1],t[1]]}return Ni(t,s,n,r,o,a,!1,i)}function Ii(t,e,n,r,o,a,i){void 0===i&&(i="NDHWC");var s,u,c=ki(e),l=c[0],h=c[1],d=c[2];if("NDHWC"===i)u="channelsLast",s=[l,h,d,t[4],t[4]];else{if("NCDHW"!==i)throw new Error("Unknown dataFormat "+i);u="channelsFirst",s=[l,h,d,t[1],t[1]]}return Oi(t,s,n,r,o,!1,u,a)}function Ni(t,e,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s="channelsLast");var u=[-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3];if("channelsLast"===s)c=t[0],l=t[1],h=t[2],d=t[3];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat "+s);c=t[0],d=t[1],l=t[2],h=t[3]}var f,p=e[0],m=e[1],g=e[3],v=Li(n),y=v[0],x=v[1],b=Li(r),w=b[0],_=b[1],S=Pi(p,w),M=Pi(m,_),E=function(t,e,n,r,o,a,i,s){var u,c,l;if("number"==typeof t){u={top:t,bottom:t,left:t,right:t,type:0===t?"VALID":"NUMBER"};var h=function(t,e,n,r,o){null==r&&(r=Di(t,e,n));var i=t[1],s=Fi((t[0]-e+2*r)/n+1,o);A(D(s),(function(){return"The output # of rows ("+s+") must be an integer. Change the stride and/or zero pad parameters"}));var u=Fi((i-e+2*r)/n+1,o);return A(D(u),(function(){return"The output # of columns ("+u+") must be an integer. Change the stride and/or zero pad parameters"})),[s,u]}([e,n],a,r,t,s);c=h[0],l=h[1]}else if("same"===t){c=Math.ceil(e/r),l=Math.ceil(n/o);var d=Math.max(0,(c-1)*r+a-e),f=Math.max(0,(l-1)*o+i-n),p=Math.floor(d/2),m=d-p,g=Math.floor(f/2);u={top:p,bottom:m,left:g,right:f-g,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-a+1)/r),l=Math.ceil((n-i+1)/o)}return{padInfo:u,outHeight:c,outWidth:l}}(o,l,h,y,x,S,M,a),T=E.padInfo,C=E.outHeight,R=E.outWidth,I=i?g*d:g;return"channelsFirst"===s?f=[c,I,C,R]:"channelsLast"===s&&(f=[c,C,R,I]),{batchSize:c,dataFormat:s,inHeight:l,inWidth:h,inChannels:d,outHeight:C,outWidth:R,outChannels:I,padInfo:T,strideHeight:y,strideWidth:x,filterHeight:p,filterWidth:m,effectiveFilterHeight:S,effectiveFilterWidth:M,dilationHeight:w,dilationWidth:_,inShape:t,outShape:f,filterShape:e}}function Oi(t,e,n,r,o,a,i,s){void 0===a&&(a=!1),void 0===i&&(i="channelsLast");var u=[-1,-1,-1,-1,-1],c=u[0],l=u[1],h=u[2],d=u[3],f=u[4];if("channelsLast"===i)c=t[0],l=t[1],h=t[2],d=t[3],f=t[4];else{if("channelsFirst"!==i)throw new Error("Unknown dataFormat "+i);c=t[0],f=t[1],l=t[2],h=t[3],d=t[4]}var p,m=e[0],g=e[1],v=e[2],y=e[4],x=ki(n),b=x[0],w=x[1],_=x[2],S=ki(r),M=S[0],E=S[1],T=S[2],C=Pi(m,M),R=Pi(g,E),I=Pi(v,T),N=function(t,e,n,r,o,a,i,s,u,c,l){var h,d,f,p;if("number"==typeof t){h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:0===t?"VALID":"NUMBER"};var m=function(t,e,n,r,o,a){null==o&&(o=Di(t,e,r));var s=t[1],u=t[2],c=Fi((t[0]-e+2*o)/r+1,a);A(D(c),(function(){return"The output # of depths ("+c+") must be an integer. Change the stride and/or zero pad parameters"}));var l=Fi((s-e+2*o)/r+1,a);A(D(l),(function(){return"The output # of rows ("+l+") must be an integer. Change the stride and/or zero pad parameters"}));var h=Fi((u-e+2*o)/r+1,a);return A(D(h),(function(){return"The output # of columns ("+h+") must be an integer. Change the stride and/or zero pad parameters"})),[c,l,h,1]}([e,n,r,1],s,0,o,t,l);d=m[0],f=m[1],p=m[2]}else if("same"===t){var g=((d=Math.ceil(e/o))-1)*o+s-e,v=((f=Math.ceil(n/a))-1)*a+u-n,y=((p=Math.ceil(r/i))-1)*i+c-r,x=Math.floor(g/2),b=g-x,w=Math.floor(v/2),_=v-w,S=Math.floor(y/2);h={top:w,bottom:_,left:S,right:y-S,front:x,back:b,type:"SAME"}}else{if("valid"!==t)throw Error("Unknown padding parameter: "+t);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},d=Math.ceil((e-s+1)/o),f=Math.ceil((n-u+1)/a),p=Math.ceil((r-c+1)/i)}return{padInfo:h,outDepth:d,outHeight:f,outWidth:p}}(o,l,h,d,b,w,_,C,R,I,s),O=N.padInfo,L=N.outDepth,k=N.outHeight,P=N.outWidth,F=a?y*f:y;return"channelsFirst"===i?p=[c,F,L,k,P]:"channelsLast"===i&&(p=[c,L,k,P,F]),{batchSize:c,dataFormat:i,inDepth:l,inHeight:h,inWidth:d,inChannels:f,outDepth:L,outHeight:k,outWidth:P,outChannels:F,padInfo:O,strideDepth:b,strideHeight:w,strideWidth:_,filterDepth:m,filterHeight:g,filterWidth:v,effectiveFilterDepth:C,effectiveFilterHeight:R,effectiveFilterWidth:I,dilationDepth:M,dilationHeight:E,dilationWidth:T,inShape:t,outShape:p,filterShape:e}}function Di(t,e,n,r){void 0===r&&(r=1);var o=Pi(e,r);return Math.floor((t[0]*(n-1)-n+o)/2)}function Li(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function ki(t){return"number"==typeof t?[t,t,t]:t}function Pi(t,e){return e<=1?t:t+(t-1)*(e-1)}function Fi(t,e){if(!e)return t;switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error("Unknown roundingMode "+e)}}function Bi(t){var e=Li(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function zi(t,e){return Bi(t)||Bi(e)}function Ui(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error("Unknown dataFormat "+t)}function Vi(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();var r=Mn(t.shape),o=t.toFloat(),a=n.complex(o,r);return r.dispose(),o.dispose(),a}if(!W(t.dtype,e))return zt.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){var i=n.real(t);return a=i.cast(e),i.dispose(),a}if("int32"===e)return n.int(t);if("bool"===e){var s=yn(0,t.dtype);return a=n.notEqual(t,s),s.dispose(),a}throw new Error("Error in Cast: failed to cast "+t.dtype+" to "+e)}function Gi(t,e){return zt.makeTensorFromDataId(t.dataId,e,t.dtype)}function Hi(t,e,n){var r=(e-t)/(n-1),o=at(n,"float32");o[0]=t;for(var a=1;a<o.length;a++)o[a]=o[a-1]+r;return xn(o,"float32")}var ji=Object.freeze({castTensor:Vi,reshapeTensor:Gi,linspaceImpl:Hi,upcastType:Nt,axesAreInnerMostDims:en,combineLocations:nn,computeOutAndReduceShapes:rn,expandShapeToKeepDim:on,assertAxesAreInnerMostDims:an,getAxesPermutation:sn,getUndoAxesPermutation:un,getInnerMostAxes:cn,getBroadcastDims:rr,getReductionAxes:ir,assertAndGetBroadcastShape:or,assertParamsConsistent:ln,computeOutShape:hn,computePool2DInfo:Ri,computePool3DInfo:Ii,computeConv2DInfo:Ni,computeConv3DInfo:Oi,computeDefaultPad:Di,tupleValuesAreOne:Bi,eitherStridesOrDilationsAreOne:zi,convertConv2DDataFormat:Ui,PARALLELIZE_THRESHOLD:30,computeOptimalWindowSize:ui});function Wi(t,e){if(t.length!==e.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+t.length+", imag: "+e.length+".");for(var n=new Float32Array(2*t.length),r=0;r<n.length;r+=2)n[r]=t[r/2],n[r+1]=e[r/2];return n}function qi(t,e){return{real:t[2*e],imag:t[2*e+1]}}function Xi(t,e,n,r){t[2*r]=e,t[2*r+1]=n}function Yi(t,e,n){var r=(n?2:-2)*Math.PI*(t/e);return{real:Math.cos(r),imag:Math.sin(r)}}function Ki(t,e,n){var r=function(t,e,n){return function(t,e,n){for(var r=0,o=t.length,a=0,i=!1;r<o;){var s=n(e,t[a=r+(o-r>>>1)]);s>0?r=a+1:(o=a,i=!s)}return i?r:-r-1}(t,e,n||Ji)}(t,e,n),o=r<0?-(r+1):r;t.splice(o,0,e)}function Ji(t,e){return t>e?1:t<e?-1:0}function Zi(t,e,n,r,o){return $i(t,e,n,r,o,0).selectedIndices}function Qi(t,e,n,r,o,a){var i=$i(t,e,n,r,o,a,!0);return i.numValidOutputs.dispose(),{selectedIndices:i.selectedIndices,selectedScores:i.selectedScores}}function $i(t,e,n,r,o,a,i,s){void 0===i&&(i=!1),void 0===s&&(s=!1);for(var u=Array.from(e).map((function(t,e){return{score:t,boxIndex:e,suppressBeginIndex:0}})).filter((function(t){return t.score>o})).sort(no),c=a>0?-.5/a:0,l=[],h=[];l.length<n&&u.length>0;){var d=u.pop(),f=d.score,p=d.boxIndex,m=d.suppressBeginIndex;if(f<o)break;for(var g=!1,v=l.length-1;v>=m;--v){var y=to(t,p,l[v]);if(y>=r){g=!0;break}if(d.score=d.score*eo(r,c,y),d.score<=o)break}d.suppressBeginIndex=l.length,g||(d.score===f?(l.push(p),h.push(d.score)):d.score>o&&Ki(u,d,no))}var x=l.length;return s&&(l.fill(0,x),h.fill(0,x)),{selectedIndices:xn(l,"int32"),selectedScores:xn(h,"float32"),numValidOutputs:yn(x,"int32")}}function to(t,e,n){var r=t.subarray(4*e,4*e+4),o=t.subarray(4*n,4*n+4),a=Math.min(r[0],r[2]),i=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(o[0],o[2]),l=Math.min(o[1],o[3]),h=Math.max(o[0],o[2]),d=Math.max(o[1],o[3]),f=(s-a)*(u-i),p=(h-c)*(d-l);if(f<=0||p<=0)return 0;var m=Math.max(a,c),g=Math.max(i,l),v=Math.min(s,h),y=Math.min(u,d),x=Math.max(v-m,0)*Math.max(y-g,0);return x/(f+p-x)}function eo(t,e,n){var r=Math.exp(e*n*n);return n<=t?r:0}function no(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}function ro(t,e,n){var r=new Array(t.rank).fill(0),o=t.shape.slice();return e.map((function(e){o[n]=e;var a=t.slice(r,o);return r[n]+=e,a}))}function io(t,e){for(var n=new Array(t.rank),r=0;r<n.length;r++)n[r]=t.shape[r]*e[r];var o=kn(n,t.dtype);for(r=0;r<o.values.length;++r){for(var a=o.indexToLoc(r),i=new Array(t.rank),s=0;s<i.length;s++)i[s]=a[s]%t.shape[s];var u=t.locToIndex(i);o.values[r]=t.values[u]}return o.toTensor()}function oo(t,e,n,r,o){for(var a=e[e.length-1],i=[t.length/a,a],s=i[0],u=i[1],c=V(n,s*r),l=V("int32",s*r),h=0;h<s;h++){for(var d=h*u,f=t.subarray(d,d+u),p=[],m=0;m<f.length;m++)p.push({value:f[m],index:m});p.sort((function(t,e){return e.value-t.value}));var g=h*r,v=c.subarray(g,g+r),y=l.subarray(g,g+r);for(m=0;m<r;m++)v[m]=p[m].value,y[m]=p[m].index}var x=e.slice();return x[x.length-1]=r,[gn(c,x,n),gn(l,x,"int32")]}function ao(t,e){for(var n=[],r=0;r<e.length;r++)e[r]&&n.push(r);var o=kn(t,"int32"),a=kn([n.length,t.length],"int32");for(r=0;r<n.length;r++){var i=o.indexToLoc(n[r]),s=r*t.length;a.values.set(i,s)}return a.toTensor()}var so=function(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("float v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        float result = "+r+";\n        setOutput(result);\n      }\n    "},uo=function(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map((function(t,e){return"T"+e}));var n=[];this.variableNames.forEach((function(t){n.push("vec4 v"+t+" = get"+t+"AtOutCoords();")}));var r=this.variableNames.map((function(t){return"v"+t})).join(" + ");this.userCode="\n      void main() {\n        "+n.join("\n        ")+"\n\n        vec4 result = "+r+";\n        setOutput(result);\n      }\n    "},co=function(t,e,n){this.variableNames=["A"];var r=t.windowSize,o=t.batchSize,a=t.inSize,i=Math.ceil(a/r);n||this.variableNames.push("bestIndicesA"),this.outputShape=[o,i];var s="max"===e?">":"<",u=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+r+";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < "+r+"; i++) {\n          int inIdx = "+u+";\n          float candidate = getA(batch, inIdx);\n          if (candidate "+s+" bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    "};function lo(t,e){return["x","y","z","w","u","v"].slice(0,e).map((function(e){return t+"."+e}))}function ho(t,e){return 1===e?[t]:lo(t,e)}function po(){var t,e,n,r,o,a,s,u,c,l;return 2===i().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",r="in",o="texture",a="outputColor",s="out vec4 outputColor;",u="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",c="",l="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",r="varying",o="texture2D",a="gl_FragColor",s="",u="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",c="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",l="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:r,texture2D:o,output:a,defineOutput:s,defineSpecialNaN:u,defineSpecialInf:c,defineRound:l}}function fo(t,e,n){void 0===n&&(n="index");var r=et(e);return r.map((function(e,o){return"int "+t[o]+" = "+n+" / "+e+"; "+(o===r.length-1?"int "+t[o+1]+" = "+n+" - "+t[o]+" * "+e:"index -= "+t[o]+" * "+e)+";"})).join("")}function mo(t){var e=et(t).map((function(t){return t.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * "+e[0]+" + coords.y * "+e[1]+" + coords.z;\n  }\n"}var go="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";function vo(t,e,n,r){var o=[];t.forEach((function(t){var e=N(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?o.push("uniform float "+t.name+(e>1?"["+e+"]":"")+";"):(o.push("uniform sampler2D "+t.name+";"),o.push("uniform int offset"+t.name+";"))}));var a,i,s=o.join("\n"),u=t.map((function(t){return function(t,e,n){void 0===n&&(n=!1);var r="";r+=n?function t(e){var n,r,o;switch(e.shapeInfo.logicalShape.length){case 0:return n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=po(),"\n    vec4 "+r+"() {\n      return "+o.texture2D+"("+n+", halfCR);\n    }\n  ";case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=po();return"\n    vec4 "+n+"(int index) {\n      vec2 uv = packedUVfrom1D(\n        "+o[0]+", "+o[1]+", index);\n      return "+a.texture2D+"("+e+", uv);\n    }\n  "}(e);case 2:return function(t){var e=t.shapeInfo.logicalShape,n=t.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),o=t.shapeInfo.texShape,a=o[0],i=o[1],s=po();if(null!=o&&O(e,o))return"\n      vec4 "+r+"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2("+i+".0, "+a+".0);\n\n        return "+s.texture2D+"("+n+", uv);\n      }\n    ";var u=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return"\n    vec4 "+r+"(int row, int col) {\n      vec2 uv = packedUVfrom2D("+Math.ceil(e[1]/2)+", "+u[0]+", "+u[1]+", row, col);\n      return "+s.texture2D+"("+n+", uv);\n    }\n  "}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=e.shapeInfo.texShape,a=[Math.ceil(c[0]/2),Math.ceil(c[1]/2)];if(1===n[0]){var s=Eo(e,n.slice(1));return"\n        "+t(s)+"\n        vec4 "+o+"(int b, int row, int col) {\n          return "+o+"("+li(["b","row","col"],[1,2])+");\n        }\n      "}var u=a[0],l=a[1],h=Math.ceil(n[2]/2);return"\n    vec4 "+o+"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        "+u+", "+l+", "+h*Math.ceil(n[1]/2)+", "+h+", b, row, col);\n      return "+po().texture2D+"("+r+", uv);\n    }\n  "}(e);default:return function(t){for(var e=t.shapeInfo.logicalShape,n=e.length,r=t.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),a=t.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],s=i[0],u=i[1],c=Math.ceil(e[n-1]/2),l=c*Math.ceil(e[n-2]/2),h="int b, int row, int col",d="b * "+l+" + (row / 2) * "+c+" + (col / 2)",f=2;f<n-1;f++)h="int b"+f+", "+h,d="b"+f+" * "+(l*=e[n-f-1])+" + "+d;return"\n    vec4 "+o+"("+h+") {\n      int index = "+d+";\n      int texR = index / "+u+";\n      int texC = index - texR * "+u+";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+u+", "+s+");\n      return "+po().texture2D+"("+r+", uv);\n    }\n  "}(e)}}(t):function t(e){var n=e.shapeInfo.logicalShape;switch(n.length){case 0:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"float "+n+"() {return "+e+";}";var r=t.shapeInfo.texShape,o=r[0],a=r[1];if(1===o&&1===a)return"\n      float "+n+"() {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=t.shapeInfo.texShape;return"\n    float "+n+"() {\n      vec2 uv = uvFromFlat("+i[0]+", "+i[1]+", "+_o(e)+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 1:return function(t){var e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return"\n      float "+n+"(int index) {\n        "+So(t)+"\n      }\n    ";var r=t.shapeInfo.texShape,o=r[0],a=r[1];if(1===a&&1===o)return"\n      float "+n+"(int index) {\n        return sampleTexture("+e+", halfCR);\n      }\n    ";var i=_o(e);return 1===a?"\n      float "+n+"(int index) {\n        vec2 uv = vec2(0.5, (float(index + "+i+") + 0.5) / "+o+".0);\n        return sampleTexture("+e+", uv);\n      }\n    ":1===o?"\n      float "+n+"(int index) {\n        vec2 uv = vec2((float(index + "+i+") + 0.5) / "+a+".0, 0.5);\n        return sampleTexture("+e+", uv);\n      }\n    ":"\n    float "+n+"(int index) {\n      vec2 uv = uvFromFlat("+o+", "+a+", index + "+i+");\n      return sampleTexture("+e+", uv);\n    }\n  "}(e);case 2:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=e.shapeInfo.texShape;if(null!=c&&O(n,c)){var a=c[0];return"\n    float "+o+"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2("+c[1]+".0, "+a+".0);\n      return sampleTexture("+r+", uv);\n    }\n  "}var s=U(n),u=s.newShape,l=s.keptDims,h=u;if(h.length<n.length){var d=Eo(e,h);return"\n      "+t(d)+"\n      float "+o+"(int row, int col) {\n        return "+o+"("+li(["row","col"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2("+n[1]+", 1)));\n        "+So(e)+"\n      }\n    ";var f=c[0],m=c[1],p=_o(r);return 1===m?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / "+f+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":1===f?"\n    float "+o+"(int row, int col) {\n      float index = dot(vec3(row, col, "+p+"), vec3("+n[1]+", 1, 1));\n      vec2 uv = vec2((index + 0.5) / "+m+".0, 0.5);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n  float "+o+"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * "+n[1]+" + col + "+p+";\n    vec2 uv = uvFromFlat("+f+", "+m+", index);\n    return sampleTexture("+r+", uv);\n  }\n"}(e);case 3:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[1]*n[2],a=n[2],i=U(n),s=i.newShape,u=i.keptDims,l=s;if(l.length<n.length){var h=Eo(e,l);return"\n        "+t(h)+"\n        float "+o+"(int row, int col, int depth) {\n          return "+o+"("+li(["row","col","depth"],u)+");\n        }\n      "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3("+c+", "+a+", 1)));\n        "+So(e)+"\n      }\n    ";var d=e.shapeInfo.texShape,f=d[0],m=d[1],p=e.shapeInfo.flatOffset;return m===c&&null==p?"\n        float "+o+"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2("+a+", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2("+m+".0, "+f+".0);\n          return sampleTexture("+r+", uv);\n        }\n      ":m===a&&null==p?"\n    float "+o+"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2("+n[1]+", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+m+".0, "+f+".0);\n      return sampleTexture("+r+", uv);\n    }\n  ":"\n      float "+o+"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * "+c+" + col * "+a+" + depth + "+_o(r)+";\n        vec2 uv = uvFromFlat("+f+", "+m+", index);\n        return sampleTexture("+r+", uv);\n      }\n  "}(e);case 4:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[3],a=n[2]*c,i=n[1]*a,s=U(n),u=s.newShape,l=s.keptDims;if(u.length<n.length){var h=Eo(e,u);return"\n      "+t(h)+"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        return "+o+"("+li(["row","col","depth","depth2"],l)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4("+i+", "+a+", "+c+", 1)));\n        "+So(e)+"\n      }\n    ";var d=e.shapeInfo.flatOffset,f=e.shapeInfo.texShape,m=f[0],p=f[1];return p===i&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3("+a+", "+c+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+p+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":p===c&&null==d?"\n      float "+o+"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3("+n[1]*n[2]+", "+n[2]+", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+p+".0, "+m+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+i+" + col * "+a+" +\n          depth * "+c+" + depth2;\n      vec2 uv = uvFromFlat("+m+", "+p+", index + "+_o(r)+");\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 5:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=n[4],a=n[3]*c,i=n[2]*a,s=n[1]*i,u=U(n),l=u.newShape,h=u.keptDims;if(l.length<n.length){var d=Eo(e,l);return"\n      "+t(d)+"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        return "+o+"("+li(["row","col","depth","depth2","depth3"],h)+");\n      }\n    "}if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+s+", "+i+", "+a+", "+c+")) +\n          depth3;\n        "+So(e)+"\n      }\n    ";var f=e.shapeInfo.flatOffset,m=e.shapeInfo.texShape,p=m[0],v=m[1];return v===s&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4("+i+", "+a+", "+c+", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":v===c&&null==f?"\n      float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]+",\n               "+n[2]*n[3]+", "+n[3]+", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+v+".0, "+p+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+s+" + col * "+i+" + depth * "+a+" +\n          depth2 * "+c+" + depth3 + "+_o(r)+";\n      vec2 uv = uvFromFlat("+p+", "+v+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);case 6:return function(e){var n=e.shapeInfo.logicalShape,r=e.name,o="get"+r.charAt(0).toUpperCase()+r.slice(1),c=U(n),a=c.newShape,i=c.keptDims;if(a.length<n.length){var s=Eo(e,a);return"\n      "+t(s)+"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return "+o+"("+li(["row","col","depth","depth2","depth3","depth4"],i)+");\n      }\n    "}var u=n[5],l=n[4]*u,h=n[3]*l,d=n[2]*h,f=n[1]*d;if(e.shapeInfo.isUniform)return"\n      float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4("+f+", "+d+", "+h+", "+l+")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2("+u+", 1)));\n        "+So(e)+"\n      }\n    ";var m=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],g=p[1];return g===f&&null==m?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4("+d+", "+h+", "+l+", "+u+")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":g===u&&null==m?"\n      float "+o+"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4("+n[1]*n[2]*n[3]*n[4]+",\n               "+n[2]*n[3]*n[4]+",\n               "+n[3]*n[4]+",\n               "+n[4]+")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2("+g+".0, "+v+".0);\n        return sampleTexture("+r+", uv);\n      }\n    ":"\n    float "+o+"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * "+f+" + col * "+d+" + depth * "+h+" +\n          depth2 * "+l+" + depth3 * "+u+" + depth4 + "+_o(r)+";\n      vec2 uv = uvFromFlat("+v+", "+g+", index);\n      return sampleTexture("+r+", uv);\n    }\n  "}(e);default:throw new Error(n.length+"-D input sampling is not yet supported")}}(t);var o=t.shapeInfo.logicalShape,a=e.logicalShape;return o.length<=a.length&&(r+=n?function(t,e){var n,r=t.name,o=r.charAt(0).toUpperCase()+r.slice(1),a="get"+o+"AtOutCoords",i=t.shapeInfo.logicalShape.length,s=e.logicalShape.length,u=rr(t.shapeInfo.logicalShape,e.logicalShape),c=Mo(s),l=s-i,h=["x","y","z","w","u","v"];n=0===i?"":s<2&&u.length>=1?"coords = 0;":u.map((function(t){return"coords."+h[t+l]+" = 0;"})).join("\n");var d;d=s<2&&i>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+h[e+l]})).join(", ");var f="return outputValue;",p=1===N(t.shapeInfo.logicalShape),m=1===N(e.logicalShape);if(1!==i||p||m){if(p&&!m)f=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var g=i-2,v=i-1;u.indexOf(g)>-1&&u.indexOf(v)>-1?f="return vec4(outputValue.x);":u.indexOf(g)>-1?f="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(v)>-1&&(f="return vec4(outputValue.xx, outputValue.zz);")}}else f="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 "+a+"() {\n      "+c+" coords = getOutputCoords();\n      "+n+"\n      vec4 outputValue = get"+o+"("+d+");\n      "+f+"\n    }\n  "}(t,e):function(t,e){var n=t.name,r=n.charAt(0).toUpperCase()+n.slice(1),o="get"+r+"AtOutCoords",a=e.texShape,i=t.shapeInfo.texShape,s=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&s===u&&null==t.shapeInfo.flatOffset&&O(i,a))return"\n      float "+o+"() {\n        return sampleTexture("+n+", resultUV);\n      }\n    ";var c=Mo(u),l=rr(t.shapeInfo.logicalShape,e.logicalShape),h=u-s,d=["x","y","z","w","u","v"];return"\n    float "+o+"() {\n      "+c+" coords = getOutputCoords();\n      "+(0===s?"":u<2&&l.length>=1?"coords = 0;":l.map((function(t){return"coords."+d[t+h]+" = 0;"})).join("\n"))+"\n      return get"+r+"("+(u<2&&s>0?"coords":t.shapeInfo.logicalShape.map((function(t,e){return"coords."+d[e+h]})).join(", "))+");\n    }\n  "}(t,e)),r}(t,e,r)})).join("\n"),c=e.texShape,l=po(),h=function(t){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return "+t.texture2D+"(textureSampler, uv).r;\n    }\n  "}(l),d=function(t){return t.version+"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    "+t.varyingFs+" vec2 resultUV;\n    "+t.defineOutput+"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    "+t.defineSpecialNaN+"\n    "+t.defineSpecialInf+"\n    "+t.defineRound+"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    "+yo+"\n    "+xo+"\n    "+bo+"\n  "}(l);return e.isPacked?(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * "+n[1]+".0);\n      }\n    ":1===n[1]?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * "+n[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      return 2 * (resTexRC.x * "+n[1]+" + resTexRC.y);\n    }\n  "}(0,e);case 2:return function(t,e){var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(O(t,e))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2("+n[0]+", "+n[1]+"));\n      }\n    ";var r=Math.ceil(t[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=t,r=e,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=(a=Math.ceil(n[2]/2))*Math.ceil(n[1]/2),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+o[0]+", "+o[1]+"));\n      int index = resTexRC.x * "+o[1]+" + resTexRC.y;\n\n      int b = index / "+i+";\n      index -= b * "+i+";\n\n      int r = 2 * (index / "+a+");\n      int c = imod(index, "+a+") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";default:return function(t,e){for(var n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],r=Math.ceil(t[t.length-1]/2),o=r*Math.ceil(t[t.length-2]/2),a=o,i="",s="b, r, c",u=2;u<t.length-1;u++)i="\n      int b"+u+" = index / "+(a*=t[t.length-u-1])+";\n      index -= b"+u+" * "+a+";\n    "+i,s="b"+u+", "+s;return"\n    ivec"+t.length+" getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n\n      "+i+"\n\n      int b = index / "+o+";\n      index -= b * "+o+";\n\n      int r = 2 * (index / "+r+");\n      int c = imod(index, "+r+") * 2;\n\n      return ivec"+t.length+"("+s+");\n    }\n  "}(t,e)}var n,r,o,a,i}(e.logicalShape,c),i=function(t){return"\n    void setOutput(vec4 val) {\n      "+t.output+" = val;\n    }\n  "}(l)):(a=function(t,e){switch(t.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(t,e){return 1===e[0]?"\n      int getOutputCoords() {\n        return int(resultUV.x * "+e[1]+".0);\n      }\n    ":1===e[1]?"\n      int getOutputCoords() {\n        return int(resultUV.y * "+e[0]+".0);\n      }\n    ":"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      return resTexRC.x * "+e[1]+" + resTexRC.y;\n    }\n  "}(0,e);case 2:return function(t,e){return O(t,e)?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2("+e[0]+", "+e[1]+"));\n      }\n    ":1===t[1]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":1===t[0]?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2("+e[0]+", "+e[1]+"));\n        int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      int r = index / "+t[1]+";\n      int c = index - r * "+t[1]+";\n      return ivec2(r, c);\n    }\n  "}(t,e);case 3:return n=e,r=fo(["r","c","d"],t),"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2("+n[0]+", "+n[1]+"));\n      int index = resTexRC.x * "+n[1]+" + resTexRC.y;\n      "+r+"\n      return ivec3(r, c, d);\n    }\n  ";case 4:return function(t,e){var n=fo(["r","c","d","d2"],t);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n      "+n+"\n      return ivec4(r, c, d, d2);\n    }\n  "}(t,e);case 5:return function(t,e){var n=fo(["r","c","d","d2","d3"],t);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2("+e[0]+",\n                             "+e[1]+"));\n\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  "}(t,e);case 6:return function(t,e){var n=fo(["r","c","d","d2","d3","d4"],t);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2("+e[0]+", "+e[1]+"));\n      int index = resTexRC.x * "+e[1]+" + resTexRC.y;\n\n      "+n+"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  "}(t,e);default:throw new Error(t.length+"-D output sampling is not yet supported")}var n,r}(e.logicalShape,c),i=function(t){return"\n    void setOutput(float val) {\n      "+t.output+" = vec4(val, 0, 0, 0);\n    }\n  "}(l)),r&&(d+=wo),[d,h,i,s,a,u,n].join("\n")}var yo="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",xo="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",bo="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",wo="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function _o(t){return"offset"+t}function So(t){var e=t.name,n=N(t.shapeInfo.logicalShape);return n<2?"return "+e+";":"\n    for (int i = 0; i < "+n+"; i++) {\n      if (i == index) {\n        return "+e+"[i];\n      }\n    }\n  "}function Mo(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error("GPU for rank "+t+" is not yet supported")}function Eo(t,e){var n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function li(t,e){return e.map((function(e){return t[e]})).join(", ")}var To=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,A(t.length>2,(function(){return"Packed arg"+(n.charAt(0).toUpperCase()+n.slice(1))+" supports only inputs with rank above 2."}));var o=t[t.length-1],a=Math.ceil(o/e);this.outputShape=t.slice(0,-1),a>1&&this.outputShape.push(a),r||this.variableNames.push("bestIndicesA");var i,s,u=this.outputShape,c=u.length,l=Mo(c),h=ho("coords",c);if(1===a){var d=Mo(s=c+1);i="\n        "+d+" sourceLocR = "+d+"("+h.join()+", 0);\n        ++"+h[c-1]+";\n        "+d+" sourceLocG = "+d+"("+h.join()+", 0);\n        ++"+h[c-2]+";\n        "+d+" sourceLocA = "+d+"("+h.join()+", 0);\n        --"+h[c-1]+";\n        "+d+" sourceLocB = "+d+"("+h.join()+", 0);\n        --"+h[c-2]+";"}else s=c,i="\n        "+l+" sourceLocR = coords;\n        ++"+h[c-1]+";\n        "+l+" sourceLocG = coords;\n        ++"+h[c-2]+";\n        "+l+" sourceLocA = coords;\n        --"+h[c-1]+";\n        "+l+" sourceLocB = coords;\n        --"+h[c-2]+";";var f=["x","y","z","w","u","v"].slice(0,s),p="."+f[s-1],m=f.map((function(t){return"int "+t})),g=ho("sourceLocR",s-1).concat("inIdx.r"),v=ho("sourceLocG",s-1).concat("inIdx.g"),y=ho("sourceLocB",s-1).concat("inIdx.b"),x=ho("sourceLocA",s-1).concat("inIdx.a"),b="max"===n?"greaterThan":"lessThan",w=r?"":"\n          inIdx = round(vec4(getBestIndicesAChannel("+g.join()+"),\n                             getBestIndicesAChannel("+v.join()+"),\n                             getBestIndicesAChannel("+y.join()+"),\n                             getBestIndicesAChannel("+x.join()+")));",_="vec4(\n            getAChannel("+g.join()+"),\n            hasNextCol ? getAChannel("+v.join()+") : 0.,\n            hasNextRow ? getAChannel("+y.join()+") : 0.,\n            hasNextRow && hasNextCol ? getAChannel("+x.join()+") : 0.)",S=r?"":"\n      float getBestIndicesAChannel("+m.join()+") {\n        return getChannel(getBestIndicesA("+f.join()+"),\n                                          vec2("+f.slice(-2).join()+"));\n      }";this.userCode="\n      float getAChannel("+m.join()+") {\n        return getChannel(getA("+f.join()+"),\n                               vec2("+f.slice(-2).join()+"));\n      }\n      "+S+"\n      void main() {\n        "+l+" coords = getOutputCoords();\n        bool hasNextCol = "+h[c-1]+" < "+(u[c-1]-1)+";\n        bool hasNextRow = "+h[c-2]+" < "+(u[c-2]-1)+";\n        "+i+"\n        ivec4 srcIdx = ivec4(sourceLocR"+p+", sourceLocG"+p+",\n          sourceLocB"+p+", sourceLocA"+p+") * "+e+";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = "+_+";\n\n        for (int i = 0; i < "+e+"; i++) {\n          inIdx = srcIdx;\n          "+w+"\n          vec4 candidate = "+_+";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4("+b+"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    "},Ao=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=s-1-t.padInfo.top,l=u-1-t.padInfo.left,h=1/(e*n);this.userCode="\n      const ivec2 pads = ivec2("+c+", "+l+");\n      const float avgMultiplier = float("+h+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+s+";\n            wR += "+a+") {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+u+";\n            wC+= "+i+") {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Co=function(t){this.variableNames=["dy"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,f=l-1-t.padInfo.front,p=h-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(e*n*r);this.userCode="\n      const ivec3 pads = ivec3("+f+", "+p+", "+m+");\n      const float avgMultiplier = float("+g+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+l+";\n            wD += "+s+") {\n          float dyD = float(dyDCorner + wD) / "+o+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+h+";\n              wR += "+u+") {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+d+";\n                wC += "+c+") {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ro=function(t,e,n,r,o,a){this.outputShape=[],this.variableNames=["x","mean","variance"],or(t,e),or(t,n);var i="0.0";null!=r&&(or(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="1.0";null!=o&&(or(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = "+i+";\n        float scale = "+s+";\n        float inv = scale * inversesqrt(variance + float("+a+"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    "},Io=function(t,e,n,r,o,a){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],or(t,e),or(t,n);var i="vec4(0.0)";null!=r&&(or(t,r),this.variableNames.push("offset"),i="getOffsetAtOutCoords()");var s="vec4(1.0)";null!=o&&(or(t,o),this.variableNames.push("scale"),s="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = "+i+";\n        vec4 scale = "+s+";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4("+a+"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    "},No=function(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=or(e,n),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        "+t+"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    "},Oo="return a + b;",Do="return a - b;",Lo="return a * b;",ko="return (a < 0.) ? b * a : a;",Po=function(t,e,n){this.variableNames=["A","B"],this.outputShape=or(e,n),this.userCode="\n      float binaryOperation(float a, float b) {\n        "+t+"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    "},Fo="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n",Bo=function(t,e,n,r){void 0===r&&(r=!1),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=or(e,n);var o=this.outputShape.length,a="";if(r)if(0===o||1===N(this.outputShape))a="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else if(a="\n          "+Mo(o)+" coords = getOutputCoords();\n        ",1===o)a+="\n            result.y = (coords + 1) >= "+this.outputShape[0]+" ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ";else{var i=ho("coords",o);a+="\n            bool nextRowOutOfBounds =\n              ("+i[o-2]+" + 1) >= "+this.outputShape[o-2]+";\n            bool nextColOutOfBounds =\n              ("+i[o-1]+" + 1) >= "+this.outputShape[o-1]+";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        "+t+"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        "+a+"\n\n        setOutput(result);\n      }\n    "},zo=function(){function t(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Uo=function(){function t(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t,e){var n=this;return function(r,o){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(o,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(o,"maxVal")),r.gl.uniform1f(n.minLoc,t),r.gl.uniform1f(n.maxLoc,e)}},t}(),Vo=function(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "},Go=function(t){this.outputShape=[],this.outputShape=hn(t,1),this.variableNames=t.map((function(t,e){return"T"+e}));var e=new Array(t.length-1);e[0]=t[0][1];for(var n=1;n<e.length;n++)e[n]=e[n-1]+t[n][1];var r=["if (yC < "+e[0]+") setOutput(getT0(yR, yC));"];for(n=1;n<e.length;n++){var o=e[n-1];r.push("else if (yC < "+e[n]+") setOutput(getT"+n+"(yR, yC-"+o+"));")}var a=e.length,i=e[e.length-1];r.push("else setOutput(getT"+a+"(yR, yC-"+i+"));"),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        "+r.join("\n        ")+"\n      }\n    "},Ho=function(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hn(t,e);var n=this.outputShape,r=n.length,o=Mo(r),a=ho("coords",r),i=["x","y","z","w","u","v"].slice(0,r);this.variableNames=t.map((function(t,e){return"T"+e}));var s=new Array(t.length-1);s[0]=t[0][e];for(var u=1;u<s.length;u++)s[u]=s[u-1]+t[u][e];var c=i[e],l=i.slice(-2),h=i.join(),d="if ("+c+" < "+s[0]+") {\n        return getChannel(\n            getT0("+h+"), vec2("+l.join()+"));\n        }";for(u=1;u<s.length;u++){var f=s[u-1];d+="\n        if ("+c+" < "+s[u]+"  && "+c+" >= "+s[u-1]+") {\n          return getChannel(\n            getT"+u+"("+jo(i,c,f)+"),\n            vec2("+jo(l,c,f)+"));\n        }"}var p=s.length,m=s[s.length-1];d+="\n        return getChannel(\n          getT"+p+"("+jo(i,c,m)+"),\n          vec2("+jo(l,c,m)+"));",this.userCode="\n      float getValue("+i.map((function(t){return"int "+t}))+") {\n        "+d+"\n      }\n\n      void main() {\n        "+o+" coords = getOutputCoords();\n        vec4 result = vec4(getValue("+a+"), 0., 0., 0.);\n\n        "+a[r-1]+" = "+a[r-1]+" + 1;\n        if ("+a[r-1]+" < "+n[r-1]+") {\n          result.g = getValue("+a+");\n        }\n\n        "+a[r-2]+" = "+a[r-2]+" + 1;\n        if ("+a[r-2]+" < "+n[r-2]+") {\n          result.a = getValue("+a+");\n        }\n\n        "+a[r-1]+" = "+a[r-1]+" - 1;\n        if ("+a[r-2]+" < "+n[r-2]+" &&\n            "+a[r-1]+" < "+n[r-1]+") {\n          result.b = getValue("+a+");\n        }\n        setOutput(result);\n      }\n    "};function jo(t,e,n){var r=t.indexOf(e);return t.map((function(t,e){return e===r?t+" - "+n:t})).join()}var Wo=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,a="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              if ("+a+") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},qo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a="channelsLast"===t.dataFormat,i=e-1-t.padInfo.top,s=n-1-t.padInfo.left,u=a?1:2,c=a?2:3,l=a?3:1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords["+l+"];\n\n        ivec2 dyCorner = ivec2(coords["+u+"], coords["+c+"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n\n              if ("+a+") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Xo=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.padInfo.front,a=t.padInfo.top,i=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yF = 0; yF < "+t.outDepth+"; yF++) {\n            int xF = wF + yF * "+e+" - "+o+";\n\n            if (xF < 0 || xF >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n              int xR = wR + yR * "+n+" - "+a+";\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n                int xC = wC + yC * "+r+" - "+i+";\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Yo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterDepth,n=t.filterHeight,r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=r-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3("+s+", "+u+", "+c+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+e+"; wF++) {\n          float dyF = float(dyFCorner + wF) / "+o+".0;\n\n          if (dyF < 0.0 || dyF >= "+t.outDepth+".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = "+e+" - 1 - wF;\n\n          for (int wR = 0; wR < "+n+"; wR++) {\n            float dyR = float(dyRCorner + wR) / "+a+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = "+n+" - 1 - wR;\n\n            for (int wC = 0; wC < "+r+"; wC++) {\n              float dyC = float(dyCCorner + wC) / "+i+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = "+r+" - 1 - wC;\n\n              for (int d2 = 0; d2 < "+t.outChannels+"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ko=function(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;var e=t.strideHeight,n=t.strideWidth,r=t.padInfo.top,o=t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * "+a+" + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < "+t.batchSize+"; b++) {\n          for (int yR = 0; yR < "+t.outHeight+"; yR++) {\n            int xR = wR + yR * "+e+" - "+r+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int yC = 0; yC < "+t.outWidth+"; yC++) {\n              int xC = wC + yC * "+n+" - "+o+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Jo=function(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;var e=t.filterHeight,n=t.filterWidth,r=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.top,i=n-1-t.padInfo.left,s=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2("+a+", "+i+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < "+e+"; wR++) {\n          float dyR = float(dyRCorner + wR) / "+r+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = "+e+" - 1 - wR;\n\n          for (int wC = 0; wC < "+n+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+o+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = "+n+" - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < "+s+"; dm++) {\n              int d2 = d1 * "+s+" + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Zo=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,a=t.padInfo.left,i=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,d=4*Math.floor(t.inChannels/4),f=t.inChannels%4,p="channelsLast"===t.dataFormat,m=p?1:2,g=p?2:3,v=p?3:1,y="",x="";n&&(y=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",x="result = activation(result);");var b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+y+"\n\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+o+", "+a+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords["+v+"];\n\n        ivec2 xRCCorner =\n            ivec2(coords["+m+"], coords["+g+"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+l+"; wR++) {\n          int xR = xRCorner + wR * "+u+";\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+h+"; wC++) {\n            int xC = xCCorner + wC * "+c+";\n\n            if (xC < 0 || xC >= "+t.inWidth+") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < "+d+"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if ("+p+") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if ("+(1===f)+") {\n\n              if ("+p+") {\n                dotProd +=\n                    getX(batch, xR, xC, "+d+") *\n                    getW(wR, wC, "+d+", d2);\n              } else {\n                dotProd +=\n                    getX(batch, "+d+", xR, xC) *\n                    getW(wR, wC, "+d+", d2);\n              }\n\n            } else if ("+(2===f)+") {\n              vec2 wValues = vec2(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2)\n              );\n\n              if ("+p+") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if ("+(3===f)+") {\n              vec3 wValues = vec3(\n                getW(wR, wC, "+d+", d2),\n                getW(wR, wC, "+d+" + 1, d2),\n                getW(wR, wC, "+d+" + 2, d2)\n              );\n\n              if ("+p+") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, "+d+"),\n                  getX(batch, xR, xC, "+d+" + 1),\n                  getX(batch, xR, xC, "+d+" + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, "+d+", xR, xC),\n                  getX(batch, "+d+" + 1, xR, xC),\n                  getX(batch, "+d+" + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        "+b+"\n        "+x+"\n        setOutput(result);\n      }\n    "},Qo=function(t){this.variableNames=["x","W"],this.outputShape=t.outShape;var e=t.padInfo.front,n=t.padInfo.top,r=t.padInfo.left,o=t.strideDepth,a=t.strideHeight,i=t.strideWidth,s=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,d=t.filterWidth,f=4*Math.floor(t.inChannels/4),p=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3("+o+", "+a+", "+i+");\n      const ivec3 pads = ivec3("+e+", "+n+", "+r+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < "+l+"; wF++) {\n          int xF = xFCorner + wF * "+s+";\n\n          if (xF < 0 || xF >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+h+"; wR++) {\n            int xR = xRCorner + wR * "+u+";\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+d+"; wC++) {\n              int xC = xCCorner + wC * "+c+";\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < "+f+"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if ("+(1===p)+") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, "+f+") *\n                  getW(wF, wR, wC, "+f+", d2);\n              } else if ("+(2===p)+") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if ("+(3===p)+") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, "+f+"),\n                  getX(batch, xF, xR, xC, "+f+" + 1),\n                  getX(batch, xF, xR, xC, "+f+" + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, "+f+", d2),\n                  getW(wF, wR, wC, "+f+" + 1, d2),\n                  getW(wF, wR, wC, "+f+" + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},$o=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=t.outChannels/t.inChannels,m="",g="";n&&(m=r?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"\n          float activation(float x) {\n            "+n+"\n          }\n        ",g="result = activation(result);");var v=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+m+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / "+p+";\n        int q = d2 - d1 * "+p+";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < "+d+"; wR++) {\n          int xR = xRCorner + wR * "+l+";\n\n          if (xR < 0 || xR >= "+o+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+f+"; wC++) {\n            int xC = xCCorner + wC * "+h+";\n\n            if (xC < 0 || xC >= "+a+") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        "+v+"\n        "+g+"\n        setOutput(result);\n      }\n    "},ta=function(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=null),void 0===r&&(r=!1),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,a=t.inWidth,i=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,p=f,m="int xR; int xC; int xCOffset;",g=0;g<d;g++)for(var v=0;v<f;v++)m+="\n          vec4 xTexelR"+g+"C"+2*v+" = vec4(0.);\n          vec4 wR"+g+"C"+v+" = vec4(0.);\n          vec4 xR"+g+"C"+v+" = vec4(0.);";for(g=0;g<d;g++)for(var y=0;y<p;y++){if(m+="\n          xR = xRCorner + "+g*l+";\n          xC = xCCorner + "+(v=2*y)*h+";\n        ",1===c){if(v<f&&(m+=s%2==1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    xTexelR"+g+"C"+v+".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < "+o+" && xCOffset >= 0 && xCOffset < "+a+") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= "+a+") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR"+g+"C"+v+" = vec4(previous.zw, xTexelR"+g+"C"+v+".xy);\n                } else {\n                  xR"+g+"C"+v+" = vec4(0, 0, xTexelR"+g+"C"+v+".xy);\n                }\n              ":"\n                if(xR >= 0 && xR < "+o+" && xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = xTexelR"+g+"C"+v+";\n              ",v+1<f)){var x=s%2==0?b(h):h;h%2==0&&s%2==1||h%2!=0&&s%2!=1?(m+="\n                  xCOffset = xC + "+s%2+" + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n                ",h>1&&(m+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < "+o+" &&\n                      xCOffset >= 0 && xCOffset < "+a+") {\n                      xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR"+g+"C"+v+" = vec4(0.);\n                    }\n                  "),m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".xy);\n                "):m+="\n                  xCOffset = xC + "+x+";\n\n                  if(xR >= 0 && xR < "+o+" &&\n                    xCOffset >= 0 && xCOffset < "+a+") {\n                    xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR"+g+"C"+(v+1)+" = xTexelR"+g+"C"+(v+2)+";\n                "}}else v<f&&(m+="\n              if(xR >= 0 && xR < "+o+") {\n            ",s%2==1?(m+="\n                xCOffset = xC + 1 - "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n              ",v+1<f&&(m+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + "+c+";\n                  if(xCOffset >= 0 && xCOffset < "+a+") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR"+g+"C"+(v+1)+" = vec4(xTexelR"+g+"C"+(v+2)+".xy, final.xy);\n                ")):(m+="\n                if(xC >= 0 && xC < "+a+") {\n                  xTexelR"+g+"C"+v+" = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR"+g+"C"+v+" = vec4(0.);\n                }\n\n                xCOffset = xC + "+c+";\n                if(xCOffset >= 0 && xCOffset < "+a+") {\n                  xTexelR"+g+"C"+(v+2)+" = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR"+g+"C"+(v+2)+" = vec4(0.);\n                }\n\n                xR"+g+"C"+v+" = vec4(\n                  xTexelR"+g+"C"+v+".xy, xTexelR"+g+"C"+(v+2)+".xy);\n              ",v+1<f&&(m+="\n                  xR"+g+"C"+(v+1)+" = vec4(\n                    xTexelR"+g+"C"+v+".zw, xTexelR"+g+"C"+(v+2)+".zw);\n                ")),m+="}");v<f&&(m+="\n            vec4 wTexelR"+g+"C"+v+" = getW("+g+", "+v+", d1, q);\n            wR"+g+"C"+v+" = vec4(wTexelR"+g+"C"+v+".xz, wTexelR"+g+"C"+v+".xz);\n          ",v+1<f&&(m+="\n              vec4 wTexelR"+g+"C"+(v+1)+" = getW("+g+", "+(v+1)+", d1, q);\n              wR"+g+"C"+(v+1)+" =\n                vec4(wTexelR"+g+"C"+(v+1)+".xz, wTexelR"+g+"C"+(v+1)+".xz);"))}for(g=0;g<d;g++)for(v=0;v<f;v++)m+="dotProd += xR"+g+"C"+v+" * wR"+g+"C"+v+";";var w="",_="";n&&(w=r?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+n+"\n        }":"vec4 activation(vec4 x) {\n          "+n+"\n        }",_="result = activation(result);");var S=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),r&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+w+"\n\n      const ivec2 strides = ivec2("+u+", "+c+");\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        "+m+"\n\n        vec4 result = dotProd;\n        "+S+"\n        "+_+"\n        setOutput(result);\n      }\n    "},ea=function(t,e,n,r,o){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var a=t[0],i=t[1],s=t[2],u=t[3],c=e[0],l=n[0],h=n[1];this.outputShape=[c,l,h,u];var d="bilinear"===r?1:0,f=[i-1+".0",s-1+".0"],p=f[0],m=f[1],g=l>1?[""+(i-1)/(l-1),"(y2-y1) * height_ratio","y1*"+p+" + float(y)*(height_scale)"]:["0.0","0.0","0.5 * (y1+y2) * "+p],v=g[0],y=g[1],x=g[2],b=h>1?[""+(s-1)/(h-1),"(x2-x1) * width_ratio","x1*"+m+" + float(x)*(width_scale)"]:["0.0","0.0","0.5 * (x1+x2) * "+m],w=b[0],_=b[1],S=b[2];this.userCode="\n      const float height_ratio = float("+v+");\n      const float width_ratio = float("+w+");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= "+a+") {\n          return;\n        }\n\n        float height_scale = "+y+";\n        float width_scale = "+_+";\n\n        float in_y = "+x+";\n        if( in_y < 0.0 || in_y > "+p+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n        float in_x = "+S+";\n        if( in_x < 0.0 || in_x > "+m+" ) {\n          setOutput(float("+o+"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if("+d+" == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    "},na=function(t,e,n){this.variableNames=["x"],this.outputShape=t;var r=t.length,o=t[t.length-1],a=n?"<":">";this.userCode="\n      int getIndex(int i) {\n        "+(n?"return "+o+" -i - 1;":"return i;")+"\n      }\n\n      void main() {\n        "+Mo(r)+" coords = getOutputCoords();\n        int end = "+ra(r,"coords")+";\n        float val = 0.0;\n        for (int i = "+o+" - 1; i >= 0; i -= 1) {\n          int idx = getIndex(i);\n          if (idx "+a+" end) {\n            continue;\n          }\n          if (idx == end && "+e+") {\n            continue;\n          }\n          "+ra(r,"coords")+" = idx;\n          val += getX("+function(t,e){if(1===t)return""+e;if(2===t)return e+".x, "+e+".y";if(3===t)return e+".x, "+e+".y, "+e+".z";if(4===t)return e+".x, "+e+".y, "+e+".z, "+e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}(r,"coords")+");\n        }\n        setOutput(val);\n      }\n    "};function ra(t,e){if(1===t)return""+e;if(2===t)return e+".y";if(3===t)return e+".z";if(4===t)return e+".w";throw Error("Cumulative sum for rank "+t+" is not yet supported")}var ia=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Gt.DENSE;var e=Jt(t),n=po();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fo(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        "+n.output+" = result;\n      }\n    "},oa=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Gt.DENSE;var e=Jt(t),n=po();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        "+fo(["r","c","d"],t)+"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2("+e[0]+", "+e[1]+"));\n        int index = 4 * (resTexRC.x * "+e[1]+" + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        "+n.output+" = result;\n      }\n    "},aa=function(){function t(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = "+this.getHeightCoordString()+";\n      int w = "+this.getWidthCoordString()+";\n      int d = "+this.getDepthCoordString()+";\n\n      int in_h = h / "+e+";\n      int offset_h = imod(h, "+e+");\n      int in_w = w / "+e+";\n      int offset_w = imod(w, "+e+");\n      int offset_d = (offset_h * "+e+" + offset_w) *\n        "+this.getOutputDepthSize()+";\n      int in_d = d + offset_d;\n\n      float result = "+this.getInputSamplingString()+";\n      setOutput(result);\n    }\n  "}return t.prototype.getHeightCoordString=function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"},t.prototype.getWidthCoordString=function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"},t.prototype.getDepthCoordString=function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"},t.prototype.getOutputDepthSize=function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]},t.prototype.getInputSamplingString=function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"},t}(),sa=function(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "},ua=function(t){this.variableNames=["A"],this.outTexUsage=Ht.DOWNLOAD;var e=po();this.outputShape=t,this.userCode="\n      "+go+"\n\n      void main() {\n        float x = getAAtOutCoords();\n        "+e.output+" = encode_float(x);\n      }\n    "},ca=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Ht.DOWNLOAD;var e=po();this.outputShape=t,this.userCode="\n      "+go+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        "+e.output+" = encode_float(x);\n      }\n    "},la=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"];var r=po(),o=e[0],a=e[1];this.outputShape=t;var i="result";n&&(i="floor(result * 255. + 0.5)"),this.userCode="\n      "+mo(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n        \n        int r = flatIndex / "+a+";\n        int c = imod(flatIndex, "+a+");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n        vec4 values = "+r.texture2D+"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        "+r.output+" = vec4("+i+", 0., 0., 0.);\n      }\n    "},ha=function(t,e,n){void 0===n&&(n=!1),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var r=po(),o=e[0],a=e[1];this.outputShape=t;var i="",s="result";n&&(s="floor(result * 255. + 0.5)");for(var u=0;u<=1;u++)for(var c=0;c<=1;c++){var l=2*u+c;i+="\n          localCoords = coords;\n          if(localCoords[2] + "+c+" < "+t[2]+") {\n            localCoords[2] += "+c+";\n            if(localCoords[1] + "+u+" < "+t[1]+") {\n              localCoords[1] += "+u+";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / "+a+";\n              c = imod(flatIndex, "+a+");\n              uv = (vec2(c, r) + halfCR) / vec2("+a+".0, "+o+".0);\n              values = "+r.texture2D+"(A, uv);\n\n              if(offset == 0) {\n                result["+l+"] = values[0];\n              } else if(offset == 1) {\n                result["+l+"] = values[1];\n              } else if(offset == 2) {\n                result["+l+"] = values[2];\n              } else {\n                result["+l+"] = values[3];\n              }\n            }\n          }\n        "}this.userCode="\n      "+mo(t)+"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        "+i+"\n\n        "+r.output+" = "+s+";\n      }\n    "},pa=function(t,e,n){this.variableNames=["real","imag"];var r=e[1];this.outputShape=e;var o=n?"2.0 * "+Math.PI:"-2.0 * "+Math.PI,a=n?r+".0":"1.0";this.userCode="\n      const float exponentMultiplier = "+o+";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        "+t+"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float("+r+");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < "+r+"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / "+a+";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    "},da=function(){function t(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.valueLoc&&(e.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(e.valueLoc,t)}},t}(),fa=function(t,e,n){this.variableNames=["A","indices"];var r=t.slice();r[n]=e,this.outputShape=r,this.rank=r.length;var o=Mo(this.rank),a=function(t,e){var n=t.length;if(n>4)throw Error("Gather for rank "+n+" is not yet supported");if(1===n)return"int(getIndices(resRC))";for(var r=["resRC.x","resRC.y","resRC.z","resRC.w"],o=[],a=0;a<t.length;a++)a===e?o.push("int(getIndices("+r[a]+"))"):o.push(""+r[a]);return o.join()}(t,n);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},ma=function(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;var r=Mo(e.length),o=Mo(n.length),a=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        "+r+" strides = "+r+"("+this.strides+");\n         void main() {\n          "+o+" coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < "+this.sliceDim+"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * "+a+";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      "};function ga(t,e){var n=po();return re(t,e,n.version+"\n    precision highp float;\n    "+n.attribute+" vec3 clipSpacePos;\n    "+n.attribute+" vec2 uv;\n    "+n.varyingVs+" vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }")}function va(t,e){return he(t,e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function ya(t,e){return pe(t,e,new Uint16Array([0,1,2,2,1,3]))}function xa(t,e,n,r,o,a,i){fe(n,r);var s=de(t,e),u=t.TEXTURE_2D;return $t(t,e,(function(){return t.bindTexture(u,s)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MIN_FILTER,t.NEAREST)})),$t(t,e,(function(){return t.texParameteri(u,t.TEXTURE_MAG_FILTER,t.NEAREST)})),$t(t,e,(function(){return t.texImage2D(u,0,o,n,r,0,a,i,null)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)})),s}function ba(t,e,n,r,o){var a=Kt(n,r);return xa(t,e,a[0],a[1],o.internalFormatFloat,o.textureFormatFloat,t.FLOAT)}function wa(t,e,n,r,o){var a=Kt(n,r);return xa(t,e,a[0],a[1],o.internalFormatHalfFloat,o.textureFormatFloat,o.textureTypeHalfFloat)}function _a(t,e,n,r,o){var a=Kt(n,r);return xa(t,e,a[0],a[1],t.RGBA,t.RGBA,t.UNSIGNED_BYTE)}function Sa(t,e,n,r,o){var a=Zt(n,r);return xa(t,e,a[0],a[1],o.internalFormatPackedFloat,t.RGBA,t.FLOAT)}function Ma(t,e,n,r,o){var a=Zt(n,r);return xa(t,e,a[0],a[1],o.internalFormatPackedHalfFloat,t.RGBA,o.textureTypeHalfFloat)}function Ea(t,e,n,r){return $t(t,e,(function(){return t.bindBuffer(t.ARRAY_BUFFER,r)})),ge(t,e,n,"clipSpacePos",r,3,20,0)&&ge(t,e,n,"uv",r,2,20,12)}function Ta(t,e,n,r,o,a,i){var s,u,c;$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),a instanceof Uint8Array?(s=new Uint8Array(r*o*4),u=t.UNSIGNED_BYTE,c=t.RGBA):(s=new Float32Array(r*o*4),u=t.FLOAT,c=i.internalFormatPackedFloat),s.set(a),$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,c,r,o,0,t.RGBA,u,s)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function Aa(t,e,n,r){$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,n)})),r.data instanceof Uint8Array?$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)})):$t(t,e,(function(){return t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)})),$t(t,e,(function(){return t.bindTexture(t.TEXTURE_2D,null)}))}function Ca(t,e,n,r,o){var a=t.createBuffer();$t(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,a)}));var i=16*n*r;return $t(t,e,(function(){return t.bufferData(t.PIXEL_PACK_BUFFER,i,t.STREAM_READ)})),$t(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,0)})),$t(t,e,(function(){return t.bindBuffer(t.PIXEL_PACK_BUFFER,null)})),a}function Ra(t,e,n){var r=t,o=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,e),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,o),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),o}function Ia(t,e,n,r,o){var a=Kt(n,r),i=a[0],s=a[1],u=new Uint8Array(n*r*4);return $t(t,e,(function(){return t.readPixels(0,0,i,s,o.downloadTextureFormat,t.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}function Na(t,e,n,r,o,a,i,s){var u=t,c=new Float32Array(function(t,e){var n=Zt(t,e);return n[0]*n[1]*4}(a,i));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function Oa(t,e,n,r){var o=new Float32Array(n*r*4);return $t(t,e,(function(){return t.readPixels(0,0,r,n,t.RGBA,t.FLOAT,o)})),o}var Da=Object.freeze({createVertexShader:ga,createVertexBuffer:va,createIndexBuffer:ya,createFloat32MatrixTexture:ba,createFloat16MatrixTexture:wa,createUnsignedBytesMatrixTexture:_a,createPackedMatrixTexture:Sa,createFloat16PackedMatrixTexture:Ma,bindVertexProgramAttributeStreams:Ea,uploadDenseMatrixToTexture:Ta,uploadPixelDataToTexture:Aa,createBufferFromOutputTexture:Ca,downloadFloat32MatrixFromBuffer:Ra,downloadByteEncodedFloatMatrixFromOutputTexture:Ia,downloadPackedMatrixFromBuffer:Na,downloadMatrixFromPackedOutputTexture:Oa}),La=function(){function t(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var e=i().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,Xt(e,t)):this.gl=Yt(e);var n="WEBGL_color_buffer_float";if(1===i().getNumber("WEBGL_VERSION")){if(this.textureFloatExtension=ne(this.gl,this.debug,"OES_texture_float"),Pe(this.gl,"OES_texture_half_float"))this.textureHalfFloatExtension=ne(this.gl,this.debug,"OES_texture_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),Pe(this.gl,"EXT_color_buffer_half_float"))this.colorBufferHalfFloatExtension=ne(this.gl,this.debug,"EXT_color_buffer_half_float");else if(i().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",Pe(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!Pe(this.gl,"EXT_color_buffer_half_float"))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension("EXT_color_buffer_half_float")}this.vertexBuffer=va(this.gl,this.debug),this.indexBuffer=ya(this.gl,this.debug),this.framebuffer=me(this.gl,this.debug),this.textureConfig=Qt(this.gl,this.textureHalfFloatExtension)}return Object.defineProperty(t.prototype,"debug",{get:function(){return i().getBool("DEBUG")},enumerable:!0,configurable:!0}),t.prototype.dispose=function(){var t=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var e=this.gl;$t(e,this.debug,(function(){return e.finish()})),$t(e,this.debug,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,null)})),$t(e,this.debug,(function(){return e.deleteFramebuffer(t.framebuffer)})),$t(e,this.debug,(function(){return e.bindBuffer(e.ARRAY_BUFFER,null)})),$t(e,this.debug,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)})),$t(e,this.debug,(function(){return e.deleteBuffer(t.indexBuffer)})),this.disposed=!0}},t.prototype.createFloat32MatrixTexture=function(t,e){return this.throwIfDisposed(),ba(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createFloat16MatrixTexture=function(t,e){return this.throwIfDisposed(),wa(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createUnsignedBytesMatrixTexture=function(t,e){return this.throwIfDisposed(),_a(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.uploadPixelDataToTexture=function(t,e){this.throwIfDisposed(),Aa(this.gl,this.debug,t,e)},t.prototype.uploadDenseMatrixToTexture=function(t,e,n,r){this.throwIfDisposed(),Ta(this.gl,this.debug,t,e,n,r,this.textureConfig)},t.prototype.createFloat16PackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Ma(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.createPackedMatrixTexture=function(t,e){return this.throwIfDisposed(),Sa(this.gl,this.debug,t,e,this.textureConfig)},t.prototype.deleteMatrixTexture=function(t){var e=this;this.throwIfDisposed(),this.outputTexture===t&&(_e(this.gl,this.debug,this.framebuffer),this.outputTexture=null),$t(this.gl,this.debug,(function(){return e.gl.deleteTexture(t)}))},t.prototype.downloadByteEncodedFloatMatrixFromOutputTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return Ia(r.gl,r.debug,e,n,r.textureConfig)}))},t.prototype.downloadPackedMatrixFromBuffer=function(t,e,n,r,o,a){return Na(this.gl,t,0,0,0,o,a,this.textureConfig)},t.prototype.downloadFloat32MatrixFromBuffer=function(t,e){return Ra(this.gl,t,e)},t.prototype.createBufferFromTexture=function(t,e,n){this.bindTextureToFrameBuffer(t);var r=Ca(this.gl,this.debug,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r},t.prototype.createAndWaitForFence=function(){var t=this.createFence(this.gl);return this.pollFence(t)},t.prototype.createFence=function(t){var e,n,r=this;if(i().getBool("WEBGL_FENCE_API_ENABLED")){var o=t,a=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=function(){var t=o.clientWaitSync(a,0,0);return t===o.ALREADY_SIGNALED||t===o.CONDITION_SATISFIED},e=a}else i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(e,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:e,isFencePassed:n}},t.prototype.downloadMatrixFromPackedTexture=function(t,e,n){var r=this;return this.downloadMatrixDriver(t,(function(){return Oa(r.gl,r.debug,e,n)}))},t.prototype.createProgram=function(t){this.throwIfDisposed();var e=this.gl,n=ie(e,this.debug,t),r=ga(e,this.debug),o=ue(e,this.debug);return $t(e,this.debug,(function(){return e.attachShader(o,r)})),$t(e,this.debug,(function(){return e.attachShader(o,n)})),ce(e,this.debug,o),this.debug&&le(e,this.debug,o),this.vertexAttrsAreBound||(this.setProgram(o),this.vertexAttrsAreBound=Ea(e,this.debug,this.program,this.vertexBuffer)),o},t.prototype.deleteProgram=function(t){var e=this;this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&$t(this.gl,this.debug,(function(){return e.gl.deleteProgram(t)}))},t.prototype.setProgram=function(t){var e=this;this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&le(this.gl,this.debug,this.program),$t(this.gl,this.debug,(function(){return e.gl.useProgram(t)}))},t.prototype.getUniformLocation=function(t,e,n){return void 0===n&&(n=!0),this.throwIfDisposed(),n?ye(this.gl,this.debug,t,e):xe(this.gl,t,e)},t.prototype.getAttributeLocation=function(t,e){var n=this;return this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return n.gl.getAttribLocation(t,e)}))},t.prototype.getUniformLocationNoThrow=function(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)},t.prototype.setInputMatrixTexture=function(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),be(this.gl,this.debug,this.program,t,e,n)},t.prototype.setOutputMatrixTexture=function(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)},t.prototype.setOutputPackedMatrixTexture=function(t,e,n){this.throwIfDisposed();var r=Zt(e,n),o=r[0],a=r[1];this.setOutputMatrixTextureDriver(t,o,a)},t.prototype.setOutputMatrixWriteRegion=function(t,e,n,r){this.setOutputMatrixWriteRegionDriver(n,t,r,e)},t.prototype.setOutputPackedMatrixWriteRegion=function(t,e,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")},t.prototype.debugValidate=function(){null!=this.program&&le(this.gl,this.debug,this.program),Se(this.gl)},t.prototype.executeProgram=function(){this.throwIfDisposed(),this.throwIfNoProgram();var t=this.gl;this.debug&&this.debugValidate(),$t(t,this.debug,(function(){return t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)}))},t.prototype.blockUntilAllProgramsCompleted=function(){var t=this;this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return t.gl.finish()}))},t.prototype.getQueryTimerExtension=function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=ne(this.gl,this.debug,2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension},t.prototype.getQueryTimerExtensionWebGL2=function(){return this.getQueryTimerExtension()},t.prototype.getQueryTimerExtensionWebGL1=function(){return this.getQueryTimerExtension()},t.prototype.beginQuery=function(){if(2===i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),o=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,o),o},t.prototype.endQuery=function(){if(2!==i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}else{var e=this.gl,n=this.getQueryTimerExtensionWebGL2();e.endQuery(n.TIME_ELAPSED_EXT)}},t.prototype.waitForQueryAndGetTime=function(t){return d(this,void 0,void 0,(function(){var e=this;return f(this,(function(n){switch(n.label){case 0:return[4,F((function(){return e.disposed||e.isQueryAvailable(t,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}))];case 1:return n.sent(),[2,this.getQueryTime(t,i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))]}}))}))},t.prototype.getQueryTime=function(t,e){if(0===e)return null;if(2===e){var n=this.gl;return n.getQueryParameter(t,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(t,r.QUERY_RESULT_EXT)/1e6},t.prototype.isQueryAvailable=function(t,e){if(0===e)return!0;if(2===e){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),o=n.getQueryParameter(t,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint}return o=(r=this.getQueryTimerExtensionWebGL1()).getQueryObjectEXT(t,r.QUERY_RESULT_AVAILABLE_EXT),null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),o&&!this.disjoint},t.prototype.pollFence=function(t){var e=this;return new Promise((function(n){e.addItemToPoll((function(){return t.isFencePassed()}),(function(){return n()}))}))},t.prototype.pollItems=function(){for(var t=function(t){for(var e=0;e<t.length&&t[e]();++e);return e-1}(this.itemsToPoll.map((function(t){return t.isDoneFn}))),e=0;e<=t;++e)(0,this.itemsToPoll[e].resolveFn)();this.itemsToPoll=this.itemsToPoll.slice(t+1)},t.prototype.addItemToPoll=function(t,e){var n=this;this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||F((function(){return n.pollItems(),0===n.itemsToPoll.length}))},t.prototype.bindTextureToFrameBuffer=function(t){this.throwIfDisposed(),we(this.gl,this.debug,t,this.framebuffer),this.debug&&Se(this.gl)},t.prototype.unbindTextureToFrameBuffer=function(){null!=this.outputTexture?(we(this.gl,this.debug,this.outputTexture,this.framebuffer),this.debug&&Se(this.gl)):_e(this.gl,this.debug,this.framebuffer)},t.prototype.downloadMatrixDriver=function(t,e){this.bindTextureToFrameBuffer(t);var n=e();return this.unbindTextureToFrameBuffer(),n},t.prototype.setOutputMatrixTextureDriver=function(t,e,n){this.throwIfDisposed();var r=this.gl;we(r,this.debug,t,this.framebuffer),this.debug&&Se(r),this.outputTexture=t,$t(r,this.debug,(function(){return r.viewport(0,0,e,n)})),$t(r,this.debug,(function(){return r.scissor(0,0,e,n)}))},t.prototype.setOutputMatrixWriteRegionDriver=function(t,e,n,r){var o=this;this.throwIfDisposed(),$t(this.gl,this.debug,(function(){return o.gl.scissor(t,e,n,r)}))},t.prototype.throwIfDisposed=function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")},t.prototype.throwIfNoProgram=function(){if(null==this.program)throw new Error("No GPU program is currently set.")},t}();function ka(t,e){if(t.length!==e.length)throw Error("Binary was compiled with "+t.length+" inputs, but was executed with "+e.length+" inputs");t.forEach((function(t,n){var r=t.logicalShape,o=e[n],a=o.shape;if(!O(r,a))throw Error("Binary was compiled with different shapes than the current args. Shapes "+r+" and "+a+" must match");if(!t.isUniform||!o.isUniform){var i=t.texShape,s=o.isUniform?null:o.texData.texShape;if(!O(i,s))throw Error("Binary was compiled with different texture shapes than the current args. Shape "+i+" and "+s+" must match")}}))}var Pa=function(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r=n.filterWidth,o=n.inChannels,a=n.strideWidth,i=n.strideHeight,s=n.padInfo,u=n.outWidth,c=n.dilationWidth,l=n.dilationHeight,h=n.dataFormat,d=s.left,f=s.top,p=o*r,m=po(),g="channelsLast"===h,v=g?0:1,y=g?1:2,x="",b=0;b<=1;b++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + "+w+";\n          pos = rc.x + "+b+";\n\n          if(blockIndex < "+t[1]+" && pos < "+t[0]+") {\n            offsetY = int(blockIndex / ("+u+")) * "+i+" - "+f+";\n            d0 = offsetY + "+l+" * (pos / "+p+");\n\n            if(d0 < "+e[v]+" && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), "+u+".) * "+a+". - "+d+".);\n              d1 = offsetX + "+c+" * (int(mod(float(pos), "+p+".) / "+o+".));\n\n              if(d1 < "+e[y]+" && d1 >= 0) {\n\n                ch = int(mod(float(pos), "+o+".));\n\n                if ("+g+") {\n                  innerDims = vec2(d1, ch);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result["+(2*b+w)+"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ";this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        "+x+"\n\n        "+m.output+" = result;\n      }\n    "},Fa=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[];var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -"+i+"; j <= "+i+"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  "+s+") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * "+a+";\n        setOutput(val);\n      }\n    "},Ba=function(t,e,n,r,o){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=r,this.beta=o,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < "+this.depth+"; ++d) {\n          int depthBegin = int(max(0.0, float(d - "+e+")));\n          int depthEnd = int(min(float("+this.depth+"),\n              float(d + "+e+" + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = "+this.depth+";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float("+r+") * norm + float("+n+");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float("+r+")\n                * float("+o+")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * "+o+");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    "},za=function(t,e,n,r,o){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var a,i=e,s=t[3]-1;this.outputShape=t;var u="float("+n+") + float("+r+") * sum";a=.5===o?"inversesqrt("+u+")":1===o?"1.0/("+u+")":"exp(log("+u+") * float(-"+o+"));",this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < "+this.outputShape[3]+";\n        bool hasNextRow = c < "+this.outputShape[2]+";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - "+i+";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - "+i+"; j <= "+i+"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2("+s+"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * "+a+";\n        setOutput(result);\n      }\n    "},Ua=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideHeight,n=t.strideWidth,r=t.dilationHeight,o=t.effectiveFilterHeight,a=t.effectiveFilterWidth,i=o-1-t.padInfo.top,s=a-1-t.padInfo.left,u=o*a-1;this.userCode="\n      const ivec2 pads = ivec2("+i+", "+s+");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < "+o+";\n          wR += "+r+") {\n          float dyR = float(dyRCorner + wR) / "+e+".0;\n\n          if (dyR < 0.0 || dyR >= "+t.outHeight+".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < "+a+"; wC++) {\n            float dyC = float(dyCCorner + wC) / "+n+".0;\n\n            if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = "+u+" - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * "+a+" + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Va=function(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var e=t.strideDepth,n=t.strideHeight,r=t.strideWidth,o=t.dilationDepth,a=t.dilationHeight,i=t.dilationWidth,s=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=s-1-t.padInfo.front,h=u-1-t.padInfo.top,d=c-1-t.padInfo.left,f=s*u*c-1;this.userCode="\n      const ivec3 pads = ivec3("+l+", "+h+", "+d+");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < "+s+";\n           wD += "+o+") {\n          float dyD = float(dyDCorner + wD) / "+e+".0;\n\n          if (dyD < 0.0 || dyD >= "+t.outDepth+".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < "+u+";\n              wR += "+a+") {\n            float dyR = float(dyRCorner + wR) / "+n+".0;\n\n            if (dyR < 0.0 || dyR >= "+t.outHeight+".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < "+c+";\n                wC += "+i+") {\n              float dyC = float(dyCCorner + wC) / "+r+".0;\n\n              if (dyC < 0.0 || dyC >= "+t.outWidth+".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = "+f+" -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * "+u+" * "+c+" +\n                  wR * "+c+" + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    "},Ga=function(t,e,n,r,o,a,i){void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),void 0===a&&(a=null),void 0===i&&(i=!1),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e;var s=n?t[1]:t[2],u=Math.ceil(s/2),c=n?"i * 2, rc.y":"rc.y, i * 2",l=r?"rc.z, i * 2":"i * 2, rc.z",h=n?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],d=r?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],f="",p="";a&&(f=i?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          "+a+"\n        }":"vec4 activation(vec4 x) {\n          "+a+"\n        }",p="result = activation(result);");var m=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),i&&this.variableNames.push("preluActivationWeights"),this.userCode="\n      "+f+"\n\n      const float sharedDimension = "+u+".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < "+u+"; i++) {\n          vec4 a = getMatrixA(rc.x, "+c+");\n          vec4 b = getMatrixB(rc.x, "+l+");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += ("+h[0]+" * "+d[0]+");\n          result += ("+h[1]+" * "+d[1]+");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        "+m+"\n\n        "+p+"\n\n        setOutput(result);\n      }\n    "},Ha=function(){function t(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < "+(e-1)+"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float("+(e-1)+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;return function(n,r){null==e.seedLoc&&(e.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(e.seedLoc,t)}},t}(),ja=function(t,e,n,r){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float("+r+"), float("+n+"),\n                      float(index == coords.y)));\n      }\n    "},Wa=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=ho("rc",e),r=Mo(e),o=function(t,e,n){if(1===t)return"rc > "+e[0];for(var r="",o=t-2;o<t;o++)r+=n[o]+" >= "+e[o],o<t-1&&(r+="||");return r}(e,t,n),a=function(t,e,n,r){if(1===t)return"";var o=r.slice(-2);return"\n    int r = "+o[0]+";\n    int c = "+o[1]+";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= "+e+";\n    bool rEdge = rp1 >= "+n+";\n  "}(e,t[t.length-1],t[t.length-2],n),i=function(t,e){var n=t.length,r=function(t,e){for(var n=[],r=0;r<=1;r++)for(var o=0;o<=1;o++){for(var a=(0===r?"r":"rp1")+", "+(0===o?"c":"cp1"),i=2;i<t;i++)a=e[e.length-1-i]+","+a;n.push(a)}return n}(n,e);return 1===n?"getA(rc),\n            rc + 1 >= "+t[0]+" ? 0. : getA(rc + 1),\n            0, 0":"getA("+r[0]+"),\n          cEdge ? 0. : getA("+r[1]+"),\n          rEdge ? 0. : getA("+r[2]+"),\n          rEdge || cEdge ? 0. : getA("+r[3]+")"}(t,n);this.userCode="\n        void main() {\n          "+r+" rc = getOutputCoords();\n\n          if("+o+") {\n            setOutput(vec4(0));\n          } else {\n            "+a+"\n\n            setOutput(vec4("+i+"));\n          }\n        }\n      "}},qa=function(t,e,n){this.variableNames=["x"],this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));var r=t.length,o=Mo(r),a=e.map((function(t){return t[0]})).join(","),i=e.map((function(e,n){return e[0]+t[n]})).join(","),s=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,r);this.userCode=1!==r?"\n      "+o+" start = "+o+"("+a+");\n      "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float("+n+"));\n        } else {\n          "+o+" coords = outC - start;\n          setOutput(getX("+s+"));\n        }\n      }\n    ":"\n        int start = "+a+";\n        int end = "+i+";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float("+n+"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      "},Xa=function(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map((function(e,n){return e[0]+t[n]+e[1]}));for(var r=t.length,o=Mo(r),a=e.map((function(t){return t[0]})).join(","),i=e.map((function(e,n){return e[0]+t[n]})).join(","),s=ho("rc",r),u=ho("source",r),c=s[r-1]+" < "+this.outputShape[r-1],l=1===r?"source":"vec2("+u.slice(-2).join()+")",h=[o+" rc = outputLoc;",s[r-1]+" += 1;\n       if("+c+") {\n      ",1===r?"":"}\n       rc = outputLoc;\n       "+s[r-2]+" += 1;\n       if("+s[r-2]+" < "+this.outputShape[r-2]+") {",1===r?"":"  "+s[r-1]+" += 1;\n         if("+c+") {"],d=1===r?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",f="",p=0,m=1===r?2:4;p<m;p++)f+="\n        "+h[p]+"\n        if ("+d+") {\n          result["+p+"] = float("+n+");\n        } else {\n          "+o+" source = rc - start;\n          result["+p+"] = getChannel(getX("+u.join()+"), "+l+");\n        }\n      ";f+=1===r?"} ":"}}",this.userCode="\n      const "+o+" start = "+o+"("+a+");\n      const "+o+" end = "+o+"("+i+");\n\n      void main() {\n        "+o+" outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        "+f+"\n        setOutput(result);\n      }\n    "},Ya=function(t,e,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var a=t.filterWidth,i=t.strideHeight,s=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,d=t.padInfo.top,f=t.padInfo.left;this.outputShape=t.outShape;var p="avg"===e,m="((batch  * "+t.inHeight+" + xR) * "+t.inWidth+" + xC) * "+t.inChannels+" + d",g="(xR * "+t.inWidth+" + xC) * "+t.inChannels+" + d",v="0.0";if(p||(v="-1.0 / 1e-20"),n)this.userCode="\n        const ivec2 strides = ivec2("+i+", "+s+");\n        const ivec2 pads = ivec2("+d+", "+f+");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < "+l+";\n              wR += "+u+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+h+";\n                wC += "+c+") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= "+t.inWidth+") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value >= currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = "+(r?o?m:g:"wR * "+h+" + wC")+";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var y=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(y="avgValue / count");var x=4*Math.floor(a/4),b=a%4,w="\n      if ("+p+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec2 strides = ivec2("+i+", "+s+");\n      const ivec2 pads = ivec2("+d+", "+f+");\n      const float initializationValue = "+v+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+v+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < "+l+";\n            wR += "+u+") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= "+t.inHeight+") {\n            continue;\n          }\n\n          for (int wC = 0; wC < "+x+"; wC += 4) {\n            int xC = xCCorner + wC * "+c+";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              getValue(batch, xR, xC + 3 * "+c+", d)\n            );\n\n            "+w+"\n          }\n\n          int xC = xCCorner + "+x+";\n          if ("+(1===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(2===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              initializationValue,\n              initializationValue\n            );\n\n            "+w+"\n          } else if ("+(3===b)+") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + "+c+", d),\n              getValue(batch, xR, xC + 2 * "+c+", d),\n              initializationValue\n            );\n\n            "+w+"\n          }\n        }\n        setOutput("+y+");\n      }\n    "}},Ka=function(t,e,n,r,o){if(void 0===r&&(r=!1),void 0===o&&(o=!1),this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");var a=t.filterWidth,i=t.strideDepth,s=t.strideHeight,u=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,d=t.effectiveFilterDepth,f=t.effectiveFilterHeight,p=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var y="avg"===e,x="0.0";if(y||(x="-1.0 / 1e-20"),n)this.userCode="\n        const ivec3 strides =\n            ivec3("+i+", "+s+", "+u+");\n        const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < "+d+";\n              wD += "+c+") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= "+t.inDepth+") {\n              continue;\n            }\n\n            for (int wR = 0; wR < "+f+";\n                wR += "+l+") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= "+t.inHeight+") {\n                continue;\n              }\n\n              for (int wC = 0; wC < "+p+";\n                  wC += "+h+") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= "+t.inWidth+") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value >= currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = "+(r?o?"(((batch * "+t.inDepth+" + xD) * "+t.inHeight+" + xR) * "+t.inWidth+" + xC) * "+t.inChannels+" + ch":"((xD * "+t.inHeight+" + xR) * "+t.inWidth+" + xC) * "+t.inChannels+" + ch":"wD * "+f+" * "+p+" +\n                      wR * "+p+" + wC")+";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ";else{var b=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===e&&(b="avgValue / count");var w=4*Math.floor(a/4),_=a%4,S="\n      if ("+y+") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = max(values, minMaxValue);\n      }\n    ";this.userCode="\n      const ivec3 strides =\n        ivec3("+i+", "+s+", "+u+");\n      const ivec3 pads = ivec3("+m+", "+g+", "+v+");\n      const float initializationValue = "+x+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= "+t.inWidth+") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4("+x+");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < "+d+";\n            wD += "+c+") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= "+t.inDepth+") {\n            continue;\n          }\n\n          for (int wR = 0; wR < "+f+";\n            wR += "+l+") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= "+t.inHeight+") {\n              continue;\n            }\n\n            for (int wC = 0; wC < "+w+"; wC += 4) {\n              int xC = xCCorner + wC * "+h+";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+h+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+h+", ch),\n                getValue(batch, xD, xR, xC + 3 * "+h+", ch)\n              );\n\n              "+S+"\n            }\n\n            int xC = xCCorner + "+w+";\n            if ("+(1===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              "+S+"\n            } else if ("+(2===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+h+", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              "+S+"\n            } else if ("+(3===_)+") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + "+h+", ch),\n                getValue(batch, xD, xR, xC + 2 * "+h+", ch),\n                initializationValue\n              );\n\n              "+S+"\n            }\n          }\n          setOutput("+b+");\n        }\n      }\n    "}},Ja=function(t,e){this.variableNames=["x"];var n=t.windowSize,r=t.batchSize,o=t.inSize,a=Math.ceil(o/n);this.outputShape=[r,a];var i="0.0",s="";"prod"===e?i="1.0":"min"===e?(i="1.0 / 1e-20",s="min"):"max"===e&&(i="-1.0 / 1e-20",s="max");var u=e+"("+e+"("+e+"(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");var c=4*Math.floor(n/4),l=n%4,h="\n      if ("+("sum"===e)+") {\n        sumValue += dot(values, ones);\n      } else if ("+("prod"===e)+") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = "+s+"(values, minMaxValue);\n      }\n    ",d="vec4";"all"===e?(i="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===e&&(i="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var f="";o%n>0&&(f="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      "),this.userCode="\n      const float initializationValue = "+i+";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        "+f+"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * "+n+";\n\n        vec4 minMaxValue = vec4("+i+");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < "+c+"; i += 4) {\n          int inIdx = inOffset + i;\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          "+h+"\n        }\n\n        int inIdx = inOffset + "+c+";\n        if ("+(1===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(2===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          "+h+"\n        } else if ("+(3===l)+") {\n          "+d+" values = "+d+"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          "+h+"\n        }\n        setOutput("+u+");\n      }\n    "},Za=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var n="",r=0;r<4;r++){var o="thisRC = rc;";r%2==1&&(o+="thisRC.z += 1;"),r>1&&(o+="thisRC.y += 1;"),n+="\n        "+o+"\n        "+(r>0?"if(thisRC.y < rows && thisRC.z < cols){":"")+"\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result["+r+"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        "+(r>0?"}":"")+"\n      "}this.userCode="\n      \n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      "+fo(["r","c","d"],e)+"\n      return ivec3(r, c, d);\n    }\n  \n      "+mo(t)+"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = "+t[1]+";\n        int cols = "+t[2]+";\n\n        "+n+"\n\n        setOutput(result);\n      }\n    "},Qa=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],a=r[2],i=t.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), "+(o-1)+".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), "+(a-1)+".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},$a=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(sourceFracIndexRC);\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    "},ts=function(t,e,n,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n];this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+",\n          "+u[1]/c[1]+");\n      const vec3 inputShapeRC = vec3("+a+".0, "+i+".0,\n                                     "+i+".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = vec3(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(sourceFracIndexRC);\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < "+(s-1)+";\n        bool hasNextRow = coords.z < "+(n-1)+";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    "},es=function(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e.shape;var r=e.shape,o=r[1],a=r[2],i=t.shape,s=i[1],u=i[2],c=[n&&s>1?o-1:o,n&&u>1?a-1:a],l=[n&&s>1?s-1:s,n&&u>1?u-1:u],h=c[0]/l[0],d=c[1]/l[1],f=1/h,p=1/d,m=2*Math.ceil(f)+2,g=2*Math.ceil(p)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float("+h+");\n        const float widthScale = float("+d+");\n\n        const float invHeightScale = float("+f+");\n        const float invWidthScale = float("+p+");\n\n        const int winHeight = int("+m+");\n        const int winWidth = int("+g+");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= "+s+") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= "+u+") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float("+c[0]+") *\n                (float(dyR) / float("+l[0]+"));\n\n            float sourceFracCol =\n                float("+c[1]+") *\n                  (float(dyC) / float("+l[1]+"));\n\n            int sourceNearestRow = int(min(\n                float(int("+o+") - 1),\n                "+n+" ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int("+a+") - 1),\n                "+n+" ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    "},ns=function(t,e,n,r){this.variableNames=["A"],this.outputShape=[];var o=t[0],a=t[1],i=t[2],s=t[3];this.outputShape=[o,e,n,s];var u=[r&&e>1?a-1:a,r&&n>1?i-1:i],c=[r&&e>1?e-1:e,r&&n>1?n-1:n],l=r?"0.5":"0.0";this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          "+u[0]/c[0]+",\n          "+u[1]/c[1]+");\n      const vec2 inputShapeRC = vec2("+a+".0, "+i+".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = vec2(yRC) * effectiveInputOverOutputRatioRC;\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + "+l+")));\n\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    "},rs=function(t,e){this.variableNames=["x"];var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");if(this.outputShape=t,1!==n){var r=t.map((function(n,r){return function(n){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - coords["+n+"] - 1":"coords["+n+"]"}(r)})).join(","),o=Mo(n);this.userCode="\n      void main() {\n        "+o+" coords = getOutputCoords();\n        setOutput(getX("+r+"));\n      }\n    "}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX("+t[0]+" - coord - 1));\n        }\n      "},is=function(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var n=t.length;if(n>4)throw new Error("WebGL backend: Reverse of rank-"+n+" tensor is not yet supported");this.outputShape=t;var r=ho("rc",n),o=r[n-1]+" + 1 < "+this.outputShape[n-1],a=r[n-2]+" + 1 < "+this.outputShape[n-2],i=Mo(n);function s(n){var r=t.map((function(r,o){return function(n,r){return-1!==e.indexOf(n)&&1!==t[n]?t[n]+" - "+r[n]+" - 1":""+r[n]}(o,n)}));return"getChannel(getX("+r.join(",")+"), vec2("+r.slice(-2).join(",")+"))"}this.userCode=1===n?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX("+t[0]+" - rc - 1),\n            "+t[0]+" - rc - 1);\n          if("+o+"){\n              result.g = getChannel(getX("+t[0]+" - (rc  + 1) - 1),\n                "+t[0]+" - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      ":"\n        void main() {\n          "+i+" rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = "+function(t){return s(t)}(r.slice())+";\n          if("+o+"){\n            result.g = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",s(t)}(r.slice())+";\n          }\n          if("+a+") {\n            result.b = "+function(t){return t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            if("+o+") {\n              result.a = "+function(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",s(t)}(r.slice())+";\n            }\n          }\n          setOutput(result);\n        }\n    "},os=function(t,e,n,r,o,a,i){void 0===i&&(i=!0),this.variableNames=["updates","indices","defaultValue"],this.outputShape=a;var s=Mo(o.length),u=Mo(a.length),c="";1===n?c="i":2===n&&(c="i, j");var l="getIndices("+c+")",h="";1===r?h="i":2===r&&(h="i, coords[1]");var d="getUpdates("+h+")",f=e>1?"strides[j]":"strides";this.userCode="\n        "+s+" strides = "+s+"("+o+");\n\n        void main() {\n          "+u+" coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < "+t+"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < "+e+"; j++) {\n              int index = round("+l+");\n              flattenedIndex += index * "+f+";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += "+d+";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      "},as=function(t,e){this.variableNames=["x","segmentIds"];var n=t.windowSize,r=t.batchSize,o=t.inSize,a=t.numSegments,i=a*Math.ceil(o/n);this.outputShape=[r,i];var s=4*Math.floor(n/4),u=n%4,c="\n        sumValue += dot(values, segFilter);\n    ",l="";o%n>0&&(l="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return initializationValue;\n        }\n      ");var h="";o%n>0&&(h="\n        if (inIdx < 0 || inIdx >= "+o+") {\n          return -1.0;\n        }\n      "),this.userCode="\n      const float initializationValue = 0.0;\n\n      float getValue(int batch, int inIdx) {\n        "+l+"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        "+h+"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          "+a+")) * float("+n+"));\n        int currentSeg = int(mod(float(outIdx), float("+a+")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < "+s+"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          "+c+"\n        }\n\n        int inIdx = inOffset + "+s+";\n        if ("+(1===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          "+c+"\n        } else if ("+(2===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          "+c+"\n        } else if ("+(3===u)+") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          "+c+"\n        }\n        setOutput(sumValue);\n      }\n    "},ss=function(t,e,n){var r,o;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error("Where for rank "+n+" is not yet supported");if(1===n)o="resRC",r="resRC";else{for(var a=["resRC.x","resRC.y","resRC.z","resRC.w"],i=[],s=[],u=0;u<e.length;u++)s.push(""+a[u]),u<t&&i.push(""+a[u]);r=i.join(),o=s.join()}var c=Mo(n);this.userCode="\n      void main() {\n        "+c+" resRC = getOutputCoords();\n        float cVal = getC("+r+");\n        if (cVal >= 1.0) {\n          setOutput(getA("+o+"));\n        } else {\n          setOutput(getB("+o+"));\n        }\n      }\n    "},us=function(){function t(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var e,n=Mo(this.rank),r="uniform int start["+this.rank+"];",o=function(t){if(1===t)return"sourceLoc";if(t<=6)return cs.slice(0,t).map((function(t){return"sourceLoc."+t})).join(",");throw Error("Slicing for rank "+t+" is not yet supported")}(this.rank);e="\n        "+n+" sourceLoc;\n        "+n+" coords = getOutputCoords();\n        "+t.map((function(t,e){return"sourceLoc."+cs[e]+" = start["+e+"] + coords."+cs[e]+";"})).join("\n")+"\n      ",this.userCode="\n      "+r+"\n      void main() {\n        "+e+"\n        setOutput(getSource("+o+"));\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),cs=["x","y","z","w","u","v"],ls=function(){function t(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var e=Mo(this.rank),n=ho("coords",this.rank),r=ho("sourceLoc",this.rank),o=1===this.rank?"sourceLoc":"vec2("+r.slice(-2).join()+")",a="getChannel(getSource("+r.join()+"), "+o+")",i="\n      result.x = "+a+";\n      if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n        ++"+r[this.rank-1]+";\n        result.y = "+a+";\n        --"+r[this.rank-1]+";\n      }\n    ",s=1===this.rank?"":"\n      --"+n[this.rank-1]+";\n      if (++"+n[this.rank-2]+" < "+t[this.rank-2]+") {\n        ++"+r[this.rank-2]+";\n        result.z = "+a+";\n        if (++"+n[this.rank-1]+" < "+t[this.rank-1]+") {\n          ++"+r[this.rank-1]+";\n          result.w = "+a+";\n        }\n      }\n    ",u=this.rank<=4?"sourceLoc = coords +\n            "+e+"("+t.map((function(t,e){return"start["+e+"]"})).join()+");":t.map((function(t,e){return r[e]+" = "+n[e]+" + start["+e+"];"})).join("\n");this.userCode="\n      uniform int start["+this.rank+"];\n      void main() {\n        "+e+" coords = getOutputCoords();\n        "+e+" sourceLoc;\n        "+u+"\n        vec4 result = vec4(0.);\n        "+i+"\n        "+s+"\n        setOutput(result);\n      }\n    "}return t.prototype.getCustomSetupFunc=function(t){var e=this;if(t.length!==this.rank)throw Error("The rank ("+this.rank+") of the program must match the length of start ("+t.length+")");return function(n,r){null==e.startLoc&&(e.startLoc=n.getUniformLocationNoThrow(r,"start"),null==e.startLoc)||n.gl.uniform1iv(e.startLoc,t)}},t}(),hs=function(t,e,n){this.variableNames=["x"],this.outputShape=n;var r=n.length,o=Mo(n.length),a=Mo(n.length),i="";if(1===r)i="coords * strides + begin";else{var s=0;i=n.map((function(t,e){return s++,1===n.length?"coords * strides["+e+"] + begin["+e+"]":"coords["+(s-1)+"] * strides["+e+"] + begin["+e+"]"})).join(",")}this.userCode="\n      "+o+" begin = "+o+"("+t+");\n      "+o+" strides = "+o+"("+e+");\n\n      void main() {\n        "+a+" coords = getOutputCoords();\n        setOutput(getX("+i+"));\n      }\n    "},ps=function(){function t(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return t.prototype.acquireTexture=function(t,e,n){var r,o=ds(e,n),a=fs(t,o,n);if(a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]),this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this.log();var i=this.freeTextures[a].shift();return this.usedTextures[a].push(i),i}return this.numUsedTextures++,this.log(),o===jt.PACKED_2X2_FLOAT32?r=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):o===jt.PACKED_2X2_FLOAT16?r=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):o===jt.UNPACKED_FLOAT32?r=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):o===jt.UNPACKED_FLOAT16?r=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):o===jt.PACKED_4X1_UNSIGNED_BYTE&&(r=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[a].push(r),r},t.prototype.releaseTexture=function(t,e,n,r){if(null!=this.freeTextures){var o=fs(e,ds(n,r),r);o in this.freeTextures||(this.freeTextures[o]=[]),this.freeTextures[o].push(t),this.numFreeTextures++,this.numUsedTextures--;var a=this.usedTextures[o],i=a.indexOf(t);if(i<0)throw new Error("Cannot release a texture that was never provided by this texture manager");a.splice(i,1),this.log()}},t.prototype.log=function(){if(this.logEnabled){var t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",this.numFreeTextures+" / "+this.numUsedTextures,"("+t+")")}},t.prototype.getNumUsedTextures=function(){return this.numUsedTextures},t.prototype.getNumFreeTextures=function(){return this.numFreeTextures},t.prototype.dispose=function(){var t=this;if(null!=this.freeTextures){for(var e in this.freeTextures)this.freeTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));for(var e in this.usedTextures)this.usedTextures[e].forEach((function(e){t.gpgpu.deleteMatrixTexture(e)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0}},t}();function ds(t,e){if(t===Ht.UPLOAD)return jt.PACKED_2X2_FLOAT32;if(t===Ht.RENDER||null==t)return function(t){return i().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?jt.PACKED_2X2_FLOAT32:jt.UNPACKED_FLOAT32:t?jt.PACKED_2X2_FLOAT16:jt.UNPACKED_FLOAT16}(e);if(t===Ht.DOWNLOAD||t===Ht.PIXELS)return jt.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type "+t)}function fs(t,e,n){return t[0]+"_"+t[1]+"_"+e+"_"+n}var ms=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;var o=Mo(this.rank),a=function(t){var e=t.length;if(e>5)throw Error("Tile for rank "+e+" is not yet supported");if(1===e)return"imod(resRC, "+t[0]+")";for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],o=0;o<t.length;o++)r.push("imod("+n[o]+", "+t[o]+")");return r.join()}(t);this.userCode="\n      void main() {\n        "+o+" resRC = getOutputCoords();\n        setOutput(getA("+a+"));\n      }\n    "},gs=1.7580993408473768,vs=1.0507009873554805,ys=function(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        "+e+"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},xs="if (isnan(x)) return x;",bs="return abs(x);",ws=xs+"\n  return (x < 0.0) ? 0.0 : x;\n",_s=xs+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Ss="return (x >= 0.0) ? x : (exp(x) - 1.0);",Ms="return -x;",Es="return ceil(x);",Ts="return floor(x);",As="return exp(x);",Cs="return exp(x) - 1.0;",Rs="return x;",Is="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Ns="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Os="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Ds=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        "+e+"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    "},Ls=function(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var e=t.length,n=ho("rc",e),r=Mo(e),o=function(t,e){if(1===t)return"rc";for(var n="",r=0;r<t;r++)n+=e[r],r<t-1&&(n+=",");return n}(e,n),a=n.slice(-2),i=e<=1?"rc":"vec2("+a.join(",")+")";this.userCode="\n      void main() {\n        "+r+" rc = getOutputCoords();\n        vec4 packedInput = getA("+o+");\n\n        setOutput(getChannel(packedInput, "+i+"));\n      }\n    "},ks={};function Ps(t,e){if(void 0===e&&(e=!1),"linear"===t)return"return x;";if("relu"===t)return e?Is:ws;if("elu"===t)return e?Os:Ss;if("relu6"===t)return e?Ns:_s;if("prelu"===t)return e?Fo:ko;throw new Error("Activation "+t+" has not been implemented for the WebGL backend.")}var Fs=function(t){function e(e){var n,r=t.call(this)||this;if(r.pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!i().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var o=Yt(i().getNumber("WEBGL_VERSION"));r.binaryCache=((n=i().getNumber("WEBGL_VERSION"))in ks||(ks[n]={}),ks[n]),r.gpgpu=new La(o),r.canvas=o.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new ps(r.gpgpu),r.numMBBeforeWarning=null==i().global.screen?1024:i().global.screen.height*i().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new Ti(r,zt),r}return h(e,t),e.prototype.numDataIds=function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes},e.prototype.write=function(t,e,n){if(i().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:e,dtype:n,values:t,usage:Ht.UPLOAD}),r},e.prototype.move=function(t,e,n,r){if(i().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:r,values:e,usage:Ht.UPLOAD})},e.prototype.readSync=function(t){var e=this.texData.get(t),n=e.values,r=e.dtype,o=e.complexTensors,a=e.slice,i=e.shape,s=e.isPacked;if(null!=a){var u;u=s?new Ds(i,Rs):new ys(i,Rs);var c=this.runWebGLProgram(u,[{dataId:t,shape:i,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeData(c.dataId),l}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===r)return n;var h,d,f=null!=this.activeTimers;return f&&(h=st()),d="complex64"===r?Wi(o.real.dataSync(),o.imag.dataSync()):this.getValuesFromTexture(t),f&&(this.downloadWaitMs+=st()-h),this.convertAndCacheOnCPU(t,d)},e.prototype.read=function(t){return d(this,void 0,void 0,(function(){var e,n,r,a,s,u,o,c,l,h,d,p,m,g,v,y,x,b,w,_,S,M;return f(this,(function(f){switch(f.label){case 0:if(this.pendingRead.has(t))return e=this.pendingRead.get(t),[2,new Promise((function(t){return e.push(t)}))];if(n=this.texData.get(t),r=n.values,a=n.shape,s=n.slice,u=n.dtype,o=n.complexTensors,c=n.isPacked,null!=s)return void 0,l=c?new Ds(a,Rs):new ys(a,Rs),h=this.runWebGLProgram(l,[{dataId:t,shape:a,dtype:u}],u),d=this.read(h.dataId),this.disposeData(h.dataId),[2,d];if(null!=r)return[2,this.convertAndCacheOnCPU(t)];if(!i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===i().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");return p=null,"complex64"!==u&&i().get("WEBGL_BUFFER_SUPPORTED")&&(m=this.decode(t),g=this.texData.get(m.dataId),p=(M=this.gpgpu).createBufferFromTexture.apply(M,[g.texture].concat(Jt(a)))),this.pendingRead.set(t,[]),"complex64"===u?[3,2]:[4,this.gpgpu.createAndWaitForFence()];case 1:f.sent(),f.label=2;case 2:return"complex64"!==u?[3,4]:[4,Promise.all([o.real.data(),o.imag.data()])];case 3:return y=f.sent(),x=y[0],b=y[1],v=Wi(x,b),[3,5];case 4:null==p?v=this.getValuesFromTexture(t):(w=N(a),v=this.gpgpu.downloadFloat32MatrixFromBuffer(p,w)),f.label=5;case 5:return null!=m&&this.disposeData(m.dataId),_=this.convertAndCacheOnCPU(t,v),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach((function(t){return t(_)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),[2,_]}}))}))},e.prototype.checkNumericalProblems=function(t){if(null!=t)for(var e=0;e<t.length;e++){var n=t[e];if(!te(n)){if(i().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value "+n+" cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value "+n+" cannot be represented on this device.")}}},e.prototype.getValuesFromTexture=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,a=n.isPacked,s=N(r);if(i().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var u=this.decode(t),c=this.texData.get(u.dataId),l=(e=this.gpgpu).downloadMatrixFromPackedTexture.apply(e,[c.texture].concat(Jt(r))).subarray(0,s);return this.disposeData(u.dataId),l}var h=i().getBool("WEBGL_PACK")&&!0===a,d=h?Re(r):r,f=h?new ca(d):new ua(d),p=this.runWebGLProgram(f,[{shape:d,dtype:o,dataId:t}],"float32"),m=this.texData.get(p.dataId),g=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(m.texture,m.texShape[0],m.texShape[1]).subarray(0,s);return this.disposeData(p.dataId),g},e.prototype.time=function(t){return d(this,void 0,void 0,(function(){var e,n,r,a,s,u,o;return f(this,(function(c){switch(c.label){case 0:return e=this.activeTimers,n=[],r=!1,null==this.programTimersStack?(this.programTimersStack=n,r=!0):this.activeTimers.push(n),this.activeTimers=n,t(),a=I(this.activeTimers.map((function(t){return t.query}))).filter((function(t){return null!=t})),s=I(this.activeTimers.map((function(t){return t.name}))).filter((function(t){return null!=t})),this.activeTimers=e,r&&(this.programTimersStack=null),u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[4,Promise.all(a)]:[3,2];case 1:return o=c.sent(),u.kernelMs=T(o),u.getExtraProfileInfo=function(){return o.map((function(t,e){return{name:s[e],ms:t}})).map((function(t){return t.name+": "+t.ms})).join(", ")},[3,3];case 2:u.kernelMs={error:"WebGL query timers are not supported in this environment."},c.label=3;case 3:return this.uploadWaitMs=0,this.downloadWaitMs=0,[2,u]}}))}))},e.prototype.memory=function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU}},e.prototype.startTimer=function(){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:st(),endMs:null}},e.prototype.endTimer=function(t){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=st(),t)},e.prototype.getQueryTime=function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){return i().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?[2,this.gpgpu.waitForQueryAndGetTime(t)]:[2,(e=t).endMs-e.startMs]}))}))},e.prototype.disposeData=function(t){if(!this.pendingDisposal.has(t)){if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(this.texData.has(t)){this.releaseGPUData(t);var e=this.texData.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.texData.delete(t)}}},e.prototype.releaseGPUData=function(t){var e=this.texData.get(t),n=e.texture,r=e.dtype,o=e.texShape,a=e.usage,i=e.isPacked,s=e.slice,u=s&&s.origDataId||t,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(o,r),this.textureManager.releaseTexture(n,o,a,i)));var l=this.texData.get(t);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null},e.prototype.getTexture=function(t){return this.uploadToGPU(t),this.texData.get(t).texture},e.prototype.getDataInfo=function(t){return this.texData.get(t)},e.prototype.getCPUBackend=function(){return i().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=zt.findBackend("cpu")),this.cpuBackend):null},e.prototype.shouldExecuteOnCPU=function(t,e){var n=this;return void 0===e&&(e=128),null!=this.getCPUBackend()&&t.every((function(t){return null==n.texData.get(t.dataId).texture&&N(t.shape)<e}))},e.prototype.getGPGPUContext=function(){return this.gpgpu},e.prototype.complex=function(t,e){var n=this.makeOutput(t.shape,"complex64");return this.texData.get(n.dataId).complexTensors={real:zt.keep(t.clone()),imag:zt.keep(e.clone())},n},e.prototype.real=function(t){return this.texData.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.texData.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.slice(t,e,n);if(0===N(n))return gn([],n,t.dtype);var r=this.texData.get(t.dataId).isPacked,o=xi(t.shape,e,n);if(r||!o){var a=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ls(n):new us(n),s=a.getCustomSetupFunc(e);return this.compileAndRun(a,[t],null,s)}return this.uploadToGPU(t.dataId),this.shallowSlice(t,e,n)},e.prototype.shallowSlice=function(t,e,n){var r=this.texData.get(t.dataId),o=this.makeOutput(n,t.dtype),a=this.texData.get(o.dataId);Object.assign(a,r),a.shape=n,a.dtype=t.dtype;var i=bi(e,t.strides);r.slice&&(i+=r.slice.flatOffset),a.slice={flatOffset:i,origDataId:r.slice&&r.slice.origDataId||t.dataId};var s=this.dataRefCount.get(a.slice.origDataId)||1;return this.dataRefCount.set(a.slice.origDataId,s+1),o},e.prototype.stridedSlice=function(t,e,n,r){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.stridedSlice(t,e,n,r);var o=gi(e,n,r);if(o.some((function(t){return 0===t})))return gn([],o);var a=new hs(e,r,o);return this.compileAndRun(a,[t])},e.prototype.reverse=function(t,e){var n=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new is(t.shape,e):new rs(t.shape,e);return this.compileAndRun(n,[t])},e.prototype.concat=function(t,e){if("complex64"===t[0].dtype){var n=t.map((function(t){return fn(t)})),r=t.map((function(t){return mn(t)}));return dn(this.concat(n,e),this.concat(r,e))}if(this.shouldExecuteOnCPU(t))return this.cpuBackend.concat(t,e);if(1===t.length)return t[0];if(t.length>i().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var o=Math.floor(t.length/2),a=this.concat(t.slice(0,o),e),s=this.concat(t.slice(o),e);return this.concat([a,s],e)}if(i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].rank>1){var u=new Ho(t.map((function(t){return t.shape})),e);return this.compileAndRun(u,t)}var c=hn(t.map((function(t){return t.shape})),e),l=t.map((function(t){return t.as2D(-1,N(t.shape.slice(e)))})),h=new Go(l.map((function(t){return t.shape})));return this.compileAndRun(h,l).reshape(c)},e.prototype.neg=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.neg(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ms,t.dtype);var e=new ys(t.shape,Ms);return this.compileAndRun(e,[t])},e.prototype.batchMatMul=function(t,e,n,r){var o=n?t.shape[2]:t.shape[1],a=r?e.shape[1]:e.shape[2],i=n?t.shape[1]:t.shape[2],s=t.shape[0];if((1===o||1===a)&&i>1e3){n&&(t=Ei(t,[0,2,1])),r&&(e=Ei(e,[0,2,1]));var u=1===a?t:t.as3D(s,i,1),c=1===a?2:1,l=1===a?e.as3D(s,1,i):e;return this.multiply(u,l).sum(c,!0)}var h=Nt(t.dtype,e.dtype),d=new Ga(t.shape,[s,o,a],n,r);return this.compileAndRun(d,[t,e],h)},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=r?e.shape[2]:e.shape[1],c=o?n.shape[1]:n.shape[2],l=e.shape[0],h=Nt(e.dtype,n.dtype),d=null!=a,f=null!=s,p=i?Ps(i,!0):null,m=new Ga(e.shape,[l,u,c],r,o,d,p,f),g=[e,n];return a&&g.push(a),s&&g.push(s),this.compileAndRun(m,g,h)},e.prototype.multiply=function(t,e){if("complex64"===t.dtype){var n=this.texData.get(t.dataId),r=this.texData.get(e.dataId),o=new No("return areal * breal - aimag * bimag;",t.shape,e.shape),a=new No("return areal * bimag + aimag * breal;",t.shape,e.shape),s=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag),this.makeComplexComponentTensorInfo(e,r.complexTensors.real),this.makeComplexComponentTensorInfo(e,r.complexTensors.imag)],u=this.compileAndRun(o,s),c=this.compileAndRun(a,s),l=this.complex(u,c);return u.dispose(),c.dispose(),l}if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.multiply(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Lo,t.dtype);var h=new Po(Lo,t.shape,e.shape);return this.compileAndRun(h,[t,e],t.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,a){var s=[t,e,n],u=null;null!=a&&(u=a.shape,s.push(a));var c=null;if(null!=o&&(c=o.shape,s.push(o)),i().getBool("WEBGL_PACK_NORMALIZATION")){var l=new Io(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(l,s)}var h=new Ro(t.shape,e.shape,n.shape,u,c,r);return this.compileAndRun(h,s)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){var a=i().getBool("WEBGL_PACK_NORMALIZATION")?new za(t.shape,e,n,r,o):new Fa(t.shape,e,n,r,o);return this.compileAndRun(a,[t])},e.prototype.LRNGrad=function(t,e,n,r,o,a,i){var s=new Ba(e.shape,r,o,a,i);return this.compileAndRun(s,[e,n,t])},e.prototype.tile=function(t,e){if("string"===t.dtype){var n=this.readSync(t.dataId).map((function(t){return ct(t)}));return io(kn(t.shape,t.dtype,n),e)}var r=new ms(t.shape,e);return this.compileAndRun(r,[t])},e.prototype.pad=function(t,e,n){var r=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Xa(t.shape,e,n):new qa(t.shape,e,n);return this.compileAndRun(r,[t])},e.prototype.gather=function(t,e,n){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.gather(t,e,n);var r=new fa(t.shape,e.size,n);return this.compileAndRun(r,[t,e])},e.prototype.batchToSpaceND=function(t,e,n){A(t.rank<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=qn(t.shape,e,r),a=Xn(o.length,e.length),i=Yn(t.shape,e,r),s=Kn(n,e.length),u=Jn(i,n,e.length);return Ei(t.reshape(o),a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){A(t.rank<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=qn(i.shape,e,r,!1),u=Xn(s.length,e.length,!1),c=Yn(i.shape,e,r,!1);return Ei(i.reshape(s),u).reshape(c)},e.prototype.reduce=function(t,e,n){var r=t.shape[0],o=t.shape[1],a=ui(o),i=new Ja({windowSize:a,inSize:o,batchSize:r},e),s=this.compileAndRun(i,[t],n);return 1===s.shape[1]?s:this.reduce(s,e,n)},e.prototype.argReduce=function(t,e,n){void 0===n&&(n=null);var r=t.shape[0],o=t.shape[1];null!=n&&(r=n.shape[0],o=n.shape[1]);var a=ui(o),i=new co({windowSize:a,inSize:o,batchSize:r},e,null==n),s=[t];null!=n&&s.push(n);var u=this.compileAndRun(i,s,"int32");return 1===u.shape[1]?u:this.argReduce(t,e,u)},e.prototype.argReducePacked=function(t,e,n){void 0===n&&(n=null);var r=null!=n?n.shape:t.shape,o=ui(r[r.length-1]),a=new To(r,o,e,null==n),i=null==n?[t]:[t,n],s=this.compileAndRun(a,i,"int32");return s.rank===t.rank?this.argReducePacked(t,e,s):s},e.prototype.sum=function(t,e){an("sum",e,t.rank);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o),i=Ot(t.dtype);return this.reduce(a,"sum",i).reshape(r)},e.prototype.prod=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.prod(t,e);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o),i=Ot(t.dtype);return this.reduce(a,"prod",i).reshape(r)},e.prototype.unsortedSegmentSum=function(t,e,n){var r=0,o=sn([r],t.rank),a=t;null!=o&&(a=Ei(t,o),r=cn(1,t.rank)[0]);var i=function(t,e,n){for(var r=[],o=t.length,a=0;a<o;a++)a!==e?r.push(t[a]):r.push(n);return r}(a.shape,r,n),s=N([a.shape[r]]),u=a.as2D(-1,s),c=Ot(t.dtype),l=this.segOpCompute(u,"unsortedSegmentSum",e,c,n).reshape(i);return null!=o&&(l=Ei(l,un(o))),l},e.prototype.segOpCompute=function(t,e,n,r,o){var a=t.shape[0],i=t.shape[1],s=function(t,e){var n,r=!1;for(t<=30?(n=t,r=!0):n=tt(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=tt(t,n+1);return n}(i,o),u=new as({windowSize:s,inSize:i,batchSize:a,numSegments:o},e),c=this.compileAndRun(u,[t,n],r);return c.shape[1]===o?c:(n=An(0,o).tile([i/s]),this.segOpCompute(c,e,n,r,o))},e.prototype.argMinMaxReduce=function(t,e,n){var r=[e];if(an("arg"+n.charAt(0).toUpperCase()+n.slice(1),r,t.rank),!i().getBool("WEBGL_PACK_REDUCE")||t.rank<=2){var o=rn(t.shape,r),a=o[0],s=N(o[1]),u=t.as2D(-1,s);return this.argReduce(u,n).reshape(a)}return this.argReducePacked(t,n)},e.prototype.argMin=function(t,e){return this.argMinMaxReduce(t,e,"min")},e.prototype.argMax=function(t,e){return this.argMinMaxReduce(t,e,"max")},e.prototype.cumsum=function(t,e,n,r){if(e!==t.rank-1)throw new Error("WebGL cumsum shader expects an inner-most axis="+(t.rank-1)+" but got axis="+e);var o=new na(t.shape,n,r);return this.compileAndRun(o,[t])},e.prototype.equal=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(equal(a, b));\n","bool");var n=new Po("return float(a == b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.notEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(notEqual(a, b));\n","bool");var n=new Po("return float(a != b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.less=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.less(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThan(a, b));\n","bool");var n=new Po("return float(a < b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.lessEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(lessThanEqual(a, b));\n","bool");var n=new Po("return float(a <= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greater=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.greater(t,e);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThan(a, b));\n","bool");var n=new Po("return float(a > b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.greaterEqual=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(greaterThanEqual(a, b));\n","bool");var n=new Po("return float(a >= b);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalNot=function(t){var e=new ys(t.shape,"return float(!(x >= 1.0));");return this.compileAndRun(e,[t])},e.prototype.logicalAnd=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n","bool");var n=new Po("return float(a >= 1.0 && b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.logicalOr=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n","bool");var n=new Po("return float(a >= 1.0 || b >= 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e],"bool")},e.prototype.select=function(t,e,n){var r=new ss(t.rank,e.shape,e.rank);return this.compileAndRun(r,[t,e,n],Nt(e.dtype,n.dtype))},e.prototype.where=function(t){Je("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var e=t.dataSync();return ao(t.shape,e)},e.prototype.topk=function(t,e,n){return oo(t.dataSync(),t.shape,t.dtype,e)},e.prototype.min=function(t,e){an("min",e,t.rank);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o);return this.reduce(a,"min",a.dtype).reshape(r)},e.prototype.minimum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.minimum(t,e);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Po("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.mod=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Po("if (b == 0.0) return NAN;\n  return mod(a, b);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.max=function(t,e){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.max(t,e);an("max",e,t.rank);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o);return this.reduce(a,"max",a.dtype).reshape(r)},e.prototype.maximum=function(t,e){if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.maximum(t,e);var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Po("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.all=function(t,e){an("all",e,t.rank);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o);return this.reduce(a,"all",a.dtype).reshape(r)},e.prototype.any=function(t,e){an("any",e,t.rank);var n=rn(t.shape,e),r=n[0],o=N(n[1]),a=t.as2D(-1,o);return this.reduce(a,"any",a.dtype).reshape(r)},e.prototype.floorDiv=function(t,e){if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n","int32");var n=new Po("\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",t.shape,e.shape);return this.compileAndRun(n,[t,e],"int32")},e.prototype.add=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Oo);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.add(t,e);var n=Nt(t.dtype,e.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Oo,n);var r=new Po(Oo,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.packedUnaryOp=function(t,e,n){var r=new Ds(t.shape,e);return this.compileAndRun(r,[t],n)},e.prototype.packedBinaryOp=function(t,e,n,r,o){void 0===o&&(o=!1);var a=new Bo(n,t.shape,e.shape,o);return this.compileAndRun(a,[t,e],r)},e.prototype.complexSeparableBinaryOp=function(t,e,n){var r=this,o=this.texData.get(t.dataId),a=this.texData.get(e.dataId),i=[[o.complexTensors.real,a.complexTensors.real],[o.complexTensors.imag,a.complexTensors.imag]].map((function(o){var a=o[0],i=o[1],s=r.makeComplexComponentTensorInfo(t,a),u=r.makeComplexComponentTensorInfo(e,i),c=new Po(n,t.shape,e.shape);return r.compileAndRun(c,[s,u],Nt(a.dtype,i.dtype))})),s=i[0],u=i[1],c=this.complex(s,u);return s.dispose(),u.dispose(),c},e.prototype.makeComplexComponentTensorInfo=function(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}},e.prototype.addN=function(t){if(1===t.length)return t[0];if(t.length>i().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var e=Math.floor(t.length/2),n=this.addN(t.slice(0,e)),r=this.addN(t.slice(e));return this.addN([n,r])}var o=t.map((function(t){return t.dtype})).reduce((function(t,e){return Nt(t,e)})),a=t.map((function(t){return t.shape})),s=i().getBool("WEBGL_PACK")?new uo(t[0].shape,a):new so(t[0].shape,a);return this.compileAndRun(s,t,o)},e.prototype.subtract=function(t,e){if("complex64"===t.dtype&&"complex64"===e.dtype)return this.complexSeparableBinaryOp(t,e,Do);if(this.shouldExecuteOnCPU([t,e]))return this.cpuBackend.subtract(t,e);var n=Nt(t.dtype,e.dtype);if(i().getBool("WEBGL_PACK_BINARY_OPERATIONS"))return this.packedBinaryOp(t,e,Do,t.dtype);var r=new Po(Do,t.shape,e.shape);return this.compileAndRun(r,[t,e],n)},e.prototype.pow=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Po("\nif(a < 0.0 && floor(b) < b){\n  return NAN;\n}\nif (b == 0.0) {\n  return 1.0;\n}\nreturn (round(mod(b, 2.0)) != 1) ?\n    pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",t.shape,e.shape),r=Nt(t.dtype,e.dtype);return this.compileAndRun(n,[t,e],r)},e.prototype.ceil=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.ceil(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Es,t.dtype);var e=new ys(t.shape,Es);return this.compileAndRun(e,[t])},e.prototype.floor=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.floor(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Ts,t.dtype);var e=new ys(t.shape,Ts);return this.compileAndRun(e,[t])},e.prototype.sign=function(t){var e=new ys(t.shape,"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n");return this.compileAndRun(e,[t])},e.prototype.isNaN=function(t){var e=new ys(t.shape,"return float(isnan(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isInf=function(t){var e=new ys(t.shape,"return float(isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.isFinite=function(t){var e=new ys(t.shape,"return float(!isnan(x) && !isinf(x));");return this.compileAndRun(e,[t],"bool")},e.prototype.round=function(t){var e=new ys(t.shape,"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n");return this.compileAndRun(e,[t])},e.prototype.exp=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.exp(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,As,t.dtype);var e=new ys(t.shape,As);return this.compileAndRun(e,[t])},e.prototype.expm1=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.expm1(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Cs,t.dtype);var e=new ys(t.shape,Cs);return this.compileAndRun(e,[t])},e.prototype.softmax=function(t,e){var n=z([e],t.shape),r=this.max(t,n),o=on(r.shape,n),a=this.subtract(t,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return oi(i,s)},e.prototype.log=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.log(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",t.dtype);var e=new ys(t.shape,"if (x < 0.0) return NAN;\n  return log(x);");return this.compileAndRun(e,[t])},e.prototype.log1p=function(t){var e=new ys(t.shape,"return log(1.0 + x);");return this.compileAndRun(e,[t])},e.prototype.sqrt=function(t){var e=new ys(t.shape,"return sqrt(x);");return this.compileAndRun(e,[t])},e.prototype.rsqrt=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.rsqrt(t);var e=new ys(t.shape,"return inversesqrt(x);");return this.compileAndRun(e,[t])},e.prototype.reciprocal=function(t){var e=new ys(t.shape,"return 1.0 / x;");return this.compileAndRun(e,[t])},e.prototype.relu=function(t){var e;return e=i().getBool("WEBGL_PACK")?new Ds(t.shape,Is):new ys(t.shape,ws),this.compileAndRun(e,[t])},e.prototype.relu6=function(t){var e;return e=i().getBool("WEBGL_PACK")?new Ds(t.shape,Ns):new ys(t.shape,_s),this.compileAndRun(e,[t])},e.prototype.prelu=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo(Fo,t.shape,e.shape):new Po(ko,t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.elu=function(t){if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,Os,t.dtype);var e=new ys(t.shape,Ss);return this.compileAndRun(e,[t])},e.prototype.eluDer=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",t.shape,e.shape):new Po("return (b >= 1.0) ? a : a * (b + 1.0);",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.selu=function(t){var e=new ys(t.shape,"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = 1.7580993408473768;\n  float scale = 1.0507009873554805;\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n");return this.compileAndRun(e,[t])},e.prototype.int=function(t){var e=new ys(t.shape,"return float(int(x));");return this.compileAndRun(e,[t],"int32")},e.prototype.clip=function(t,e,n){var r,o=(r=i().getBool("WEBGL_PACK_CLIP")?new Uo(t.shape):new zo(t.shape)).getCustomSetupFunc(e,n);return this.compileAndRun(r,[t],null,o)},e.prototype.abs=function(t){if(this.shouldExecuteOnCPU([t]))return this.cpuBackend.abs(t);if(i().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,bs,t.dtype);var e=new ys(t.shape,bs);return this.compileAndRun(e,[t])},e.prototype.complexAbs=function(t){var e=this.texData.get(t.dataId),n=new Vo(t.shape),r=[this.makeComplexComponentTensorInfo(t,e.complexTensors.real),this.makeComplexComponentTensorInfo(t,e.complexTensors.imag)];return this.compileAndRun(n,r)},e.prototype.sigmoid=function(t){var e=new ys(t.shape,"return 1.0 / (1.0 + exp(-1.0 * x));");return this.compileAndRun(e,[t])},e.prototype.softplus=function(t){var e=new ys(t.shape,"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n");return this.compileAndRun(e,[t])},e.prototype.sin=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  return sin(x);\n");return this.compileAndRun(e,[t])},e.prototype.cos=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  return cos(x);\n");return this.compileAndRun(e,[t])},e.prototype.tan=function(t){var e=new ys(t.shape,"return tan(x);");return this.compileAndRun(e,[t])},e.prototype.asin=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n");return this.compileAndRun(e,[t])},e.prototype.acos=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  return atan(x);\n");return this.compileAndRun(e,[t])},e.prototype.atan2=function(t,e){var n=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",t.shape,e.shape):new Po("\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",t.shape,e.shape);return this.compileAndRun(n,[t,e])},e.prototype.sinh=function(t){var e=new ys(t.shape,"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.cosh=function(t){var e=new ys(t.shape,"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n");return this.compileAndRun(e,[t])},e.prototype.tanh=function(t){var e=new ys(t.shape,"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n");return this.compileAndRun(e,[t])},e.prototype.asinh=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));");return this.compileAndRun(e,[t])},e.prototype.acosh=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\n  return log(x + sqrt(x * x - 1.0));");return this.compileAndRun(e,[t])},e.prototype.atanh=function(t){var e=new ys(t.shape,"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\n  return (log(1.0 + x) - log(1.0 - x)) / 2.0;");return this.compileAndRun(e,[t])},e.prototype.erf=function(t){var e=new ys(t.shape,'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = 0.3275911;\n  float a1 = 0.254829592;\n  float a2 = -0.284496736;\n  float a3 = 1.421413741;\n  float a4 = -1.453152027;\n  float a5 = 1.061405429;\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n');return this.compileAndRun(e,[t])},e.prototype.step=function(t,e){var n=new ys(t.shape,function(t){return void 0===t&&(t=0),xs+"\n    return x > 0.0 ? 1.0 : float("+t+");\n  "}(e));return this.compileAndRun(n,[t])},e.prototype.conv2dByMatMul=function(t,e,n,r,o,a){var s=t.shape,u=this.texData.get(t.dataId),c=n.inChannels,l=s[0]*s[1]*s[2],h=n.outChannels,d="channelsLast"===n.dataFormat,f=(1===l||1===h)&&c>1e3,p=s[2]%2!=0&&!!u.isPacked;if(f||!i().getBool("WEBGL_LAZILY_UNPACK")||!i().getBool("WEBGL_PACK_BINARY_OPERATIONS")||!p){var m=d?s[0]*s[1]*s[2]:s[0]*s[2]*s[3],g=this.reshape(t,[1,m,n.inChannels]),v=this.reshape(e,[1,n.inChannels,n.outChannels]);return this.reshape(this.fusedBatchMatMul({a:g,b:v,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),n.outShape)}var y=d?s[0]*s[1]*(s[2]+1):s[0]*s[2]*(s[3]+1),x={dataId:t.dataId,shape:[1,y,n.inChannels],dtype:t.dtype},b=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,A(Oe(u.shape,x.shape),(function(){return"packed reshape "+u.shape+" to "+x.shape+" isn't free"}));var w=this.reshape(e,[1,n.inChannels,n.outChannels]),_=this.fusedBatchMatMul({a:x,b:w,transposeA:!1,transposeB:!1,bias:r,activation:o,preluActivationWeights:a}),S=this.texData.get(_.dataId);return A(S.isPacked,(function(){return"batchMatMul result is expected to be packed"})),u.shape=b,S.shape=n.outShape,zt.makeTensorFromDataId(_.dataId,n.outShape,_.dtype)},e.prototype.conv2dWithIm2Row=function(t,e,n,r,o,a){var i=n.filterWidth,s=n.filterHeight,u=n.inChannels,c=n.outWidth,l=n.outHeight,h="channelsLast"===n.dataFormat,d=i*s*u,f=l*c,p=[d,f],m=t.squeeze([0]),g=e.reshape([1,d,-1]),v=new Pa(p,m.shape,n),y=this.compileAndRun(v,[m]).reshape([1,p[0],p[1]]),x=null!=r,b=null!=a,w=o?Ps(o,!0):null,_=new Ga(y.shape,[1,f,n.outChannels],!0,!1,x,w,b),S=[y,g];r&&S.push(r),b&&S.push(a);var M=this.compileAndRun(_,S);return h?M.reshape([1,l,c,n.outChannels]):M.reshape([1,n.outChannels,l,c])},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,s=t.preluActivationWeights;if(1===r.filterHeight&&1===r.filterWidth&&1===r.dilationHeight&&1===r.dilationWidth&&1===r.strideHeight&&1===r.strideWidth&&("SAME"===r.padInfo.type||"VALID"===r.padInfo.type))return this.conv2dByMatMul(e,n,r,o,a,s);if(i().getBool("WEBGL_CONV_IM2COL")&&1===e.shape[0])return this.conv2dWithIm2Row(e,n,r,o,a,s);var u=null!=o,c=null!=s,l=a?Ps(a,!1):null,h=new Zo(r,u,l,c),d=[e,n];return o&&d.push(o),s&&d.push(s),this.compileAndRun(h,d)},e.prototype.conv2d=function(t,e,n){if(1===n.filterHeight&&1===n.filterWidth&&1===n.dilationHeight&&1===n.dilationWidth&&1===n.strideHeight&&1===n.strideWidth&&("SAME"===n.padInfo.type||"VALID"===n.padInfo.type))return this.conv2dByMatMul(t,e,n);if(i().getBool("WEBGL_CONV_IM2COL")&&1===t.shape[0])return this.conv2dWithIm2Row(t,e,n);var r=new Zo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerInput=function(t,e,n){var r=new qo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv2dDerFilter=function(t,e,n){var r=new Wo(n);return this.compileAndRun(r,[t,e])},e.prototype.fusedDepthwiseConv2D=function(t){var e,n=t.input,r=t.filter,o=t.convInfo,a=t.bias,s=t.activation,u=t.preluActivationWeights,c=i().getBool("WEBGL_PACK_DEPTHWISECONV")&&o.strideWidth<=2&&o.outChannels/o.inChannels==1,l=s?Ps(s,c):null,h=[n,r],d=null!=a,f=null!=u;return d&&h.push(a),f&&h.push(u),c?(e=new ta(o,d,l,f),this.compileAndRun(e,h)):(e=new $o(o,d,l,f),this.compileAndRun(e,h))},e.prototype.depthwiseConv2D=function(t,e,n){var r;return i().getBool("WEBGL_PACK_DEPTHWISECONV")&&n.strideWidth<=2&&n.outChannels/n.inChannels==1?(r=new ta(n),this.compileAndRun(r,[t,e])):(r=new $o(n),this.compileAndRun(r,[t,e]))},e.prototype.depthwiseConv2DDerInput=function(t,e,n){var r=new Jo(n);return this.compileAndRun(r,[t,e])},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){var r=new Ko(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3d=function(t,e,n){var r=new Qo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerInput=function(t,e,n){var r=new Yo(n);return this.compileAndRun(r,[t,e])},e.prototype.conv3dDerFilter=function(t,e,n){var r=new Xo(n);return this.compileAndRun(r,[t,e])},e.prototype.maxPool=function(t,e){var n=new Ya(e,"max",!1);return this.compileAndRun(n,[t])},e.prototype.avgPool=function(t,e){var n=new Ya(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPoolBackprop=function(t,e,n,r){var o=new Ya(r,"max",!0),a=this.compileAndRun(o,[e]),i=new Ua(r),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.avgPoolBackprop=function(t,e,n){var r=new Ao(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.cast=function(t,e){return Vi(t,e,this)},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(r[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(r);return u},e.prototype.avgPool3d=function(t,e){var n=new Ka(e,"avg",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.avgPool3dBackprop=function(t,e,n){var r=new Co(n);return this.compileAndRun(r,[t],e.dtype)},e.prototype.maxPool3d=function(t,e){var n=new Ka(e,"max",!1);return this.compileAndRun(n,[t],"float32")},e.prototype.maxPool3dBackprop=function(t,e,n,r){var o=new Ka(r,"max",!0),a=this.compileAndRun(o,[e]),i=new Va(r),s=this.compileAndRun(i,[t,a],e.dtype);return a.dispose(),s},e.prototype.reshape=function(t,e){var n=this.texData.get(t.dataId);if(n.isPacked&&!Oe(t.shape,e)&&(null===n.texture||!Oe(n.shape,e))){var r=this.packedReshape(t,e);return zt.makeTensorFromDataId(r.dataId,r.shape,r.dtype)}return Gi(t,e)},e.prototype.resizeBilinear=function(t,e,n,r){var o=i().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new ts(t.shape,e,n,r):new $a(t.shape,e,n,r);return this.compileAndRun(o,[t],"float32")},e.prototype.resizeBilinearBackprop=function(t,e,n){var r=new Qa(t,e,n);return this.compileAndRun(r,[t])},e.prototype.resizeNearestNeighbor=function(t,e,n,r){var o=new ns(t.shape,e,n,r);return this.compileAndRun(o,[t])},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){var r=new es(t,e,n);return this.compileAndRun(r,[t])},e.prototype.multinomial=function(t,e,n,r){var o=e?t:Si(t),a=o.shape[0],i=o.shape[1],s=new Ha(a,i,n),u=s.getCustomSetupFunc(r);return this.compileAndRun(s,[o],"int32",u)},e.prototype.oneHot=function(t,e,n,r){var o=new ja(t.size,e,n,r);return this.compileAndRun(o,[t])},e.prototype.diag=function(t){var e=new sa(t.size);return this.compileAndRun(e,[t])},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return Je("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead"),Zi(t.dataSync(),e.dataSync(),n,r,o)},e.prototype.cropAndResize=function(t,e,n,r,o,a){var i=new ea(t.shape,e.shape,r,o,a);return this.compileAndRun(i,[t,e,n],"float32")},e.prototype.depthToSpace=function(t,e,n){A(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));var r=t.shape[0],o="NHWC"===n?t.shape[1]:t.shape[2],a="NHWC"===n?t.shape[2]:t.shape[3],i="NHWC"===n?t.shape[3]:t.shape[1],s=o*e,u=a*e,c=i/(e*e),l=new aa("NHWC"===n?[r,s,u,c]:[r,c,s,u],e,n);return this.compileAndRun(l,[t])},e.prototype.split=function(t,e,n){return ro(t,e,n)},e.prototype.scatterND=function(t,e,n){var r=pi(0,t,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=[u/i,i],l=t.reshape([a,o]),h=e.reshape([a,i]);if(0===u)return Gi(gn([]),n);var d=yn(0),f=new os(a,o,l.rank,h.rank,s,c);return this.compileAndRun(f,[h,l,d]).reshape(n)},e.prototype.sparseToDense=function(t,e,n,r){var o=pi(0,t,n),a=o.sliceRank,i=o.numUpdates,s=o.strides,u=o.outputSize,c=new os(i,a,t.rank,e.rank,s,[u,1],!1);return this.compileAndRun(c,[e,t,r]).reshape(n)},e.prototype.fft=function(t){return this.fftImpl(t,!1)},e.prototype.ifft=function(t){return this.fftImpl(t,!0)},e.prototype.fftImpl=function(t,e){var n=this.texData.get(t.dataId),r=new pa("return real * expR - imag * expI;",t.shape,e),o=new pa("return real * expI + imag * expR;",t.shape,e),a=[this.makeComplexComponentTensorInfo(t,n.complexTensors.real),this.makeComplexComponentTensorInfo(t,n.complexTensors.imag)],i=this.compileAndRun(r,a),s=this.compileAndRun(o,a),u=this.complex(i,s).as2D(t.shape[0],t.shape[1]);return i.dispose(),s.dispose(),u},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=ai(t,e),a=o[0],i=o[1],s=o[2],u=o[3],c=e.reshape([i,r]),l=t.reshape([t.size/s,s]),h=new ma(r,u,[i,s]);return this.compileAndRun(h,[l,c]).reshape(a)},e.prototype.fill=function(t,e,n){if("string"===(n=n||Q(e))){var r=G(n,N(t));return r.fill(e),zt.makeTensor(r,t,n,this)}var o=new da(t,e),a=o.getCustomSetupFunc(e);return this.compileAndRun(o,[],n,a)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported under string dtype");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){return this.fill(t.shape,"string"===t.dtype?"":0,t.dtype)},e.prototype.linspace=function(t,e,n){return Hi(t,e,n)},e.prototype.makeTensorInfo=function(t,e){var n=this.write(null,t,e);return this.texData.get(n).usage=null,{dataId:n,shape:t,dtype:e}},e.prototype.makeOutput=function(t,e){var n=this.makeTensorInfo(t,e).dataId;return zt.makeTensorFromDataId(n,t,e,this)},e.prototype.unpackTensor=function(t){var e=new Ls(t.shape);return this.runWebGLProgram(e,[t],t.dtype)},e.prototype.packTensor=function(t){var e=new Wa(t.shape);return this.runWebGLProgram(e,[t],t.dtype,null,!0)},e.prototype.packedReshape=function(t,e){var n=[Ae(t.shape)].concat(Ce(t.shape)),r={dtype:t.dtype,shape:n,dataId:t.dataId},o=[Ae(e)].concat(Ce(e)),a=new Za(o,n),i=this.runWebGLProgram(a,[r],t.dtype,null,!0);return{dataId:i.dataId,shape:e,dtype:i.dtype}},e.prototype.decode=function(t){var e,n=this.texData.get(t),r=n.isPacked,o=n.shape,a=n.dtype,i=Re(o);return e=r?new oa(i):new ia(i),{dtype:a,shape:o,dataId:this.runWebGLProgram(e,[{shape:i,dtype:a,dataId:t}],a,null,!0).dataId}},e.prototype.runWebGLProgram=function(t,e,n,r,o){var a=this;void 0===o&&(o=!1);var s=this.makeTensorInfo(t.outputShape,n),u=this.texData.get(s.dataId);if(t.packedOutput&&(u.isPacked=!0),t.outPackingScheme===Gt.DENSE){var c=Jt(t.outputShape);u.texShape=c.map((function(t){return 2*t}))}if(null!=t.outTexUsage&&(u.usage=t.outTexUsage),0===N(s.shape))return u.values=V(s.dtype,0),s;var l=[],h=e.map((function(e){if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&N(e.shape)<=i().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!=!!t.packedInputs)e=n.isPacked?a.unpackTensor(e):a.packTensor(e),l.push(e),n=a.texData.get(e.dataId);else if(n.isPacked&&!Oe(n.shape,e.shape)){var r=e,o=e.shape;e.shape=n.shape,e=a.packedReshape(e,o),l.push(e),n=a.texData.get(e.dataId),r.shape=o}return a.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var d,f={shape:s.shape,texData:u,isUniform:!1},p=function(t,e,n){var r="";e.concat(n).forEach((function(t){var e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;r+=t.shape+"_"+n+"_"+e}));var o=t.userCode;return t.constructor.name+"_"+r+"_"+o}(t,h,f),m=this.getAndSaveBinary(p,(function(){return function(t,e,n,r){var o=e.userCode,a=n.map((function(t,n){var r={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(r.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:r}})),s=a.map((function(t){return t.shapeInfo})),u={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},c=vo(a,u,o,e.packedInputs),l=t.createProgram(c),h=null,d=t.getUniformLocation(l,"NAN",!1);1===i().getNumber("WEBGL_VERSION")&&(h=t.getUniformLocation(l,"INFINITY",!1));for(var f={},p=0;p<e.variableNames.length;p++){var m=e.variableNames[p];f[m]=t.getUniformLocation(l,m,!1),f["offset"+m]=t.getUniformLocation(l,"offset"+m,!1)}return{program:e,source:c,webGLProgram:l,uniformLocations:f,inShapeInfos:s,outShapeInfo:u,infLoc:h,nanLoc:d}}(a.gpgpu,t,h,f)})),g=null!=this.activeTimers;if(g&&(d=this.startTimer()),function(t,e,n,r,o){ka(e.inShapeInfos,n),ka([e.outShapeInfo],[r]);var a=r.texData.texture,s=r.texData.texShape;r.texData.isPacked?t.setOutputPackedMatrixTexture(a,s[0],s[1]):t.setOutputMatrixTexture(a,s[0],s[1]),t.setProgram(e.webGLProgram),1===i().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach((function(n,r){var o=e.program.variableNames[r],a=e.uniformLocations[o],i=e.uniformLocations["offset"+o];if(null!=a)if(n.isUniform)if(N(n.shape)<2)t.gl.uniform1f(a,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),t.gl.uniform1fv(a,s)}else null!=n.texData.slice&&null!=i&&t.gl.uniform1i(i,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,a,r)})),null!=o&&o(t,e.webGLProgram),t.executeProgram()}(this.gpgpu,m,h,f,r),l.forEach((function(t){return a.disposeData(t.dataId)})),g&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)})),!i().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===o){var v=this.unpackTensor(s);return this.disposeData(s.dataId),v}return s},e.prototype.compileAndRun=function(t,e,n,r,o){void 0===o&&(o=!1),n=n||e[0].dtype;var a=this.runWebGLProgram(t,e,n,r,o);return zt.makeTensorFromDataId(a.dataId,a.shape,a.dtype)},e.prototype.getAndSaveBinary=function(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]},e.prototype.getTextureManager=function(){return this.textureManager},e.prototype.dispose=function(){var t=this;this.disposed||(i().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach((function(e){t.gpgpu.deleteProgram(t.binaryCache[e].webGLProgram),delete t.binaryCache[e]})),this.textureManager.dispose(),null!=this.canvas&&"undefined"!=typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)},e.prototype.floatPrecision=function(){var t=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=qe((function(){if(!i().get("WEBGL_RENDER_FLOAT32_ENABLED")){var e=i().getBool("DEBUG");i().set("DEBUG",!1);var n=t.abs(yn(1e-8)).dataSync()[0];if(i().set("DEBUG",e),n>0)return 32}return 16}))),this.floatPrecisionValue},e.prototype.epsilon=function(){return 32===this.floatPrecision()?1e-7:1e-4},e.prototype.uploadToGPU=function(t){var e,n=this.texData.get(t),r=n.shape,o=n.dtype,a=n.values,i=n.texture,s=n.usage,u=n.isPacked;if(null==i){var c,l=null!=this.activeTimers;l&&(c=st());var h=n.texShape;if(null==h&&(h=Ie(r,u),n.texShape=h),null!=a){var d=Re(r),f=void 0,p=h[1],m=h[0],g=a instanceof Uint8Array;u?(p=(e=Zt(h[0],h[1]))[0],m=e[1],f=new ha(d,[m,p],g)):f=new la(d,[m,p],g);var v=this.makeTensorInfo([m,p],o);this.texData.get(v.dataId).usage=g?Ht.PIXELS:Ht.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(v.dataId),p,m,a);var y=this.runWebGLProgram(f,[v],o,null,!0),x=this.texData.get(y.dataId);n.texture=x.texture,n.texShape=x.texShape,n.isPacked=x.isPacked,n.usage=x.usage,this.disposeData(v.dataId),this.texData.delete(y.dataId),n.values=null,l&&(this.uploadWaitMs+=st()-c)}else{var b=this.acquireTexture(h,s,o,u);n.texture=b}}},e.prototype.convertAndCacheOnCPU=function(t,e){var n=this.texData.get(t),r=n.dtype;return this.releaseGPUData(t),null!=e&&(n.values=function(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){for(var n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length),r=0;r<n.length;++r)n[r]=Math.round(t[r]);return n}throw new Error("Unknown dtype "+e)}(e,r)),n.values},e.prototype.acquireTexture=function(t,e,n,r){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var o=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: "+o+" MB, most likely due to a memory leak")}return this.textureManager.acquireTexture(t,e,r)},e.prototype.computeBytes=function(t,e){return t[0]*t[1]*Y(e)},e}(Ai);function Bs(t,e){return t(e={exports:{}},e.exports),e.exports}Ut()&&zt.registerBackend("webgl",(function(){return new Fs}),2),"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t||"undefined"!=typeof self&&self;var zs=Bs((function(t){!function(t,e,n){function r(t){var e,n=this,r=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=r(" "),n.s1=r(" "),n.s2=r(" "),n.s0-=r(t),n.s0<0&&(n.s0+=1),n.s1-=r(t),n.s1<0&&(n.s1+=1),n.s2-=r(t),n.s2<0&&(n.s2+=1),r=null}function o(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function a(t,e){var n=new r(t),a=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.alea=a}(0,t)})),Us=Bs((function(t){!function(t,e,n){function r(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xor128=a}(0,t)})),Vs=Bs((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var r=0;r<n.length+64;r++)e.x^=0|n.charCodeAt(r),r==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function o(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xorwow=a}(0,t)})),Gs=Bs((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.x,o=e.i;return t=r[o],n=(t^=t>>>7)^t<<24,n^=(t=r[o+1&7])^t>>>10,n^=(t=r[o+3&7])^t>>>3,n^=(t=r[o+4&7])^t<<7,t=r[o+7&7],n^=(t^=t<<13)^t<<9,r[o]=n,e.i=o+1&7,n},function(t,e){var n,r=[];if(e===(0|e))r[0]=e;else for(e=""+e,n=0;n<e.length;++n)r[7&n]=r[7&n]<<15^e.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],t.x=r,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function o(t,e){return e.x=t.x.slice(),e.i=t.i,e}function a(t,e){null==t&&(t=+new Date);var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&(a.x&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xorshift7=a}(0,t)})),Hs=Bs((function(t){!function(t,e,n){function r(t){var e=this;e.next=function(){var t,n,r=e.w,o=e.X,a=e.i;return e.w=r=r+1640531527|0,n=o[a+34&127],t=o[a=a+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=o[a]=n^t,e.i=a,n+(r^r>>>16)|0},function(t,e){var n,r,o,a,i,s=[],u=128;for(e===(0|e)?(r=e,e=null):(e+="\0",r=0,u=Math.max(u,e.length)),o=0,a=-32;a<u;++a)e&&(r^=e.charCodeAt((a+32)%e.length)),0===a&&(i=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,a>=0&&(i=i+1640531527|0,o=0==(n=s[127&a]^=r+i)?o+1:0);for(o>=128&&(s[127&(e&&e.length||0)]=-1),o=127,a=512;a>0;--a)r=s[o+34&127],n=s[o=o+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[o]=r^n;t.w=i,t.X=s,t.i=o}(e,t)}function o(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function a(t,e){null==t&&(t=+new Date);var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&(a.X&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.xor4096=a}(0,t)})),js=Bs((function(t){!function(t,e,n){function r(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,r=e.d,o=e.a;return t=t<<25^t>>>7^n,n=n-r|0,r=r<<24^r>>>8^o,o=o-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-r|0,e.d=r<<16^n>>>16^o,e.a=o-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var r=0;r<n.length+20;r++)e.b^=0|n.charCodeAt(r),e.next()}function o(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function a(t,e){var n=new r(t),a=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,a&&("object"==typeof a&&o(a,n),i.state=function(){return o(n,{})}),i}e&&e.exports?e.exports=a:this.tychei=a}(0,t)})),Ws=Bs((function(t){!function(e,r){var o,c=this,a=256,s="random",u=r.pow(a,6),l=r.pow(2,52),h=2*l,d=255;function f(t,n,d){var f=[],y=v(function t(e,n){var r,o=[],a=typeof e;if(n&&"object"==a)for(r in e)try{o.push(t(e[r],n-1))}catch(t){}return o.length?o:"string"==a?e:e+"\0"}((n=1==n?{entropy:!0}:n||{}).entropy?[t,g(e)]:null==t?function(){try{var t;return o&&(t=o.randomBytes)?t=t(a):(t=new Uint8Array(a),(c.crypto||c.msCrypto).getRandomValues(t)),g(t)}catch(t){var n=c.navigator,i=n&&n.plugins;return[+new Date,c,i,c.screen,g(e)]}}():t,3),f),x=new m(f),b=function(){for(var t=x.g(6),e=u,n=0;t<l;)t=(t+n)*a,e*=a,n=x.g(1);for(;t>=h;)t/=2,e/=2,n>>>=1;return(t+n)/e};return b.int32=function(){return 0|x.g(4)},b.quick=function(){return x.g(4)/4294967296},b.double=b,v(g(x.S),e),(n.pass||d||function(t,e,n,o){return o&&(o.S&&p(o,x),t.state=function(){return p(x,{})}),n?(r[s]=t,e):t})(b,y,"global"in n?n.global:this==r,n.state)}function m(t){var e,n=t.length,r=this,o=0,i=r.i=r.j=0,s=r.S=[];for(n||(t=[n++]);o<a;)s[o]=o++;for(o=0;o<a;o++)s[o]=s[i=d&i+t[o%n]+(e=s[o])],s[i]=e;(r.g=function(t){for(var e,n=0,o=r.i,i=r.j,s=r.S;t--;)e=s[o=d&o+1],n=n*a+s[d&(s[o]=s[i=d&i+e])+(s[i]=e)];return r.i=o,r.j=i,n})(a)}function p(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){for(var n,r=t+"",o=0;o<r.length;)e[d&o]=d&(n^=19*e[d&o])+r.charCodeAt(o++);return g(e)}function g(t){return String.fromCharCode.apply(0,t)}if(r.seedrandom=f,v(r.random(),e),t.exports){t.exports=f;try{o=n(185)}catch(t){}}}([],Math)}));Ws.alea=zs,Ws.xor128=Us,Ws.xorwow=Vs,Ws.xorshift7=Gs,Ws.xor4096=Hs,Ws.tychei=js;var qs=Ws.alea,Xs=pn({addN_:function(t){A(Array.isArray(t),(function(){return"The argument passed to tf.addN() must be a list of tensors"})),A(t.length>=1,(function(){return"Must pass at least one tensor to tf.addN(), but got "+t.length}));var e=t.map((function(t,e){return $e(t,"tensors"+e,"addN")})),n=e[0];e.forEach((function(t){if(t.dtype!==n.dtype)throw new Error("All tensors passed to tf.addN() must have the same dtype")})),e.forEach((function(t){if(!O(t.shape,n.shape))throw new Error("All tensors passed to tf.addN() must have the same shape")}));var r=e;return zt.runKernelFunc((function(t,n){return t.addN(e)}),r,null,"AddN")}});function Ys(){je("tf.batchNormalization() is going away. Use tf.batchNorm() instead, and note the positional argument change of scale, offset, and varianceEpsilon")}function Ks(t){return 0===t.rank||1===t.rank?t.as4D(1,1,1,t.size):2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}function Js(t,e,n,r,o,a){null==a&&(a=.001);var i,s,u=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");null!=o&&(i=$e(o,"scale","batchNorm")),null!=r&&(s=$e(r,"offset","batchNorm")),A(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),A(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),A(null==i||c.rank===i.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h={x:u,scale:i,offset:s,mean:c,variance:l},d={varianceEpsilon:a};return zt.runKernelFunc((function(t,e){var n=Ks(u),r=t.batchNormalization(n,Zs(c),Zs(l),a,Zs(i),Zs(s));return e([u,c,l,i]),r}),h,null,"FusedBatchNorm",d).reshape(u.shape)}function Zs(t){return null==t?null:0===t.rank?t.as1D():1===t.rank?t:2===t.rank?t.as4D(1,1,t.shape[0],t.shape[1]):3===t.rank?t.as4D(1,t.shape[0],t.shape[1],t.shape[2]):t}var Qs=pn({batchNormalization_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ys(),Js(t,e,n,a,o,r)}}),$s=pn({batchNorm_:Js});function tu(t,e,n,r,o,a){var i,s,u=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=o&&(i=$e(o,"scale","batchNorm")),null!=r&&(s=$e(r,"offset","batchNorm")),A(2===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank "+c.rank+"."})),A(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank "+l.rank+"."})),null!=i&&A(2===i.rank||1===i.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank "+i.rank+"."})),null!=s&&A(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank "+s.rank+"."})),$s(u,c,l,s,i,a)}var eu=pn({batchNormalization2d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ys(),tu(t,e,n,a,o,r)}}),nu=pn({batchNorm2d_:tu});function ru(t,e,n,r,o,a){var i,s,u=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=o&&(i=$e(o,"scale","batchNorm")),null!=r&&(s=$e(r,"offset","batchNorm")),A(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+u.rank+"."})),A(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank "+c.rank+"."})),A(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank "+l.rank+"."})),null!=i&&A(3===i.rank||1===i.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank "+i.rank+"."})),null!=s&&A(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank "+s.rank+"."})),$s(u,c,l,s,i,a)}var iu=pn({batchNormalization3d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ys(),ru(t,e,n,a,o,r)}}),ou=pn({batchNorm3d_:ru});function au(t,e,n,r,o,a){var i,s,u=$e(t,"x","batchNorm"),c=$e(e,"mean","batchNorm"),l=$e(n,"variance","batchNorm");return null!=o&&(i=$e(o,"scale","batchNorm")),null!=r&&(s=$e(r,"offset","batchNorm")),A(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank "+c.rank+"."})),A(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank "+l.rank+"."})),null!=i&&A(4===i.rank||1===i.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank "+i.rank+"."})),null!=s&&A(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank "+s.rank+"."})),$s(u,c,l,s,i,a)}var su=pn({batchNormalization4d_:function(t,e,n,r,o,a){return void 0===r&&(r=.001),Ys(),au(t,e,n,a,o,r)}}),uu=pn({batchNorm4d_:au}),cu=pn({broadcastTo_:function(t,e){var n=$e(t,"broadcastTo","x"),r=n.shape;if(e.some((function(t){return!(t>0)||t%1!=0})))throw new Error("broadcastTo(): Invalid broadcast shape ["+e+"].");if(e.length<n.rank)throw new Error("broadcastTo(): shape.length="+e.length+" < input.rank="+n.rank+".");if(e.length>n.rank){for(var o=n.shape.slice();o.length<e.length;)o.unshift(1);n=n.reshape(o)}for(var a=n.shape,i=Array.from(e),s=e.length-1;s>=0;s--)if(a[s]===e[s])i[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): ["+r+"] cannot be broadcast to ["+e+"].");var u=i.map((function(t,e){return t>1?e:-1})).filter((function(t){return t>=0}));if(0===u.length)return n.clone();var c={x:n},l={shape:e,inputShape:a};return zt.runKernelFunc((function(t){return t.tile(n,i)}),c,(function(t){return{x:function(){return t.sum(u,!0)}}}),$n,l)}}),lu=pn({clone_:function(t){var e=$e(t,"x","clone",null);return zt.runKernelFunc((function(){return zt.makeTensorFromDataId(e.dataId,e.shape,e.dtype)}),{x:e},null,er)}}),hu=pn({logicalAnd_:function(t,e){var n=$e(t,"a","logicalAnd","bool"),r=$e(e,"b","logicalAnd","bool");return or(n.shape,r.shape),zt.runKernelFunc((function(t){return t.logicalAnd(n,r)}),{a:n,b:r},null,"LogicalAnd")}}),pu=pn({logicalNot_:function(t){var e=$e(t,"x","logicalNot","bool");return zt.runKernelFunc((function(t){return t.logicalNot(e)}),{$x:e})}}),du=pn({logicalOr_:function(t,e){var n=$e(t,"a","logicalOr","bool"),r=$e(e,"b","logicalOr","bool");return or(n.shape,r.shape),zt.runKernelFunc((function(t){return t.logicalOr(n,r)}),{$a:n,$b:r})}}),fu=pn({logicalXor_:function(t,e){var n=$e(t,"a","logicalXor","bool"),r=$e(e,"b","logicalXor","bool");return or(n.shape,r.shape),du(t,e).logicalAnd(hu(t,e).logicalNot())}}),mu=pn({where_:function(t,e,n){var r=$e(e,"a","where"),o=$e(n,"b","where"),a=$e(t,"condition","where","bool");return C(r.shape,o.shape,"Error in where: "),1===a.rank?A(a.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})):C(a.shape,o.shape,"Error in where: "),zt.runKernelFunc((function(t,e){var n=t.select(a,r,o);return e([a]),n}),{$condition:a,$a:r,$b:o},(function(t,e){var n=e[0];return{$condition:function(){return Rn(n).toFloat()},$a:function(){return t.mul(n.cast(t.dtype))},$b:function(){return t.mul(n.logicalNot().cast(t.dtype))}}}))}}),gu=function(t){return d(this,void 0,void 0,(function(){var e,n,r;return f(this,(function(o){switch(o.label){case 0:return[4,(e=$e(t,"condition","whereAsync","bool")).data()];case 1:return n=o.sent(),r=ao(e.shape,n),t!==e&&e.dispose(),[2,r]}}))}))},vu=pn({divNoNan_:function(t,e){var n,r=$e(t,"a","div"),o=$e(e,"b","div");r=(n=Dt(r,o))[0],o=n[1];var a=oi(r,o),i=Rn(a),s=o.equal(i);return mu(s,i,a)}}),yu=pn({tile_:function(t,e){var n=$e(t,"x","tile",null);A(n.rank===e.length,(function(){return"Error in transpose: rank of input "+n.rank+" must match length of reps "+e+"."}));var r=[n],o={x:n},a={reps:e};return zt.runKernelFunc((function(t,r){var o=t.tile(n,e);return r([n]),o}),o,null,"Tile",a,r)}}),xu=pn({eye_:function(t,e,n,r){void 0===r&&(r="float32"),null==e&&(e=t);for(var o=kn([t,e],r),a=t<=e?t:e,i=0;i<a;++i)o.set(1,i,i);var s=o.toTensor().as2D(t,e);if(null==n)return s;if(1===n.length)return yu(Un(s,0),[n[0],1,1]);if(2===n.length)return yu(Un(Un(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return yu(Un(Un(Un(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D batchShapes, but received "+n.length+"D.")}}),bu=pn({multinomial_:function(t,e,n,r){void 0===r&&(r=!1);var o=$e(t,"logits","multinomial"),a=o.size,i=o.rank;if(a<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+a+".");if(i>2)throw new Error("Rank of probabilities must be 1 or 2, but is "+i);n=n||Math.random();var s=1===i?o.as2D(1,-1):o,u=zt.runKernelFunc((function(t){return t.multinomial(s,r,e,n)}),{logits2D:s});return 1===i?u.as1D():u}}),wu=pn({oneHot_:function(t,e,n,r){if(void 0===n&&(n=1),void 0===r&&(r=0),e<2)throw new Error("Error in oneHot: depth must be >=2, but it is "+e);var o=$e(t,"indices","oneHot","int32"),a=o.shape.concat([e]),i={indices:o=o.flatten()},s={depth:e,onValue:n,offValue:r};return zt.runKernelFunc((function(t,a){return a([o]),t.oneHot(o,e,n,r)}),i,null,"OneHot",s).reshape(a)}}),_u=pn({pad_:function(t,e,n){void 0===n&&(n=0);var r=$e(t,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var o={paddings:e,constantValue:n},a={x:r};return zt.runKernelFunc((function(t,o){return o([r]),t.pad(r,e,n)}),a,null,"PadV2",o)}}),Su=pn({pad1d_:function(t,e,n){return void 0===n&&(n=0),A(2===e.length,(function(){return"Invalid number of paddings. Must be length of 2."})),_u(t,[e],n)}}),Mu=pn({pad2d_:function(t,e,n){return void 0===n&&(n=0),A(2===e.length&&2===e[0].length&&2===e[1].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),_u(t,e,n)}}),Eu=pn({pad3d_:function(t,e,n){return void 0===n&&(n=0),A(3===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),_u(t,e,n)}}),Tu=pn({pad4d_:function(t,e,n){return void 0===n&&(n=0),A(4===e.length&&2===e[0].length&&2===e[1].length&&2===e[2].length&&2===e[3].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),_u(t,e,n)}}),Au=pn({rand_:function(t,e,n){var r=N(t),o=null;if(null==n||"float32"===n)o=new Float32Array(r);else if("int32"===n)o=new Int32Array(r);else{if("bool"!==n)throw new Error("Unknown data type "+n);o=new Uint8Array(r)}for(var a=0;a<r;a++)o[a]=e();return zt.makeTensor(o,t,n)}});function Cu(){return 32===zt.backend.floatPrecision()?.001:.1}function Ru(t,e,n){var r=!0;if((X(t)||X(e))&&(r=!1),X(t)&&X(e)&&(r=!0),r){var o=t.constructor.name,a=e.constructor.name;if(o!==a)throw new Error("Arrays are of different type. Actual: "+o+". Expected: "+a)}if(Array.isArray(t)&&Array.isArray(e)){var i=Ze(t),s=Ze(e);if(!O(i,s))throw new Error("Arrays have different shapes. Actual: ["+i+"]. Expected: ["+s+"]")}var u=X(t)?t:I(t),c=X(e)?e:I(e);if(u.length!==c.length)throw new Error("Arrays have different lengths actual: "+u.length+" vs expected: "+c.length+".\nActual:   "+u+".\nExpected: "+c+".");for(var l=0;l<c.length;++l){var h=u[l],d=c[l];if(!n(h,d))throw new Error("Arrays differ: actual["+l+"] = "+h+", expected["+l+"] = "+d+".\nActual:   "+u+".\nExpected: "+c+".")}}function Iu(t,e,n){return!isFinite(t)&&!isFinite(e)||!(isNaN(t)||isNaN(e)||Math.abs(t-e)>n)}Object.freeze({TEST_EPSILON_FLOAT16:.1,expectArraysClose:function(t,e,n){return null==n&&(n=Cu()),Ru(t,e,(function(t,e){return Iu(t,e,n)}))},testEpsilon:Cu,expectPromiseToFail:function(t,e){t().then((function(){return e.fail()}),(function(){return e()}))},expectArraysEqual:function(t,e){var n="string"==typeof e||"number"==typeof e||"boolean"==typeof e?[e]:e;return J(t)||J(t[0])||J(e)||J(e[0])?Ru(t,n,(function(t,e){return t==e})):Ru(t,e,(function(t,e){return Iu(t,e,0)}))},expectNumbersClose:function(t,e,n){if(null==n&&(n=Cu()),!Iu(t,e,n))throw new Error("Numbers differ: actual === "+t+", expected === "+e)},expectValuesInRange:function(t,e,n){for(var r=0;r<t.length;r++)if(t[r]<e||t[r]>n)throw new Error("Value out of range:"+t[r]+" low: "+e+", high: "+n)},expectArrayBuffersEqual:function(t,e){expect(new Float32Array(t)).toEqual(new Float32Array(e))}});var Nu=function(){function t(t,e,n,r,o){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=r,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var a=o||Math.random();this.random=qs(a.toString())}return t.prototype.nextValue=function(){if(!isNaN(this.nextVal)){var t=this.nextVal;return this.nextVal=NaN,t}for(var e,n,r=!1;!r;){var o=void 0,a=void 0,i=void 0;do{i=(o=2*this.random()-1)*o+(a=2*this.random()-1)*a}while(i>=1||0===i);var s=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*s,n=this.mean+this.stdDev*a*s,this.truncated&&!this.isValidTruncated(e)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(e)},t.prototype.convertValue=function(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)},t.prototype.isValidTruncated=function(t){return t<=this.upper&&t>=this.lower},t}(),Ou=function(){function t(t,e,n,r){this.alpha=t,this.beta=1/e,this.dtype=n;var o=r||Math.random();this.randu=qs(o.toString()),this.randn=new Nu(0,1,n,!1,this.randu()),this.d=t<1?t+2/3:t-1/3,this.c=1/Math.sqrt(9*this.d)}return t.prototype.nextValue=function(){for(var t,e,n,r,o,a;;){do{r=this.randn.nextValue(),a=1+this.c*r}while(a<=0);if(a*=a*a,e=1-.331*(t=r*r)*t,n=.5*t+this.d*(1-a+Math.log(a)),(o=this.randu())<e||Math.log(o)<n)break}return a=1/this.beta*this.d*a,this.alpha<1&&(a*=Math.pow(this.randu(),1/this.alpha)),this.convertValue(a)},t.prototype.convertValue=function(t){return"float32"===this.dtype?t:Math.round(t)},t}(),Du=function(){function t(t,e,n,r){var o=this;if(void 0===t&&(t=0),void 0===e&&(e=1),this.canReturnFloat=function(){return null==o.dtype||"float32"===o.dtype},this.min=t,this.range=e-t,this.dtype=n,null==r&&(r=Math.random()),"number"==typeof r&&(r=r.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between "+t+" - "+e+" <= 1 and dtype is not float");this.random=qs(r)}return t.prototype.convertValue=function(t){return this.canReturnFloat()?t:Math.round(t)},t.prototype.nextValue=function(){return this.convertValue(this.min+this.range*this.random())},t}(),Lu=pn({randomGamma_:function(t,e,n,r,o){if(void 0===n&&(n=1),void 0===r&&(r="float32"),null==n&&(n=1),null==r&&(r="float32"),"float32"!==r&&"int32"!==r)throw new Error("Unsupported data type "+r);for(var a=new Ou(e,n,r,o),i=kn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),ku=pn({randomNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type "+r);for(var a=new Nu(e,n,r,!1,o),i=kn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Pu=pn({randomUniform_:function(t,e,n,r,o){void 0===e&&(e=0),void 0===n&&(n=1),void 0===r&&(r="float32");for(var a=kn(t,r),i=new Du(e,n,null,o),s=0;s<a.values.length;s++)a.values[s]=i.nextValue();return a.toTensor()}}),Fu=pn({square_:function(t){var e=$e(t,"x","square"),n=[e];return zt.runKernelFunc((function(t,n){return n([e]),t.square(e)}),{x:e},null,"Square",{},n,[])}}),Bu=pn({squaredDifference_:function(t,e){var n,r=$e(t,"a","squaredDifference"),o=$e(e,"b","squaredDifference");n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape);var a={a:r,b:o},i=[r,o];return zt.runKernelFunc((function(t,e){var n=t.squaredDifference(r,o);return e([r,o]),n}),a,(function(t,e){var n=e[0],r=e[1],o=yn(2);return{a:function(){return t.mul(n.sub(r).mul(o))},b:function(){return t.mul(r.sub(n).mul(o))}}}),Qn,{},i,[])}}),zu=pn({truncatedNormal_:function(t,e,n,r,o){if(void 0===e&&(e=0),void 0===n&&(n=1),null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var a=new Nu(e,n,r,!0,o),i=kn(t,r),s=0;s<i.values.length;s++)i.values[s]=a.nextValue();return i.toTensor()}}),Uu=pn({equal_:function(t,e){var n,r=$e(t,"a","equal"),o=$e(e,"b","equal");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t){return t.equal(r,o)}),{$a:r,$b:o})}}),Vu=pn({equalStrict_:function(t,e){var n=$e(t,"a","equalStrict"),r=$e(e,"b","equalStrict");return C(n.shape,r.shape,"Error in equalStrict: "),n.equal(r)}}),Gu=pn({greater_:function(t,e){var n,r=$e(t,"a","greater"),o=$e(e,"b","greater");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t){return t.greater(r,o)}),{a:r,b:o},null,"Greater")}}),Hu=pn({greaterEqual_:function(t,e){var n,r=$e(t,"a","greaterEqual"),o=$e(e,"b","greaterEqual");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t,e){var n=t.greaterEqual(r,o);return e([r,o]),n}),{a:r,b:o},(function(t,e){var n=e[0],r=e[1];return{a:function(){return Rn(n)},b:function(){return Rn(r)}}}),"GreaterEqual")}}),ju=pn({greaterEqualStrict_:function(t,e){var n=$e(t,"a","greaterEqualStrict"),r=$e(e,"b","greaterEqualStrict");return C(n.shape,r.shape,"Error in greaterEqualStrict: "),n.greaterEqual(r)}}),Wu=pn({greaterStrict_:function(t,e){var n=$e(t,"a","greaterStrict"),r=$e(e,"b","greaterStrict");return C(n.shape,r.shape,"Error in greaterStrict: "),n.greater(r)}}),qu=pn({less_:function(t,e){var n,r=$e(t,"a","less"),o=$e(e,"b","less");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t){return t.less(r,o)}),{a:r,b:o},null,"Less")}}),Xu=pn({lessEqual_:function(t,e){var n,r=$e(t,"a","lessEqual"),o=$e(e,"b","lessEqual");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t,e){var n=t.lessEqual(r,o);return e([r,o]),n}),{a:r,b:o},null,"LessEqual")}}),Yu=pn({lessEqualStrict_:function(t,e){var n=$e(t,"a","lessEqualStrict"),r=$e(e,"b","lessEqualStrict");return C(n.shape,r.shape,"Error in lessEqualStrict: "),n.lessEqual(r)}}),Ku=pn({lessStrict_:function(t,e){var n=$e(t,"a","lessStrict"),r=$e(e,"b","lessStrict");return C(n.shape,r.shape,"Error in lessStrict: "),n.less(r)}}),Ju=pn({notEqual_:function(t,e){var n,r=$e(t,"a","notEqual"),o=$e(e,"b","notEqual");return n=Dt(r,o),r=n[0],o=n[1],or(r.shape,o.shape),zt.runKernelFunc((function(t){return t.notEqual(r,o)}),{a:r,b:o},null,"NotEqual")}}),Zu=pn({notEqualStrict_:function(t,e){var n=$e(t,"a","notEqualStrict"),r=$e(e,"b","notEqualStrict");return C(n.shape,r.shape,"Error in notEqualStrict: "),n.notEqual(r)}});function ol(t,e){for(var n=[],r=t;r<e;++r)n.push(r);return n}function Qu(t){for(var e=[],n=0;n<t.length;++n)for(var r=0;r<t[n].length;++r)e.push(t[n][r]);return e}var $u=pn({gather_:function(t,e,n){void 0===n&&(n=0);var r=$e(t,"x","gather"),o=$e(e,"indices","gather","int32");n=z(n,r.shape)[0];var a=function(t,e,n){for(var r=t.shape[n],o=[],a=1,i=1,s=0;s<n;s++)o.push(t.shape[s]),a*=t.shape[s];for(s=0;s<e.rank;s++)o.push(e.shape[s]);for(s=n+1;s<t.rank;s++)o.push(t.shape[s]),i*=t.shape[s];return{batchSize:a,sliceSize:i,dimSize:r,outputShape:o}}(r,o,n);return zt.runKernelFunc((function(t,e){var a=t.gather(r,o.flatten(),n);return e([o]),a}),{x:r,indices:o},(function(t,e){var o=e[0];return{x:function(){var e=r.shape,a=o.size,i=e.slice(0,n),s=i.length,u=e.slice(n,e.length).slice(1),c=u.length,l=ol(0,s),h=ol(s+1,s+1+c),d=Qu([i,[a],u]),f=t.reshape(d),p=o.reshape([a]),m=Qu([[s],l,h]),g=f.transpose(m),v=tc(g,p,r.shape[n]),y=un(m);return v.transpose(y)},indices:function(){return o}}}),"Gather",{axis:n}).reshape(a.outputShape)}}),tc=pn({unsortedSegmentSum_:function(t,e,n){var r=$e(t,"x","unsortedSegmentSum"),o=$e(e,"segmentIds","unsortedSegmentSum","int32");return A(D(n),(function(){return"numSegments must be of dtype int"})),zt.runKernelFunc((function(t,e){var a=t.unsortedSegmentSum(r,o,n);return e([o]),a}),{$x:r},(function(t,e){var n=e[0];return{$x:function(){return function(t,e){for(var n=qr(e,Rn(e)),r=$u(t,n),o=Hu(e,yn(0,"int32")),a=r.rank-o.rank,i=0;i<a;++i)o=Un(o,i+1);o=hu(o,Sn(r.shape,"bool"));var s=Rn(r);return mu(o,r,s)}(t,n)}}}))}});function ec(t,e,n,r,o,a,i){void 0===a&&(a="NHWC"),A(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var s=t,u=e,c=!1;3===e.rank&&(c=!0,u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]),s=[1,t[0],t[1],t[2]]),A(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+s.length+"."})),A(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got rank "+u.rank})),A(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got rank "+n.rank}));var l="NHWC"===a?s[3]:s[1],h="NHWC"===a?u.shape[3]:u.shape[1];A(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input ("+l+") must match input depth for filter "+n.shape[2]+"."})),A(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output ("+h+") must match output depth for filter "+n.shape[3]+"."})),null!=i&&A(D(o),(function(){return"Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var d=Ui(a),f=Ni(s,n.shape,r,1,o,i,!1,d),p=zt.runKernelFunc((function(t,e){var r=t.conv2dDerInput(u,n,f);return e([n,u]),r}),{dy4D:u,filter:n},(function(t,e){var n=e[0],s=e[1];return{dy4D:function(){return dl(t,n,r,o,a,1,i)},filter:function(){return ac(t,s,n.shape,r,o,a,i)}}}));return c?p.as3D(p.shape[1],p.shape[2],p.shape[3]):p}function nc(t){var e=function(t){return"number"==typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}(t),n=e[0],r=e[1],o=e[2];return 1===n&&1===r&&1===o}function rc(t,e,n,r,o){A(t.length===e.rank,(function(){return"Length of inShape ("+t.length+") and rank of dy ("+e.rank+") must match"}));var a=t,i=e,s=!1;4===e.rank&&(s=!0,i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]),a=[1,t[0],t[1],t[2],t[3]]);var u=a[4],c=i.shape[4];A(5===a.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+a.length+"."})),A(5===i.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got rank "+i.rank})),A(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got rank "+n.rank})),A(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input ("+u+") must match input depth for filter "+n.shape[3]+"."})),A(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output ("+c+") must match output depth for filter "+n.shape[4]+"."}));var l=Oi(a,n.shape,r,1,o),h=zt.runKernelFunc((function(t){return t.conv3dDerInput(i,n,l)}),{dy5D:i});return s?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}var ic=pn({conv1d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NWC"),void 0===a&&(a=1);var s=$e(t,"x","conv1d"),u=$e(e,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=s.as3D(1,s.shape[0],s.shape[1])),A(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank "+c.rank+"."})),A(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+u.rank+"."})),null!=i&&A(D(r),(function(){return"Error in conv1d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."})),A(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input ("+c.shape[2]+") must match input depth for filter "+u.shape[1]+"."})),A(zi(n,a),(function(){return"Error in conv1D: Either stride or dilation must be 1. Got stride "+n+" and dilation '"+a+"'"})),A("NWC"===o,(function(){return"Error in conv1d: got dataFormat of "+o+" but only NWC is currently supported."}));var h=u.as4D(1,u.shape[0],u.shape[1],u.shape[2]),d=c.as4D(c.shape[0],1,c.shape[1],c.shape[2]),f=dl(d,h,[1,n],r,"NHWC",[1,a],i);return l?f.as2D(f.shape[2],f.shape[3]):f.as3D(f.shape[0],f.shape[2],f.shape[3])}}),dl=pn({conv2d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=$e(t,"x","conv2d"),u=$e(e,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+u.rank+"."})),null!=i&&A(D(r),(function(){return"Error in conv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var h="NHWC"===o?c.shape[3]:c.shape[1];A(h===u.shape[2],(function(){return"Error in conv2d: depth of input ("+h+") must match input depth for filter "+u.shape[2]+"."})),A(zi(n,a),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"}));var d=Ui(o),f=Ni(c.shape,u.shape,n,a,r,i,!1,d),p=[u,c],m=zt.runKernelFunc((function(t,e){var n=t.conv2d(c,u,f);return e([u,c]),n}),{x:c,filter:u},(function(t,e){var i=e,s=i[0],u=i[1];return A(Bi(a),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"})),{x:function(){return sc(u.shape,t,s,n,r,o)},filter:function(){return ac(u,t,s.shape,n,r,o)}}}),"Conv2D",f,p);return l?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),oc=pn({conv3d_:function(t,e,n,r,o,a){void 0===o&&(o="NDHWC"),void 0===a&&(a=[1,1,1]);var i=$e(t,"x","conv3d"),s=$e(e,"filter","conv3d"),u=i,c=!1;4===i.rank&&(c=!0,u=i.as5D(1,i.shape[0],i.shape[1],i.shape[2],i.shape[3])),A(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank "+u.rank+"."})),A(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+s.rank+"."})),A(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input ("+u.shape[4]+") must match input depth for filter "+s.shape[3]+"."})),A(function(t,e){return nc(t)||nc(e)}(n,a),(function(){return"Error in conv3D: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),A("NDHWC"===o,(function(){return"Error in conv3d: got dataFormat of "+o+" but only NDHWC is currently supported."}));var l=Oi(u.shape,s.shape,n,a,r),h=zt.runKernelFunc((function(t,e){var n=t.conv3d(u,s,l);return e([u,s]),n}),{x:u,$filter:s},(function(t,e){A(nc(a),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+a+"'"}));var o=e[0],i=e[1];return{x:function(){return rc(o.shape,t,i,n,r)},$filter:function(){return function(t,e,n,r,o){var a=t;4===t.rank&&(a=t.as5D(1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]));var i=e;4===i.rank&&(i=e.as5D(1,e.shape[0],e.shape[1],e.shape[2],e.shape[3])),A(5===a.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+a.shape+"."})),A(5===i.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+i.shape+"."})),A(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+n+"."})),A(a.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input "+a.shape[4]+") must match input depth in filter ("+n[3]+"."})),A(i.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy ("+i.shape[4]+") must match output depth for filter ("+n[4]+")."}));var s=Oi(a.shape,n,r,1,o);return zt.runKernelFunc((function(t){return t.conv3dDerFilter(a,i,s)}),{x5D:a,dy5D:i})}(o,t,i.shape,n,r)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),ac=pn({conv2dDerFilter_:function(t,e,n,r,o,a,i){void 0===a&&(a="NHWC");var s=t;3===t.rank&&(s=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var u=e;3===u.rank&&(u=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),A(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+s.shape+"."})),A(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+u.shape+"."})),A(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+n+"."}));var c="NHWC"===a?s.shape[3]:s.shape[1],l="NHWC"===a?u.shape[3]:u.shape[1];A(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input "+c+") must match input depth in filter ("+n[2]+"."})),A(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy ("+l+") must match output depth for filter ("+n[3]+")."})),null!=i&&A(D(o),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+o+"."}));var h=Ui(a),d=Ni(s.shape,n,r,1,o,i,!1,h);return zt.runKernelFunc((function(t){return t.conv2dDerFilter(s,u,d)}),{x4D:s,dy4D:u})}}),sc=pn({conv2dDerInput_:ec}),uc=pn({depthwiseConv2d_:function(t,e,n,r,o,a,i){void 0===o&&(o="NHWC"),void 0===a&&(a=[1,1]);var s=$e(t,"x","depthwiseConv2d"),u=$e(e,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),A(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+u.rank+"."})),A(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels ("+c.shape[3]+") must match the inChannels dimension in filter "+u.shape[2]+"."})),null==a&&(a=[1,1]),A(zi(n,a),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+a+"'"})),null!=i&&A(D(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+r+"."}));var h=Ni(c.shape,u.shape,n,a,r,i,!0),d=[c,u],f=zt.runKernelFunc((function(t,e){var n=t.depthwiseConv2D(c,u,h);return e([c,u]),n}),{x:c,filter:u},(function(t,e){A(Bi(a),(function(){return"Error in gradient of depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+a+"'"}));var n=e[0],r=e[1];return{x:function(){return cc(n.shape,t,r,h)},filter:function(){return lc(n,t,r.shape,h)}}}),"DepthwiseConv2dNative",h,d);return l?f.as3D(f.shape[1],f.shape[2],f.shape[3]):f}}),cc=pn({depthwiseConv2dDerInput_:function(t,e,n,r){var o=e,a=!1;3===e.rank&&(a=!0,o=e.as4D(1,e.shape[0],e.shape[1],e.shape[2]));var i=zt.runKernelFunc((function(t){return t.depthwiseConv2DDerInput(o,n,r)}),{dy4D:o});return a?i.as3D(i.shape[1],i.shape[2],i.shape[3]):i}}),lc=pn({depthwiseConv2dDerFilter_:function(t,e,n,r){var o=t;3===t.rank&&(o=t.as4D(1,t.shape[0],t.shape[1],t.shape[2]));var a=e;return 3===a.rank&&(a=e.as4D(1,e.shape[0],e.shape[1],e.shape[2])),zt.runKernelFunc((function(t){return t.depthwiseConv2DDerFilter(o,a,r)}),{x4D:o,dy4D:a})}}),hc=pn({separableConv2d_:function(t,e,n,r,o,a,i){void 0===a&&(a=[1,1]),void 0===i&&(i="NHWC");var s=$e(t,"x","separableConv2d"),u=$e(e,"depthwiseFilter","separableConv2d"),c=$e(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=s.as4D(1,s.shape[0],s.shape[1],s.shape[2])),"NCHW"===i)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got rank "+l.rank+"."})),A(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but got rank "+u.rank+"."})),A(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got "+c.shape[0]+"."})),A(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise filter must be 1, but got "+c.shape[1]+"."}));var d=u.shape[2],f=u.shape[3];A(c.shape[2]===d*f,(function(){return"Error in separableConv2d: the third dimension of pointwise filter must be "+d*f+", but got "+c.shape[2]+"."}));var p=uc(l,u,r,o,i,a),m=dl(p,c,1,"valid",i);return h?m.as3D(m.shape[1],m.shape[2],m.shape[3]):m}}),pc=pn({conv2dTranspose_:function(t,e,n,r,o,a){return ec(n,$e(t,"x","conv2dTranspose"),$e(e,"filter","conv2dTranspose"),r,o,"NHWC",a)}}),dc=pn({conv3dTranspose_:function(t,e,n,r,o){return rc(n,$e(t,"x","conv3dTranspose"),$e(e,"filter","conv3dTranspose"),r,o)}}),fc=pn({matMul_:function(t,e,n,r){var o;void 0===n&&(n=!1),void 0===r&&(r=!1);var a=$e(t,"a","matMul"),i=$e(e,"b","matMul");o=Dt(a,i),a=o[0],i=o[1];var s=n?a.shape[a.rank-2]:a.shape[a.rank-1],u=r?i.shape[i.rank-1]:i.shape[i.rank-2],c=n?a.shape[a.rank-1]:a.shape[a.rank-2],l=r?i.shape[i.rank-2]:i.shape[i.rank-1],h=a.shape.slice(0,-2),d=i.shape.slice(0,-2),f=N(h),p=N(d);A(a.rank>=2&&i.rank>=2&&a.rank===i.rank,(function(){return"Error in matMul: inputs must have the same rank of at least 2, got ranks "+a.rank+" and "+i.rank+"."})),A(O(h,d),(function(){return"Error in matMul: outer dimensions ("+h+") and ("+d+") of Tensors with shapes "+a.shape+" and "+i.shape+" must match."})),A(s===u,(function(){return"Error in matMul: inner shapes ("+s+") and ("+u+") of Tensors with shapes "+a.shape+" and "+i.shape+" and transposeA="+n+" and transposeB="+r+" must match."}));var m=a.shape.slice(0,-2).concat([c,l]),g=n?a.as3D(f,s,c):a.as3D(f,c,s),v=r?i.as3D(p,l,u):i.as3D(p,u,l),y={transposeA:n,transposeB:r};return zt.runKernelFunc((function(t,e){var o=t.batchMatMul(g,v,n,r);return e([g,v]),o}),{a:g,b:v},(function(t,e){var o=e,a=o[0],i=o[1];return n||r?!n&&r?{a:function(){return t.matMul(i,!1,!1)},b:function(){return t.matMul(a,!0,!1)}}:n&&!r?{a:function(){return i.matMul(t,!1,!0)},b:function(){return a.matMul(t,!1,!1)}}:{a:function(){return i.matMul(t,!0,!0)},b:function(){return t.matMul(a,!0,!0)}}:{a:function(){return t.matMul(i,!1,!0)},b:function(){return a.matMul(t,!0,!1)}}}),"BatchMatMul",y).reshape(m)}}),mc=pn({dot_:function(t,e){var n=$e(t,"t1","dot"),r=$e(e,"t2","dot");A(!(1!==n.rank&&2!==n.rank||1!==r.rank&&2!==r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+n.rank+" and "+r.rank+"."}));var o=1===n.rank?n.size:n.shape[1],a=1===r.rank?r.size:r.shape[0];return A(o===a,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+o+" and "+a+"."})),1===n.rank&&1===r.rank?n.as2D(1,-1).matMul(r.as2D(-1,1)).asScalar():1===n.rank&&2===r.rank?n.as2D(1,-1).matMul(r.as2D(r.shape[0],r.shape[1])).as1D():2===n.rank&&1===r.rank?n.matMul(r.as2D(-1,1)).as1D():n.matMul(r.as2D(r.shape[0],r.shape[1]))}}),gc=pn({outerProduct_:function(t,e){var n=$e(t,"v1","outerProduct"),r=$e(e,"v2","outerProduct");return A(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+n.rank+" and "+r.rank+"."})),n.as2D(-1,1).matMul(r.as2D(1,-1))}}),vc=pn({reverse_:function(t,e){var n=$e(t,"x","reverse");if(0===n.rank)return n.clone();var r=z(e,n.shape);return zt.runKernelFunc((function(t){return t.reverse(n,r)}),{$x:n},(function(t){return{$x:function(){return t.reverse(r)}}})).reshapeAs(n)}}),yc=pn({reverse1d_:function(t){var e=$e(t,"x","reverse");return A(1===e.rank,(function(){return"Error in reverse1D: x must be rank 1 but got rank "+e.rank+"."})),vc(e,0)}}),xc=pn({reverse2d_:function(t,e){var n=$e(t,"x","reverse");return A(2===n.rank,(function(){return"Error in reverse2D: x must be rank 2 but got rank "+n.rank+"."})),vc(n,e)}}),bc=pn({reverse3d_:function(t,e){var n=$e(t,"x","reverse");return A(3===n.rank,(function(){return"Error in reverse3D: x must be rank 3 but got rank "+n.rank+"."})),vc(n,e)}}),wc=pn({reverse4d_:function(t,e){var n=$e(t,"x","reverse");return A(4===n.rank,(function(){return"Error in reverse4D: x must be rank 4 but got rank "+n.rank+"."})),vc(n,e)}});function _c(t,e,n,r,o,a){var i=$e(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),null==r&&(r=[1,1]),A(4===s.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank "+s.rank+"."})),A(zi(n,r),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"})),null!=a&&A(D(o),(function(){return"Error in maxPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Ri(s.shape,e,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&O(c.inShape,c.outShape))return i.clone();var l=[s],h=zt.runKernelFunc((function(t,e){var n=t.maxPool(s,c);return e([s,n]),n}),{x:s},(function(t,a){var i=a[0],s=a[1];return{x:function(){return function(t,e,n,r,o,a,i,s){var u=$e(t,"dy","maxPoolBackprop"),c=$e(e,"input","maxPoolBackprop"),l=$e(n,"output","maxPoolBackprop");A(c.rank===u.rank,(function(){return"Rank of input ("+c.rank+") does not match rank of dy ("+u.rank+")"})),null==a&&(a=[1,1]),A(zi(o,a),(function(){return"Error in maxPoolBackProp: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),A(4===u.rank,(function(){return"Error in maxPoolBackprop: dy must be rank 4 but got rank "+u.rank+"."})),A(4===c.rank,(function(){return"Error in maxPoolBackprop: input must be rank 4 but got rank "+c.rank+"."}));var h=Ri(c.shape,r,o,a,i,s);return zt.runKernelFunc((function(t){return t.maxPoolBackprop(u,c,l,h)}),{$dy:u,$input:c})}(t,i,s,e,n,r,o)}}}),"MaxPool",c,l);return u?h.as3D(h.shape[1],h.shape[2],h.shape[3]):h}function Sc(t,e,n,r,o,a){var i=$e(t,"x","avgPool","float32");null==r&&(r=[1,1]),A(zi(n,r),(function(){return"Error in avgPool: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+r+"'"}));var s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),A(4===s.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank "+s.rank+"."})),null!=a&&A(D(o),(function(){return"Error in avgPool: pad must be an integer when using, dimRoundingMode "+a+" but got pad "+o+"."}));var c=Ri(s.shape,e,n,r,o,a);if(1===c.filterWidth&&1===c.filterHeight&&O(c.inShape,c.outShape))return i.clone();var l=zt.runKernelFunc((function(t){return t.avgPool(s,c)}),{x:s},(function(t){return{x:function(){return function(t,e,n,r,o,a){var i=$e(t,"dy","avgPoolBackprop"),s=$e(e,"input","avgPoolBackprop");A(s.rank===i.rank,(function(){return"Rank of input ("+s.rank+") does not match rank of dy ("+i.rank+")"})),null==o&&(o=[1,1]),A(zi(r,o),(function(){return"Error in avgPoolBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"}));var u=s,c=i,l=!1;3===s.rank&&(l=!0,u=s.as4D(1,s.shape[0],s.shape[1],s.shape[2]),c=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),A(4===c.rank,(function(){return"Error in avgPoolBackprop: dy must be rank 4 but got rank "+c.rank+"."})),A(4===u.rank,(function(){return"Error in avgPoolBackprop: input must be rank 4 but got rank "+u.rank+"."}));var h=Ri(u.shape,n,r,o,a),d=zt.runKernelFunc((function(t){return t.avgPoolBackprop(c,u,h)}),{dy4D:c,input4D:u});return l?d.as3D(d.shape[1],d.shape[2],d.shape[3]):d}(t,s,e,n,r,o)}}}),"AvgPool",c);return l=l.cast(i.dtype),u?l.as3D(l.shape[1],l.shape[2],l.shape[3]):l}var Mc=pn({maxPool_:function(t,e,n,r,o){return _c(t,e,n,1,r,o)}}),Ec=pn({avgPool_:function(t,e,n,r,o){return Sc(t,e,n,1,r,o)}}),Tc=pn({pool_:function(t,e,n,r,o,a){null==o&&(o=[1,1]),null==a&&(a=1),0===r&&(r="valid");var i=$e(t,"x","maxPool"),s=i,u=!1;3===i.rank&&(u=!0,s=i.as4D(1,i.shape[0],i.shape[1],i.shape[2])),A(zi(a,o),(function(){return"Error in pool: Either strides or dilations must be 1. Got strides "+a+" and dilations '"+o+"'"}));var c,l=Ri(s.shape,e,a,o,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(t,e){var n=t.map((function(t,n){return t+(t-1)*(e[n]-1)})).map((function(t){return t-1})),r=n.map((function(t){return Math.floor(t/2)})),o=n.map((function(t,e){return t-r[e]}));return n.map((function(t,e){return[r[e],o[e]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],f=function(t,e,n){var r=n.map((function(t){return t[0]})),o=n.map((function(t){return t[1]})),a=t.concat(r,o),i=e.map((function(t,e){return(t-a[e]%t)%t})),s=o.map((function(t,e){return t+i[e]}));return[e.map((function(t,e){return[r[e],s[e]]})),e.map((function(t,e){return[0,i[e]]}))]}([l.inHeight,l.inWidth],h,c),p=f[0],m=f[1],g=d?r:"valid",v=d?s:Gn(s,h,p),y=("avg"===n?function(){return Sc(v,e,a,1,g)}:function(){return _c(v,e,a,1,g)})(),x=d?y:Pn(y,h,m);return u?x.as3D(x.shape[1],x.shape[2],x.shape[3]):x}}),Ac=pn({maxPool3d_:function(t,e,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=$e(t,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),A(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(zi(n,i),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&A(D(r),(function(){return"Error in maxPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Ii(u.shape,e,n,i,r,o,a),h=zt.runKernelFunc((function(t,e){var n=t.maxPool3d(u,l);return e([u,n]),n}),{x:u},(function(t,a){var s=a[0],u=a[1];return{x:function(){return function(t,e,n,r,o,a,i,s){var u=$e(t,"dy","maxPool3dBackprop"),c=$e(e,"input","maxPool3dBackprop"),l=$e(n,"output","maxPool3dBackprop"),h=u,d=c,f=l,p=!1;4===c.rank&&(p=!0,h=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]),d=c.as5D(1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]),f=l.as5D(1,l.shape[0],l.shape[1],l.shape[2],l.shape[3])),A(5===h.rank,(function(){return"Error in maxPool3dBackprop: dy must be rank 5 but got rank "+h.rank+"."})),A(5===d.rank,(function(){return"Error in maxPool3dBackprop: input must be rank 5 but got rank "+d.rank+"."})),A(5===f.rank,(function(){return"Error in maxPool3dBackprop: output must be rank 5 but got rank "+f.rank+"."})),null==a&&(a=[1,1,1]),A(zi(o,a),(function(){return"Error in maxPool3dBackprop: Either strides or dilations must be 1. Got strides "+o+" and dilations '"+a+"'"})),null!=s&&A(D(i),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+s+" but got pad "+i+"."}));var m=Ii(d.shape,r,o,a,i,s),g=zt.runKernelFunc((function(t){return t.maxPool3dBackprop(h,d,f,m)}),{dy5D:h,input5D:d});return p?g.as4D(g.shape[1],g.shape[2],g.shape[3],g.shape[4]):g}(t,s,u,e,n,i,r,o)}}}));return c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Cc=pn({avgPool3d_:function(t,e,n,r,o,a,i){void 0===a&&(a="NDHWC");var s=$e(t,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3])),null==i&&(i=[1,1,1]),A(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank "+u.rank+"."})),A("NDHWC"===a,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of "+a})),A(zi(n,i),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. Got strides "+n+" and dilations '"+i+"'"})),null!=o&&A(D(r),(function(){return"Error in avgPool3d: pad must be an integer when using, dimRoundingMode "+o+" but got pad "+r+"."}));var l=Ii(u.shape,e,n,i,r,o,a),h=zt.runKernelFunc((function(t){return t.avgPool3d(u,l)}),{x:u},(function(t){return{x:function(){return function(t,e,n,r,o,a,i){var s=$e(t,"dy","avgPool3dBackprop"),u=$e(e,"input","avgPool3dBackprop"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=s.as5D(1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]),l=u.as5D(1,u.shape[0],u.shape[1],u.shape[2],u.shape[3])),A(5===c.rank,(function(){return"Error in avgPool3dBackprop: dy must be rank 5 but got rank "+c.rank+"."})),A(5===l.rank,(function(){return"Error in avgPool3dBackprop: input must be rank 5 but got rank "+l.rank+"."})),null==o&&(o=[1,1,1]),A(zi(r,o),(function(){return"Error in avgPool3dBackprop: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+o+"'"})),null!=i&&A(D(a),(function(){return"Error in maxPool3dBackprop: pad must be an integer when using, dimRoundingMode "+i+" but got pad "+a+"."}));var d=Ii(l.shape,n,r,o,a,i),f=zt.runKernelFunc((function(t){return t.avgPool3dBackprop(c,l,d)}),{dy5D:c,input5D:l});return h?f.as4D(f.shape[1],f.shape[2],f.shape[3],f.shape[4]):f}(t,u,e,n,i,r,o)}}}));return h=h.cast(u.dtype),c?h.as4D(h.shape[1],h.shape[2],h.shape[3],h.shape[4]):h}}),Rc=pn({maxPoolWithArgmax_:function(t,e,n,r,o){void 0===o&&(o=!1);var a=$e(t,"x","maxPoolWithArgmax"),i={filterSize:e,strides:n,pad:r,includeBatchInIndex:o},s=zt.runKernel("MaxPoolWithArgmax",{x:a},i);return{result:s[0],indexes:s[1]}}}),Ic=pn({slice_:function(t,e,n){var r,o,a=$e(t,"x","slice");if(0===a.rank)throw new Error("Slicing scalar is not possible");(r="number"==typeof e?[e].concat(new Array(a.rank-1).fill(0)):e.length<a.rank?e.concat(new Array(a.rank-e.length).fill(0)):e.slice()).forEach((function(t){A(-1!==t,(function(){return"slice() does not support negative begin indexing."}))})),o=(o=null==n?new Array(a.rank).fill(-1):"number"==typeof n?[n].concat(new Array(a.rank-1).fill(-1)):n.length<a.rank?n.concat(new Array(a.rank-n.length).fill(-1)):n).map((function(t,e){return t>=0?t:(A(-1===t,(function(){return"Negative size values should be exactly -1 but got "+t+" for the slice() size at index "+e+"."})),a.shape[e]-r[e])})),fi(a,r,o);var i=a.shape,s={begin:r,size:o};return zt.runKernelFunc((function(t){return t.slice(a,r,o)}),{x:a},(function(t){for(var e=[],n=0;n<t.rank;n++)e.push([r[n],i[n]-r[n]-o[n]]);return{x:function(){return _u(t,e)}}}),"Slice",s)}}),Nc=pn({slice1d_:function(t,e,n){var r=$e(t,"x","slice1d");return A(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-"+r.rank+" tensor"})),Ic(r,[e],[n])}}),Oc=pn({slice2d_:function(t,e,n){var r=$e(t,"x","slice2d");return A(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-"+r.rank+" tensor"})),Ic(r,e,n)}}),Dc=pn({slice3d_:function(t,e,n){var r=$e(t,"x","slice3d");return A(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-"+r.rank+" tensor"})),Ic(r,e,n)}}),Lc=pn({slice4d_:function(t,e,n){var r=$e(t,"x","slice4d");return A(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-"+r.rank+" tensor"})),Ic(r,e,n)}});function kc(t,e,n,r,o){return e.rank<n.rank&&(e=e.reshape(on(e.shape,r))),t.rank<n.rank&&(t=t.reshape(on(t.shape,r))),{x:function(){var r=t.mul(n.equal(e).cast(t.dtype));return null==o?r:r.transpose(o)}}}var Pc=pn({all_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","all","bool"),o=z(e,r.shape),a=o,i=sn(a,r.rank);null!=i&&(r=r.transpose(i),a=cn(a.length,r.rank));var s=zt.runKernelFunc((function(t){return t.all(r,a)}),{$x:r});if(n){var u=on(s.shape,o);return s.reshape(u)}return s}}),Fc=pn({any_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","any","bool"),o=z(e,r.shape),a=o,i=sn(a,r.rank);null!=i&&(r=r.transpose(i),a=cn(a.length,r.rank));var s=zt.runKernelFunc((function(t){return t.any(r,a)}),{$x:r});if(n){var u=on(s.shape,o);return s.reshape(u)}return s}}),Bc=pn({argMax_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","argMax");null==e&&(e=0);var r=z(e,n.shape),o=sn(r,n.rank);null!=o&&(n=n.transpose(o),r=cn(r.length,n.rank));var a={axis:r[0]},i=[n];return zt.runKernelFunc((function(t,e){var o=t.argMax(n,r[0]);return e([n]),o}),{x:n},(function(t,e){var n=e[0];return{x:function(){return Rn(n)}}}),"ArgMax",a,i)}}),zc=pn({argMin_:function(t,e){void 0===e&&(e=0);var n=$e(t,"x","argMin");null==e&&(e=0);var r=z(e,n.shape),o=sn(r,n.rank);return null!=o&&(n=n.transpose(o),r=cn(r.length,n.rank)),zt.runKernelFunc((function(t,e){var o=t.argMin(n,r[0]);return e([n]),o}),{$x:n},(function(t,e){var n=e[0];return{$x:function(){return Rn(n)}}}))}}),Uc=pn({logSumExp_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","logSumExp"),o=z(e,r.shape),a=r.max(o,!0),i=r.sub(a).exp().sum(o).log(),s=a.reshape(i.shape).add(i);if(n){var u=on(s.shape,o);return s.reshape(u)}return s}}),Vc=pn({max_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","max"),o=r,a=z(e,r.shape),i=a,s=sn(i,r.rank);null!=s&&(r=r.transpose(s),i=cn(i.length,r.rank));var u=[r],c=zt.runKernelFunc((function(t,e){var n=t.max(r,i);return e([o,n]),n}),{x:r},(function(t,e){return kc(t,e[1],e[0],a,s)}),"Max",{axes:i},u,[!0]);if(n){var l=on(c.shape,a);c=c.reshape(l)}return c}}),Gc=pn({mean_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","mean"),o=z(e,r.shape),a=N(rn(r.shape,o)[1]);return _i((function(t){var r=yn(a);return{value:(r.dtype===t.dtype?t:t.cast(r.dtype)).div(r).sum(e,n),gradFunc:function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(Sn(t.shape,"float32")).div(a)}}}))(r)}}),Hc=pn({min_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","min"),o=r,a=z(e,r.shape),i=a,s=sn(i,r.rank);null!=s&&(r=r.transpose(s),i=cn(i.length,r.rank));var u=[r],c=zt.runKernelFunc((function(t,e){var n=t.min(r,i);return e([o,n]),n}),{x:r},(function(t,e){return kc(t,e[1],e[0],a,s)}),"Min",{axes:i},u,[!0]);if(n){var l=on(c.shape,a);c=c.reshape(l)}return c}}),jc=pn({moments_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=z(e,(t=$e(t,"x","moments")).shape),o=t.mean(r,n),a=o.shape;n||(a=on(o.shape,r));var i=t.toFloat().sub(o.reshape(a)).square();return{mean:o,variance:i.mean(r,n)}}}),th=pn({sum_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","sum");"bool"===r.dtype&&(r=r.toInt());var o=z(e,r.shape);return _i((function(t){var e=sn(o,t.rank),r=o,a=t;null!=e&&(a=t.transpose(e),r=cn(r.length,t.rank));var i=function(e){var n=t.shape.slice();return o.forEach((function(t){n[t]=1})),e.reshape(n).mul(Sn(t.shape,"float32"))},s={axes:r},u=zt.runKernelFunc((function(t){return t.sum(a,r)}),{x:a},(function(t){return{x:function(){return i(t)}}}),"Sum",s);if(n){var c=on(u.shape,o);u=u.reshape(c)}return{value:u,gradFunc:i}}))(r)}}),Wc=pn({prod_:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=$e(t,"x","prod");"bool"===r.dtype&&(r=r.toInt());var o=z(e,r.shape),a=sn(o,r.rank),i=o,s=r;null!=a&&(s=r.transpose(a),i=cn(i.length,r.rank));var u=zt.runKernelFunc((function(t){return t.prod(s,i)}),{permutedX:s});if(n){var c=on(u.shape,o);u=u.reshape(c)}return u}}),qc=pn({elu_:function(t){var e=$e(t,"x","elu");return zt.runKernelFunc((function(t,n){var r=t.elu(e);return n([r]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){return zt.runKernelFunc((function(e){return e.eluDer(t,n)}),{dy:t,y:n})}}}))}}),Xc=pn({leakyRelu_:function(t,e){void 0===e&&(e=.2);var n=$e(t,"x","leakyRelu");return qr(yn(e).mul(n),n)}}),Yc=pn({prelu_:function(t,e){var n=$e(t,"x","prelu"),r=$e(e,"alpha","prelu");return zt.runKernelFunc((function(t,e){var o=t.prelu(n,r);return e([n,r]),o}),{x:n,alpha:r},(function(t,e){var n=e[0],r=e[1],o=n.greater(0);return{x:function(){return mu(o,t,t.mul(r))},alpha:function(){var e=mu(o,Rn(t),t.mul(n)),a=ir(r.shape,t.shape);return a.length>0&&(e=e.sum(a)),e.reshape(r.shape)}}}),"Prelu")}}),Kc=pn({relu_:function(t){var e=$e(t,"x","relu");return"bool"===e.dtype?e.toInt():zt.runKernelFunc((function(t,n){var r=t.relu(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0];return{x:function(){return t.mulStrict(n.step().toFloat())}}}),"Relu")}}),Jc=pn({relu6_:function(t){var e=$e(t,"x","relu6");return"bool"===e.dtype?e.toInt():zt.runKernelFunc((function(t,n){var r=t.relu6(e);return n([e]),r}),{x:e},(function(t,e){var n=e[0],r=n.lessEqual(6).mul(n.step());return{x:function(){return t.mulStrict(r.toFloat())}}}),"Relu6")}}),Zc=pn({selu_:function(t){var e=$e(t,"x","selu");return zt.runKernelFunc((function(t,n){var r=t.selu(e);return n([e]),r}),{$x:e},(function(t,e){var n=e[0];return{$x:function(){var e=n.greater(yn(0)),r=yn(gs),o=yn(vs),a=t.mul(o),i=t.mul(r).mul(n.toFloat().exp());return mu(e,a,i)}}}))}}),Qc=pn({localResponseNormalization_:function(t,e,n,r,o){void 0===e&&(e=5),void 0===n&&(n=1),void 0===r&&(r=1),void 0===o&&(o=.5);var a=$e(t,"x","localResponseNormalization");A(4===a.rank||3===a.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank "+a.rank+"."})),A(D(e),(function(){return"Error in localResponseNormalization: depthRadius must be an integer but got depthRadius "+e+"."}));var i=a,s=!1;3===a.rank&&(s=!0,i=a.as4D(1,a.shape[0],a.shape[1],a.shape[2]));var u=zt.runKernelFunc((function(t,a){var s=t.localResponseNormalization4D(i,e,n,r,o);return a([i,s]),s}),{x4D:i},(function(t,a){var i=a[0],s=a[1];return{x4D:function(){return zt.runKernelFunc((function(a){return a.LRNGrad(t,i,s,e,n,r,o)}),{})}}}));return s?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),$c=pn({norm_:function(t,e,n,r){void 0===e&&(e="euclidean"),void 0===n&&(n=null),void 0===r&&(r=!1);var o=function t(e,n,r){if(void 0===r&&(r=null),0===e.rank)return e.abs();if(1!==e.rank&&null===r)return t(e.reshape([-1]),n,r);if(1===e.rank||"number"==typeof r||Array.isArray(r)&&1===r.length){if(1===n)return e.abs().sum(r);if(n===1/0)return e.abs().max(r);if(n===-1/0)return e.abs().min(r);if("euclidean"===n||2===n)return e.abs().pow(yn(2,"int32")).sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}if(Array.isArray(r)&&2===r.length){if(1===n)return e.abs().sum(r[0]).max(r[1]-1);if(n===1/0)return e.abs().sum(r[1]).max(r[0]);if(n===-1/0)return e.abs().sum(r[1]).min(r[0]);if("fro"===n||"euclidean"===n)return e.square().sum(r).sqrt();throw new Error("Error in norm: invalid ord value: "+n)}throw new Error("Error in norm: invalid axis: "+r)}(t=$e(t,"x","norm"),e,n),a=o.shape;if(r){var i=z(n,t.shape);a=on(o.shape,i)}return o.reshape(a)}}),tl=pn({basicLSTMCell_:function(t,e,n,r,o,a){var i=$e(t,"forgetBias","basicLSTMCell"),s=$e(e,"lstmKernel","basicLSTMCell"),u=$e(n,"lstmBias","basicLSTMCell"),c=$e(r,"data","basicLSTMCell"),l=$e(o,"c","basicLSTMCell"),h=$e(a,"h","basicLSTMCell"),d=c.concat(h,1).matMul(s).add(u),f=d.shape[0],p=d.shape[1]/4,m=[f,p],g=d.slice([0,0],m),v=d.slice([0,p],m),y=d.slice([0,2*p],m),x=d.slice([0,3*p],m),b=g.sigmoid().mulStrict(v.tanh()).addStrict(l.mulStrict(i.add(y).sigmoid())),w=b.tanh().mulStrict(x.sigmoid());return[b,w]}}),el=pn({multiRNNCell_:function(t,e,n,r){for(var o=$e(e,"data","multiRNNCell"),a=tn(n,"c","multiRNNCell"),i=tn(r,"h","multiRNNCell"),s=o,u=[],c=0;c<t.length;c++){var l=t[c](s,a[c],i[c]);u.push(l[0]),u.push(l[1]),s=l[1]}var h=[],d=[];for(c=0;c<u.length;c+=2)h.push(u[c]),d.push(u[c+1]);return[h,d]}}),nl=pn({movingAverage_:function(t,e,n,r,o){void 0===o&&(o=!0);var a=$e(t,"v","movingAverage"),i=$e(e,"x","movingAverage"),s=$e(n,"decay","movingAverage");Lt(a,i),A(O(a.shape,i.shape),(function(){return"Shape mismatch in v and x"}));var u=yn(1),c=u.sub(s),l=i.sub(a).mul(c);if(o){A(null!=r,(function(){return"When using zeroDebias: true, step is required."}));var h=$e(r,"step","movingAverage");l=l.div(u.sub(ti(s,h)))}return a.add(l)}}),rl=pn({stridedSlice_:function(t,e,n,r,o,a,i,s,u){if(void 0===o&&(o=0),void 0===a&&(a=0),void 0===i&&(i=0),void 0===s&&(s=0),void 0===u&&(u=0),null==r&&(r=new Array(e.length)),0!==i)throw new Error("ellipsis mask is not yet supported");var c=$e(t,"x","stridedSlice"),l=mi(s),h=c.shape.slice();l.forEach((function(t){e[t]=0,n[t]=1,h.splice(t,0,1)})),c=c.reshape(h);for(var d=0;d<c.rank;d++)e[d]=vi(o,e,r,c.shape,d),n[d]=yi(a,n,r,c.shape,d),r[d]=r[d]||1;var f=mi(u);f.forEach((function(t){n[t]=e[t]+1,r[t]=1}));var p=gi(e,n,r),m=p.filter((function(t,e){return-1===f.indexOf(e)}));return r.every((function(t){return 1===t}))?Ic(c,e,p).reshape(m):zt.runKernelFunc((function(t){return t.stridedSlice(c,e,n,r)}),{$x:c}).reshape(m)}}),il=pn({topk_:function(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!0);var r=$e(t,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var o=r.shape[r.shape.length-1];if(e>o)throw new Error("'k' passed to topk() must be <= the last dimension ("+o+") but got "+e);var a=zt.runKernelFunc((function(t){return t.topk(r,e,n)}),{$x:r});return{values:a[0],indices:a[1]}}}),al=pn({scatterND_:function(t,e,n){var r=$e(t,"indices","scatterND","int32"),o=$e(e,"updates","scatterND");return hi(o,r,n),zt.runKernelFunc((function(t){return t.scatterND(r,o,n)}),{indices:r,updates:o},null,"ScatterNd",{shape:n})}}),sl=pn({fft_:function(t){A("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return zt.runKernelFunc((function(t){return t.fft(r)}),{input:t}).reshape(t.shape)}}),cl=pn({ifft_:function(t){A("complex64"===t.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 but got "+t.dtype+"."}));var e=t.shape[t.shape.length-1],n=t.size/e,r=t.as2D(n,e);return zt.runKernelFunc((function(t){return t.ifft(r)}),{input:t}).reshape(t.shape)}}),ll=pn({rfft_:function(t,e){A("float32"===t.dtype,(function(){return"The dtype for rfft() must be real value but got "+t.dtype}));var n,r=t.shape[t.shape.length-1],o=t.size/r;if(null!=e&&e<r){var a=t.shape.map((function(t){return 0})),i=t.shape.map((function(t){return t}));i[t.shape.length-1]=e,n=t.slice(a,i),r=e}else if(null!=e&&e>r){var s=t.shape.map((function(t){return t}));s[t.shape.length-1]=e-r,n=t.concat(Mn(s),t.shape.length-1),r=e}else n=t;var u=n.zerosLike(),c=dn(n,u).as2D(o,r),l=sl(c),h=Math.floor(r/2)+1,d=fn(l),f=mn(l),p=d.split([h,r-h],d.shape.length-1),m=f.split([h,r-h],f.shape.length-1),g=n.shape.slice();return g[n.shape.length-1]=h,dn(p[0],m[0]).reshape(g)}}),hl=pn({irfft_:function(t){var e=t.shape[t.shape.length-1],n=t.size/e;if(e<=2){var r=t.as2D(n,e),o=cl(r);return fn(o)}var a=[n,2*(e-1)],i=fn(t).as2D(n,e),s=mn(t).as2D(n,e),u=i.slice([0,1],[n,e-2]).reverse(1),c=s.slice([0,1],[n,e-2]).reverse(1).mul(yn(-1)),l=i.concat(u,1),h=s.concat(c,1);return r=dn(l,h).as2D(a[0],a[1]),o=cl(r),fn(o)}}),pl=Object.freeze({fft:sl,ifft:cl,rfft:ll,irfft:hl}),fl=pn({sparseToDense_:function(t,e,n,r){void 0===r&&(r=0);var o=$e(t,"sparseIndices","sparseToDense","int32"),a=$e(e,"sparseValues","sparseToDense"),i=$e(r,"defaultValue","sparseToDense",a.dtype);return function(t,e,n,r){if("int32"!==t.dtype)throw new Error("tf.sparseToDense() expects the indices to be int32 type, but the dtype was "+t.dtype+".");if(t.rank>2)throw new Error("sparseIndices should be a scalar, vector, or matrix, but got shape "+t.shape+".");var o=t.rank>0?t.shape[0]:1,a=t.rank>1?t.shape[1]:1;if(n.length!==a)throw new Error("outputShape has incorrect number of elements:, "+n.length+", should be: "+a+".");var i=e.size;if(0!==e.rank&&(1!==e.rank||i!==o))throw new Error("sparseValues has incorrect shape "+e.shape+", should be [] or ["+o+"]");if(e.dtype!==r.dtype)throw new Error("sparseValues.dtype must match defaultValues.dtype")}(o,a,n,i),zt.runKernelFunc((function(t){return t.sparseToDense(o,a,n,i)}),{$sparseIndices:o,$sparseValues:a,$defaultValue:i})}}),ml=pn({gatherND_:function(t,e){var n=$e(e,"indices","gatherND","int32"),r=$e(t,"x","gatherND");return zt.runKernelFunc((function(t){return t.gatherND(r,n)}),{x:r,indices:n},null,"GatherNd")}}),gl=pn({diag_:function(t){var e=$e(t,"x","diag").flatten(),n=t.shape.concat(t.shape);return zt.runKernelFunc((function(t){return t.diag(e)}),{$x:e}).reshape(n)}}),vl=pn({dropout_:function(t,e,n,r){var o=$e(t,"x","dropout");if(A("float32"===o.dtype,(function(){return"x has to be a floating point tensor since it's going to be scaled, but got a "+o.dtype+" tensor instead."})),A(e>=0&&e<1,(function(){return"rate must be a float in the range [0, 1), but got "+e+"."})),0===e)return t instanceof St?o.clone():o;var a=function(t,e){if(null==e)return t.shape.slice();if(O(t.shape,e))return e;if(t.shape.length===e.length){for(var n=[],r=0;r<t.shape.length;r++)null==e[r]&&null!=t.shape[r]?n.push(t.shape[r]):n.push(e[r]);return n}return e}(o,n),i=1-e,s=Pu(a,0,1,"float32",r).add(i).floor().div(i);return o.mul(s)}});function yl(t,e,n){for(var r=1-t%2,o=new Float32Array(t),a=0;a<t;++a){var i=2*Math.PI*a/(t+r-1);o[a]=e-n*Math.cos(i)}return xn(o,"float32")}var xl,bl=pn({hannWindow_:function(t){return yl(t,.5,.5)}}),wl=pn({hammingWindow_:function(t){return yl(t,.54,.46)}}),_l=pn({frame_:function(t,e,n,r,o){void 0===r&&(r=!1),void 0===o&&(o=0);for(var a=0,i=[];a+e<=t.size;)i.push(Ic(t,a,e)),a+=n;if(r)for(;a<t.size;){var s=a+e-t.size,u=In([Ic(t,a,e-s),En([s],o)]);i.push(u),a+=n}return 0===i.length?bn([],[0,e]):In(i).as2D(i.length,e)}}),Sl=pn({stft_:function(t,e,n,r,o){var a;void 0===o&&(o=bl),null==r&&(a=e,r=Math.floor(Math.pow(2,Math.ceil(Math.log(a)/Math.log(2)))));for(var i=_l(t,e,n),s=Qr(i,o(e)),u=[],c=0;c<i.shape[0];c++)u.push(ll(s.slice([c,0],[1,e]),r));return In(u)}}),Ml=Object.freeze({hannWindow:bl,hammingWindow:wl,frame:_l,stft:Sl});!function(t){t[t.NONE=0]="NONE",t[t.MEAN=1]="MEAN",t[t.SUM=2]="SUM",t[t.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xl||(xl={}));var El=pn({absoluteDifference_:function(t,e,n,r){void 0===r&&(r=xl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","absoluteDifference"),a=$e(e,"predictions","absoluteDifference"),i=null;null!=n&&(i=$e(n,"weights","absoluteDifference")),C(o.shape,a.shape,"Error in absoluteDifference: ");var s=o.sub(a).abs();return Tl(s,i,r)}}),Tl=pn({computeWeightedLoss_:function(t,e,n){void 0===n&&(n=xl.SUM_BY_NONZERO_WEIGHTS);var r=$e(t,"losses","computeWeightedLoss"),o=null;null!=e&&(o=$e(e,"weights","computeWeightedLoss"));var a=null==o?r:r.mul(o);if(n===xl.NONE)return a;if(n===xl.SUM)return a.sum();if(n===xl.MEAN){if(null==o)return a.mean();var i=r.size/o.size,s=a.sum().div(o.sum());return i>1?s.div(yn(i)):s}if(n===xl.SUM_BY_NONZERO_WEIGHTS){if(null==o)return a.sum().div(yn(r.size));var u=o.mul(Sn(r.shape)).notEqual(yn(0)).sum().toFloat();return a.sum().div(u)}throw Error("Unknown reduction: "+n)}}),Al=pn({cosineDistance_:function(t,e,n,r,o){void 0===o&&(o=xl.SUM_BY_NONZERO_WEIGHTS);var a=$e(t,"labels","cosineDistance"),i=$e(e,"predictions","cosineDistance"),s=null;null!=r&&(s=$e(r,"weights","cosineDistance")),C(a.shape,i.shape,"Error in cosineDistance: ");var u=yn(1).sub(a.mul(i).sum(n,!0));return Tl(u,s,o)}}),Cl=pn({hingeLoss_:function(t,e,n,r){void 0===r&&(r=xl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","hingeLoss"),a=$e(e,"predictions","hingeLoss"),i=null;null!=n&&(i=$e(n,"weights","hingeLoss")),C(o.shape,a.shape,"Error in hingeLoss: ");var s=yn(1);o=yn(2).mul(o).sub(s);var u=s.sub(o.mul(a)).relu();return Tl(u,i,r)}}),Rl=pn({huberLoss_:function(t,e,n,r,o){void 0===r&&(r=1),void 0===o&&(o=xl.SUM_BY_NONZERO_WEIGHTS);var a=$e(t,"labels","huberLoss"),i=$e(e,"predictions","huberLoss"),s=null;null!=n&&(s=$e(n,"weights","huberLoss")),C(a.shape,i.shape,"Error in huberLoss: ");var u=yn(r),c=i.sub(a).abs(),l=Yr(c,u),h=c.sub(l),d=yn(.5).mul(l.square()).add(u.mul(h));return Tl(d,s,o)}}),Il=pn({logLoss_:function(t,e,n,r,o){void 0===r&&(r=1e-7),void 0===o&&(o=xl.SUM_BY_NONZERO_WEIGHTS);var a=$e(t,"labels","logLoss"),i=$e(e,"predictions","logLoss"),s=null;null!=n&&(s=$e(n,"weights","logLoss")),C(a.shape,i.shape,"Error in logLoss: ");var u=yn(1),c=yn(r),l=a.mul(i.add(c).log()).neg().sub(u.sub(a).mul(u.sub(i).add(c).log()));return Tl(l,s,o)}}),Nl=pn({meanSquaredError_:function(t,e,n,r){void 0===r&&(r=xl.SUM_BY_NONZERO_WEIGHTS);var o=$e(t,"labels","meanSquaredError"),a=$e(e,"predictions","meanSquaredError"),i=null;null!=n&&(i=$e(n,"weights","meanSquaredError")),C(o.shape,a.shape,"Error in meanSquaredError: ");var s=o.squaredDifference(a);return Tl(s,i,r)}}),Ol=pn({sigmoidCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=xl.SUM_BY_NONZERO_WEIGHTS);var a=$e(t,"multiClassLabels","sigmoidCrossEntropy"),i=$e(e,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=$e(n,"weights","sigmoidCrossEntropy")),C(a.shape,i.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=yn(r),c=yn(1),l=yn(.5);a=a.mul(c.sub(u)).add(l.mul(u))}var h=function(t,e){var n=$e(t,"labels","sigmoidCrossEntropyWithLogits"),r=$e(e,"logits","sigmoidCrossEntropyWithLogits");C(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var o=r.relu(),a=r.mul(n),i=r.abs().neg().exp().log1p();return o.sub(a).add(i)}(a,i);return Tl(h,s,o)}}),Dl=pn({softmaxCrossEntropy_:function(t,e,n,r,o){void 0===r&&(r=0),void 0===o&&(o=xl.SUM_BY_NONZERO_WEIGHTS);var a=$e(t,"onehotLabels","softmaxCrossEntropy"),i=$e(e,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=$e(n,"weights","softmaxCrossEntropy")),C(a.shape,i.shape,"Error in softmaxCrossEntropy: "),r>0){var u=yn(r),c=yn(1),l=yn(a.shape[1]);a=a.mul(c.sub(u)).add(u.div(l))}var h=function(t,e,n){if(void 0===n&&(n=-1),-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank "+e.rank+" and dim was "+n);return _i((function(t,e,r){var o=e.logSumExp([n],!0),a=e.toFloat().sub(o);return r([t,a]),{value:a.mul(t).neg().sum([n]),gradFunc:function(t,e){var r=e[0],o=e[1],a=on(t.shape,[n]);return[t.reshape(a).mul(r.toFloat().sub(o.exp())),t.reshape(a).mul(o.exp().sub(r.toFloat()))]}}}))(t,e)}(a,i);return Tl(h,s,o)}}),Ll=Object.freeze({get Reduction(){return xl},absoluteDifference:El,computeWeightedLoss:Tl,cosineDistance:Al,hingeLoss:Cl,huberLoss:Rl,logLoss:Il,meanSquaredError:Nl,sigmoidCrossEntropy:Ol,softmaxCrossEntropy:Dl});function kl(t,e){return void 0===e&&(e=!1),zt.tidy((function(){if(2!==t.shape.length)throw new Error("qr2d() requires a 2D Tensor, but got a "+t.shape.length+"D Tensor.");for(var n=t.shape[0],r=t.shape[1],o=xu(n),a=t.clone(),i=bn([[1]],[1,1]),s=i.clone(),u=n>=r?r:n,c=function(t){var e,u=a,c=s,l=o;e=zt.tidy((function(){var e=a.slice([t,t],[n-t,1]),u=e.norm(),c=a.slice([t,t],[1,1]),l=bn([[-1]]).where(c.greater(0),bn([[1]])),h=c.sub(l.mul(u)),d=e.div(h);s=1===d.shape[0]?i.clone():i.concat(d.slice([1,0],[d.shape[0]-1,d.shape[1]]),0);var f=l.matMul(h).div(u).neg(),p=a.slice([t,0],[n-t,r]),m=f.mul(s),g=s.transpose();if(0===t)a=p.sub(m.matMul(g.matMul(p)));else{var v=p.sub(m.matMul(g.matMul(p)));a=a.slice([0,0],[t,r]).concat(v,0)}var y=m.transpose(),x=o.slice([0,t],[n,o.shape[1]-t]);if(0===t)o=x.sub(x.matMul(s).matMul(y));else{var b=x.sub(x.matMul(s).matMul(y));o=o.slice([0,0],[n,t]).concat(b,1)}return[s,a,o]})),s=e[0],a=e[1],o=e[2],Xe([u,c,l])},l=0;l<u;++l)c(l);return!e&&n>r&&(o=o.slice([0,0],[n,r]),a=a.slice([0,0],[r,r])),[o,a]}))}var Pl=pn({bandPart_:function(t,e,n){if(e%1!=0)throw new Error("bandPart(): numLower must be an integer, got "+e+".");if(n%1!=0)throw new Error("bandPart(): numUpper must be an integer, got "+n+".");var r=$e(t,"a","bandPart");if(r.rank<2)throw new Error("bandPart(): Rank must be at least 2, got "+r.rank+".");var o=r.shape,a=r.shape.slice(-2),i=a[0],s=a[1];if(!(e<=i))throw new Error("bandPart(): numLower ("+e+") must not be greater than the number of rows ("+i+").");if(!(n<=s))throw new Error("bandPart(): numUpper ("+n+") must not be greater than the number of columns ("+s+").");e<0&&(e=i),n<0&&(n=s);var u=An(0,i,1,"int32").reshape([-1,1]),c=An(0,s,1,"int32"),l=ri(u,c),h=hu(l.lessEqual(yn(+e,"int32")),l.greaterEqual(yn(-n,"int32"))),d=Mn([i,s],r.dtype);return hr(jn(r.reshape([-1,i,s])).map((function(t){return mu(h,t,d)}))).reshape(o)}}),Fl=pn({gramSchmidt_:function(t){var e;if(Array.isArray(t)){e=!1,A(null!=t&&t.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=t[0].shape[0],r=function(e){A(t[e].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: ("+t[e].shape[0]+" vs. "+n+")"}))},o=1;o<t.length;++o)r(o)}else e=!0,t=tr(t,t.shape[0],0).map((function(t){return Hn(t,[0])}));A(t.length<=t[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors ("+t.length+") exceeds number of dimensions ("+t[0].shape[0]+")."}));var a=[],i=t,s=function(t){a.push(zt.tidy((function(){var e=i[t];if(t>0)for(var n=0;n<t;++n){var r=th(a[n].mulStrict(e)).mul(a[n]);e=e.sub(r)}return e.div($c(e,"euclidean"))})))};for(o=0;o<t.length;++o)s(o);return e?hr(a,0):a}}),Bl=pn({qr_:function(t,e){if(void 0===e&&(e=!1),t.rank<2)throw new Error("qr() requires input tensor to have a rank >= 2, but got rank "+t.rank);if(2===t.rank)return kl(t,e);var n=t.shape.slice(0,t.shape.length-2).reduce((function(t,e){return t*e})),r=jn(t.reshape([n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],a=[];return r.forEach((function(t){var n=kl(t,e),r=n[0],i=n[1];o.push(r),a.push(i)})),[hr(o,0).reshape(t.shape),hr(a,0).reshape(t.shape)]}}),zl=Object.freeze({bandPart:Pl,gramSchmidt:Fl,qr:Bl});function Ul(t,e,n,r,o,a){null==r&&(r=.5),null==o&&(o=Number.NEGATIVE_INFINITY),null==a&&(a=0);var i=t.shape[0];return n=Math.min(n,i),A(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '"+r+"'"})),A(2===t.rank,(function(){return"boxes must be a 2D tensor, but was of rank '"+t.rank+"'"})),A(4===t.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was "+t.shape[1]})),A(1===e.rank,(function(){return"scores must be a 1D tensor"})),A(e.shape[0]===i,(function(){return"scores has incompatible shape with boxes. Expected "+i+", but was "+e.shape[0]})),A(0<=a&&a<=1,(function(){return"softNmsSigma must be in [0, 1], but was '"+a+"'"})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:o,softNmsSigma:a}}var Vl=pn({resizeBilinear_:function(t,e,n){void 0===n&&(n=!1);var r=$e(t,"images","resizeBilinear");A(3===r.rank||4===r.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===e.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+e+"."}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],s=e[1],u=zt.runKernelFunc((function(t,e){return e([o]),t.resizeBilinear(o,i,s,n)}),{x:o},(function(t,e){return{x:function(){return zt.runKernelFunc((function(r){return r.resizeBilinearBackprop(t,e[0],n)}),{})}}}),"ResizeBilinear",{alignCorners:n,newHeight:i,newWidth:s});return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Gl=pn({resizeNearestNeighbor_:function(t,e,n){void 0===n&&(n=!1);var r=$e(t,"images","resizeNearestNeighbor");A(3===r.rank||4===r.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank "+r.rank+"."})),A(2===e.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+e+"."})),A("float32"===r.dtype||"int32"===r.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"}));var o=r,a=!1;3===r.rank&&(a=!0,o=r.as4D(1,r.shape[0],r.shape[1],r.shape[2]));var i=e[0],s=e[1],u=zt.runKernelFunc((function(t,e){return e([o]),t.resizeNearestNeighbor(o,i,s,n)}),{batchImages:o},(function(t,e){return{batchImages:function(){return zt.runKernelFunc((function(r){return r.resizeNearestNeighborBackprop(t,e[0],n)}),{})}}}));return a?u.as3D(u.shape[1],u.shape[2],u.shape[3]):u}}),Hl=pn({nonMaxSuppression_:function(t,e,n,r,o){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY);var a=$e(t,"boxes","nonMaxSuppression"),i=$e(e,"scores","nonMaxSuppression"),s=Ul(a,i,n,r,o);n=s.maxOutputSize,r=s.iouThreshold,o=s.scoreThreshold;var u={maxOutputSize:n,iouThreshold:r,scoreThreshold:o};return zt.runKernelFunc((function(t){return t.nonMaxSuppression(a,i,n,r,o)}),{boxes:a,scores:i},null,"NonMaxSuppressionV3",u)}}),jl=pn({nonMaxSuppressionWithScore_:function(t,e,n,r,o,a){void 0===r&&(r=.5),void 0===o&&(o=Number.NEGATIVE_INFINITY),void 0===a&&(a=0);var i=$e(t,"boxes","nonMaxSuppression"),s=$e(e,"scores","nonMaxSuppression"),u=Ul(i,s,n,r,o,a),c={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:o=u.scoreThreshold,softNmsSigma:a=u.softNmsSigma},l=zt.runKernel("NonMaxSuppressionV5",{boxes:i,scores:s},c);return{selectedIndices:l[0],selectedScores:l[1]}}}),Wl=pn({cropAndResize_:function(t,e,n,r,o,a){var i=$e(t,"image","cropAndResize"),s=$e(e,"boxes","cropAndResize","float32"),u=$e(n,"boxInd","cropAndResize","int32");o=o||"bilinear",a=a||0;var c=s.shape[0];return A(4===i.rank,(function(){return"Error in cropAndResize: image must be rank 4,but got rank "+i.rank+"."})),A(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size ["+c+",4] but had shape "+s.shape+"."})),A(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size ["+c+"] but had shape "+s.shape+"."})),A(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got length "+r.length+"."})),A(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was "+r})),A("bilinear"===o||"nearest"===o,(function(){return"method must be bilinear or nearest, but was "+o})),zt.runKernelFunc((function(t,e){return t.cropAndResize(i,s,u,r,o,a)}),{images:i,boxes:s,boxInd:u},null,"CropAndResize",{method:o,extrapolationValue:a,cropSize:r})}}),ql=Object.freeze({resizeBilinear:Vl,resizeNearestNeighbor:Gl,nonMaxSuppression:Hl,nonMaxSuppressionAsync:function(t,e,n,a,i){return void 0===a&&(a=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),d(this,void 0,void 0,(function(){var r,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:return r=$e(t,"boxes","nonMaxSuppressionAsync"),s=$e(e,"scores","nonMaxSuppressionAsync"),u=Ul(r,s,n,a,i),n=u.maxOutputSize,a=u.iouThreshold,i=u.scoreThreshold,[4,Promise.all([r.data(),s.data()])];case 1:return o=d.sent(),c=o[0],l=o[1],h=Zi(c,l,n,a,i),r!==t&&r.dispose(),s!==e&&s.dispose(),[2,h]}}))}))},nonMaxSuppressionWithScore:jl,nonMaxSuppressionWithScoreAsync:function(t,e,n,a,i,s){return void 0===a&&(a=.5),void 0===i&&(i=Number.NEGATIVE_INFINITY),void 0===s&&(s=0),d(this,void 0,void 0,(function(){var r,u,o,c,l,h,d;return f(this,(function(f){switch(f.label){case 0:return r=$e(t,"boxes","nonMaxSuppressionAsync"),u=$e(e,"scores","nonMaxSuppressionAsync"),o=Ul(r,u,n,a,i,s),n=o.maxOutputSize,a=o.iouThreshold,i=o.scoreThreshold,s=o.softNmsSigma,[4,Promise.all([r.data(),u.data()])];case 1:return c=f.sent(),l=c[0],h=c[1],d=Qi(l,h,n,a,i,s),r!==t&&r.dispose(),u!==e&&u.dispose(),[2,d]}}))}))},cropAndResize:Wl}),Xl=function(t,e){return!(t>0)||"linear"===e},Yl=function(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return t.mul(e.step());throw new Error("Gradient for activation "+n+" has not been implemented yet.")},Kl=function(t,e){var n=e,r=ir(t.shape,e.shape);return r.length>0&&(n=n.sum(r)),n.reshape(t.shape)},Jl=function(t,e,n){if("linear"===e)return t;if("relu"===e)return Kc(t);if("elu"===e)return qc(t);if("relu6"===e)return Jc(t);if("prelu"===e)return Yc(t,n);throw new Error("Unknown fused activation "+e+".")},Zl=pn({fusedMatMul_:function(t){var e,n=t.a,r=t.b,o=t.transposeA,a=void 0!==o&&o,i=t.transposeB,s=void 0!==i&&i,u=t.bias,c=t.activation,l=void 0===c?"linear":c,h=t.preluActivationWeights;if(!1===Xl(zt.state.gradientDepth,l)){var d=fc(n,r,a,s);return null!=u&&(d=nr(d,u)),Jl(d,l,h)}var f=$e(n,"a","fused matMul"),p=$e(r,"b","fused matMul");e=Dt(f,p),f=e[0],p=e[1];var m=a?f.shape[f.rank-2]:f.shape[f.rank-1],g=s?p.shape[p.rank-1]:p.shape[p.rank-2],v=a?f.shape[f.rank-1]:f.shape[f.rank-2],y=s?p.shape[p.rank-2]:p.shape[p.rank-1],x=f.shape.slice(0,-2),b=p.shape.slice(0,-2),w=N(x),_=N(b);A(f.rank>=2&&p.rank>=2&&f.rank===p.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at least 2, got ranks "+f.rank+" and "+p.rank+"."})),A(O(x,b),(function(){return"Error in fused matMul: outer dimensions ("+x+") and ("+b+") of Tensors with shapes "+f.shape+" and "+p.shape+" must match."})),A(m===g,(function(){return"Error in fused matMul: inner shapes ("+m+") and ("+g+") of Tensors with shapes "+f.shape+" and "+p.shape+" and transposeA="+a+" and transposeB="+s+" must match."}));var S,M,E=f.shape.slice(0,-2).concat([v,y]),T=a?f.as3D(w,m,v):f.as3D(w,v,m),C=s?p.as3D(_,y,g):p.as3D(_,g,y);null!=u&&or(E,(S=Dt(S=$e(u,"bias","fused matMul"),f)[0]).shape),null!=h&&(M=$e(h,"prelu weights","fused matMul"));var R={a:T,b:C};null!=u&&(R.bias=S),null!=h&&(R.preluActivationWeights=M);var I=[T,C];return zt.runKernelFunc((function(t,e){var n=t.fusedBatchMatMul({a:T,b:C,transposeA:a,transposeB:s,bias:S,activation:l,preluActivationWeights:M});return e([T,C,n]),n}),R,(function(t,e){var n=e[0],r=e[1],o=e[2],i=Yl(t,o,l),c={};return null!=u&&(c={bias:function(){return Kl(S,i)}}),a||s?!a&&s?Object.assign({a:function(){return i.matMul(r,!1,!1)},b:function(){return i.matMul(n,!0,!1)}},c):a&&!s?Object.assign({a:function(){return r.matMul(i,!1,!0)},b:function(){return n.matMul(i,!1,!1)}},c):Object.assign({a:function(){return r.matMul(i,!0,!0)},b:function(){return i.matMul(n,!0,!0)}},c):Object.assign({a:function(){return i.matMul(r,!1,!0)},b:function(){return n.matMul(i,!0,!1)}},c)}),"_FusedMatMul",{transposeA:a,transposeB:s,activation:l},I,[!0]).reshape(E)}}),Ql=pn({fusedConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,f=t.preluActivationWeights;if(d=d||"linear",!1===Xl(zt.state.gradientDepth,d)){var p=dl(e,n,r,o,i,u,c);return null!=l&&(p=nr(p,l)),Jl(p,d,f)}var m=$e(e,"x","conv2d"),g=$e(n,"filter","conv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===v.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+v.rank+"."})),A(4===g.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+g.rank+"."})),null!=c&&A(D(o),(function(){return"Error in fused conv2d: pad must be an integer when using, dimRoundingMode "+c+" but got pad "+o+"."})),A(v.shape[3]===g.shape[2],(function(){return"Error in conv2d: depth of input ("+v.shape[3]+") must match input depth for filter "+g.shape[2]+"."})),A(zi(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),A("NHWC"===i,(function(){return"Error in conv2d: got dataFormat of "+i+" but only NHWC is currently supported."}));var x,b,w=Ni(v.shape,g.shape,r,u,o,c);null!=l&&(x=Dt(x=$e(l,"bias","fused conv2d"),m)[0],or(w.outShape,x.shape)),null!=f&&(b=$e(f,"prelu weights","fused conv2d"));var _={x:v,filter:g};null!=l&&(_.bias=x),null!=f&&(_.preluActivationWeights=b);var S=[g,v],M=zt.runKernelFunc((function(t,e){var n=t.fusedConv2d({input:v,filter:g,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return e([g,v,n]),n}),_,(function(t,e){var n=e,a=n[0],i=n[1],s=n[2],c=Yl(t,s,d);A(Bi(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '"+u+"'"}));var h={};return null!=l&&(h={bias:function(){return Kl(x,c)}}),Object.assign({x:function(){return sc(i.shape,c,a,r,o)},filter:function(){return ac(i,c,a.shape,r,o)}},h)}),"FusedConv2D",{convInfo:w,activation:d},S,[!0]);return y?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),$l=pn({fusedDepthwiseConv2d_:function(t){var e=t.x,n=t.filter,r=t.strides,o=t.pad,a=t.dataFormat,i=void 0===a?"NHWC":a,s=t.dilations,u=void 0===s?[1,1]:s,c=t.dimRoundingMode,l=t.bias,h=t.activation,d=void 0===h?"linear":h,f=t.preluActivationWeights;if(!1===Xl(zt.state.gradientDepth,d)){var p=uc(e,n,r,o,i,u,c);return null!=l&&(p=nr(p,l)),Jl(p,d,f)}var m=$e(e,"x","depthwiseConv2d"),g=$e(n,"filter","depthwiseConv2d"),v=m,y=!1;3===m.rank&&(y=!0,v=m.as4D(1,m.shape[0],m.shape[1],m.shape[2])),A(4===v.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got rank "+v.rank+"."})),A(4===g.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, but got rank "+g.rank+"."})),A(v.shape[3]===g.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels ("+v.shape[3]+") must match the inChannels dimension in filter "+g.shape[2]+"."})),null==u&&(u=[1,1]),A(zi(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides "+r+" and dilations '"+u+"'"})),null!=c&&A(D(o),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode "+c+" but got pad "+o+"."}));var x,b,w=Ni(v.shape,g.shape,r,u,o,c,!0);null!=l&&(x=Dt(x=$e(l,"bias","fused conv2d"),m)[0],or(w.outShape,x.shape)),null!=f&&(b=$e(f,"prelu weights","fused depthwiseConv2d"));var _={x:v,filter:g};null!=l&&(_.bias=x),null!=f&&(_.preluActivationWeights=b);var S=[g,v],M=zt.runKernelFunc((function(t,e){var n=t.fusedDepthwiseConv2D({input:v,filter:g,convInfo:w,bias:x,activation:d,preluActivationWeights:b});return e([g,v,n]),n}),_,(function(t,e){A(Bi(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '"+u+"'"}));var n=e[0],r=e[1],o=e[2],a=Yl(t,o,d),i={};return null!=l&&(i={bias:function(){return Kl(x,a)}}),Object.assign({x:function(){return cc(r.shape,a,n,w)},filter:function(){return lc(r,a,n.shape,w)}},i)}),"FusedDepthwiseConv2D",{convInfo:w,activation:d},S,[!0]);return y?M.as3D(M.shape[1],M.shape[2],M.shape[3]):M}}),eh=Object.freeze({matMul:Zl,conv2d:Ql,depthwiseConv2d:$l}),nh=Object.freeze({image:ql,linalg:zl,losses:Ll,spectral:pl,fused:eh,signal:Ml,add:nr,addN:Xs,batchNorm:$s,batchNormalization:Qs,batchNorm2d:nu,batchNormalization2d:eu,batchNorm3d:ou,batchNormalization3d:iu,batchNorm4d:uu,batchNormalization4d:su,broadcastTo:cu,clone:lu,div:oi,divNoNan:vu,eye:xu,multinomial:bu,oneHot:wu,pad:_u,pad1d:Su,pad2d:Mu,pad3d:Eu,pad4d:Tu,rand:Au,randomGamma:Lu,randomNormal:ku,randomUniform:Pu,square:Fu,squaredDifference:Bu,tile:yu,truncatedNormal:zu,conv1d:ic,conv2d:dl,conv3d:oc,depthwiseConv2d:uc,separableConv2d:hc,conv2dTranspose:pc,conv3dTranspose:dc,op:pn,booleanMaskAsync:function(t,e,n){return d(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h,d,p,m,g;return f(this,(function(f){switch(f.label){case 0:for(r=$e(t,"tensor","boolMask"),a=$e(e,"mask","boolMask","bool"),i=null==n?0:n,s=a.rank,u=r.shape,A(s>0,(function(){return"mask cannot be scalar"})),C(u.slice(i,i+s),a.shape,"mask's shape must match the first K dimensions of tensor's shape,"),o=1,c=i;c<i+s;c++)o*=u[c];return l=u.slice(0,i).concat([o],u.slice(i+s)),h=r.reshape(l),d=a.reshape([-1]),[4,gu(d)];case 1:return p=f.sent(),m=p.squeeze([1]),g=$u(h,m,i),t!==r&&r.dispose(),e!==a&&a.dispose(),m.dispose(),h.dispose(),d.dispose(),p.dispose(),[2,g]}}))}))},complex:dn,real:fn,imag:mn,concat:In,concat1d:Nn,concat2d:On,concat3d:Dn,concat4d:Ln,split:tr,matMul:fc,dot:mc,outerProduct:gc,reverse:vc,reverse1d:yc,reverse2d:xc,reverse3d:bc,reverse4d:wc,maxPool:Mc,avgPool:Ec,pool:Tc,maxPool3d:Ac,avgPool3d:Cc,maxPoolWithArgmax:Rc,slice:Ic,slice1d:Nc,slice2d:Oc,slice3d:Dc,slice4d:Lc,abs:ar,acos:sr,acosh:ur,asin:cr,asinh:lr,atan:pr,atanh:dr,ceil:fr,clipByValue:mr,cos:gr,cosh:vr,erf:yr,exp:xr,expm1:wr,floor:_r,log:Sr,log1p:Mr,logSigmoid:Er,neg:Tr,reciprocal:Ar,round:Cr,rsqrt:Rr,sigmoid:Ir,sign:Nr,isNaN:Or,isInf:Dr,isFinite:Lr,sin:kr,sinh:Pr,softplus:Fr,sqrt:Br,step:zr,tan:Ur,tanh:Vr,all:Pc,any:Fc,argMax:Bc,argMin:zc,logSumExp:Uc,max:Vc,mean:Gc,min:Hc,moments:jc,sum:th,prod:Wc,equal:Uu,equalStrict:Vu,greater:Gu,greaterEqual:Hu,greaterEqualStrict:ju,greaterStrict:Wu,less:qu,lessEqual:Xu,lessEqualStrict:Yu,lessStrict:Ku,notEqual:Ju,notEqualStrict:Zu,addStrict:Gr,atan2:Hr,divStrict:jr,floorDiv:Wr,maximum:qr,maximumStrict:Xr,minimum:Yr,minimumStrict:Kr,mod:Jr,modStrict:Zr,mul:Qr,mulStrict:$r,pow:ti,powStrict:ei,squaredDifferenceStrict:ni,sub:ri,subStrict:ii,elu:qc,leakyRelu:Xc,prelu:Yc,relu:Kc,relu6:Jc,selu:Zc,logicalAnd:hu,logicalNot:pu,logicalOr:du,logicalXor:fu,where:mu,whereAsync:gu,buffer:kn,print:function(t,e){void 0===e&&(e=!1),console.log(t.toString(e))},batchToSpaceND:Pn,cast:Fn,cumsum:Bn,depthToSpace:zn,expandDims:Un,reshape:Vn,spaceToBatchND:Gn,squeeze:Hn,stack:hr,unstack:jn,setdiff1dAsync:Wn,fill:En,linspace:Tn,ones:Sn,range:An,scalar:yn,tensor:gn,tensor1d:xn,tensor2d:bn,tensor3d:wn,tensor4d:_n,tensor5d:function(t,e,n){if(R(t),null!=e&&5!==e.length)throw new Error("tensor5d() requires shape to have five numbers");var r=Ze(t,n);if(5!==r.length&&1!==r.length)throw new Error("tensor5d() requires values to be number[][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor5d() requires shape to be provided when `values` are a flat array");return vn(t,e,r,n)},tensor6d:function(t,e,n){if(R(t),null!=e&&6!==e.length)throw new Error("tensor6d() requires shape to have six numbers");var r=Ze(t,n);if(6!==r.length&&1!==r.length)throw new Error("tensor6d() requires values to be number[][][][][][] or flat/TypedArray");if(1===r.length&&null==e)throw new Error("tensor6d() requires shape to be provided when `values` are a flat array");return vn(t,e=e||r,r,n)},variable:function(t,e,n,r){return void 0===e&&(e=!0),zt.makeVariable(t,e,n,r)},zeros:Mn,onesLike:Cn,zerosLike:Rn,transpose:Ei,softmax:Si,logSoftmax:Mi,localResponseNormalization:Qc,norm:$c,gather:$u,unsortedSegmentSum:tc,basicLSTMCell:tl,multiRNNCell:el,movingAverage:nl,stridedSlice:rl,topk:il,scatterND:al,fft:sl,ifft:cl,rfft:ll,irfft:hl,sparseToDense:fl,gatherND:ml,diag:gl,dropout:vl,hannWindow:bl,hammingWindow:wl,frame:_l,stft:Sl,inTopKAsync:function(t,e,n){return void 0===n&&(n=1),d(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h,d,p,m,g,v;return f(this,(function(f){switch(f.label){case 0:return r=$e(t,"predictions","inTopK"),a=$e(e,"targets","inTopK"),A(r.rank>1,(function(){return"inTopK() expects the predictions to be of rank 2 or higher, but got "+r.rank})),A(r.rank-1===a.rank,(function(){return"predictions rank should be 1 larger than targets rank, but got predictions rank "+r.rank+" and targets rank "+a.rank})),C(r.shape.slice(0,r.shape.length-1),a.shape,"predictions's shape should be align with the targets' shape, except the last dimension."),i=r.shape[r.shape.length-1],A(n>0&&n<=i,(function(){return"'k' passed to inTopK() must be > 0 && <= the predictions last dimension ("+i+"), but got "+n})),[4,r.data()];case 1:return s=f.sent(),[4,a.data()];case 2:for(u=f.sent(),o=[s.length/i,i],l=o[1],h=V("bool",c=o[0]),d=0;d<c;d++){for(p=d*l,m=s.subarray(p,p+l),g=[],v=0;v<m.length;v++)g.push({value:m[v],index:v});for(g.sort((function(t,e){return e.value-t.value})),h[d]=0,v=0;v<n;v++)if(g[v].index===u[d]){h[d]=1;break}}return t!==r&&r.dispose(),e!==a&&a.dispose(),[2,gn(h,a.shape,"bool")]}}))}))}});function rh(t,e){Array.isArray(t)||(t=[t]),t.forEach((function(t){null!=t&&A("complex64"!==t.dtype,(function(){return e+" does not support complex64 tensors."}))}))}function ih(t,e,n,r,o,a){for(var i=o.strideHeight,s=o.strideWidth,u=o.dilationHeight,c=o.dilationWidth,l=o.effectiveFilterHeight,h=o.effectiveFilterWidth,d=o.padInfo.top,f=o.padInfo.left,p="max"===a?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=kn(o.outShape,n),g=m.values,v=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],x=o.outShape[3],b=0;b<o.batchSize;++b)for(var w=b*v,_=b*r[0],S=0;S<o.inChannels;++S)for(var M=0;M<o.outHeight;++M)for(var E=M*i-d,T=Math.max(0,E),A=Math.min(o.inHeight,l+E),C=w+M*y,R=0;R<o.outWidth;++R){for(var I=R*s-f,N=Math.max(0,I),O=Math.min(o.inWidth,h+I),D=p,L=0,k=0,P=T;P<A;P+=u){for(var F=_+P*r[1],B=N;B<O;B+=c){var z=t[F+B*r[2]+S];"max"===a&&z>D?D=z:"avg"===a&&(L+=z,k++)}if(isNaN(D))break}g[C+R*x+S]="avg"===a?L/k:D}return m}function oh(t,e,n,r,o,a){void 0===o&&(o=!1),void 0===a&&(a=!1);for(var i=kn(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,d=r.effectiveFilterWidth,f=r.padInfo.top,p=r.padInfo.left,m=kn(e,n,t),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.outHeight;++y){for(var x=y*s-f,b=x;b<0;)b+=c;for(var w=Math.min(r.inHeight,h+x),_=0;_<r.outWidth;++_){for(var S=_*u-p,M=S;M<0;)M+=l;for(var E=Math.min(r.inWidth,d+S),T=Number.NEGATIVE_INFINITY,A=-1,C=b;C<w;C+=c)for(var R=C-x,I=M;I<E;I+=l){var N=I-S,O=m.get(g,C,I,v);O>T&&(T=O,A=o?a?((g*r.inHeight+C)*r.inWidth+I)*r.inChannels+v:(C*r.inWidth+I)*r.inChannels+v:R*d+N)}i.set(A,g,y,_,v)}}return i}function ah(t,e,n,r){if("linear"===n)return t.linear(e);if("relu"===n)return t.relu(e);if("elu"===n)return t.elu(e);if("relu6"===n)return t.relu6(e);if("prelu"===n)return t.prelu(e,r);throw new Error("Activation "+n+" has not been implemented for the CPU backend.")}var sh=function(t){function e(){var e=t.call(this)||this;return e.blockSize=48,e.firstUse=!0,e.data=new Ti(e,zt),e}return h(e,t),e.prototype.write=function(t,e,n){this.firstUse&&(this.firstUse=!1,i().get("IS_NODE")&&Je("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:t,dtype:n}),r},e.prototype.move=function(t,e,n,r){this.data.set(t,{values:e,dtype:r})},e.prototype.numDataIds=function(){return this.data.numDataIds()},e.prototype.read=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var e=this.data.get(t),n=e.dtype,r=e.complexTensors;return"complex64"===n?Wi(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(t).values},e.prototype.bufferSync=function(t){var e=this.readSync(t.dataId),n=e;if("string"===t.dtype)try{n=e.map((function(t){return ct(t)}))}catch(t){throw new Error("Failed to decode encoded string bytes into utf-8")}return kn(t.shape,t.dtype,n)},e.prototype.makeOutput=function(t,e,n){var r=this.write(t,e,n);return zt.makeTensorFromDataId(r,e,n,this)},e.prototype.disposeData=function(t){if(this.data.has(t)){var e=this.data.get(t).complexTensors;null!=e&&(e.real.dispose(),e.imag.dispose()),this.data.delete(t)}},e.prototype.time=function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){return e=st(),t(),[2,{kernelMs:st()-e}]}))}))},e.prototype.memory=function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}},e.prototype.complex=function(t,e){var n=this.makeOutput(null,t.shape,"complex64");return this.data.get(n.dataId).complexTensors={real:zt.keep(t.clone()),imag:zt.keep(e.clone())},n},e.prototype.real=function(t){return this.data.get(t.dataId).complexTensors.real.clone()},e.prototype.imag=function(t){return this.data.get(t.dataId).complexTensors.imag.clone()},e.prototype.slice=function(t,e,n){if(rh(t,"slice"),xi(t.shape,e,n)){var r=bi(e,t.strides),o=N(n);return gn(this.readSync(t.dataId).subarray(r,r+o),n,t.dtype)}for(var a=kn(n,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s).map((function(t,n){return t+e[n]}));a.values[s]=i.get.apply(i,u)}return a.toTensor()},e.prototype.stridedSlice=function(t,e,n,r){rh(t,"stridedSlice");var o=gi(e,n,r);if(o.some((function(t){return 0===t})))return gn([],o);for(var a=kn(o,t.dtype),i=this.bufferSync(t),s=0;s<a.size;s++){for(var u=a.indexToLoc(s),c=new Array(u.length),l=0;l<c.length;l++)c[l]=u[l]*r[l]+e[l];a.set.apply(a,[i.get.apply(i,c)].concat(u))}return a.toTensor()},e.prototype.diag=function(t){for(var e=this.readSync(t.dataId),n=kn([t.size,t.size],t.dtype),r=n.values,o=0;o<e.length;o++)r[o*t.size+o]=e[o];return n.toTensor()},e.prototype.unstack=function(t,e){for(var n=t.shape[e],r=new Array(t.rank-1),o=0,a=0;a<t.rank;a++)a!==e&&(r[o++]=t.shape[a]);var i=new Array(t.rank).fill(0),s=t.shape.slice();s[e]=1;var u=new Array(n);for(a=0;a<u.length;a++)i[e]=a,u[a]=this.slice(t,i,s).reshape(r);return u},e.prototype.reverse=function(t,e){rh(t,"reverse");for(var n=kn(t.shape,t.dtype),r=this.bufferSync(t),o=function(o){var a=n.indexToLoc(o),i=a.slice();e.forEach((function(e){return i[e]=t.shape[e]-1-i[e]})),n.set.apply(n,[r.get.apply(r,i)].concat(a))},a=0;a<n.size;a++)o(a);return n.toTensor()},e.prototype.concat=function(t,e){var n=this;if("complex64"===t[0].dtype){var r=t.map((function(t){return fn(t)})),o=t.map((function(t){return mn(t)}));return dn(this.concat(r,e),this.concat(o,e))}var a=t.map((function(t){var n=N(t.shape.slice(e));return t.as2D(-1,n)})),i=hn(a.map((function(t){return t.shape})),1),s=kn(i,t[0].dtype).values;if(1===a[0].shape[0]){var u=0;a.forEach((function(t){s.set(n.readSync(t.dataId),u),u+=t.size}))}else{var c=0;a.forEach((function(t){for(var e=n.readSync(t.dataId),r=0,o=0;o<t.shape[0];++o)for(var a=o*i[1]+c,u=0;u<t.shape[1];++u)s[a+u]=e[r++];c+=t.shape[1]}))}var l=hn(t.map((function(t){return t.shape})),e);return gn(s,l,t[0].dtype)},e.prototype.neg=function(t){return rh(t,"neg"),this.multiply(yn(-1),t)},e.prototype.add=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t+n,imag:e+r}})):this.broadcastedBinaryOp(t,e,Nt(t.dtype,e.dtype),(function(t,e){return t+e}))},e.prototype.addN=function(t){var e=this;rh(t,"addN");for(var n=t.map((function(t){return e.readSync(t.dataId)})),r=kn(t[0].shape,t[0].dtype),o=r.values,a=0;a<t.length;a++)for(var i=n[a],s=0;s<o.length;s++)o[s]+=i[s];return r.toTensor()},e.prototype.softmax=function(t,e){var n=z([e],t.shape),r=this.max(t,n),o=on(r.shape,n),a=this.subtract(t,r.reshape(o)),i=this.exp(a),s=this.sum(i,n).reshape(o);return oi(i,s)},e.prototype.subtract=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t-n,imag:e-r}})):this.broadcastedBinaryOp(t,e,Nt(t.dtype,e.dtype),(function(t,e){return t-e}))},e.prototype.pow=function(t,e){return rh([t,e],"pow"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.pow(t,e)}))},e.prototype.batchMatMul=function(t,e,n,r){rh([t,e],"matMul");for(var o=n?t.shape[1]:t.shape[2],a=n?t.shape[2]:t.shape[1],i=r?e.shape[1]:e.shape[2],s=t.shape[0],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=n?[t.strides[0],1,t.strides[1]]:[t.strides[0],t.strides[1],1],h=l[0],d=l[1],f=l[2],p=r?[1,e.strides[1],e.strides[0]]:[e.strides[1],1,e.strides[0]],m=p[0],g=p[1],v=p[2],y=a*i,x=kn([s,a,i],t.dtype),b=x.values,w=this.blockSize,_=0;_<s;_++)for(var S=0;S<a;S+=w)for(var M=0;M<i;M+=w)for(var E=0;E<o;E+=w)for(var T=Math.min(S+w,a),A=Math.min(M+w,i),C=Math.min(E+w,o),R=S;R<T;R++)for(var I=M;I<A;I++){for(var N=0,O=E;O<C;O++)N+=u[_*h+R*d+O*f]*c[O*m+I*g+_*v];b[_*y+(R*i+I)]+=N}return x.toTensor()},e.prototype.fusedBatchMatMul=function(t){var e=t.a,n=t.b,r=t.transposeA,o=t.transposeB,a=t.bias,i=t.activation,s=t.preluActivationWeights,u=this.batchMatMul(e,n,r,o);return a&&(u=this.add(u,a)),i&&(u=ah(this,u,i,s)),u},e.prototype.multiply=function(t,e){return"complex64"===t.dtype||"complex64"===e.dtype?this.broadcastedBinaryComplexOp(t.cast("complex64"),e.cast("complex64"),(function(t,e,n,r){return{real:t*n-e*r,imag:t*r+e*n}})):this.broadcastedBinaryOp(t,e,Nt(t.dtype,e.dtype),(function(t,e){return t*e}))},e.prototype.floorDiv=function(t,e){return rh([t,e],"floorDiv"),this.broadcastedBinaryOp(t,e,"int32",(function(t,e){return Math.floor(t/e)}))},e.prototype.sum=function(t,e){rh(t,"sum"),an("sum",e,t.rank);for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,Nt(t.dtype,"int32")),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=0,d=0;d<i;++d)h+=u[l+d];s[c]=h}return a},e.prototype.prod=function(t,e){rh(t,"sum");for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,Nt(t.dtype,"int32")),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=1,d=0;d<i;++d)h*=u[l+d];s[c]=h}return a},e.prototype.unsortedSegmentSum=function(t,e,n){rh(t,"unsortedSegmentSum");for(var r=[],o=t.rank-e.rank,a=0;a<o;++a)e=e.expandDims(a+1);for(a=0;a<n;++a){var i=yn(a,"int32"),s=Uu(i,e).asType("float32").mul(t).sum(0);r.push(s)}return hr(r)},e.prototype.argMin=function(t,e){rh(t,"argMin");var n=[e];an("argMin",n,t.rank);for(var r=rn(t.shape,n),o=r[0],a=r[1],i=Mn(o,"int32"),s=N(a),u=this.readSync(i.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var m=c[h+p];m<d&&(d=m,f=p)}u[l]=f}return i},e.prototype.argMax=function(t,e){rh(t,"argMax");var n=[e];an("argMax",n,t.rank);for(var r=rn(t.shape,n),o=r[0],a=r[1],i=Mn(o,"int32"),s=N(a),u=this.readSync(i.dataId),c=this.readSync(t.dataId),l=0;l<u.length;++l){for(var h=l*s,d=c[h],f=0,p=0;p<s;++p){var m=c[h+p];m>d&&(d=m,f=p)}u[l]=f}return i},e.prototype.cumsum=function(t,e,n,r){if(rh(t,"cumsum"),e!==t.rank-1)throw new Error("backend.cumsum in CPU expects an inner-most axis="+(t.rank-1)+" but got axis="+e);for(var o=Nt(t.dtype,"int32"),a=Mn(t.shape,o),i=this.readSync(a.dataId),s=this.readSync(t.dataId),u=t.shape[t.rank-1],c=r?function(t,e){return t+u-e-1}:function(t,e){return t+e},l=0;l<s.length;l+=u)for(var h=0;h<u;h++){var d=c(l,h);if(0===h)i[d]=n?0:s[d];else{var f=c(l,h-1);i[d]=n?s[f]+i[f]:s[d]+i[f]}}return a},e.prototype.equal=function(t,e){return rh([t,e],"equal"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t===e?1:0}))},e.prototype.notEqual=function(t,e){return rh([t,e],"notEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t!==e?1:0}))},e.prototype.less=function(t,e){return rh([t,e],"less"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<e?1:0}))},e.prototype.lessEqual=function(t,e){return rh([t,e],"lessEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t<=e?1:0}))},e.prototype.greater=function(t,e){return rh([t,e],"greater"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>e?1:0}))},e.prototype.greaterEqual=function(t,e){return rh([t,e],"greaterEqual"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t>=e?1:0}))},e.prototype.logicalNot=function(t){rh(t,"logicalNot");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)n[r]=e[r]?0:1;return this.makeOutput(n,t.shape,"bool")},e.prototype.logicalAnd=function(t,e){return rh([t,e],"logicalAnd"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t&&e}))},e.prototype.logicalOr=function(t,e){return rh([t,e],"logicalOr"),this.broadcastedBinaryOp(t,e,"bool",(function(t,e){return t||e}))},e.prototype.select=function(t,e,n){rh([t,e,n],"select");for(var r=this.readSync(t.dataId),o=this.readSync(e.dataId),a=this.readSync(n.dataId),i=Mn(e.shape,Nt(e.dtype,n.dtype)),s=this.readSync(i.dataId),u=0,c=0===t.rank||t.rank>1||1===e.rank?1:N(e.shape.slice(1)),l=0;l<r.length;l++)for(var h=0;h<c;h++)1===r[l]?s[u++]=o[l]:s[u++]=a[l];return i},e.prototype.where=function(t){rh([t],"where");var e=this.readSync(t.dataId);return ao(t.shape,e)},e.prototype.topk=function(t,e,n){return rh(t,"topk"),oo(this.readSync(t.dataId),t.shape,t.dtype,e)},e.prototype.min=function(t,e){rh(t,"min"),an("min",e,t.rank);for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,t.dtype),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],d=0;d<i;++d){var f=u[l+d];f<h&&(h=f)}s[c]=h}return a},e.prototype.minimum=function(t,e){return rh([t,e],"minimum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.min(t,e)}))},e.prototype.mod=function(t,e){return rh([t,e],"mod"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e}))},e.prototype.max=function(t,e){rh(t,"max"),an("max",e,t.rank);for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,t.dtype),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],d=0;d<i;++d){var f=u[l+d];f>h&&(h=f)}s[c]=h}return a},e.prototype.maximum=function(t,e){return rh([t,e],"maximum"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.max(t,e)}))},e.prototype.all=function(t,e){rh(t,"all"),an("all",e,t.rank);for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,t.dtype),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],d=0;d<i;++d){var f=u[l+d];h=h&&f}s[c]=h}return a},e.prototype.any=function(t,e){rh(t,"any"),an("any",e,t.rank);for(var n=rn(t.shape,e),r=n[0],o=n[1],a=Mn(r,t.dtype),i=N(o),s=this.readSync(a.dataId),u=this.readSync(t.dataId),c=0;c<s.length;++c){for(var l=c*i,h=u[l],d=0;d<i;++d){var f=u[l+d];h=h||f}s[c]=h}return a},e.prototype.squaredDifference=function(t,e){return rh([t,e],"squaredDifference"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){var n=t-e;return n*n}))},e.prototype.ceil=function(t){rh(t,"ceil");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.ceil(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.floor=function(t){rh(t,"floor");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.floor(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.sign=function(t){rh(t,"x");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)e[r]<0?n[r]=-1:e[r]>0?n[r]=1:n[r]=0;return this.makeOutput(n,t.shape,"float32")},e.prototype.isNaN=function(t){rh(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isNaN(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isInf=function(t){rh(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Math.abs(e[r])===1/0&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.isFinite=function(t){rh(t,"x");for(var e=this.readSync(t.dataId),n=new Uint8Array(e.length),r=0;r<e.length;++r)Number.isFinite(e[r])&&(n[r]=1);return this.makeOutput(n,t.shape,"bool")},e.prototype.round=function(t){rh(t,"round");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=Math.floor(e[r]);e[r]-o<.5?n[r]=Math.floor(e[r]):e[r]-o>.5?n[r]=Math.ceil(e[r]):n[r]=o%2==0?o:o+1}return this.makeOutput(n,t.shape,"float32")},e.prototype.exp=function(t){rh(t,"exp");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.exp(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.expm1=function(t){rh(t,"expm1");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=Math.expm1(e[r]);return this.makeOutput(n,t.shape,"float32")},e.prototype.log=function(t){rh(t,"log");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.log1p=function(t){rh(t,"log1p");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.log1p(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.sqrt=function(t){rh(t,"sqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.rsqrt=function(t){rh(t,"rsqrt");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r){var o=e[r];n[r]=1/Math.sqrt(o)}return this.makeOutput(n,t.shape,"float32")},e.prototype.reciprocal=function(t){rh(t,"reciprocal");for(var e=this.readSync(t.dataId),n=new Float32Array(e.length),r=0;r<e.length;++r)n[r]=1/e[r];return this.makeOutput(n,t.shape,"float32")},e.prototype.linear=function(t){return t},e.prototype.relu=function(t){rh(t,"relu");for(var e=Mn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.max(0,r[o]);return e},e.prototype.relu6=function(t){rh(t,"relu");for(var e=Mn(t.shape,t.dtype),n=this.readSync(e.dataId),r=this.readSync(t.dataId),o=0;o<r.length;++o)n[o]=Math.min(Math.max(0,r[o]),6);return e},e.prototype.prelu=function(t,e){return rh([t,e],"prelu"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return t<0?e*t:t}))},e.prototype.elu=function(t){rh(t,"elu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=n[r];e[r]=o>=0?o:Math.exp(o)-1}return this.makeOutput(e,t.shape,"float32")},e.prototype.eluDer=function(t,e){rh([t,e],"eluDer");for(var n=new Float32Array(e.size),r=this.readSync(e.dataId),o=this.readSync(t.dataId),a=0;a<r.length;++a){var i=r[a];n[a]=i>=1?o[a]:o[a]*(i+1)}return this.makeOutput(n,e.shape,"float32")},e.prototype.selu=function(t){rh(t,"selu");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),a=0;a<n.length;++a){var i=n[a];e[a]=i>=0?1.0507009873554805*i:1.7580993408473768*(Math.exp(i)-1)}return this.makeOutput(e,t.shape,"float32")},e.prototype.clip=function(t,e,n){rh(t,"clip");for(var r=new Float32Array(t.size),o=this.readSync(t.dataId),a=0;a<o.length;++a){var i=o[a];r[a]=i>n?n:i<e?e:i}return this.makeOutput(r,t.shape,"float32")},e.prototype.abs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.abs(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.complexAbs=function(t){for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<t.size;++r){var o=n[2*r],a=n[2*r+1];e[r]=Math.hypot(o,a)}return this.makeOutput(e,t.shape,"float32")},e.prototype.int=function(t){rh(t,"int");for(var e=new Int32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=n[r];return this.makeOutput(e,t.shape,"int32")},e.prototype.sigmoid=function(t){rh(t,"sigmoid");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=1/(1+Math.exp(-n[r]));return this.makeOutput(e,t.shape,"float32")},e.prototype.softplus=function(t){rh(t,"softplus");for(var e=Math.log(1.1920928955078125e-7)+2,n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var u,a=r[o]>-e,i=r[o]<e,s=Math.exp(r[o]);u=i?s:a?r[o]:Math.log(1+s),n[o]=u}return this.makeOutput(n,t.shape,"float32")},e.prototype.sin=function(t){rh(t,"sin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cos=function(t){rh(t,"cos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tan=function(t){rh(t,"tan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.tan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asin=function(t){rh(t,"asin");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asin(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acos=function(t){rh(t,"acos");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acos(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan=function(t){rh(t,"atan");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atan(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atan2=function(t,e){return rh([t,e],"atan2"),this.broadcastedBinaryOp(t,e,t.dtype,(function(t,e){return Math.atan2(t,e)}))},e.prototype.sinh=function(t){rh(t,"sinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.sinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.cosh=function(t){rh(t,"cosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.cosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.tanh=function(t){rh(t,"tanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=L(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.asinh=function(t){rh(t,"asinh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.asinh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.acosh=function(t){rh(t,"acosh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.acosh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.atanh=function(t){rh(t,"atanh");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r)e[r]=Math.atanh(n[r]);return this.makeOutput(e,t.shape,"float32")},e.prototype.erf=function(t){rh(t,"erf");for(var e=new Float32Array(t.size),n=this.readSync(t.dataId),r=0;r<n.length;++r){var o=Math.sign(n[r]),a=Math.abs(n[r]),i=1/(1+.3275911*a);e[r]=o*(1-((((1.061405429*i-1.453152027)*i+1.421413741)*i-.284496736)*i+.254829592)*i*Math.exp(-a*a))}return this.makeOutput(e,t.shape,"float32")},e.prototype.step=function(t,e){void 0===e&&(e=0),rh(t,"step");for(var n=new Float32Array(t.size),r=this.readSync(t.dataId),o=0;o<r.length;++o){var a=r[o];isNaN(a)?n[o]=NaN:n[o]=a>0?1:e}return this.makeOutput(n,t.shape,"float32")},e.prototype.fusedConv2d=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.conv2d(e,n,r);return o&&(s=this.add(s,o)),a&&(s=ah(this,s,a,i)),s},e.prototype.conv2d=function(t,e,n){rh([t,e],"conv2d");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c="channelsLast"===n.dataFormat,l=kn(n.outShape,t.dtype),h=t.strides[0],d=c?t.strides[1]:t.strides[2],f=c?t.strides[2]:1,p=c?1:t.strides[1],m=l.strides[0],g=c?l.strides[1]:l.strides[2],v=c?l.strides[2]:1,y=c?1:l.strides[1],x=this.readSync(t.dataId),b=this.readSync(e.dataId),w=l.values,_=0;_<n.batchSize;++_)for(var S=_*h,M=_*m,E=0;E<n.outHeight;++E)for(var T=M+E*g,A=E*n.strideHeight-u,C=0;C<r;C++){var R=A+C*a;if(!(R<0||R>=n.inHeight))for(var I=C*e.strides[0],N=S+R*d,O=0;O<n.outWidth;++O)for(var D=T+O*v,L=O*n.strideWidth-s,k=0;k<o;k++){var P=L+k*i;if(!(P<0||P>=n.inWidth))for(var F=N+P*f,B=I+k*e.strides[1],z=0;z<n.inChannels;++z){for(var U=x[F+z*p],V=0;V<n.outChannels;++V)w[D+V*y]+=U*b[B+V];B+=n.outChannels}}}return l.toTensor()},e.prototype.conv3d=function(t,e,n){for(var r=n.filterDepth,o=n.filterHeight,a=n.filterWidth,i=n.dilationDepth,s=n.dilationHeight,u=n.dilationWidth,c=n.padInfo.front,l=n.padInfo.left,h=n.padInfo.top,d=kn(n.outShape,t.dtype),f=this.readSync(t.dataId),p=this.readSync(e.dataId),m=d.values,g=0;g<n.batchSize;++g)for(var v=g*t.strides[0],y=g*d.strides[0],x=0;x<n.outDepth;++x)for(var b=y+x*d.strides[1],w=x*n.strideDepth-c,_=0;_<r;_++){var S=w+_*i;if(!(S<0||S>=n.inDepth))for(var M=_*e.strides[0],E=v+S*t.strides[1],T=0;T<n.outHeight;++T)for(var A=b+T*d.strides[2],C=T*n.strideHeight-h,R=0;R<o;R++){var I=C+R*s;if(!(I<0||I>=n.inHeight))for(var N=M+R*e.strides[1],O=E+I*t.strides[2],D=0;D<n.outWidth;++D)for(var L=A+D*n.outChannels,k=D*n.strideWidth-l,P=0;P<a;P++){var F=k+P*u;if(!(F<0||F>=n.inWidth))for(var B=N+P*e.strides[2],z=O+F*n.inChannels,U=B,V=0;V<n.inChannels;++V){for(var G=f[z+V],H=0;H<n.outChannels;++H)m[L+H]+=G*p[U+H];U+=n.outChannels}}}}return d.toTensor()},e.prototype.conv2dDerInput=function(t,e,n){rh([t,e],"conv2dDerInput");for(var r=kn(n.inShape,"float32"),o=r.values,a=this.readSync(t.dataId),i=this.readSync(e.dataId),s=e.strides,u=s[0],c=s[1],l=s[2],h=n.batchSize,d=n.filterHeight,f=n.filterWidth,p=n.inChannels,m=n.inHeight,g=n.inWidth,v=n.outChannels,y=n.outHeight,x=n.outWidth,b=n.strideHeight,w=n.strideWidth,_=n.dataFormat,S=d-1-n.padInfo.top,M=f-1-n.padInfo.left,E="channelsLast"===_,T=r.strides[0],A=E?r.strides[1]:r.strides[2],C=E?r.strides[2]:1,R=E?1:r.strides[1],I=t.strides[0],N=E?t.strides[1]:t.strides[2],O=E?t.strides[2]:1,D=E?1:t.strides[1],L=0;L<h;++L)for(var k=0;k<p;++k)for(var P=0;P<m;++P)for(var F=P-S,B=Math.max(0,Math.ceil(F/b)),z=Math.min(y,(d+F)/b),U=0;U<g;++U){for(var V=U-M,G=Math.max(0,Math.ceil(V/w)),H=Math.min(x,(f+V)/w),j=0,q=B;q<z;++q)for(var W=q*b-F,X=G;X<H;++X)for(var Y=I*L+N*q+O*X,K=u*(d-1-W)+c*(f-1-(X*w-V))+l*k,J=0;J<v;++J)j+=a[Y+D*J]*i[K+J];o[T*L+A*P+C*U+R*k]=j}return r.toTensor()},e.prototype.conv3dDerInput=function(t,e,n){for(var r=kn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=a[3],l=this.readSync(t.dataId),h=t.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(e.dataId),v=e.strides,y=v[0],x=v[1],b=v[2],w=v[3],_=n.batchSize,S=n.filterDepth,M=n.filterHeight,E=n.filterWidth,T=n.inChannels,A=n.inDepth,C=n.inHeight,R=n.inWidth,I=n.outChannels,N=n.outDepth,O=n.outHeight,D=n.outWidth,L=n.strideDepth,k=n.strideHeight,P=n.strideWidth,F=S-1-n.padInfo.front,B=M-1-n.padInfo.top,z=E-1-n.padInfo.left,U=0;U<_;++U)for(var V=0;V<T;++V)for(var G=0;G<A;++G)for(var H=G-F,j=Math.max(0,Math.ceil(H/L)),q=Math.min(N,(S+H)/L),W=0;W<C;++W)for(var X=W-B,Y=Math.max(0,Math.ceil(X/k)),K=Math.min(O,(M+X)/k),J=0;J<R;++J){for(var Z=J-z,Q=Math.max(0,Math.ceil(Z/P)),$=Math.min(D,(E+Z)/P),tt=0,et=j;et<q;++et)for(var nt=et*L-H,rt=Y;rt<K;++rt)for(var it=rt*k-X,ot=Q;ot<$;++ot)for(var at=d*U+f*et+p*rt+m*ot,st=y*(S-1-nt)+x*(M-1-it)+b*(E-1-(ot*P-Z))+w*V,ut=0;ut<I;++ut)tt+=l[at+ut]*g[st+ut];o[i*U+s*G+u*W+c*J+V]=tt}return r.toTensor()},e.prototype.conv2dDerFilter=function(t,e,n){rh([t,e],"conv2dDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s="channelsLast"===n.dataFormat,u=kn(n.filterShape,"float32"),c=n.padInfo.left,l=n.padInfo.top,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<a;++f)for(var p=Math.max(0,Math.ceil((l-f)/r)),m=Math.min(n.outHeight,(n.inHeight+l-f)/r),g=0;g<i;++g)for(var v=Math.max(0,Math.ceil((c-g)/o)),y=Math.min(n.outWidth,(n.inWidth+c-g)/o),x=0;x<n.inChannels;++x)for(var b=0;b<n.outChannels;++b){for(var w=0,_=0;_<n.batchSize;++_)for(var S=p;S<m;++S)for(var M=f+S*r-l,E=v;E<y;++E){var T=g+E*o-c;w+=s?h.get(_,M,T,x)*d.get(_,S,E,b):h.get(_,x,M,T)*d.get(_,b,S,E)}u.set(w,f,g,x,b)}return u.toTensor()},e.prototype.conv3dDerFilter=function(t,e,n){for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=kn(n.filterShape,"float32"),l=c.values,h=c.strides,d=h[0],f=h[1],p=h[2],m=h[3],g=this.readSync(e.dataId),v=e.strides,y=v[0],x=v[1],b=v[2],w=v[3],_=this.readSync(t.dataId),S=t.strides,M=S[0],E=S[1],T=S[2],A=S[3],C=n.padInfo.front,R=n.padInfo.left,I=n.padInfo.top,N=0;N<i;++N)for(var O=Math.max(0,Math.ceil((C-N)/r)),D=Math.min(n.outDepth,(n.inDepth+C-N)/r),L=N*d,k=0;k<s;++k)for(var P=Math.max(0,Math.ceil((I-k)/o)),F=Math.min(n.outHeight,(n.inHeight+I-k)/o),B=k*f+L,z=0;z<u;++z)for(var U=Math.max(0,Math.ceil((R-z)/a)),V=Math.min(n.outWidth,(n.inWidth+R-z)/a),G=z*p+B,H=0;H<n.inChannels;++H)for(var j=H*m+G,q=0;q<n.outChannels;++q){for(var W=0,X=0;X<n.batchSize;++X)for(var Y=X*M,K=X*y,J=O;J<D;++J)for(var Z=(N+J*r-C)*E+Y,Q=J*x+K,$=P;$<F;++$)for(var tt=(k+$*o-I)*T+Z,et=$*b+Q,nt=U;nt<V;++nt){var rt=nt*w+et;W+=_[(z+nt*a-R)*A+tt+H]*g[rt+q]}l[j+q]=W}return c.toTensor()},e.prototype.fusedDepthwiseConv2D=function(t){var e=t.input,n=t.filter,r=t.convInfo,o=t.bias,a=t.activation,i=t.preluActivationWeights,s=this.depthwiseConv2D(e,n,r);return o&&(s=this.add(s,o)),a&&(s=ah(this,s,a,i)),s},e.prototype.depthwiseConv2D=function(t,e,n){rh([t,e],"depthwiseConv2D");for(var r=n.filterHeight,o=n.filterWidth,a=n.dilationHeight,i=n.dilationWidth,s=n.padInfo.left,u=n.padInfo.top,c=n.outChannels/n.inChannels,l=kn(n.outShape,t.dtype),h=this.readSync(t.dataId),d=this.readSync(e.dataId),f=l.values,p=0;p<n.batchSize;++p)for(var m=p*t.strides[0],g=p*l.strides[0],v=0;v<n.outHeight;++v)for(var y=g+v*l.strides[1],x=v*n.strideHeight-s,b=0;b<r;++b){var w=x+b*a;if(!(w<0||w>=n.inHeight))for(var _=b*e.strides[0],S=m+w*t.strides[1],M=0;M<n.outWidth;++M)for(var E=y+M*l.strides[2],T=M*n.strideWidth-u,A=0;A<o;++A){var C=T+A*i;if(!(C<0||C>=n.inWidth))for(var R=_+A*e.strides[1],I=S+C*n.inChannels,N=E,O=R,D=0;D<n.inChannels;++D){for(var L=h[I+D],k=0;k<c;++k)f[N+k]+=L*d[O+k];N+=c,O+=c}}}return l.toTensor()},e.prototype.depthwiseConv2DDerInput=function(t,e,n){rh([t,e],"depthwiseConv2DDerInput");for(var r=kn(n.inShape,"float32"),o=r.values,a=r.strides,i=a[0],s=a[1],u=a[2],c=this.readSync(t.dataId),l=t.strides,h=l[0],d=l[1],f=l[2],p=this.readSync(e.dataId),m=e.strides,g=m[0],v=m[1],y=m[2],x=n.batchSize,b=n.filterHeight,w=n.filterWidth,_=n.inChannels,S=n.inHeight,M=n.inWidth,E=n.outChannels,T=n.outHeight,A=n.outWidth,C=n.strideHeight,R=n.strideWidth,I=b-1-n.padInfo.top,N=w-1-n.padInfo.left,O=E/_,D=0;D<x;++D)for(var L=0;L<_;++L)for(var k=0;k<S;++k)for(var P=k-I,F=Math.max(0,Math.ceil(P/C)),B=Math.min(T,(b+P)/C),z=0;z<M;++z){for(var U=z-N,V=Math.max(0,Math.ceil(U/R)),G=Math.min(A,(w+U)/R),H=0,j=F;j<B;++j)for(var q=j*C-P,W=V;W<G;++W)for(var X=h*D+d*j+f*W,Y=g*(b-1-q)+v*(w-1-(W*R-U))+y*L,K=0;K<O;++K)H+=c[X+(L*O+K)]*p[Y+K];o[i*D+s*k+u*z+L]=H}return r.toTensor()},e.prototype.depthwiseConv2DDerFilter=function(t,e,n){rh([t,e],"depthwiseConv2DDerFilter");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=kn(n.filterShape,"float32"),u=n.padInfo.left,c=n.padInfo.top,l=n.outChannels/n.inChannels,h=this.bufferSync(t),d=this.bufferSync(e),f=0;f<a;++f)for(var p=Math.max(0,Math.ceil((c-f)/r)),m=Math.min(n.outHeight,(n.inHeight+c-f)/r),g=0;g<i;++g)for(var v=Math.max(0,Math.ceil((u-g)/o)),y=Math.min(n.outWidth,(n.inWidth+u-g)/o),x=0;x<n.outChannels;++x){for(var b=Math.trunc(x/l),w=x%l,_=0,S=0;S<n.batchSize;++S)for(var M=p;M<m;++M)for(var E=f+M*r-c,T=v;T<y;++T){var A=g+T*o-u;_+=h.get(S,E,A,b)*d.get(S,M,T,x)}s.set(_,f,g,b,w)}return s.toTensor()},e.prototype.tile=function(t,e){return rh(t,"tile"),io(this.bufferSync(t),e)},e.prototype.pad=function(t,e,n){rh(t,"pad");var r=e.map((function(e,n){return e[0]+t.shape[n]+e[1]})),o=e.map((function(t){return t[0]})),a=this.bufferSync(t),i=kn(r,t.dtype);0!==n&&i.values.fill(n);for(var s=0;s<t.size;s++){var u=a.indexToLoc(s),c=u.map((function(t,e){return t+o[e]}));i.set.apply(i,[a.get.apply(a,u)].concat(c))}return i.toTensor()},e.prototype.gather=function(t,e,n){rh([t,e],"gather");var r=t.shape.slice(),o=this.readSync(e.dataId);r[n]=o.length;for(var a=kn(r,t.dtype),i=this.bufferSync(t),s=0;s<a.size;++s){var u=a.indexToLoc(s),c=u.slice();c[n]=o[u[n]];var l=i.locToIndex(c);a.values[s]=i.values[l]}return a.toTensor()},e.prototype.batchToSpaceND=function(t,e,n){rh([t],"batchToSpaceND");var r=e.reduce((function(t,e){return t*e})),o=qn(t.shape,e,r),a=Xn(o.length,e.length),i=Yn(t.shape,e,r),s=Kn(n,e.length),u=Jn(i,n,e.length);return Ei(t.reshape(o),a).reshape(i).slice(s,u)},e.prototype.spaceToBatchND=function(t,e,n){rh([t],"spaceToBatchND");var r=e.reduce((function(t,e){return t*e})),o=[[0,0]];o.push.apply(o,n);for(var a=1+e.length;a<t.shape.length;++a)o.push([0,0]);var i=t.pad(o),s=qn(i.shape,e,r,!1),u=Xn(s.length,e.length,!1),c=Yn(i.shape,e,r,!1);return Ei(i.reshape(s),u).reshape(c)},e.prototype.maxPool=function(t,e){return rh(t,"maxPool"),ih(this.readSync(t.dataId),t.shape,t.dtype,t.strides,e,"max").toTensor()},e.prototype.maxPoolBackprop=function(t,e,n,r){rh([e,n],"maxPoolBackprop");for(var o=this.readSync(e.dataId),a=kn(r.outShape,e.dtype,oh(o,e.shape,e.dtype,r).values),i=r.strideHeight,s=r.strideWidth,u=r.dilationHeight,c=r.dilationWidth,l=r.effectiveFilterHeight,h=r.effectiveFilterWidth,d=h-1-r.padInfo.left,f=l-1-r.padInfo.top,p=kn(e.shape,"float32"),m=this.bufferSync(t),g=0;g<r.batchSize;++g)for(var v=0;v<r.inChannels;++v)for(var y=0;y<r.inHeight;++y)for(var x=0;x<r.inWidth;++x){for(var b=y-f,w=x-d,_=0,S=0;S<l;S+=u){var M=(b+S)/i;if(!(M<0||M>=r.outHeight||Math.floor(M)!==M))for(var E=0;E<h;E+=c){var T=(w+E)/s;if(!(T<0||T>=r.outWidth||Math.floor(T)!==T)){var A=l*h-1-a.get(g,M,T,v)===S*h+E?1:0;0!==A&&(_+=m.get(g,M,T,v)*A)}}}p.set(_,g,y,x,v)}return p.toTensor()},e.prototype.avgPoolBackprop=function(t,e,n){rh([t,e],"avgPoolBackprop");for(var r=n.strideHeight,o=n.strideWidth,a=n.filterHeight,i=n.filterWidth,s=n.dilationHeight,u=n.dilationWidth,c=n.effectiveFilterHeight,l=n.effectiveFilterWidth,h=l-1-n.padInfo.left,d=c-1-n.padInfo.top,f=kn(e.shape,"float32"),p=1/(a*i),m=this.bufferSync(t),g=0;g<n.batchSize;++g)for(var v=0;v<n.inChannels;++v)for(var y=0;y<n.inHeight;++y)for(var x=0;x<n.inWidth;++x){for(var b=y-d,w=x-h,_=0,S=0;S<c;S+=s){var M=(b+S)/r;if(!(M<0||M>=n.outHeight||Math.floor(M)!==M))for(var E=0;E<l;E+=u){var T=(w+E)/o;T<0||T>=n.outWidth||Math.floor(T)!==T||(_+=m.get(g,M,T,v))}}f.set(_*p,g,y,x,v)}return f.toTensor()},e.prototype.pool3d=function(t,e,n){rh(t,"pool3d");for(var r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,m="max"===n?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,g=this.readSync(t.dataId),v=kn(e.outShape,t.dtype),y=v.values,x=e.outShape[1]*e.outShape[2]*e.outShape[3]*e.outShape[4],b=e.outShape[2]*e.outShape[3]*e.outShape[4],w=e.outShape[3]*e.outShape[4],_=e.outShape[4],S=0;S<e.batchSize;++S)for(var M=S*x,E=S*t.strides[0],T=0;T<e.inChannels;++T)for(var A=0;A<e.outDepth;++A){for(var C=A*r-d,R=C;R<0;)R+=i;for(var I=Math.min(e.inDepth,c+C),N=M+A*b,O=0;O<e.outHeight;++O){for(var D=O*o-f,L=D;L<0;)L+=s;for(var k=Math.min(e.inHeight,l+D),P=N+O*w,F=0;F<e.outWidth;++F){for(var B=F*a-p,z=B;z<0;)z+=u;for(var U=Math.min(e.inWidth,h+B),V=P+F*_,G=m,H=0,j=0,q=R;q<I;q+=i){for(var W=E+q*t.strides[1],X=L;X<k;X+=s){for(var Y=W+X*t.strides[2],K=z;K<U;K+=u){var J=g[Y+K*t.strides[3]+T];if("max"===n&&J>G?G=J:"avg"===n&&(H+=J,j++),isNaN(G))break}if(isNaN(G))break}if(isNaN(G))break}y[V+T]="avg"===n?H/j:G}}}return v.toTensor()},e.prototype.avgPool3d=function(t,e){return rh(t,"avgPool3d"),this.pool3d(t,e,"avg").toFloat()},e.prototype.avgPool3dBackprop=function(t,e,n){rh([t,e],"avgPool3dBackprop");for(var r=n.strideDepth,o=n.strideHeight,a=n.strideWidth,i=n.filterDepth,s=n.filterHeight,u=n.filterWidth,c=n.dilationDepth,l=n.dilationHeight,h=n.dilationWidth,d=n.effectiveFilterDepth,f=n.effectiveFilterHeight,p=n.effectiveFilterWidth,m=d-1-n.padInfo.front,g=p-1-n.padInfo.left,v=f-1-n.padInfo.top,y=kn(e.shape,"float32"),x=1/(i*s*u),b=this.bufferSync(t),w=0;w<n.batchSize;++w)for(var _=0;_<n.inChannels;++_)for(var S=0;S<n.inDepth;++S)for(var M=0;M<n.inHeight;++M)for(var E=0;E<n.inWidth;++E){for(var T=S-m,A=M-v,C=E-g,R=0,I=0;I<d;I+=c){var N=(T+I)/r;if(!(N<0||N>=n.outDepth||Math.floor(N)!==N))for(var O=0;O<f;O+=l){var D=(A+O)/o;if(!(D<0||D>=n.outHeight||Math.floor(D)!==D))for(var L=0;L<p;L+=h){var k=(C+L)/a;k<0||k>=n.outWidth||Math.floor(k)!==k||(R+=b.get(w,N,D,k,_))}}}y.set(R*x,w,S,M,E,_)}return y.toTensor()},e.prototype.maxPool3d=function(t,e){return rh(t,"maxPool3d"),this.pool3d(t,e,"max").toFloat()},e.prototype.maxPool3dPositions=function(t,e){for(var n=kn(e.outShape,"int32"),r=e.strideDepth,o=e.strideHeight,a=e.strideWidth,i=e.dilationDepth,s=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,d=e.padInfo.front,f=e.padInfo.top,p=e.padInfo.left,m=this.bufferSync(t),g=0;g<e.batchSize;++g)for(var v=0;v<e.inChannels;++v)for(var y=0;y<e.outDepth;++y){for(var x=y*r-d,b=x;b<0;)b+=i;for(var w=Math.min(e.inDepth,c+x),_=0;_<e.outHeight;++_){for(var S=_*o-f,M=S;M<0;)M+=s;for(var E=Math.min(e.inHeight,l+S),T=0;T<e.outWidth;++T){for(var A=T*a-p,C=A;C<0;)C+=u;for(var R=Math.min(e.inWidth,h+A),I=Number.NEGATIVE_INFINITY,N=-1,O=b;O<w;O+=i)for(var D=O-x,L=M;L<E;L+=s)for(var k=L-S,P=C;P<R;P+=u){var F=P-A,B=m.get(g,O,L,P,v);B>=I&&(I=B,N=D*l*h+k*l+F)}n.set(N,g,y,_,T,v)}}}return n.toTensor()},e.prototype.maxPool3dBackprop=function(t,e,n,r){rh([e,n],"maxPool3dBackprop");for(var o=this.maxPool3dPositions(e,r),a=r.strideDepth,i=r.strideHeight,s=r.strideWidth,u=r.dilationDepth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterDepth,d=r.effectiveFilterHeight,f=r.effectiveFilterWidth,p=h-1-r.padInfo.front,m=f-1-r.padInfo.left,g=d-1-r.padInfo.top,v=kn(e.shape,"float32"),y=this.bufferSync(o),x=this.bufferSync(t),b=0;b<r.batchSize;++b)for(var w=0;w<r.inChannels;++w)for(var _=0;_<r.inDepth;++_)for(var S=0;S<r.inHeight;++S)for(var M=0;M<r.inWidth;++M){for(var E=_-p,T=S-g,A=M-m,C=0,R=0;R<h;R+=u){var I=(E+R)/a;if(!(I<0||I>=r.outDepth||Math.floor(I)!==I))for(var N=0;N<d;N+=c){var O=(T+N)/i;if(!(O<0||O>=r.outHeight||Math.floor(O)!==O))for(var D=0;D<f;D+=l){var L=(A+D)/s;if(!(L<0||L>=r.outWidth||Math.floor(L)!==L)){var k=h*d*f-1-y.get(b,I,O,L,w)===R*d*f+N*f+D?1:0;0!==k&&(C+=x.get(b,I,O,L,w)*k)}}}}v.set(C,b,_,S,M,w)}return v.toTensor()},e.prototype.cast=function(t,e){return Vi(t,e,this)},e.prototype.reshape=function(t,e){return Gi(t,e)},e.prototype.avgPool=function(t,e){return rh(t,"avgPool"),rh(t,"maxPool"),ih(this.readSync(t.dataId),t.shape,t.dtype,t.strides,e,"avg").toTensor().toFloat()},e.prototype.resizeBilinear=function(t,e,n,r){rh(t,"resizeBilinear");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(N([a,e,n,u])),h=[r&&e>1?i-1:i,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=0,p=h[0]/d[0],m=h[1]/d[1],g=0;g<a;g++)for(var v=0;v<e;v++)for(var y=p*v,x=Math.floor(y),b=y-x,w=Math.min(i-1,Math.ceil(y)),_=g*t.strides[0]+x*t.strides[1],S=g*t.strides[0]+w*t.strides[1],M=0;M<n;M++)for(var E=m*M,T=Math.floor(E),A=E-T,C=Math.min(s-1,Math.ceil(E)),R=_+T*t.strides[2],I=S+T*t.strides[2],O=_+C*t.strides[2],D=S+C*t.strides[2],L=0;L<u;L++){var k=c[R+L],P=c[I+L],F=k+(c[O+L]-k)*A,B=F+(P+(c[D+L]-P)*A-F)*b;l[f++]=B}return gn(l,[a,e,n,u])},e.prototype.resizeBilinearBackprop=function(t,e,n){rh([t,e],"resizeBilinearBackprop");for(var r=e.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*a*i*s),d=[n&&c>1?a-1:a,n&&l>1?i-1:i],f=[n&&c>1?c-1:c,n&&l>1?l-1:l],p=d[0]/f[0],m=d[1]/f[1],g=this.readSync(t.dataId),v=0,y=0;y<o;y++)for(var x=y*e.strides[0],b=0;b<c;b++)for(var w=b*p,_=Math.floor(w),S=Math.min(Math.ceil(w),a-1),M=x+_*e.strides[1],E=x+S*e.strides[1],T=w-_,A=1-T,C=0;C<l;C++)for(var R=C*m,I=Math.floor(R),N=Math.min(Math.ceil(R),i-1),O=R-I,D=1-O,L=M+I*e.strides[2],k=M+N*e.strides[2],P=E+I*e.strides[2],F=E+N*e.strides[2],B=A*D,z=A*O,U=T*D,V=T*O,G=0;G<s;G++){var H=g[v++];h[L+G]+=H*B,h[k+G]+=H*z,h[P+G]+=H*U,h[F+G]+=H*V}return _n(h,[o,i,a,s],e.dtype)},e.prototype.resizeNearestNeighbor=function(t,e,n,r){rh(t,"resizeNearestNeighbor");for(var o=t.shape,a=o[0],i=o[1],s=o[2],u=o[3],c=this.readSync(t.dataId),l=new Float32Array(a*e*n*u),h=[r&&e>1?i-1:i,r&&n>1?s-1:s],d=[r&&e>1?e-1:e,r&&n>1?n-1:n],f=h[0]/d[0],p=h[1]/d[1],m=0,g=0;g<a;g++)for(var v=g*t.strides[0],y=0;y<e;y++)for(var x=f*y,b=v+Math.min(i-1,r?Math.round(x):Math.floor(x))*t.strides[1],w=0;w<n;w++)for(var _=p*w,S=b+Math.min(s-1,r?Math.round(_):Math.floor(_))*t.strides[2],M=0;M<u;M++){var E=c[S+M];l[m++]=E}return gn(l,[a,e,n,u],t.dtype)},e.prototype.resizeNearestNeighborBackprop=function(t,e,n){rh([t,e],"resizeNearestNeighborBackprop");for(var r=e.shape,o=r[0],a=r[1],i=r[2],s=r[3],u=t.shape,c=u[1],l=u[2],h=new Float32Array(o*a*i*s),d=this.readSync(t.dataId),f=[n&&c>1?a-1:a,n&&l>1?i-1:i],p=[n&&c>1?c-1:c,n&&l>1?l-1:l],m=f[0]/p[0],g=f[1]/p[1],v=1/m,y=1/g,x=2*Math.ceil(v)+2,b=2*Math.ceil(y)+2,w=0;w<o;w++)for(var _=w*e.strides[0],S=0;S<a;S++)for(var M=_+S*e.strides[1],E=Math.floor(S*v),T=Math.floor(E-x/2),A=0;A<i;A++)for(var C=M+A*e.strides[2],R=Math.floor(A*y),I=Math.floor(R-b/2),N=0;N<s;N++){for(var O=0,D=0;D<x;D++){var L=D+T;if(!(L<0||L>=c)){var k=_+L*t.strides[1],P=L*m;if(S===Math.min(a-1,n?Math.round(P):Math.floor(P)))for(var F=0;F<b;F++){var B=F+I;if(!(B<0||B>=l)){var z=k+B*t.strides[2],U=B*g;A===Math.min(i-1,n?Math.round(U):Math.floor(U))&&(O+=d[z+N])}}}}h[C+N]=O}return _n(h,e.shape,e.dtype)},e.prototype.batchNormalization=function(t,e,n,r,o,a){rh([t,e,n,o,a],"batchNorm");for(var i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=this.readSync(n.dataId),c=o?this.readSync(o.dataId):new Float32Array([1]),l=a?this.readSync(a.dataId):new Float32Array([0]),h=new Float32Array(i.length),d=l.length,f=c.length,p=u.length,m=s.length,g=0,v=0,y=0,x=0,b=0;b<i.length;++b)h[b]=l[g++]+(i[b]-s[v++])*c[y++]/Math.sqrt(u[x++]+r),g>=d&&(g=0),v>=m&&(v=0),y>=f&&(y=0),x>=p&&(x=0);return _n(h,t.shape)},e.prototype.localResponseNormalization4D=function(t,e,n,r,o){rh(t,"localResponseNormalization4D");var a=t.shape[3],i=a-1,s=this.readSync(t.dataId),u=t.size,c=new Float32Array(u);function l(t){for(var n=t%a,r=t-n+Math.max(0,n-e),o=t-n+Math.min(n+e,i),u=0;r<=o;r++){var c=s[r];u+=c*c}return u}for(var h=0;h<u;h++){var d=l(h),f=s[h]*Math.pow(n+r*d,-o);c[h]=f}return _n(c,t.shape)},e.prototype.LRNGrad=function(t,e,n,r,o,a,i){rh(t,"LRNGrad");for(var s=t.shape[3],u=this.readSync(t.dataId),c=this.readSync(e.dataId),l=this.readSync(n.dataId),h=new Float32Array(t.size),d=t.size,f=0;f<d;f++){for(var p=f%s,m=f-p+Math.max(0,p-r),g=f-p+Math.min(s,p+r+1),v=0,y=m;y<g;y++)v+=Math.pow(c[y],2);for(v=a*v+o,y=m;y<g;y++){var x=-2*a*i*c[y]*l[f]/v;f===y&&(x+=Math.pow(v,-i)),x*=u[f],h[y]+=x}}return _n(h,t.shape)},e.prototype.multinomial=function(t,e,n,r){rh(t,"multinomial");for(var o=e?t:Si(t),a=o.shape[0],i=o.shape[1],s=Mn([a,n],"int32"),u=this.readSync(s.dataId),c=this.readSync(o.dataId),l=0;l<a;++l){var h=l*i,d=new Float32Array(i-1);d[0]=c[h];for(var f=1;f<d.length;++f)d[f]=d[f-1]+c[h+f];for(var p=qs(r.toString()),m=l*n,g=0;g<n;++g){var v=p();u[m+g]=d.length;for(var y=0;y<d.length;y++)if(v<d[y]){u[m+g]=y;break}}}return s},e.prototype.oneHot=function(t,e,n,r){rh(t,"oneHot");var o=new Float32Array(t.size*e);o.fill(r);for(var a=this.readSync(t.dataId),i=0;i<t.size;++i)a[i]>=0&&a[i]<e&&(o[i*e+a[i]]=n);return bn(o,[t.size,e],"int32")},e.prototype.nonMaxSuppression=function(t,e,n,r,o){return rh(t,"nonMaxSuppression"),Zi(this.readSync(t.dataId),this.readSync(e.dataId),n,r,o)},e.prototype.fft=function(t){return this.fftBatch(t,!1)},e.prototype.ifft=function(t){return this.fftBatch(t,!0)},e.prototype.fftBatch=function(t,e){for(var n=t.shape[0],r=t.shape[1],o=kn(t.shape,"float32"),a=kn(t.shape,"float32"),i=fn(t).as2D(n,r),s=mn(t).as2D(n,r),u=0;u<n;u++)for(var c=i.slice([u,0],[1,r]),l=s.slice([u,0],[1,r]),h=dn(c,l),d=this.readSync(this.fftImpl(h,e).dataId),f=0;f<r;f++){var p=qi(d,f);o.values[u*r+f]=p.real,a.values[u*r+f]=p.imag}return dn(o.toTensor(),a.toTensor()).as2D(n,r)},e.prototype.fftImpl=function(t,e){var n=t.as1D(),r=n.size;if(this.isExponentOf2(r)){var o=this.fftRadix2(n,r,e).as2D(t.shape[0],t.shape[1]);return e&&(o=dn(fn(o).div(yn(r)),mn(o).div(yn(r)))),o}var a=this.readSync(t.dataId),i=function(t){for(var e=new Float32Array(t.length/2),n=new Float32Array(t.length/2),r=0;r<t.length;r+=2)e[r/2]=t[r],n[r/2]=t[r+1];return{real:e,imag:n}}(this.fourierTransformByMatmul(a,r,e));return dn(i.real,i.imag).as2D(t.shape[0],t.shape[1])},e.prototype.isExponentOf2=function(t){return 0==(t&t-1)},e.prototype.fftRadix2=function(t,e,n){if(1===e)return t;var r=this.readSync(t.dataId),o=e/2,a=function(t){for(var e=Math.ceil(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=0;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),i=dn(a.real,a.imag).as1D(),s=function(t){for(var e=Math.floor(t.length/4),n=new Float32Array(e),r=new Float32Array(e),o=2;o<t.length;o+=4)n[Math.floor(o/4)]=t[o],r[Math.floor(o/4)]=t[o+1];return{real:n,imag:r}}(r),u=dn(s.real,s.imag).as1D();i=this.fftRadix2(i,o,n),u=this.fftRadix2(u,o,n);var c=function(t,e){for(var n=new Float32Array(t/2),r=new Float32Array(t/2),o=0;o<Math.ceil(t/2);o++){var a=(e?2:-2)*Math.PI*(o/t);n[o]=Math.cos(a),r[o]=Math.sin(a)}return{real:n,imag:r}}(e,n),l=dn(c.real,c.imag).mul(u),h=i.add(l),d=i.sub(l),f=fn(h).concat(fn(d)),p=mn(h).concat(mn(d));return dn(f,p).as1D()},e.prototype.fourierTransformByMatmul=function(t,e,n){for(var r=new Float32Array(2*e),o=0;o<e;o++){for(var a=0,i=0,s=0;s<e;s++){var u=Yi(o*s,e,n),c=qi(t,s);a+=c.real*u.real-c.imag*u.imag,i+=c.real*u.imag+c.imag*u.real}n&&(a/=e,i/=e),Xi(r,a,i,o)}return r},e.prototype.depthToSpace=function(t,e,n){A("NHWC"===n,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got "+n})),A(e>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: "+e}));for(var r=t.shape[0],o=t.shape[1],a=t.shape[2],i=t.shape[3],s=o*e,u=a*e,c=i/(e*e),l=this.readSync(t.dataId),h=new Float32Array(r*s*u*c),d=0,f=0;f<r;++f)for(var p=0;p<s;++p)for(var m=Math.floor(p/e),g=p%e,v=0;v<u;++v)for(var y=Math.floor(v/e),x=(g*e+v%e)*c,b=0;b<c;++b){var w=b+x+i*(y+a*(m+o*f));h[d++]=l[w]}return _n(h,[r,s,u,c])},e.prototype.broadcastedBinaryOp=function(t,e,n,r){var o=or(t.shape,e.shape),a=kn(o,n),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=rr(t.shape,o),c=rr(e.shape,o),l=a.values;if(u.length+c.length===0)for(var h=0;h<l.length;++h)l[h]=r(i[h%i.length],s[h%s.length]);else{var d=this.bufferSync(t),f=this.bufferSync(e),p=function(n){var o=a.indexToLoc(n),h=o.slice(-t.rank);u.forEach((function(t){return h[t]=0}));var p=d.locToIndex(h),m=o.slice(-e.rank);c.forEach((function(t){return m[t]=0}));var g=f.locToIndex(m);l[n]=r(i[p],s[g])};for(h=0;h<l.length;++h)p(h)}return a.toTensor()},e.prototype.broadcastedBinaryComplexOp=function(t,e,n){var r=or(t.shape,e.shape),o=kn(r,"float32"),a=kn(r,"float32"),i=this.readSync(t.dataId),s=this.readSync(e.dataId),u=rr(t.shape,r),c=rr(e.shape,r),l=o.values,h=a.values;if(u.length+c.length===0)for(var d=0;d<l.length;d++){var f=d%i.length,p=d%s.length,m=n(i[2*f],i[2*f+1],s[2*p],s[2*p+1]);l[d]=m.real,h[d]=m.imag}else{var g=this.bufferSync(this.data.get(t.dataId).complexTensors.real),v=this.bufferSync(this.data.get(e.dataId).complexTensors.real),y=function(r){var a=o.indexToLoc(r),d=a.slice(-t.rank);u.forEach((function(t){return d[t]=0}));var f=g.locToIndex(d),p=a.slice(-e.rank);c.forEach((function(t){return p[t]=0}));var m=v.locToIndex(p),y=n(i[2*f],i[2*f+1],s[2*m],s[2*m+1]);l[r]=y.real,h[r]=y.imag};for(d=0;d<l.length;d++)y(d)}return this.complex(o.toTensor(),a.toTensor())},e.prototype.split=function(t,e,n){return ro(t,e,n)},e.prototype.dispose=function(){},e.prototype.floatPrecision=function(){return 32},e.prototype.epsilon=function(){return 1e-7},e.prototype.cropAndResize=function(t,e,n,r,o,a){for(var i=t.shape,s=i[0],u=i[1],c=i[2],l=i[3],h=e.shape[0],d=r[0],f=r[1],p=kn([h,d,f,l],"float32"),m=this.readSync(e.dataId),g=this.readSync(n.dataId),v=this.readSync(t.dataId),y=t.strides,x=p.strides,b=0;b<h;b++){var w=4*b,_=m[w],S=m[w+1],M=m[w+2],E=m[w+3],T=g[b];if(!(T>=s))for(var A=d>1?(M-_)*(u-1)/(d-1):0,C=f>1?(E-S)*(c-1)/(f-1):0,R=0;R<d;R++){var I=d>1?_*(u-1)+R*A:.5*(_+M)*(u-1);if(I<0||I>u-1)for(var N=0;N<f;N++)for(var O=0;O<l;O++){var D=O+N*x[2]+R*x[1]+b*x[0];p.values[D]=a}else if("bilinear"===o){var L=Math.floor(I),k=Math.ceil(I),P=I-L;for(N=0;N<f;N++)if((q=f>1?S*(c-1)+N*C:.5*(S+E)*(c-1))<0||q>c-1)for(O=0;O<l;O++)D=O+N*x[2]+R*x[1]+b*x[0],p.values[D]=a;else{var F=Math.floor(q),B=Math.ceil(q),z=q-F;for(O=0;O<l;O++){var U=v[D=O+F*y[2]+L*y[1]+T*y[0]],V=v[D=O+B*y[2]+L*y[1]+T*y[0]],G=v[D=O+F*y[2]+k*y[1]+T*y[0]],H=U+(V-U)*z,j=G+(v[D=O+B*y[2]+k*y[1]+T*y[0]]-G)*z;D=O+N*x[2]+R*x[1]+b*x[0],p.values[D]=H+(j-H)*P}}}else for(N=0;N<f;++N){var q;if((q=f>1?S*(c-1)+N*C:.5*(S+E)*(c-1))<0||q>c-1)for(O=0;O<l;O++)D=O+N*x[2]+R*x[1]+b*x[0],p.values[D]=a;else{var W=Math.round(q),X=Math.round(I);for(O=0;O<l;O++){var Y=O+W*y[2]+X*y[1]+T*y[0],K=O+N*x[2]+R*x[1]+b*x[0];p.values[K]=v[Y]}}}}}return p.toTensor()},e.prototype.sparseToDense=function(t,e,n,r){var o=pi(0,t,n),a=o.sliceRank,i=o.numUpdates,s=o.sliceSize,u=o.strides,c=o.outputSize;return this.scatter(t,e,n,c,s,i,a,u,r,!1)},e.prototype.gatherND=function(t,e){var n=e.shape,r=n[n.length-1],o=ai(t,e),a=o[0],i=o[1],s=o[2],u=o[3];if(0===i)return gn([],a,t.dtype);for(var c=new xt([i,s],t.dtype),l=this.readSync(e.dataId),h=this.readSync(t.dataId),d=0;d<i;d++){for(var f=[],p=0,m=0;m<r;m++){var g=l[d*r+m];p+=g*u[m],f.push(g)}if(p<0||p>=t.size/s)throw new Error("Invalid indices: "+f+" does not index into "+t.shape);for(var v=0;v<s;v++)c.values[d*s+v]=h[p*s+v]}return c.toTensor().reshape(a)},e.prototype.scatterND=function(t,e,n){var r=pi(0,t,n),o=r.sliceRank,a=r.numUpdates,i=r.sliceSize,s=r.strides,u=r.outputSize,c=yn(0);return this.scatter(t,e,n,u,i,a,o,s,c,!0)},e.prototype.fill=function(t,e,n){var r=G(n=n||Q(e),N(t));return r.fill(e),zt.makeTensor(r,t,n,this)},e.prototype.onesLike=function(t){if("string"===t.dtype)throw new Error("onesLike is not supported for string tensors");return this.fill(t.shape,1,t.dtype)},e.prototype.zerosLike=function(t){var e=G(t.dtype,N(t.shape));return this.makeOutput(e,t.shape,t.dtype)},e.prototype.linspace=function(t,e,n){return Hi(t,e,n)},e.prototype.scatter=function(t,e,n,r,o,a,i,s,u,c){var l=[r/o,o],h=this.readSync(t.dataId),d=this.readSync(e.dataId);if(0===r)return gn([],n,e.dtype);var f=new xt(l,e.dtype);f.values.fill(this.readSync(u.dataId)[0]);for(var p=0;p<a;p++){for(var m=[],g=0,v=0;v<i;v++){var y=h[p*i+v];m.push(y),g+=y*s[v]}if(g<0||g>=r/o)throw new Error("Invalid indices: "+m+" does not index into "+n);for(var x=0;x<o;x++)c?f.values[g*o+x]+=d[p*o+x]:f.values[g*o+x]=0===e.rank?d[0]:d[p*o+x]}return f.toTensor().reshape(n)},e}(Ai);function uh(t,e){return{kernelName:t,backendName:"cpu",kernelFunc:function(n){var r=n.inputs,o=n.backend,a=r,i=a.a,s=a.b,u=o;rh([i,s],t);var c=u.data.get(i.dataId).values,l=u.data.get(s.dataId).values,h=e(i.shape,s.shape,c,l,i.dtype),d=h[0],f=h[1];return{dataId:u.write(d,f,i.dtype),shape:f,dtype:i.dtype}}}}function ch(t){return function(e,n,r,o,a){var i=or(e,n),s=i.length,u=et(i),c=V(a,N(i)),l=e.length,h=n.length,d=et(e),f=et(n),p=rr(e,i),m=rr(n,i);if(p.length+m.length===0)for(var g=0;g<c.length;++g)c[g]=t(r[g%r.length],o[g%o.length]);else{var v=function(e){var n=ht(e,s,u),a=n.slice(-l);p.forEach((function(t){return a[t]=0}));var i=lt(a,l,d),g=n.slice(-h);m.forEach((function(t){return g[t]=0}));var v=lt(g,h,f);c[e]=t(r[i],o[v])};for(g=0;g<c.length;++g)v(g)}return[c,i]}}zt.registerBackend("cpu",(function(){return new sh}),1);var lh=ch((function(t,e){return t/e})),hh=uh(Zn,lh),ph={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.attrs,r=t.backend,o=e.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;rh(o,"MaxPoolWithArgmax");var h=l.data.get(o.dataId).values,d=Ri(o.shape,i,s,[1,1],u),f=function(t,e,n,r,o){var a=ih(t,0,n,et(e),o,"max"),i=oh(t,e,n,o,!0,r);return[a.values,i.values]}(h,o.shape,o.dtype,c,d),p=f[0],m=f[1],g=l.write(p,d.outShape,o.dtype),v=l.write(m,d.outShape,o.dtype);return[{dataId:g,shape:d.outShape,dtype:o.dtype},{dataId:v,shape:d.outShape,dtype:"int32"}]}},dh={kernelName:"NonMaxSuppressionV5",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n;rh(a,"NonMaxSuppressionWithScore");var f=Qi(d.data.get(a.dataId).values,d.data.get(i.dataId).values,u,c,l,h);return[f.selectedIndices,f.selectedScores]}},fh={kernelName:"Square",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n;rh(r,"square");for(var a=o.data.get(r.dataId).values,i=new Float32Array(a.length),s=0;s<a.length;++s){var u=a[s];i[s]=u*u}return{dataId:o.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},mh=ch((function(t,e){var n=t-e;return n*n}));function gh(t,e,n,r,o){for(var a=N(e),i=e.length,s=et(e),u=et(o),c=V(n,N(o)),l=0;l<a;++l){for(var h=ht(l,i,s),d=new Array(h.length),f=0;f<d.length;f++)d[f]=h[r[f]];c[lt(d,i,u)]=t[l]}return c}for(var vh=0,yh=[dh,fh,uh(Qn,mh),hh,{kernelName:"Transpose",backendName:"cpu",kernelFunc:function(t){var e=t.inputs,n=t.attrs,r=t.backend,o=e.x,a=n.perm,i=r;rh(o,"transpose");for(var s=o.shape.length,u=new Array(s),c=0;c<u.length;c++)u[c]=o.shape[a[c]];var l=gh(i.data.get(o.dataId).values,o.shape,o.dtype,a,u);return{dataId:i.write(l,u,o.dtype),shape:u,dtype:o.dtype}}},ph];vh<yh.length;vh++)_(yh[vh]);for(var xh,bh=function(t){this.variableNames=["A"];var e=po(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2("+r+".0, "+n+".0);\n\n        vec4 values = "+e.texture2D+"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    "},wh=function(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var e=po(),n=t[0],r=t[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2("+r+".0, "+n+".0);\n            vec4 values = "+e.texture2D+"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        "+e.output+" = result;\n      }\n    "},_h=function(t,e){this.variableNames=["A"];for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;var o=Mo(this.rank),a=function(t){var e=t.length;if(e>6)throw Error("Transpose for rank "+e+" is not yet supported");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(e),o=0;o<t.length;o++)r[t[o]]=n[o];return r.join()}(e);this.userCode="\n    void main() {\n      "+o+" resRC = getOutputCoords();\n      setOutput(getA("+a+"));\n    }\n    "},Sh=function(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t[e[r]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error("Packed transpose for rank "+this.rank+" is not yet supported.");var o=Mo(this.rank),a=lo("rc",this.rank),i=new Array(this.rank);for(r=0;r<e.length;r++)i[e[r]]=a[r];var s="vec2("+i.slice(-2).join()+")",u="++"+a[this.rank-1]+" < "+n[this.rank-1],c="getChannel(getA("+i.join()+"), "+s+")";this.userCode="\n    void main() {\n      "+o+" rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = "+c+";\n      if("+u+") {\n        result[1] = "+c+";\n      }\n      --"+a[this.rank-1]+";\n      if(++"+a[this.rank-2]+" < "+n[this.rank-2]+") {\n        result[2] = "+c+";\n        if("+u+") {\n          result[3] = "+c+";\n        }\n      }\n      setOutput(result);\n    }\n    "},Mh=0,Eh=[{kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs,o=e.pixels,a=r.numChannels,s="undefined"!=typeof HTMLVideoElement&&o instanceof HTMLVideoElement,u="undefined"!=typeof HTMLImageElement&&o instanceof HTMLImageElement,c=s?[o.videoWidth,o.videoHeight]:[o.width,o.height],l=c[0],h=c[1],d=[h,l],f=[h,l,a];(u||s)&&(null==xh&&(xh=document.createElement("canvas").getContext("2d")),xh.canvas.width=l,xh.canvas.height=h,xh.drawImage(o,0,0,l,h),o=xh.canvas);var p=n.makeTensorInfo(d,"int32");n.texData.get(p.dataId).usage=Ht.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(p.dataId),o);var m=i().getBool("WEBGL_PACK")?new wh(f):new bh(f),g=n.runWebGLProgram(m,[p],"int32");return n.disposeData(p.dataId),g}},{kernelName:Zn,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e;return function(t,e,n){var r=new Po("\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",t.shape,e.shape);return i().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&(r=new Bo("\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",t.shape,e.shape,!0)),n.runWebGLProgram(r,[t,e],"float32")}(r.a,r.b,n)}},{kernelName:"NonMaxSuppressionV5",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=t.attrs;Je("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var o=e,a=o.boxes,i=o.scores,s=r,u=s.maxOutputSize,c=s.iouThreshold,l=s.scoreThreshold,h=s.softNmsSigma,d=n,f=Qi(d.readSync(a.dataId),d.readSync(i.dataId),u,c,l,h);return[f.selectedIndices,f.selectedScores]}},{kernelName:"Square",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e.x,o=n,a=new ys(r.shape,"return x * x;");return o.runWebGLProgram(a,[r],r.dtype)}},{kernelName:Qn,backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.backend,r=e,o=r.a,a=r.b,s=n,u=i().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Bo("return (a - b) * (a - b);",o.shape,a.shape):new Po("return (a - b) * (a - b);",o.shape,a.shape);return s.compileAndRun(u,[o,a])}},{kernelName:"Transpose",backendName:"webgl",kernelFunc:function(t){for(var e,n=t.inputs,r=t.attrs,o=t.backend,a=n.x,s=r.perm,u=o,c=a.shape.length,l=new Array(c),h=0;h<l.length;h++)l[h]=a.shape[s[h]];if(u.shouldExecuteOnCPU([a])){var d=gh(u.texData.get(a.dataId).values,a.shape,a.dtype,s,l);e=u.makeTensorInfo(l,a.dtype),u.texData.get(e.dataId).values=d}else e=function(t,e,n){var r=i().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Sh(t.shape,e):new _h(t.shape,e);return n.runWebGLProgram(r,[t],t.dtype)}(a,s,u);return e}},{kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(t){var e=t.inputs,n=t.attrs,r=t.backend,o=e.x,a=n,i=a.filterSize,s=a.strides,u=a.pad,c=a.includeBatchInIndex,l=r;A(4===o.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank "+o.shape.length+"."}));var h=[1,1];A(zi(s,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. Got strides "+s+" and dilations '"+h+"'"}));var d=Ri(o.shape,i,s,h,u),f=function(t,e,n,r){var o=new Ya(n,"max",!1),a=r.runWebGLProgram(o,[t],"float32");return o=new Ya(n,"max",!0,!0,e),[a,r.runWebGLProgram(o,[t],"float32")]}(o,c,d,l);return[f[0],f[1]]}}];Mh<Eh.length;Mh++)_(Eh[Mh]);for(var Th=0,Ah=[{kernelName:"Add",inputsToSave:["a","b"],gradFunc:function(t,e){var n=e[0],r=e[1],o=or(n.shape,r.shape);return{a:function(){var e=t,r=ir(n.shape,o);return r.length>0&&(e=e.sum(r)),e.reshape(n.shape)},b:function(){var e=t,n=ir(r.shape,o);return n.length>0&&(e=e.sum(n)),e.reshape(r.shape)}}}},{kernelName:"AddN",saveAllInputs:!0,gradFunc:function(t,e){var n={};return e.forEach((function(e,r){n[r]=function(){return t.clone()}})),n}},{kernelName:$n,gradFunc:function(t,e,n){for(var r=n,o=r.inputShape,a=r.shape,i=Array.from(a),s=o.length-1;s>=0;s--)if(o[s]===a[s])i[s]=1;else if(1!==o[s])throw new Error("broadcastTo(): ["+o+"] cannot be broadcast to ["+a+"].");var u=[];for(s=0;s<i.length;s++)i[s]>1&&u.push(s);return{x:function(){return t.sum(u,!0)}}}},{kernelName:Zn,inputsToSave:["a","b"],gradFunc:function(t,e){var n=e[0],r=e[1],o=or(n.shape,r.shape);return{a:function(){var e=oi(t,r.toFloat()),a=ir(n.shape,o);return a.length>0?th(e,a).reshape(n.shape):e},b:function(){var e=t.mul(n.toFloat()),a=ir(r.shape,o);a.length>0&&(e=th(e,a).reshape(r.shape));var i=Fu(r);return Tr(oi(e,i.toFloat()))}}}},{kernelName:"FusedBatchNorm",inputsToSave:["x","mean","variance","scale"],gradFunc:function(t,e,n){var r=n.varianceEpsilon,o=e[0],a=e[1],i=e[2],s=e[3],u=Ks(o),c=null==s?yn(1):s,l=ir(a.shape,u.shape),h=[];if(1===a.rank){for(var d=0;d<u.shape.length-1;++d)h.push(u.shape[d]);h.push(1)}var f=ri(o,a),p=Qr(t,c),m=Rr(nr(i,yn(r))),g=Qr(Qr(Qr(m,m),m),yn(-.5));return{x:function(){return 1===a.rank?Vn(Qr(Qr(t,yu(m.as4D(1,1,1,a.shape[0]),h)),c),o.shape):Vn(Qr(Qr(t,m),c),o.shape)},mean:function(){var t=Qr(Qr(m,yn(-1)),p);return 1===a.rank&&(t=th(t,l)),Vn(t,a.shape)},variance:function(){var t=Qr(Qr(g,f),p);return 1===a.rank&&(t=th(t,l)),Vn(t,a.shape)},scale:function(){var e=Qr(f,m),n=Qr(t,e);return 1===a.rank&&(n=th(n,l)),Vn(n,a.shape)},offset:function(){var e=t;return 1===a.rank&&(e=th(e,l)),Vn(e,a.shape)}}}},{kernelName:er,gradFunc:function(t){return{x:function(){return t.toFloat()}}}},{kernelName:"OneHot",inputsToSave:["indices"],gradFunc:function(t,e){var n=e[0];return{indices:function(){return Mn(n.shape,"float32")}}}},{kernelName:"PadV2",inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],o=n.paddings.map((function(t){return t[0]}));return{x:function(){return t.slice(o,r.shape)}}}},{kernelName:"Square",inputsToSave:["x"],gradFunc:function(t,e){var n=e[0];return{x:function(){return t.mul(n.toFloat().mul(2))}}}},{kernelName:Qn,inputsToSave:["a","b"],gradFunc:function(t,e){var n=e[0],r=e[1],o=yn(2);return{a:function(){return Qr(t,Qr(o,ri(n,r)))},b:function(){return Qr(t,Qr(o,ri(r,n)))}}}},{kernelName:"Tile",inputsToSave:["x"],gradFunc:function(t,e,n){var r=e[0],o=n.reps;return{x:function(){var e=Rn(r);if(1===r.rank)for(var n=0;n<o[0];++n)e=e.add(t.slice([n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(n=0;n<o[0];++n)for(var a=0;a<o[1];++a)e=e.add(t.slice([n*r.shape[0],a*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(var i=0;i<o[2];++i)e=e.add(t.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+r.rank+" tensors yet.");for(n=0;n<o[0];++n)for(a=0;a<o[1];++a)for(i=0;i<o[2];++i)for(var s=0;s<o[3];++s)e=e.add(t.slice([n*r.shape[0],a*r.shape[1],i*r.shape[2],s*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return e}}}},{kernelName:"Transpose",gradFunc:function(t,e,n){var r=un(n.perm);return{x:function(){return Ei(t,r)}}}}];Th<Ah.length;Th++)p(Ah[Th]);var Ch=function(){function t(){}return t.prototype.fetch=function(t,e){return fetch(t,e)},t.prototype.now=function(){return performance.now()},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Browser's encoder only supports utf-8, but got "+e);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return new TextDecoder(e).decode(t)},t}();i().get("IS_BROWSER")&&i().setPlatform("browser",new Ch);var Rh,Ih=function(){function t(){this.util=n(187),this.textEncoder=new this.util.TextEncoder}return t.prototype.fetch=function(t,e){return null!=i().global.fetch?i().global.fetch(t,e):(null==Rh&&(Rh=n(186)),Rh(t,e))},t.prototype.now=function(){var t=r.hrtime();return 1e3*t[0]+t[1]/1e6},t.prototype.encode=function(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error("Node built-in encoder only supports utf-8, but got "+e);return this.textEncoder.encode(t)},t.prototype.decode=function(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)},t}();i().get("IS_NODE")&&i().setPlatform("node",new Ih);var Nh={float32:4,int32:4,uint16:2,uint8:1,bool:1};function Oh(t,e){for(var n={},r=0,o=function(e){var o=e.name,a=e.dtype,i=e.shape,s=N(i),u=void 0;if("quantization"in e){var c=e.quantization;if("uint8"!==c.dtype&&"uint16"!==c.dtype)throw new Error("Weight "+e.name+" has unknown quantization dtype "+c.dtype+". Supported quantization dtypes are: 'uint8' and 'uint16'.");var l=Nh[c.dtype],h=t.slice(r,r+s*l),d="uint8"===c.dtype?new Uint8Array(h):new Uint16Array(h);if("float32"===a)u=Float32Array.from(d,(function(t){return t*c.scale+c.min}));else{if("int32"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=Int32Array.from(d,(function(t){return Math.round(t*c.scale+c.min)}))}r+=s*l}else if("string"===a){var f=N(e.shape);u=[];for(var p=0;p<f;p++){var m=new Uint32Array(t.slice(r,r+4))[0];r+=4;var g=new Uint8Array(t.slice(r,r+m));u.push(g),r+=m}}else{var v=Nh[a];if(h=t.slice(r,r+s*v),"float32"===a)u=new Float32Array(h);else if("int32"===a)u=new Int32Array(h);else{if("bool"!==a)throw new Error("Unsupported dtype in weight '"+o+"': "+a);u=new Uint8Array(h)}r+=s*v}n[o]=gn(u,i,a)},a=0,i=e;a<i.length;a++)o(i[a]);return n}function Dh(t){if(null===t)throw new Error("Invalid input value: "+JSON.stringify(t));var e=0,n=[];t.forEach((function(t){if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: "+t.constructor.name)}));var r=new Uint8Array(e),o=0;return n.forEach((function(t){r.set(new Uint8Array(t.buffer),o),o+=t.byteLength})),r.buffer}var Lh=void 0!==o&&("undefined"==typeof Blob||"undefined"==typeof atob||"undefined"==typeof btoa);function kh(t){return Lh?o.byteLength(t):new Blob([t]).size}function Ph(t){var e=0;t.forEach((function(t){e+=t.byteLength}));var n=new Uint8Array(e),r=0;return t.forEach((function(t){n.set(new Uint8Array(t),r),r+=t.byteLength})),n.buffer}function Fh(t){for(t=t.trim();t.endsWith("/");)t=t.slice(0,t.length-1);var e=t.split("/");return e[e.length-1]}function Bh(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:kh(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:kh(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}var zh=function(){function t(){this.saveRouters=[],this.loadRouters=[]}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerSaveRouter=function(e){t.getInstance().saveRouters.push(e)},t.registerLoadRouter=function(e){t.getInstance().loadRouters.push(e)},t.getSaveHandlers=function(e){return t.getHandlers(e,"save")},t.getLoadHandlers=function(e,n){return t.getHandlers(e,"load",n)},t.getHandlers=function(e,n,r){var o=[];return("load"===n?t.getInstance().loadRouters:t.getInstance().saveRouters).forEach((function(t){var n=t(e,r);null!==n&&o.push(n)})),o},t}(),Uh="://",Vh=function(){function t(){this.managers={}}return t.getInstance=function(){return null==t.instance&&(t.instance=new t),t.instance},t.registerManager=function(e,n){A(null!=e,(function(){return"scheme must not be undefined or null."})),e.endsWith(Uh)&&(e=e.slice(0,e.indexOf(Uh))),A(e.length>0,(function(){return"scheme must not be an empty string."}));var r=t.getInstance();A(null==r.managers[e],(function(){return"A model store manager is already registered for scheme '"+e+"'."})),r.managers[e]=n},t.getManager=function(t){var e=this.getInstance().managers[t];if(null==e)throw new Error("Cannot find model manager for scheme '"+t+"'");return e},t.getSchemes=function(){return Object.keys(this.getInstance().managers)},t}();function td(t){if(-1===t.indexOf(Uh))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+Vh.getSchemes().join(","));return{scheme:t.split(Uh)[0],path:t.split(Uh)[1]}}function Gh(t,e,n){return void 0===n&&(n=!1),d(this,void 0,void 0,(function(){var r,a,i,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:return A(t!==e,(function(){return"Old path and new path are the same: '"+t+"'"})),A((r=zh.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL "+t+"."})),A(r.length<2,(function(){return"Copying failed because more than one ("+r.length+") load handlers for source URL "+t+"."})),a=r[0],A((i=zh.getSaveHandlers(e)).length>0,(function(){return"Copying failed because no save handler is found for destination URL "+e+"."})),A(i.length<2,(function(){return"Copying failed because more than one ("+r.length+") save handlers for destination URL "+e+"."})),s=i[0],u=td(t).scheme,o=td(t).path,c=u===td(t).scheme,[4,a.load()];case 1:return l=d.sent(),n&&c?[4,Vh.getManager(u).removeModel(o)]:[3,3];case 2:d.sent(),d.label=3;case 3:return[4,s.save(l)];case 4:return h=d.sent(),!n||c?[3,6]:[4,Vh.getManager(u).removeModel(o)];case 5:d.sent(),d.label=6;case 6:return[2,h.modelArtifactsInfo]}}))}))}var Hh="models_store",jh="model_info_store";function Wh(){if(!i().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var t=window||self,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function qh(t){var e=t.result;e.createObjectStore(Hh,{keyPath:"modelPath"}),e.createObjectStore(jh,{keyPath:"modelPath"})}var Xh=function(){function t(t){if(this.indexedDB=Wh(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return t.prototype.save=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return[2,this.databaseAction(this.modelPath,t)]}))}))},t.prototype.load=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){return[2,this.databaseAction(this.modelPath)]}))}))},t.prototype.databaseAction=function(t,e){var n=this;return new Promise((function(t,r){var o=n.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return qh(o)},o.onsuccess=function(){var a=o.result;if(null==e){var i=a.transaction(Hh,"readonly"),s=i.objectStore(Hh).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return a.close(),r(new Error("Cannot find model with path '"+n.modelPath+"' in IndexedDB."));t(s.result.modelArtifacts)},s.onerror=function(t){return a.close(),r(s.error)},i.oncomplete=function(){return a.close()}}else{var u,c=Bh(e),l=a.transaction(jh,"readwrite"),h=l.objectStore(jh),d=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});d.onsuccess=function(){var o=(u=a.transaction(Hh,"readwrite")).objectStore(Hh).put({modelPath:n.modelPath,modelArtifacts:e,modelArtifactsInfo:c});o.onsuccess=function(){return t({modelArtifactsInfo:c})},o.onerror=function(t){var e=(h=l.objectStore(jh)).delete(n.modelPath);e.onsuccess=function(){return a.close(),r(o.error)},e.onerror=function(t){return a.close(),r(o.error)}}},d.onerror=function(t){return a.close(),r(d.error)},l.oncomplete=function(){null==u?a.close():u.oncomplete=function(){return a.close()}}}},o.onerror=function(t){return r(o.error)}}))},t.URL_SCHEME="indexeddb://",t}(),Yh=function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Xh.URL_SCHEME)?(e=t.slice(Xh.URL_SCHEME.length),new Xh(e)):null;var e};zh.registerSaveRouter(Yh),zh.registerLoadRouter(Yh);var Kh=function(){function t(){this.indexedDB=Wh()}return t.prototype.listModels=function(){return d(this,void 0,void 0,(function(){var t=this;return f(this,(function(e){return[2,new Promise((function(e,n){var r=t.indexedDB.open("tensorflowjs",1);r.onupgradeneeded=function(){return qh(r)},r.onsuccess=function(){var t=r.result,o=t.transaction(jh,"readonly"),a=o.objectStore(jh).getAll();a.onsuccess=function(){for(var t={},n=0,r=a.result;n<r.length;n++){var o=r[n];t[o.modelPath]=o.modelArtifactsInfo}e(t)},a.onerror=function(e){return t.close(),n(a.error)},o.oncomplete=function(){return t.close()}},r.onerror=function(t){return n(r.error)}}))]}))}))},t.prototype.removeModel=function(t){return d(this,void 0,void 0,(function(){var e=this;return f(this,(function(n){var r;return t=(r=t).startsWith(Xh.URL_SCHEME)?r.slice(Xh.URL_SCHEME.length):r,[2,new Promise((function(n,r){var o=e.indexedDB.open("tensorflowjs",1);o.onupgradeneeded=function(){return qh(o)},o.onsuccess=function(){var e,a=o.result,i=a.transaction(jh,"readwrite"),s=i.objectStore(jh),u=s.get(t);u.onsuccess=function(){if(null==u.result)return a.close(),r(new Error("Cannot find model with path '"+t+"' in IndexedDB."));var o=s.delete(t),i=function(){var o=(e=a.transaction(Hh,"readwrite")).objectStore(Hh).delete(t);o.onsuccess=function(){return n(u.result.modelArtifactsInfo)},o.onerror=function(t){return r(u.error)}};o.onsuccess=i,o.onerror=function(t){return i(),a.close(),r(u.error)}},u.onerror=function(t){return a.close(),r(u.error)},i.oncomplete=function(){null==e?a.close():e.oncomplete=function(){return a.close()}}},o.onerror=function(t){return r(o.error)}}))]}))}))},t}();if(i().getBool("IS_BROWSER"))try{Vh.registerManager(Xh.URL_SCHEME,new Kh)}catch(l){}var Jh="/",Zh="tensorflowjs_models",Qh="info",$h="model_topology",dd="weight_specs",tp="weight_data",ep="model_metadata";function np(t){return{info:[Zh,t,Qh].join(Jh),topology:[Zh,t,$h].join(Jh),weightSpecs:[Zh,t,dd].join(Jh),weightData:[Zh,t,tp].join(Jh),modelMetadata:[Zh,t,ep].join(Jh)}}function ip(t){var e=t.split(Jh);if(e.length<3)throw new Error("Invalid key format: "+t);return e.slice(1,e.length-1).join(Jh)}var op=function(){function t(t){if(!i().getBool("IS_BROWSER")||"undefined"==typeof window||void 0===window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=np(this.modelPath)}return t.prototype.save=function(t){return d(this,void 0,void 0,(function(){var e,n,r;return f(this,(function(c){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");e=JSON.stringify(t.modelTopology),n=JSON.stringify(t.weightSpecs),r=Bh(t);try{return this.LS.setItem(this.keys.info,JSON.stringify(r)),this.LS.setItem(this.keys.topology,e),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,function(t){if(Lh)return o.from(t).toString("base64");for(var e=new Uint8Array(t),n="",r=0,c=e.length;r<c;r++)n+=String.fromCharCode(e[r]);return btoa(n)}(t.weightData)),this.LS.setItem(this.keys.modelMetadata,JSON.stringify({format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata})),[2,{modelArtifactsInfo:r}]}catch(t){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '"+this.modelPath+"' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes="+r.modelTopologyBytes+", weightSpecsBytes="+r.weightSpecsBytes+", weightDataBytes="+r.weightDataBytes+".")}return[2]}))}))},t.prototype.load=function(){return d(this,void 0,void 0,(function(){var t,e,n,r,a,i,s;return f(this,(function(c){if(null==(t=JSON.parse(this.LS.getItem(this.keys.info))))throw new Error("In local storage, there is no model with name '"+this.modelPath+"'");if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");if(e={},null==(n=JSON.parse(this.LS.getItem(this.keys.topology))))throw new Error("In local storage, the topology of model '"+this.modelPath+"' is missing.");if(e.modelTopology=n,null==(r=JSON.parse(this.LS.getItem(this.keys.weightSpecs))))throw new Error("In local storage, the weight specs of model '"+this.modelPath+"' are missing.");if(e.weightSpecs=r,null!=(a=this.LS.getItem(this.keys.modelMetadata))&&(i=JSON.parse(a),e.format=i.format,e.generatedBy=i.generatedBy,e.convertedBy=i.convertedBy,e.userDefinedMetadata=i.userDefinedMetadata),null==(s=this.LS.getItem(this.keys.weightData)))throw new Error("In local storage, the binary weight values of model '"+this.modelPath+"' are missing.");return e.weightData=function(t){if(Lh){var e=o.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}for(var n=atob(t),r=new Uint8Array(n.length),c=0;c<n.length;++c)r.set([n.charCodeAt(c)],c);return r.buffer}(s),[2,e]}))}))},t.URL_SCHEME="localstorage://",t}(),ap=function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(op.URL_SCHEME)?(e=t.slice(op.URL_SCHEME.length),new op(e)):null;var e};zh.registerSaveRouter(ap),zh.registerLoadRouter(ap);var sp=function(){function t(){A(i().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),A("undefined"==typeof window||void 0!==window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return t.prototype.listModels=function(){return d(this,void 0,void 0,(function(){var t,e,n,r,a,i;return f(this,(function(o){for(t={},e=Zh+Jh,n=Jh+Qh,r=0;r<this.LS.length;++r)(a=this.LS.key(r)).startsWith(e)&&a.endsWith(n)&&(i=ip(a),t[i]=JSON.parse(this.LS.getItem(a)));return[2,t]}))}))},t.prototype.removeModel=function(t){return d(this,void 0,void 0,(function(){var e,n;return f(this,(function(r){var o;if(t=(o=t).startsWith(op.URL_SCHEME)?o.slice(op.URL_SCHEME.length):o,e=np(t),null==this.LS.getItem(e.info))throw new Error("Cannot find model at path '"+t+"'");return n=JSON.parse(this.LS.getItem(e.info)),this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),[2,n]}))}))},t}();if(i().getBool("IS_BROWSER"))try{Vh.registerManager(op.URL_SCHEME,new sp)}catch(l){}function up(t){return new Promise((function(t){return setTimeout(t)})).then(t)}var cp=function(){function t(e){if(!i().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(t.URL_SCHEME)&&(e=e.slice(t.URL_SCHEME.length)),null!=e&&0!==e.length||(e="model"),this.modelTopologyFileName=e+".json",this.weightDataFileName=e+".weights.bin"}return t.prototype.save=function(t){return d(this,void 0,void 0,(function(){var e,n,r,a,i,s;return f(this,(function(o){switch(o.label){case 0:if("undefined"==typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");if(e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer))return[3,1];throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 1:return n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n},a=window.URL.createObjectURL(new Blob([JSON.stringify(r)],{type:"application/json"})),(i=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,i.href=a,[4,up((function(){return i.dispatchEvent(new MouseEvent("click"))}))];case 2:return o.sent(),null==t.weightData?[3,4]:((s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=e,[4,up((function(){return s.dispatchEvent(new MouseEvent("click"))}))]);case 3:o.sent(),o.label=4;case 4:return[2,{modelArtifactsInfo:Bh(t)}]}}))}))},t.URL_SCHEME="downloads://",t}(),lp=function(){function t(t){if(null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, but received "+t);this.files=t}return t.prototype.load=function(){return d(this,void 0,void 0,(function(){var t,e,n=this;return f(this,(function(r){return t=this.files[0],e=this.files.slice(1),[2,new Promise((function(r,o){var a=new FileReader;a.onload=function(a){var i=JSON.parse(a.target.result),s=i.modelTopology;if(null!=s){0===e.length&&r({modelTopology:s});var u=i.weightsManifest;if(null!=u){var c;try{c=n.checkManifestAndWeightFiles(u,e)}catch(t){return void o(t)}var l=[],h=[],d=[];u.forEach((function(t){t.paths.forEach((function(t){h.push(t),d.push(null)})),l.push.apply(l,t.weights)})),u.forEach((function(t){t.paths.forEach((function(t){var e=new FileReader;e.onload=function(e){var n=e.target.result,o=h.indexOf(t);d[o]=n,-1===d.indexOf(null)&&r({modelTopology:s,weightSpecs:l,weightData:Ph(d),format:i.format,generatedBy:i.generatedBy,convertedBy:i.convertedBy,userDefinedMetadata:i.userDefinedMetadata})},e.onerror=function(e){return o("Failed to weights data from file of path '"+t+"'.")},e.readAsArrayBuffer(c[t])}))}))}else o(new Error("weightManifest field is missing from file "+t.name))}else o(new Error("modelTopology field is missing from file "+t.name))},a.onerror=function(e){return o("Failed to read model topology and weights manifest JSON from file '"+t.name+"'. BrowserFiles supports loading Keras-style tf.Model artifacts only.")},a.readAsText(t)}))]}))}))},t.prototype.checkManifestAndWeightFiles=function(t,e){for(var n=[],r=e.map((function(t){return Fh(t.name)})),o={},a=0,i=t;a<i.length;a++)i[a].paths.forEach((function(t){var a=Fh(t);if(-1!==n.indexOf(a))throw new Error("Duplicate file basename found in weights manifest: '"+a+"'");if(n.push(a),-1===r.indexOf(a))throw new Error("Weight file with basename '"+a+"' is not provided.");o[t]=e[r.indexOf(a)]}));if(n.length!==e.length)throw new Error("Mismatch in the number of files in weights manifest ("+n.length+") and the number of weight files provided ("+e.length+").");return o},t}();function hp(t,e,n,r){!function(t){A(null!=t&&Array.isArray(t)&&t.length>0,(function(){return"promises must be a none empty array"}))}(t),function(t,e){A(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but got startFraction "+t})),A(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but got endFraction "+e})),A(e>=t,(function(){return"startFraction must be no more than endFraction, but got startFraction "+t+" and endFraction "+e}))}(n=null==n?0:n,r=null==r?1:r);var o=0;return Promise.all(t.map((function(a){return a.then((function(a){var i=n+ ++o/t.length*(r-n);return e(i),a})),a})))}function pp(t,e){return d(this,void 0,void 0,(function(){var n,r,a,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:return null==e&&(e={}),n=null==e.fetchFunc?i().platform.fetch:e.fetchFunc,r=t.map((function(t){return n(t,e.requestInit,{isBinary:!0})})),a=0,s=.5,null!=e.onProgress?[3,2]:[4,Promise.all(r)];case 1:return u=d.sent(),[3,4];case 2:return[4,hp(r,e.onProgress,a,s)];case 3:u=d.sent(),d.label=4;case 4:return o=u.map((function(t){return t.arrayBuffer()})),c=.5,l=1,null!=e.onProgress?[3,6]:[4,Promise.all(o)];case 5:return h=d.sent(),[3,8];case 6:return[4,hp(o,e.onProgress,c,l)];case 7:h=d.sent(),d.label=8;case 8:return[2,h]}}))}))}function dp(t){var e=this;return function(n,a,i){return void 0===a&&(a=""),d(e,void 0,void 0,(function(){var e,r,s,u,o,c,l,h,d,p;return f(this,(function(f){switch(f.label){case 0:if(e=n.map((function(){return!1})),r={},s=null!=i?i.map((function(){return!1})):[],u=[],n.forEach((function(t,n){var o=0;t.weights.forEach((function(t){var a="quantization"in t?t.quantization.dtype:t.dtype,c=Nh[a]*N(t.shape),l=function(){e[n]=!0,null==r[n]&&(r[n]=[]),r[n].push({manifestEntry:t,groupOffset:o,sizeBytes:c})};null!=i?i.forEach((function(e,n){e===t.name&&(l(),s[n]=!0)})):l(),u.push(t.name),o+=c}))})),!s.every((function(t){return t})))throw o=i.filter((function(t,e){return!s[e]})),new Error("Could not find weights in manifest with names: "+o.join(", ")+". \nManifest JSON has weights with names: "+u.join(", ")+".");return c=e.reduce((function(t,e,n){return e&&t.push(n),t}),[]),l=[],c.forEach((function(t){n[t].paths.forEach((function(t){var e=a+(a.endsWith("/")?"":"/")+t;l.push(e)}))})),[4,t(l)];case 1:return h=f.sent(),d={},p=0,c.forEach((function(t){for(var e=n[t].paths.length,o=0,a=0;a<e;a++)o+=h[p+a].byteLength;for(var i=new ArrayBuffer(o),s=new Uint8Array(i),u=0,c=0;c<e;c++){var l=new Uint8Array(h[p+c]);s.set(l,u),u+=l.byteLength}r[t].forEach((function(t){var e=Oh(i.slice(t.groupOffset,t.groupOffset+t.sizeBytes),[t.manifestEntry]);for(var n in e)d[n]=e[n]})),p+=e})),[2,d]}}))}))}}zh.registerSaveRouter((function(t){return i().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(cp.URL_SCHEME)?function(t){return void 0===t&&(t="model"),new cp(t)}(t.slice(cp.URL_SCHEME.length)):null}));var fp=function(){function t(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,null!=e.fetchFunc?(A("function"==typeof e.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=e.fetchFunc):this.fetch=i().platform.fetch,A(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&A(2===t.length,(function(){return"URL paths for http must have a length of 2, (actual length is "+t.length+")."})),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}return t.prototype.save=function(t){return d(this,void 0,void 0,(function(){var e,n,r,a;return f(this,(function(o){switch(o.label){case 0:if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");return(e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,userDefinedMetadata:t.userDefinedMetadata,weightsManifest:n},e.body.append("model.json",new Blob([JSON.stringify(r)],{type:"application/json"}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),[4,this.fetch(this.path,e)];case 1:if((a=o.sent()).ok)return[2,{modelArtifactsInfo:Bh(t),responses:[a]}];throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+a.status+".")}}))}))},t.prototype.load=function(){return d(this,void 0,void 0,(function(){var t,e,n,r,a,i,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:return[4,this.fetch(this.path,this.requestInit)];case 1:if(!(t=d.sent()).ok)throw new Error("Request to "+this.path+" failed with status code "+t.status+". Please verify this URL points to the model JSON of the model to load.");d.label=2;case 2:return d.trys.push([2,4,,5]),[4,t.json()];case 3:return e=d.sent(),[3,5];case 4:throw d.sent(),n="Failed to parse model JSON of response from "+this.path+".",this.path.endsWith(".pb")?n+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":n+=" Please make sure the server is serving valid JSON for this request.",new Error(n);case 5:if(r=e.modelTopology,a=e.weightsManifest,i=e.generatedBy,s=e.convertedBy,u=e.format,o=e.userDefinedMetadata,null==r&&null==a)throw new Error("The JSON from HTTP path "+this.path+" contains neither model topology or manifest for weights.");return null==a?[3,7]:[4,this.loadWeights(a)];case 6:h=d.sent(),c=h[0],l=h[1],d.label=7;case 7:return[2,{modelTopology:r,weightSpecs:c,weightData:l,userDefinedMetadata:o,generatedBy:i,convertedBy:s,format:u}]}}))}))},t.prototype.loadWeights=function(t){return d(this,void 0,void 0,(function(){var e,n,r,a,i,s,u,o,c,l,h;return f(this,(function(d){switch(d.label){case 0:for(e=Array.isArray(this.path)?this.path[1]:this.path,n=function(t){var e=t.lastIndexOf("/"),n=t.lastIndexOf("?");return[t.substring(0,e)+"/",n>e?t.substring(n):""]}(e),r=n[0],a=n[1],i=this.weightPathPrefix||r,s=[],u=0,o=t;u<o.length;u++)c=o[u],s.push.apply(s,c.weights);return l=[],t.forEach((function(t){t.paths.forEach((function(t){l.push(i+t+a)}))})),[4,pp(l,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress})];case 1:return h=d.sent(),[2,[s,Ph(h)]]}}))}))},t.URL_SCHEME_REGEX=/^https?:\/\//,t}();function mp(t){return null!=t.match(fp.URL_SCHEME_REGEX)}var gp=function(t,e){return"undefined"==typeof fetch?null:(Array.isArray(t)?t.every((function(t){return mp(t)})):mp(t))?vp(t,{onProgress:e}):null};function vp(t,e){return new fp(t,e)}zh.registerSaveRouter(gp),zh.registerLoadRouter(gp);var yp,xp=function(){function t(t){this.modelArtifacts=t}return t.prototype.load=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){return[2,this.modelArtifacts]}))}))},t}(),bp=function(){function t(t){this.saveHandler=t}return t.prototype.save=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){return[2,this.saveHandler(t)]}))}))},t}(),wp=Object.freeze({browserFiles:function(t){return new lp(t)},browserHTTPRequest:function(t,e){return vp(t,e)},concatenateArrayBuffers:Ph,decodeWeights:Oh,encodeWeights:function(t,e){return d(this,void 0,void 0,(function(){var n,a,i,s,u,r=this;return f(this,(function(o){switch(o.label){case 0:for(n=[],a=[],i=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t),s=function(s){var u=i[s],o=Array.isArray(t)?t[s].tensor:t[u];if("float32"!==o.dtype&&"int32"!==o.dtype&&"bool"!==o.dtype&&"string"!==o.dtype)throw new Error("Unsupported dtype in weight '"+u+"': "+o.dtype);var c={name:u,shape:o.shape,dtype:o.dtype};if("string"===o.dtype){var l=new Promise((function(t){return d(r,void 0,void 0,(function(){var e,n,r,a,i,s,u;return f(this,(function(c){switch(c.label){case 0:return[4,o.bytes()];case 1:for(e=c.sent(),n=e.reduce((function(t,e){return t+e.length}),0)+4*e.length,r=new Uint8Array(n),a=0,i=0;i<e.length;i++)s=e[i],u=new Uint8Array(new Uint32Array([s.length]).buffer),r.set(u,a),a+=4,r.set(s,a),a+=s.length;return t(r),[2]}}))}))}));a.push(l)}else a.push(o.data());null!=e&&(c.group=e),n.push(c)},u=0;u<i.length;++u)s(u);return[4,Promise.all(a)];case 1:return[2,{data:Dh(o.sent()),specs:n}]}}))}))},fromMemory:function(t,e,n,r){return 1===arguments.length?null!=t.modelTopology||null!=t.weightSpecs?new xp(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xp({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new xp({modelTopology:t,weightSpecs:e,weightData:n,trainingConfig:r}))},getLoadHandlers:function(t,e){return zh.getLoadHandlers(t,e)},getModelArtifactsInfoForJSON:Bh,getSaveHandlers:function(t){return zh.getSaveHandlers(t)},http:vp,isHTTPScheme:mp,loadWeights:function(t,e,n,a){return void 0===e&&(e=""),d(this,void 0,void 0,(function(){return f(this,(function(r){return[2,dp((function(t){return pp(t,{requestInit:a})}))(t,e,n)]}))}))},registerLoadRouter:function(t){return zh.registerLoadRouter(t)},registerSaveRouter:function(t){return zh.registerSaveRouter(t)},weightsLoaderFactory:dp,withSaveHandler:function(t){return new bp(t)},copyModel:function(t,e){return d(this,void 0,void 0,(function(){return f(this,(function(n){return[2,Gh(t,e,!1)]}))}))},listModels:function(){return d(this,void 0,void 0,(function(){var t,e,n,r,a,i,s;return f(this,(function(o){switch(o.label){case 0:t=Vh.getSchemes(),e={},n=0,r=t,o.label=1;case 1:return n<r.length?(a=r[n],[4,Vh.getManager(a).listModels()]):[3,4];case 2:for(s in i=o.sent())e[a+Uh+s]=i[s];o.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},moveModel:function(t,e){return d(this,void 0,void 0,(function(){return f(this,(function(n){return[2,Gh(t,e,!0)]}))}))},removeModel:function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){return e=td(t),[2,Vh.getManager(e.scheme).removeModel(e.path)]}))}))}}),_p=pn({confusionMatrix_:function(t,e,n){var r=$e(t,"labels","confusionMatrix"),o=$e(e,"predictions","confusionMatrix");A(null==n||n>0&&Number.isInteger(n),(function(){return"If provided, numClasses must be a positive integer, but got "+n})),A(1===r.rank,(function(){return"Expected the rank of labels to be 1, but got "+r.rank})),A(1===o.rank,(function(){return"Expected the rank of predictions to be 1, but got "+o.rank})),A(r.shape[0]===o.shape[0],(function(){return"Mismatch in the number of examples: "+r.shape[0]+" vs. "+o.shape[0]+". Labels and predictions should have the same number of elements."})),A(n>0&&Number.isInteger(n),(function(){return"numClasses is required to be a positive integer, but got "+n}));var a=wu(r.asType("int32"),n),i=wu(o.asType("int32"),n);return a.transpose().matMul(i).asType("int32")}}),Sp=(Object.freeze({confusionMatrix:_p}),pn({fromPixels_:function(t,e){if(void 0===e&&(e=3),e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,o=!1,a=!1,i=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!=typeof ImageData&&t instanceof ImageData)r=!0;else if("undefined"!=typeof HTMLVideoElement&&t instanceof HTMLVideoElement)o=!0;else if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement)a=!0;else{if(null==t.getContext)throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was "+t.constructor.name);i=!0}if(o&&o&&t.readyState<2)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.");if(null!=y("FromPixels",zt.backendName))return zt.runKernel("FromPixels",{pixels:t},{numChannels:e});var s,u,c=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],l=c[0],h=c[1];if(i?s=t.getContext("2d").getImageData(0,0,l,h).data:r||n?s=t.data:(a||o)&&(null==yp&&(yp=document.createElement("canvas").getContext("2d")),yp.canvas.width=l,yp.canvas.height=h,yp.drawImage(t,0,0,l,h),s=yp.getImageData(0,0,l,h).data),4===e)u=new Int32Array(s);else{var d=l*h;u=new Int32Array(d*e);for(var p=0;p<d;p++)for(var f=0;f<e;++f)u[p*e+f]=s[4*p+f]}return wn(u,[h,l,e],"int32")}})),Mp=Object.freeze({toPixels:function(t,e){return d(this,void 0,void 0,(function(){var n,r,a,i,s,u,o,c,l,h,d,p,m,g,v,y,x,b,w,_,S,M,E;return f(this,(function(f){switch(f.label){case 0:if(n=$e(t,"img","toPixels"),t instanceof St||(n=n.toInt()),2!==n.rank&&3!==n.rank)throw new Error("toPixels only supports rank 2 or 3 tensors, got rank "+n.rank+".");if(r=n.shape.slice(0,2),a=r[0],i=r[1],(s=2===n.rank?1:n.shape[2])>4||2===s)throw new Error("toPixels only supports depth of size 1, 3 or 4 but got "+s);return[4,n.data()];case 1:return u=f.sent(),o=n.min(),c=n.max(),[4,Promise.all([o.data(),c.data()])];case 2:if(l=f.sent(),h=l[0],d=l[1],p=h[0],m=d[0],o.dispose(),c.dispose(),"float32"===n.dtype){if(p<0||m>1)throw new Error("Tensor values for a float32 Tensor must be in the range [0 - 1] but got range ["+p+" - "+m+"].")}else{if("int32"!==n.dtype)throw new Error("Unsupported type for toPixels: "+n.dtype+". Please use float32 or int32 tensors.");if(p<0||m>255)throw new Error("Tensor values for a int32 Tensor must be in the range [0 - 255] but got range ["+p+" - "+m+"].")}for(g="float32"===n.dtype?255:1,v=new Uint8ClampedArray(i*a*4),y=0;y<a*i;++y)x=void 0,b=void 0,w=void 0,_=void 0,1===s?(x=u[y]*g,b=u[y]*g,w=u[y]*g,_=255):3===s?(x=u[3*y]*g,b=u[3*y+1]*g,w=u[3*y+2]*g,_=255):4===s&&(x=u[4*y]*g,b=u[4*y+1]*g,w=u[4*y+2]*g,_=u[4*y+3]*g),v[0+(S=4*y)]=Math.round(x),v[S+1]=Math.round(b),v[S+2]=Math.round(w),v[S+3]=Math.round(_);return null!=e&&(e.width=i,e.height=a,M=e.getContext("2d"),E=new ImageData(v,i,a),M.putImageData(E,0,0)),n!==t&&n.dispose(),[2,v]}}))}))},fromPixels:Sp}),Ep=function(){function t(){}return t.prototype.getClassName=function(){return this.constructor.className},t.fromConfig=function(t,e){return new t(e)},t}(),Tp=function(){function t(){this.classNameMap={}}return t.getMap=function(){return null==t.instance&&(t.instance=new t),t.instance},t.register=function(e){t.getMap().classNameMap[e.className]=[e,e.fromConfig]},t}();function Ap(t){A(null!=t.className,(function(){return"Class being registered does not have the static className property defined."})),A("string"==typeof t.className,(function(){return"className is required to be a string, but got type "+typeof t.className})),A(t.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),Tp.register(t)}Object.freeze({Serializable:Ep,SerializationMap:Tp,registerClass:Ap}),Object.freeze({gpgpu_util:Da,webgl_util:Ge,forceHalfFloat:function(){i().set("WEBGL_FORCE_F16_TEXTURES",!0)},MathBackendWebGL:Fs,setWebGLContext:Xt,GPGPUContext:La});var Cp=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return h(e,t),e.prototype.minimize=function(t,e,n){void 0===e&&(e=!1);var r=this.computeGradients(t,n),o=r.value,a=r.grads;if(null!=n){var i=n.map((function(t){return{name:t.name,tensor:a[t.name]}}));this.applyGradients(i)}else this.applyGradients(a);return Xe(a),e?o:(o.dispose(),null)},Object.defineProperty(e.prototype,"iterations",{get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_},enumerable:!0,configurable:!0}),e.prototype.incrementIterations=function(){this.iterations_=this.iterations+1},e.prototype.computeGradients=function(t,e){return function(t,e){A($(t),(function(){return"The f passed in variableGrads(f) must be a function"})),A(null==e||Array.isArray(e)&&e.every((function(t){return t instanceof Rt})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=e;if(!n)for(var r in e=[],zt.registeredVariables)e.push(zt.registeredVariables[r]);var o=n?e.filter((function(t){return!t.trainable})):null,a=e.length;A((e=e.filter((function(t){return t.trainable}))).length>0,(function(){return"variableGrads() expects at least one of the input variables to be trainable, but none of the "+a+" variables is trainable."}));var i=zt.gradients(t,e,null,!0),s=i.value,u=i.grads;A(u.some((function(t){return null!=t})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),A(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it returned a rank-"+s.rank+" tensor"}));var c={};return e.forEach((function(t,e){null!=u[e]&&(c[t.name]=u[e])})),null!=o&&o.forEach((function(t){return c[t.name]=null})),{value:s,grads:c}}(t,e)},e.prototype.dispose=function(){null!=this.iterations_&&Xe(this.iterations_)},e.prototype.saveIterations=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){return null==this.iterations_&&(this.iterations_=0),[2,{name:"iter",tensor:yn(this.iterations_,"int32")}]}))}))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){throw new Error("getWeights() is not implemented for this optimizer yet.")}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(t){throw new Error("setWeights() is not implemented for this optimizer class "+this.getClassName())}))}))},e.prototype.extractIterations=function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:return e=this,[4,t[0].tensor.data()];case 1:return e.iterations_=n.sent()[0],[2,t.slice(1)]}}))}))},e}(Ep);Object.defineProperty(Cp,Symbol.hasInstance,{value:function(t){return null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients}});var Rp=function(t){function e(e,n,r){void 0===r&&(r=null);var o=t.call(this)||this;return o.learningRate=e,o.rho=n,o.epsilon=r,o.accumulatedGrads=[],o.accumulatedUpdates=[],null==r&&(o.epsilon=zt.backend.epsilon()),o}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=zt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accum_grad",variable:qe((function(){return Rn(o).variable(!1)}))}),null==e.accumulatedUpdates[r]&&(e.accumulatedUpdates[r]={originalName:n+"/accum_var",variable:qe((function(){return Rn(o).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedGrads[r].variable,s=e.accumulatedUpdates[r].variable;qe((function(){var t=i.mul(e.rho).add(a.square().mul(1-e.rho)),n=s.add(e.epsilon).sqrt().div(i.add(e.epsilon).sqrt()).mul(a),r=s.mul(e.rho).add(n.square().mul(1-e.rho));i.assign(t),s.assign(r);var u=n.mul(-e.learningRate).add(o);o.assign(u)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedUpdates&&(Xe(this.accumulatedGrads.map((function(t){return t.variable}))),Xe(this.accumulatedUpdates.map((function(t){return t.variable}))))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return t=this.accumulatedGrads.concat(this.accumulatedUpdates),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=t.length/2,this.accumulatedGrads=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedUpdates=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.rho,e.epsilon)},e.className="Adadelta",e}(Cp);Ap(Rp);var Ip=function(t){function e(e,n){void 0===n&&(n=.1);var r=t.call(this)||this;return r.learningRate=e,r.initialAccumulatorValue=n,r.accumulatedGrads=[],r}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=zt.registeredVariables[n];null==e.accumulatedGrads[r]&&(e.accumulatedGrads[r]={originalName:n+"/accumulator",variable:qe((function(){return En(o.shape,e.initialAccumulatorValue).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedGrads[r].variable;qe((function(){var t=i.add(a.square());i.assign(t);var n=a.div(t.add(zt.backend.epsilon()).sqrt()).mul(-e.learningRate).add(o);o.assign(n)}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedGrads&&Xe(this.accumulatedGrads.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulatedGrads.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulatedGrads=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}},e.fromConfig=function(t,e){return new t(e.learningRate,e.initialAccumulatorValue)},e.className="Adagrad",e}(Cp);Ap(Ip);var Np=function(t){function e(e,n,r,o){void 0===o&&(o=null);var a=t.call(this)||this;return a.learningRate=e,a.beta1=n,a.beta2=r,a.epsilon=o,a.accumulatedFirstMoment=[],a.accumulatedSecondMoment=[],qe((function(){a.accBeta1=yn(n).variable(),a.accBeta2=yn(r).variable()})),null==o&&(a.epsilon=zt.backend.epsilon()),a}return h(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);qe((function(){var r=ri(1,e.accBeta1),o=ri(1,e.accBeta2);n.forEach((function(n,a){var i=zt.registeredVariables[n];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:n+"/m",variable:qe((function(){return Rn(i).variable(!1)}))}),null==e.accumulatedSecondMoment[a]&&(e.accumulatedSecondMoment[a]={originalName:n+"/v",variable:qe((function(){return Rn(i).variable(!1)}))});var s=Array.isArray(t)?t[a].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,c=e.accumulatedSecondMoment[a].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2).add(s.square().mul(1-e.beta2)),d=l.div(r),f=h.div(o);u.assign(l),c.assign(h);var p=d.div(f.sqrt().add(e.epsilon)).mul(-e.learningRate).add(i);i.assign(p)}})),e.accBeta1.assign(e.accBeta1.mul(e.beta1)),e.accBeta2.assign(e.accBeta2.mul(e.beta2))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&Xe(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedSecondMoment&&Xe(this.accumulatedSecondMoment.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return t=this.accumulatedFirstMoment.concat(this.accumulatedSecondMoment),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){var e,n=this;return f(this,(function(r){switch(r.label){case 0:return[4,this.extractIterations(t)];case 1:return t=r.sent(),qe((function(){n.accBeta1.assign(ti(n.beta1,n.iterations_+1)),n.accBeta2.assign(ti(n.beta2,n.iterations_+1))})),e=t.length/2,this.accumulatedFirstMoment=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedSecondMoment=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon)},e.className="Adam",e}(Cp);Ap(Np);var Op=function(t){function e(e,n,r,o,a){void 0===o&&(o=null),void 0===a&&(a=0);var i=t.call(this)||this;return i.learningRate=e,i.beta1=n,i.beta2=r,i.epsilon=o,i.decay=a,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],qe((function(){i.iteration=yn(0).variable(),i.accBeta1=yn(n).variable()})),null==o&&(i.epsilon=zt.backend.epsilon()),i}return h(e,t),e.prototype.applyGradients=function(t){var e=this,n=Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t);qe((function(){var r=ri(1,e.accBeta1),o=oi(-e.learningRate,e.iteration.mul(e.decay).add(1));n.forEach((function(n,a){var i=zt.registeredVariables[n];null==e.accumulatedFirstMoment[a]&&(e.accumulatedFirstMoment[a]={originalName:n+"/m",variable:Rn(i).variable(!1)}),null==e.accumulatedWeightedInfNorm[a]&&(e.accumulatedWeightedInfNorm[a]={originalName:n+"/v",variable:Rn(i).variable(!1)});var s=Array.isArray(t)?t[a].tensor:t[n];if(null!=s){var u=e.accumulatedFirstMoment[a].variable,c=e.accumulatedWeightedInfNorm[a].variable,l=u.mul(e.beta1).add(s.mul(1-e.beta1)),h=c.mul(e.beta2),d=s.abs(),f=h.maximum(d);u.assign(l),c.assign(f);var p=o.div(r).mul(l.div(f.add(e.epsilon))).add(i);i.assign(p)}})),e.iteration.assign(e.iteration.add(1)),e.accBeta1.assign(e.accBeta1.mul(e.beta1))})),this.incrementIterations()},e.prototype.dispose=function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&Xe(this.accumulatedFirstMoment.map((function(t){return t.variable}))),null!=this.accumulatedWeightedInfNorm&&Xe(this.accumulatedWeightedInfNorm.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){throw new Error("getWeights() is not implemented for Adamax yet.")}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(t){throw new Error("setWeights() is not implemented for Adamax yet.")}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}},e.fromConfig=function(t,e){return new t(e.learningRate,e.beta1,e.beta2,e.epsilon,e.decay)},e.className="Adamax",e}(Cp);Ap(Op);var Dp=function(t){function e(e){var n=t.call(this)||this;return n.learningRate=e,n.setLearningRate(e),n}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=Array.isArray(t)?t[r].tensor:t[n];if(null!=o){var a=zt.registeredVariables[n];qe((function(){var t=e.c.mul(o).add(a);a.assign(t)}))}})),this.incrementIterations()},e.prototype.setLearningRate=function(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=function(t){return zt.keep(t)}(yn(-t))},e.prototype.dispose=function(){this.c.dispose()},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()]]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:if(0!==(t=e.sent()).length)throw new Error("SGD optimizer does not have settable weights.");return[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate}},e.fromConfig=function(t,e){return new t(e.learningRate)},e.className="SGD",e}(Cp);Ap(Dp);var Lp=function(t){function e(e,n,r){void 0===r&&(r=!1);var o=t.call(this,e)||this;return o.learningRate=e,o.momentum=n,o.useNesterov=r,o.accumulations=[],o.m=yn(o.momentum),o}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=zt.registeredVariables[n];null==e.accumulations[r]&&(e.accumulations[r]={originalName:n+"/momentum",variable:qe((function(){return Rn(o).variable(!1)}))});var a=e.accumulations[r].variable,i=Array.isArray(t)?t[r].tensor:t[n];null!=i&&qe((function(){var t,n=e.m.mul(a).add(i);t=e.useNesterov?e.c.mul(i.add(n.mul(e.m))).add(o):e.c.mul(n).add(o),a.assign(n),o.assign(t)}))})),this.incrementIterations()},e.prototype.dispose=function(){this.m.dispose(),null!=this.accumulations&&Xe(this.accumulations.map((function(t){return t.variable})))},e.prototype.setMomentum=function(t){this.momentum=t},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this.saveIterations()];case 1:return[2,[t.sent()].concat(this.accumulations.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.extractIterations(t)];case 1:return t=e.sent(),this.accumulations=t.map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}},e.fromConfig=function(t,e){return new t(e.learningRate,e.momentum,e.useNesterov)},e.className="Momentum",e}(Dp);Ap(Lp);var kp=function(t){function e(e,n,r,o,a){void 0===n&&(n=.9),void 0===r&&(r=0),void 0===o&&(o=null),void 0===a&&(a=!1);var i=t.call(this)||this;if(i.learningRate=e,i.decay=n,i.momentum=r,i.epsilon=o,i.accumulatedMeanSquares=[],i.accumulatedMoments=[],i.accumulatedMeanGrads=[],i.centered=a,null==o&&(i.epsilon=zt.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return i}return h(e,t),e.prototype.applyGradients=function(t){var e=this;(Array.isArray(t)?t.map((function(t){return t.name})):Object.keys(t)).forEach((function(n,r){var o=zt.registeredVariables[n];null==e.accumulatedMeanSquares[r]&&(e.accumulatedMeanSquares[r]={originalName:n+"/rms",variable:qe((function(){return Rn(o).variable(!1)}))}),null==e.accumulatedMoments[r]&&(e.accumulatedMoments[r]={originalName:n+"/momentum",variable:qe((function(){return Rn(o).variable(!1)}))}),null==e.accumulatedMeanGrads[r]&&e.centered&&(e.accumulatedMeanGrads[r]={originalName:n+"/mg",variable:qe((function(){return Rn(o).variable(!1)}))});var a=Array.isArray(t)?t[r].tensor:t[n];if(null!=a){var i=e.accumulatedMeanSquares[r].variable,s=e.accumulatedMoments[r].variable;qe((function(){var t=i.mul(e.decay).add(a.square().mul(1-e.decay));if(e.centered){var n=e.accumulatedMeanGrads[r].variable,u=n.mul(e.decay).add(a.mul(1-e.decay)),c=s.mul(e.momentum).add(a.mul(e.learningRate).div(t.sub(u.square().add(e.epsilon)).sqrt()));i.assign(t),n.assign(u),s.assign(c);var l=o.sub(c);o.assign(l)}else{var h=i.mul(e.decay).add(a.square().mul(1-e.decay));c=s.mul(e.momentum).add(a.mul(e.learningRate).div(h.add(e.epsilon).sqrt())),i.assign(h),s.assign(c),l=o.sub(c),o.assign(l)}}))}})),this.incrementIterations()},e.prototype.dispose=function(){null!=this.accumulatedMeanSquares&&Xe(this.accumulatedMeanSquares.map((function(t){return t.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&Xe(this.accumulatedMeanGrads.map((function(t){return t.variable}))),null!=this.accumulatedMoments&&Xe(this.accumulatedMoments.map((function(t){return t.variable})))},e.prototype.getWeights=function(){return d(this,void 0,void 0,(function(){var t;return f(this,(function(e){switch(e.label){case 0:return t=this.accumulatedMeanSquares.concat(this.accumulatedMoments),this.centered&&t.push.apply(t,this.accumulatedMeanGrads),[4,this.saveIterations()];case 1:return[2,[e.sent()].concat(t.map((function(t){return{name:t.originalName,tensor:t.variable}})))]}}))}))},e.prototype.setWeights=function(t){return d(this,void 0,void 0,(function(){var e;return f(this,(function(n){switch(n.label){case 0:return[4,this.extractIterations(t)];case 1:return t=n.sent(),e=this.centered?t.length/3:t.length/2,this.accumulatedMeanSquares=t.slice(0,e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.accumulatedMoments=t.slice(e,2*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((function(t){return{originalName:t.name,variable:t.tensor.variable(!1)}}))),[2]}}))}))},e.prototype.getConfig=function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}},e.fromConfig=function(t,e){return new t(e.learningRate,e.decay,e.momentum,e.epsilon,e.centered)},e.className="RMSProp",e}(Cp);Ap(kp);var Pp=function(){function t(){}return t.sgd=function(t){return new Dp(t)},t.momentum=function(t,e,n){return void 0===n&&(n=!1),new Lp(t,e,n)},t.rmsprop=function(t,e,n,r,o){return void 0===e&&(e=.9),void 0===n&&(n=0),void 0===r&&(r=null),void 0===o&&(o=!1),new kp(t,e,n,r,o)},t.adam=function(t,e,n,r){return void 0===t&&(t=.001),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),new Np(t,e,n,r)},t.adadelta=function(t,e,n){return void 0===t&&(t=.001),void 0===e&&(e=.95),void 0===n&&(n=null),new Rp(t,e,n)},t.adamax=function(t,e,n,r,o){return void 0===t&&(t=.002),void 0===e&&(e=.9),void 0===n&&(n=.999),void 0===r&&(r=null),void 0===o&&(o=0),new Op(t,e,n,r,o)},t.adagrad=function(t,e){return void 0===e&&(e=.1),new Ip(t,e)},t}();Pp.sgd,Pp.momentum,Pp.adadelta,Pp.adagrad,Pp.rmsprop,Pp.adamax,Pp.adam,"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame;St.prototype.add=function(t){return nr(this,t)},St.prototype.broadcastTo=function(t){return cu(this,t)},St.prototype.div=function(t){return oi(this,t)},St.prototype.divNoNan=function(t){return vu(this,t)},St.prototype.squaredDifference=function(t){return Bu(this,t)},St.prototype.tile=function(t){return yu(this,t)},St.prototype.oneHot=function(t,e,n){return void 0===e&&(e=1),void 0===n&&(n=0),wu(this,t,e,n)},St.prototype.transpose=function(t){return Ei(this,t)},St.prototype.pad=function(t,e){return _u(this,t,e)},St.prototype.batchNorm=function(t,e,n,r,o){return $s(this,t,e,n,r,o)},wt=nh}).call(this,n(27),n(89),n(118).Buffer,n(114).setImmediate)},1:function(t,e,n){"use strict";n.d(e,"a",(function(){return As})),n.d(e,"b",(function(){return fo})),n.d(e,"c",(function(){return kt})),n.d(e,"d",(function(){return we})),n.d(e,"e",(function(){return Ue})),n.d(e,"f",(function(){return Uo})),n.d(e,"g",(function(){return l})),n.d(e,"h",(function(){return he})),n.d(e,"i",(function(){return xu})),n.d(e,"j",(function(){return o})),n.d(e,"k",(function(){return Ls})),n.d(e,"l",(function(){return r})),n.d(e,"m",(function(){return Di})),n.d(e,"n",(function(){return Lu})),n.d(e,"o",(function(){return Vi})),n.d(e,"p",(function(){return Hi})),n.d(e,"q",(function(){return ms})),n.d(e,"r",(function(){return M})),n.d(e,"s",(function(){return E})),n.d(e,"t",(function(){return To})),n.d(e,"u",(function(){return bo})),n.d(e,"v",(function(){return Io})),n.d(e,"w",(function(){return Ro})),n.d(e,"x",(function(){return v})),n.d(e,"y",(function(){return x})),n.d(e,"z",(function(){return y})),n.d(e,"A",(function(){return Os})),n.d(e,"B",(function(){return Eu})),n.d(e,"C",(function(){return ve})),n.d(e,"D",(function(){return O})),n.d(e,"E",(function(){return tt})),n.d(e,"F",(function(){return on})),n.d(e,"G",(function(){return ye})),n.d(e,"H",(function(){return as})),n.d(e,"I",(function(){return os})),n.d(e,"J",(function(){return h})),n.d(e,"K",(function(){return d})),n.d(e,"L",(function(){return m})),n.d(e,"M",(function(){return f})),n.d(e,"N",(function(){return _s})),n.d(e,"O",(function(){return bt})),n.d(e,"P",(function(){return vu})),n.d(e,"Q",(function(){return xn})),n.d(e,"R",(function(){return gu})),n.d(e,"S",(function(){return Po})),n.d(e,"T",(function(){return No})),n.d(e,"U",(function(){return mc})),n.d(e,"V",(function(){return Ms})),n.d(e,"W",(function(){return _})),n.d(e,"X",(function(){return w})),n.d(e,"Y",(function(){return c})),n.d(e,"Z",(function(){return wt})),n.d(e,"ab",(function(){return vn})),n.d(e,"bb",(function(){return po})),n.d(e,"cb",(function(){return co})),n.d(e,"db",(function(){return Bt})),n.d(e,"eb",(function(){return fu})),n.d(e,"fb",(function(){return R})),n.d(e,"gb",(function(){return Us})),n.d(e,"hb",(function(){return se})),n.d(e,"ib",(function(){return A})),n.d(e,"jb",(function(){return T})),n.d(e,"kb",(function(){return D})),n.d(e,"lb",(function(){return W})),n.d(e,"mb",(function(){return Ts})),n.d(e,"nb",(function(){return Fi})),n.d(e,"ob",(function(){return C})),void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),"name"in Function.prototype==!1&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");const output=Object(t);for(let t=1;t<arguments.length;t++){const source=arguments[t];if(null!=source)for(const t in source)Object.prototype.hasOwnProperty.call(source,t)&&(output[t]=source[t])}return output});const r=0,o=2,c=1e3,l=1001,h=1002,d=1003,f=1004,m=1005,v=1006,y=1007,x=1008,w=1022,_=1023,S=_,M=2300,E=2301,T=1,A=2,C=3001,R=0;function I(){}Object.assign(I.prototype,{addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});const n=this._listeners;void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e)},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;const n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return;const n=this._listeners[t];if(void 0!==n){const t=n.indexOf(e);-1!==t&&n.splice(t,1)}},dispatchEvent:function(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const n=e.slice(0);for(let i=0,e=n.length;i<e;i++)n[i].call(this,t)}}});const N=[];for(let i=0;i<256;i++)N[i]=(i<16?"0":"")+i.toString(16);const O={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(N[255&t]+N[t>>8&255]+N[t>>16&255]+N[t>>24&255]+"-"+N[255&e]+N[e>>8&255]+"-"+N[e>>16&15|64]+N[e>>24&255]+"-"+N[63&n|128]+N[n>>8&255]+"-"+N[n>>16&255]+N[n>>24&255]+N[255&r]+N[r>>8&255]+N[r>>16&255]+N[r>>24&255]).toUpperCase()},clamp:function(t,e,n){return Math.max(e,Math.min(n,t))},euclideanModulo:function(t,e){return(t%e+e)%e},mapLinear:function(t,e,n,r,o){return r+(t-e)*(o-r)/(n-e)},lerp:function(t,e,n){return(1-n)*t+n*e},smoothstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*(3-2*t)},smootherstep:function(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},degToRad:function(t){return t*O.DEG2RAD},radToDeg:function(t){return t*O.RAD2DEG},isPowerOfTwo:function(t){return 0==(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(q,a,b,t,e){const n=Math.cos,r=Math.sin,o=n(b/2),c=r(b/2),l=n((a+t)/2),h=r((a+t)/2),d=n((a-t)/2),f=r((a-t)/2),m=n((t-a)/2),v=r((t-a)/2);switch(e){case"XYX":q.set(o*h,c*d,c*f,o*l);break;case"YZY":q.set(c*f,o*h,c*d,o*l);break;case"ZXZ":q.set(c*d,c*f,o*h,o*l);break;case"XZX":q.set(o*h,c*v,c*m,o*l);break;case"YXY":q.set(c*m,o*h,c*v,o*l);break;case"ZYZ":q.set(c*v,c*m,o*h,o*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+e)}}};function D(t=0,e=0){this.x=t,this.y=e}function L(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}let k;Object.defineProperties(D.prototype,{width:{get:function(){return this.x},set:function(t){this.x=t}},height:{get:function(){return this.y},set:function(t){this.y=t}}}),Object.assign(D.prototype,{isVector2:!0,set:function(t,e){return this.x=t,this.y=e,this},setScalar:function(t){return this.x=t,this.y=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(t){return this.x=t.x,this.y=t.y,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this)},addScalar:function(s){return this.x+=s,this.y+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this},addScaledVector:function(t,s){return this.x+=t.x*s,this.y+=t.y*s,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this)},subScalar:function(s){return this.x-=s,this.y-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this},divide:function(t){return this.x/=t.x,this.y/=t.y,this},divideScalar:function(t){return this.multiplyScalar(1/t)},applyMatrix3:function(t){const e=this.x,n=this.y,r=t.elements;return this.x=r[0]*e+r[3]*n+r[6],this.y=r[1]*e+r[4]*n+r[7],this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(t){return this.x*t.x+this.y*t.y},cross:function(t){return this.x*t.y-this.y*t.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){return Math.atan2(-this.y,-this.x)+Math.PI},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y;return e*e+n*n},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this},rotateAround:function(t,e){const n=Math.cos(e),s=Math.sin(e),r=this.x-t.x,o=this.y-t.y;return this.x=r*n-o*s+t.x,this.y=r*s+o*n+t.y,this},random:function(){return this.x=Math.random(),this.y=Math.random(),this}}),Object.assign(L.prototype,{isMatrix3:!0,set:function(t,e,n,r,o,c,l,h,d){const f=this.elements;return f[0]=t,f[1]=r,f[2]=l,f[3]=e,f[4]=o,f[5]=h,f[6]=n,f[7]=c,f[8]=d,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],this},extractBasis:function(t,e,n){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this},setFromMatrix4:function(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this},multiply:function(t){return this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(a,b){const t=a.elements,e=b.elements,n=this.elements,r=t[0],o=t[3],c=t[6],l=t[1],h=t[4],d=t[7],f=t[2],m=t[5],v=t[8],y=e[0],x=e[3],w=e[6],_=e[1],S=e[4],M=e[7],E=e[2],T=e[5],A=e[8];return n[0]=r*y+o*_+c*E,n[3]=r*x+o*S+c*T,n[6]=r*w+o*M+c*A,n[1]=l*y+h*_+d*E,n[4]=l*x+h*S+d*T,n[7]=l*w+h*M+d*A,n[2]=f*y+m*_+v*E,n[5]=f*x+m*S+v*T,n[8]=f*w+m*M+v*A,this},multiplyScalar:function(s){const t=this.elements;return t[0]*=s,t[3]*=s,t[6]*=s,t[1]*=s,t[4]*=s,t[7]*=s,t[2]*=s,t[5]*=s,t[8]*=s,this},determinant:function(){const t=this.elements,a=t[0],b=t[1],e=t[2],n=t[3],r=t[4],o=t[5],g=t[6],c=t[7],i=t[8];return a*r*i-a*o*c-b*n*i+b*o*g+e*n*c-e*r*g},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix3: .getInverse() can no longer be configured to throw on degenerate.");const n=t.elements,r=this.elements,o=n[0],c=n[1],l=n[2],h=n[3],d=n[4],f=n[5],m=n[6],v=n[7],y=n[8],x=y*d-f*v,w=f*m-y*h,_=v*h-d*m,S=o*x+c*w+l*_;if(0===S)return this.set(0,0,0,0,0,0,0,0,0);const M=1/S;return r[0]=x*M,r[1]=(l*v-y*c)*M,r[2]=(f*c-l*d)*M,r[3]=w*M,r[4]=(y*o-l*m)*M,r[5]=(l*h-f*o)*M,r[6]=_*M,r[7]=(c*m-v*o)*M,r[8]=(d*o-c*h)*M,this},transpose:function(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this},getNormalMatrix:function(t){return this.setFromMatrix4(t).getInverse(this).transpose()},transposeIntoArray:function(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this},setUvTransform:function(t,e,n,r,o,c,l){const h=Math.cos(o),s=Math.sin(o);this.set(n*h,n*s,-n*(h*c+s*l)+c+t,-r*s,r*h,-r*(-s*c+h*l)+l+e,0,0,1)},scale:function(t,e){const n=this.elements;return n[0]*=t,n[3]*=t,n[6]*=t,n[1]*=e,n[4]*=e,n[7]*=e,this},rotate:function(t){const e=Math.cos(t),s=Math.sin(t),n=this.elements,r=n[0],o=n[3],c=n[6],l=n[1],h=n[4],d=n[7];return n[0]=e*r+s*l,n[3]=e*o+s*h,n[6]=e*c+s*d,n[1]=-s*r+e*l,n[4]=-s*o+e*h,n[7]=-s*c+e*d,this},translate:function(t,e){const n=this.elements;return n[0]+=t*n[2],n[3]+=t*n[5],n[6]+=t*n[8],n[1]+=e*n[2],n[4]+=e*n[5],n[7]+=e*n[8],this},equals:function(t){const e=this.elements,n=t.elements;for(let i=0;i<9;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t}});const P={getDataURL:function(image){if(/^data:/i.test(image.src))return image.src;if("undefined"==typeof HTMLCanvasElement)return image.src;let canvas;if(image instanceof HTMLCanvasElement)canvas=image;else{void 0===k&&(k=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),k.width=image.width,k.height=image.height;const t=k.getContext("2d");image instanceof ImageData?t.putImageData(image,0,0):t.drawImage(image,0,0,image.width,image.height),canvas=k}return canvas.width>2048||canvas.height>2048?canvas.toDataURL("image/jpeg",.6):canvas.toDataURL("image/png")}};let F=0;function B(image,t,e,n,r,o,c,h,d,f){Object.defineProperty(this,"id",{value:F++}),this.uuid=O.generateUUID(),this.name="",this.image=void 0!==image?image:B.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==t?t:B.DEFAULT_MAPPING,this.wrapS=void 0!==e?e:l,this.wrapT=void 0!==n?n:l,this.magFilter=void 0!==r?r:v,this.minFilter=void 0!==o?o:x,this.anisotropy=void 0!==d?d:1,this.format=void 0!==c?c:_,this.internalFormat=null,this.type=void 0!==h?h:1009,this.offset=new D(0,0),this.repeat=new D(1,1),this.center=new D(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new L,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==f?f:3e3,this.version=0,this.onUpdate=null}function z(t=0,e=0,n=0,r=1){this.x=t,this.y=e,this.z=n,this.w=r}function U(t,e,n){this.width=t,this.height=e,this.scissor=new z(0,0,t,e),this.scissorTest=!1,this.viewport=new z(0,0,t,e),n=n||{},this.texture=new B(void 0,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.image={},this.texture.image.width=t,this.texture.image.height=e,this.texture.generateMipmaps=void 0!==n.generateMipmaps&&n.generateMipmaps,this.texture.minFilter=void 0!==n.minFilter?n.minFilter:v,this.depthBuffer=void 0===n.depthBuffer||n.depthBuffer,this.stencilBuffer=void 0===n.stencilBuffer||n.stencilBuffer,this.depthTexture=void 0!==n.depthTexture?n.depthTexture:null}function V(t,e,n){U.call(this,t,e,n),this.samples=4}function G(t=0,e=0,n=0,r=1){this._x=t,this._y=e,this._z=n,this._w=r}B.DEFAULT_IMAGE=void 0,B.DEFAULT_MAPPING=300,B.prototype=Object.assign(Object.create(I.prototype),{constructor:B,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.name=source.name,this.image=source.image,this.mipmaps=source.mipmaps.slice(0),this.mapping=source.mapping,this.wrapS=source.wrapS,this.wrapT=source.wrapT,this.magFilter=source.magFilter,this.minFilter=source.minFilter,this.anisotropy=source.anisotropy,this.format=source.format,this.internalFormat=source.internalFormat,this.type=source.type,this.offset.copy(source.offset),this.repeat.copy(source.repeat),this.center.copy(source.center),this.rotation=source.rotation,this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrix.copy(source.matrix),this.generateMipmaps=source.generateMipmaps,this.premultiplyAlpha=source.premultiplyAlpha,this.flipY=source.flipY,this.unpackAlignment=source.unpackAlignment,this.encoding=source.encoding,this},toJSON:function(meta){const t=void 0===meta||"string"==typeof meta;if(!t&&void 0!==meta.textures[this.uuid])return meta.textures[this.uuid];const output={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const image=this.image;if(void 0===image.uuid&&(image.uuid=O.generateUUID()),!t&&void 0===meta.images[image.uuid]){let t;if(Array.isArray(image)){t=[];for(let i=0,e=image.length;i<e;i++)t.push(P.getDataURL(image[i]))}else t=P.getDataURL(image);meta.images[image.uuid]={uuid:image.uuid,url:t}}output.image=image.uuid}return t||(meta.textures[this.uuid]=output),output},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case c:t.x=t.x-Math.floor(t.x);break;case l:t.x=t.x<0?0:1;break;case h:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case c:t.y=t.y-Math.floor(t.y);break;case l:t.y=t.y<0?0:1;break;case h:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}}),Object.defineProperty(B.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.defineProperties(z.prototype,{width:{get:function(){return this.z},set:function(t){this.z=t}},height:{get:function(){return this.w},set:function(t){this.w=t}}}),Object.assign(z.prototype,{isVector4:!0,set:function(t,e,n,r){return this.x=t,this.y=e,this.z=n,this.w=r,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this.w=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setW:function(t){return this.w=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this.w+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this.w=a.w+b.w,this},addScaledVector:function(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this.w+=t.w*s,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this.w-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this.w=a.w-b.w,this},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},applyMatrix4:function(t){const e=this.x,n=this.y,r=this.z,o=this.w,c=t.elements;return this.x=c[0]*e+c[4]*n+c[8]*r+c[12]*o,this.y=c[1]*e+c[5]*n+c[9]*r+c[13]*o,this.z=c[2]*e+c[6]*n+c[10]*r+c[14]*o,this.w=c[3]*e+c[7]*n+c[11]*r+c[15]*o,this},divideScalar:function(t){return this.multiplyScalar(1/t)},setAxisAngleFromQuaternion:function(q){this.w=2*Math.acos(q.w);const s=Math.sqrt(1-q.w*q.w);return s<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=q.x/s,this.y=q.y/s,this.z=q.z/s),this},setAxisAngleFromRotationMatrix:function(t){let e,n,r,o;const c=t.elements,l=c[0],h=c[4],d=c[8],f=c[1],m=c[5],v=c[9],y=c[2],x=c[6],w=c[10];if(Math.abs(h-f)<.01&&Math.abs(d-y)<.01&&Math.abs(v-x)<.01){if(Math.abs(h+f)<.1&&Math.abs(d+y)<.1&&Math.abs(v+x)<.1&&Math.abs(l+m+w-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const t=(l+1)/2,c=(m+1)/2,_=(w+1)/2,S=(h+f)/4,M=(d+y)/4,E=(v+x)/4;return t>c&&t>_?t<.01?(n=0,r=.707106781,o=.707106781):(n=Math.sqrt(t),r=S/n,o=M/n):c>_?c<.01?(n=.707106781,r=0,o=.707106781):(r=Math.sqrt(c),n=S/r,o=E/r):_<.01?(n=.707106781,r=.707106781,o=0):(o=Math.sqrt(_),n=M/o,r=E/o),this.set(n,r,o,e),this}let s=Math.sqrt((x-v)*(x-v)+(d-y)*(d-y)+(f-h)*(f-h));return Math.abs(s)<.001&&(s=1),this.x=(x-v)/s,this.y=(d-y)/s,this.z=(f-h)/s,this.w=Math.acos((l+m+w-1)/2),this},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this.w=t.w+(e.w-t.w)*n,this},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}}),U.prototype=Object.assign(Object.create(I.prototype),{constructor:U,isWebGLRenderTarget:!0,setSize:function(t,e){this.width===t&&this.height===e||(this.width=t,this.height=e,this.texture.image.width=t,this.texture.image.height=e,this.dispose()),this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.width=source.width,this.height=source.height,this.viewport.copy(source.viewport),this.texture=source.texture.clone(),this.depthBuffer=source.depthBuffer,this.stencilBuffer=source.stencilBuffer,this.depthTexture=source.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),V.prototype=Object.assign(Object.create(U.prototype),{constructor:V,isWebGLMultisampleRenderTarget:!0,copy:function(source){return U.prototype.copy.call(this,source),this.samples=source.samples,this}}),Object.assign(G,{slerp:function(t,e,n,r){return n.copy(t).slerp(e,r)},slerpFlat:function(t,e,n,r,o,c,l){let h=n[r+0],d=n[r+1],f=n[r+2],m=n[r+3];const v=o[c+0],y=o[c+1],x=o[c+2],w=o[c+3];if(m!==w||h!==v||d!==y||f!==x){let s=1-l,t=h*v+d*y+f*x+m*w,e=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const r=Math.sqrt(n),o=Math.atan2(r,t*e);s=Math.sin(s*o)/r,l=Math.sin(l*o)/r}const r=l*e;if(h=h*s+v*r,d=d*s+y*r,f=f*s+x*r,m=m*s+w*r,s===1-l){const t=1/Math.sqrt(h*h+d*d+f*f+m*m);h*=t,d*=t,f*=t,m*=t}}t[e]=h,t[e+1]=d,t[e+2]=f,t[e+3]=m},multiplyQuaternionsFlat:function(t,e,n,r,o,c){const l=n[r],h=n[r+1],d=n[r+2],f=n[r+3],m=o[c],v=o[c+1],y=o[c+2],x=o[c+3];return t[e]=l*x+f*m+h*y-d*v,t[e+1]=h*x+f*v+d*m-l*y,t[e+2]=d*x+f*y+l*v-h*m,t[e+3]=f*x-l*m-h*v-d*y,t}}),Object.defineProperties(G.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(t){this._w=t,this._onChangeCallback()}}}),Object.assign(G.prototype,{isQuaternion:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._w=r,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this},setFromEuler:function(t,e){if(!t||!t.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const n=t._x,r=t._y,o=t._z,c=t.order,l=Math.cos,h=Math.sin,d=l(n/2),f=l(r/2),m=l(o/2),v=h(n/2),y=h(r/2),x=h(o/2);switch(c){case"XYZ":this._x=v*f*m+d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m-v*y*x;break;case"YXZ":this._x=v*f*m+d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m+v*y*x;break;case"ZXY":this._x=v*f*m-d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m-v*y*x;break;case"ZYX":this._x=v*f*m-d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m+v*y*x;break;case"YZX":this._x=v*f*m+d*y*x,this._y=d*y*m+v*f*x,this._z=d*f*x-v*y*m,this._w=d*f*m-v*y*x;break;case"XZY":this._x=v*f*m-d*y*x,this._y=d*y*m-v*f*x,this._z=d*f*x+v*y*m,this._w=d*f*m+v*y*x;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+c)}return!1!==e&&this._onChangeCallback(),this},setFromAxisAngle:function(t,e){const n=e/2,s=Math.sin(n);return this._x=t.x*s,this._y=t.y*s,this._z=t.z*s,this._w=Math.cos(n),this._onChangeCallback(),this},setFromRotationMatrix:function(t){const e=t.elements,n=e[0],r=e[4],o=e[8],c=e[1],l=e[5],h=e[9],d=e[2],f=e[6],m=e[10],v=n+l+m;if(v>0){const s=.5/Math.sqrt(v+1);this._w=.25/s,this._x=(f-h)*s,this._y=(o-d)*s,this._z=(c-r)*s}else if(n>l&&n>m){const s=2*Math.sqrt(1+n-l-m);this._w=(f-h)/s,this._x=.25*s,this._y=(r+c)/s,this._z=(o+d)/s}else if(l>m){const s=2*Math.sqrt(1+l-n-m);this._w=(o-d)/s,this._x=(r+c)/s,this._y=.25*s,this._z=(h+f)/s}else{const s=2*Math.sqrt(1+m-n-l);this._w=(c-r)/s,this._x=(o+d)/s,this._y=(h+f)/s,this._z=.25*s}return this._onChangeCallback(),this},setFromUnitVectors:function(t,e){let n=t.dot(e)+1;return n<1e-6?(n=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=n):(this._x=0,this._y=-t.z,this._z=t.y,this._w=n)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=n),this.normalize()},angleTo:function(q){return 2*Math.acos(Math.abs(O.clamp(this.dot(q),-1,1)))},rotateTowards:function(q,t){const e=this.angleTo(q);if(0===e)return this;const n=Math.min(1,t/e);return this.slerp(q,n),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this},multiply:function(q,p){return void 0!==p?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(q,p)):this.multiplyQuaternions(this,q)},premultiply:function(q){return this.multiplyQuaternions(q,this)},multiplyQuaternions:function(a,b){const t=a._x,e=a._y,n=a._z,r=a._w,o=b._x,c=b._y,l=b._z,h=b._w;return this._x=t*h+r*o+e*l-n*c,this._y=e*h+r*c+n*o-t*l,this._z=n*h+r*l+t*c-e*o,this._w=r*h-t*o-e*c-n*l,this._onChangeCallback(),this},slerp:function(t,e){if(0===e)return this;if(1===e)return this.copy(t);const n=this._x,r=this._y,o=this._z,c=this._w;let l=c*t._w+n*t._x+r*t._y+o*t._z;if(l<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,l=-l):this.copy(t),l>=1)return this._w=c,this._x=n,this._y=r,this._z=o,this;const h=1-l*l;if(h<=Number.EPSILON){const s=1-e;return this._w=s*c+e*this._w,this._x=s*n+e*this._x,this._y=s*r+e*this._y,this._z=s*o+e*this._z,this.normalize(),this._onChangeCallback(),this}const d=Math.sqrt(h),f=Math.atan2(d,l),m=Math.sin((1-e)*f)/d,v=Math.sin(e*f)/d;return this._w=c*m+this._w*v,this._x=n*m+this._x*v,this._y=r*m+this._y*v,this._z=o*m+this._z*v,this._onChangeCallback(),this},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w},fromArray:function(t,e){return void 0===e&&(e=0),this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t},fromBufferAttribute:function(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}});const H=new W,j=new G;function W(t=0,e=0,n=0){this.x=t,this.y=e,this.z=n}Object.assign(W.prototype,{isVector3:!0,set:function(t,e,n){return this.x=t,this.y=e,this.z=n,this},setScalar:function(t){return this.x=t,this.y=t,this.z=t,this},setX:function(t){return this.x=t,this},setY:function(t){return this.y=t,this},setZ:function(t){return this.z=t,this},setComponent:function(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this},getComponent:function(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},add:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(t,e)):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addScalar:function(s){return this.x+=s,this.y+=s,this.z+=s,this},addVectors:function(a,b){return this.x=a.x+b.x,this.y=a.y+b.y,this.z=a.z+b.z,this},addScaledVector:function(t,s){return this.x+=t.x*s,this.y+=t.y*s,this.z+=t.z*s,this},sub:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(t,e)):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subScalar:function(s){return this.x-=s,this.y-=s,this.z-=s,this},subVectors:function(a,b){return this.x=a.x-b.x,this.y=a.y-b.y,this.z=a.z-b.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(t,e)):(this.x*=t.x,this.y*=t.y,this.z*=t.z,this)},multiplyScalar:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiplyVectors:function(a,b){return this.x=a.x*b.x,this.y=a.y*b.y,this.z=a.z*b.z,this},applyEuler:function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(j.setFromEuler(t))},applyAxisAngle:function(t,e){return this.applyQuaternion(j.setFromAxisAngle(t,e))},applyMatrix3:function(t){const e=this.x,n=this.y,r=this.z,o=t.elements;return this.x=o[0]*e+o[3]*n+o[6]*r,this.y=o[1]*e+o[4]*n+o[7]*r,this.z=o[2]*e+o[5]*n+o[8]*r,this},applyNormalMatrix:function(t){return this.applyMatrix3(t).normalize()},applyMatrix4:function(t){const e=this.x,n=this.y,r=this.z,o=t.elements,c=1/(o[3]*e+o[7]*n+o[11]*r+o[15]);return this.x=(o[0]*e+o[4]*n+o[8]*r+o[12])*c,this.y=(o[1]*e+o[5]*n+o[9]*r+o[13])*c,this.z=(o[2]*e+o[6]*n+o[10]*r+o[14])*c,this},applyQuaternion:function(q){const t=this.x,e=this.y,n=this.z,r=q.x,o=q.y,c=q.z,l=q.w,h=l*t+o*n-c*e,d=l*e+c*t-r*n,f=l*n+r*e-o*t,m=-r*t-o*e-c*n;return this.x=h*l+m*-r+d*-c-f*-o,this.y=d*l+m*-o+f*-r-h*-c,this.z=f*l+m*-c+h*-o-d*-r,this},project:function(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)},unproject:function(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)},transformDirection:function(t){const e=this.x,n=this.y,r=this.z,o=t.elements;return this.x=o[0]*e+o[4]*n+o[8]*r,this.y=o[1]*e+o[5]*n+o[9]*r,this.z=o[2]*e+o[6]*n+o[10]*r,this.normalize()},divide:function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},divideScalar:function(t){return this.multiplyScalar(1/t)},min:function(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this},max:function(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this},clamp:function(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this},clampScalar:function(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this},clampLength:function(t,e){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(t,Math.min(e,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(t){return this.normalize().multiplyScalar(t)},lerp:function(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this},lerpVectors:function(t,e,n){return this.x=t.x+(e.x-t.x)*n,this.y=t.y+(e.y-t.y)*n,this.z=t.z+(e.z-t.z)*n,this},cross:function(t,e){return void 0!==e?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(t,e)):this.crossVectors(this,t)},crossVectors:function(a,b){const t=a.x,e=a.y,n=a.z,r=b.x,o=b.y,c=b.z;return this.x=e*c-n*o,this.y=n*r-t*c,this.z=t*o-e*r,this},projectOnVector:function(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const n=t.dot(this)/e;return this.copy(t).multiplyScalar(n)},projectOnPlane:function(t){return H.copy(this).projectOnVector(t),this.sub(H)},reflect:function(t){return this.sub(H.copy(t).multiplyScalar(2*this.dot(t)))},angleTo:function(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const n=this.dot(t)/e;return Math.acos(O.clamp(n,-1,1))},distanceTo:function(t){return Math.sqrt(this.distanceToSquared(t))},distanceToSquared:function(t){const e=this.x-t.x,n=this.y-t.y,r=this.z-t.z;return e*e+n*n+r*r},manhattanDistanceTo:function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)},setFromSpherical:function(s){return this.setFromSphericalCoords(s.radius,s.phi,s.theta)},setFromSphericalCoords:function(t,e,n){const r=Math.sin(e)*t;return this.x=r*Math.sin(n),this.y=Math.cos(e)*t,this.z=r*Math.cos(n),this},setFromCylindrical:function(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)},setFromCylindricalCoords:function(t,e,n){return this.x=t*Math.sin(e),this.y=n,this.z=t*Math.cos(e),this},setFromMatrixPosition:function(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this},setFromMatrixScale:function(t){const e=this.setFromMatrixColumn(t,0).length(),n=this.setFromMatrixColumn(t,1).length(),r=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=n,this.z=r,this},setFromMatrixColumn:function(t,e){return this.fromArray(t.elements,4*e)},setFromMatrix3Column:function(t,e){return this.fromArray(t.elements,3*e)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},fromArray:function(t,e){return void 0===e&&(e=0),this.x=t[e],this.y=t[e+1],this.z=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t},fromBufferAttribute:function(t,e,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this},random:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}});const X=new W,Y=new tt,K=new W(0,0,0),J=new W(1,1,1),Z=new W,Q=new W,$=new W;function tt(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(tt.prototype,{isMatrix4:!0,set:function(t,e,n,r,o,c,l,h,d,f,m,v,y,x,w,_){const S=this.elements;return S[0]=t,S[4]=e,S[8]=n,S[12]=r,S[1]=o,S[5]=c,S[9]=l,S[13]=h,S[2]=d,S[6]=f,S[10]=m,S[14]=v,S[3]=y,S[7]=x,S[11]=w,S[15]=_,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new tt).fromArray(this.elements)},copy:function(t){const e=this.elements,n=t.elements;return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],this},copyPosition:function(t){const e=this.elements,n=t.elements;return e[12]=n[12],e[13]=n[13],e[14]=n[14],this},extractBasis:function(t,e,n){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(t,e,n){return this.set(t.x,e.x,n.x,0,t.y,e.y,n.y,0,t.z,e.z,n.z,0,0,0,0,1),this},extractRotation:function(t){const e=this.elements,n=t.elements,r=1/X.setFromMatrixColumn(t,0).length(),o=1/X.setFromMatrixColumn(t,1).length(),c=1/X.setFromMatrixColumn(t,2).length();return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=0,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=0,e[8]=n[8]*c,e[9]=n[9]*c,e[10]=n[10]*c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromEuler:function(t){t&&t.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const e=this.elements,n=t.x,r=t.y,o=t.z,a=Math.cos(n),b=Math.sin(n),c=Math.cos(r),l=Math.sin(r),h=Math.cos(o),d=Math.sin(o);if("XYZ"===t.order){const t=a*h,n=a*d,r=b*h,o=b*d;e[0]=c*h,e[4]=-c*d,e[8]=l,e[1]=n+r*l,e[5]=t-o*l,e[9]=-b*c,e[2]=o-t*l,e[6]=r+n*l,e[10]=a*c}else if("YXZ"===t.order){const t=c*h,n=c*d,r=l*h,o=l*d;e[0]=t+o*b,e[4]=r*b-n,e[8]=a*l,e[1]=a*d,e[5]=a*h,e[9]=-b,e[2]=n*b-r,e[6]=o+t*b,e[10]=a*c}else if("ZXY"===t.order){const t=c*h,n=c*d,r=l*h,o=l*d;e[0]=t-o*b,e[4]=-a*d,e[8]=r+n*b,e[1]=n+r*b,e[5]=a*h,e[9]=o-t*b,e[2]=-a*l,e[6]=b,e[10]=a*c}else if("ZYX"===t.order){const t=a*h,n=a*d,r=b*h,o=b*d;e[0]=c*h,e[4]=r*l-n,e[8]=t*l+o,e[1]=c*d,e[5]=o*l+t,e[9]=n*l-r,e[2]=-l,e[6]=b*c,e[10]=a*c}else if("YZX"===t.order){const t=a*c,n=a*l,r=b*c,o=b*l;e[0]=c*h,e[4]=o-t*d,e[8]=r*d+n,e[1]=d,e[5]=a*h,e[9]=-b*h,e[2]=-l*h,e[6]=n*d+r,e[10]=t-o*d}else if("XZY"===t.order){const t=a*c,n=a*l,r=b*c,o=b*l;e[0]=c*h,e[4]=-d,e[8]=l*h,e[1]=t*d+o,e[5]=a*h,e[9]=n*d-r,e[2]=r*d-n,e[6]=b*h,e[10]=o*d+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this},makeRotationFromQuaternion:function(q){return this.compose(K,q,J)},lookAt:function(t,e,n){const r=this.elements;return $.subVectors(t,e),0===$.lengthSq()&&($.z=1),$.normalize(),Z.crossVectors(n,$),0===Z.lengthSq()&&(1===Math.abs(n.z)?$.x+=1e-4:$.z+=1e-4,$.normalize(),Z.crossVectors(n,$)),Z.normalize(),Q.crossVectors($,Z),r[0]=Z.x,r[4]=Q.x,r[8]=$.x,r[1]=Z.y,r[5]=Q.y,r[9]=$.y,r[2]=Z.z,r[6]=Q.z,r[10]=$.z,this},multiply:function(t,e){return void 0!==e?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(t,e)):this.multiplyMatrices(this,t)},premultiply:function(t){return this.multiplyMatrices(t,this)},multiplyMatrices:function(a,b){const t=a.elements,e=b.elements,n=this.elements,r=t[0],o=t[4],c=t[8],l=t[12],h=t[1],d=t[5],f=t[9],m=t[13],v=t[2],y=t[6],x=t[10],w=t[14],_=t[3],S=t[7],M=t[11],E=t[15],T=e[0],A=e[4],C=e[8],R=e[12],I=e[1],N=e[5],O=e[9],D=e[13],L=e[2],k=e[6],P=e[10],F=e[14],B=e[3],z=e[7],U=e[11],V=e[15];return n[0]=r*T+o*I+c*L+l*B,n[4]=r*A+o*N+c*k+l*z,n[8]=r*C+o*O+c*P+l*U,n[12]=r*R+o*D+c*F+l*V,n[1]=h*T+d*I+f*L+m*B,n[5]=h*A+d*N+f*k+m*z,n[9]=h*C+d*O+f*P+m*U,n[13]=h*R+d*D+f*F+m*V,n[2]=v*T+y*I+x*L+w*B,n[6]=v*A+y*N+x*k+w*z,n[10]=v*C+y*O+x*P+w*U,n[14]=v*R+y*D+x*F+w*V,n[3]=_*T+S*I+M*L+E*B,n[7]=_*A+S*N+M*k+E*z,n[11]=_*C+S*O+M*P+E*U,n[15]=_*R+S*D+M*F+E*V,this},multiplyScalar:function(s){const t=this.elements;return t[0]*=s,t[4]*=s,t[8]*=s,t[12]*=s,t[1]*=s,t[5]*=s,t[9]*=s,t[13]*=s,t[2]*=s,t[6]*=s,t[10]*=s,t[14]*=s,t[3]*=s,t[7]*=s,t[11]*=s,t[15]*=s,this},determinant:function(){const t=this.elements,e=t[0],n=t[4],r=t[8],o=t[12],c=t[1],l=t[5],h=t[9],d=t[13],f=t[2],m=t[6],v=t[10],y=t[14];return t[3]*(+o*h*m-r*d*m-o*l*v+n*d*v+r*l*y-n*h*y)+t[7]*(+e*h*y-e*d*v+o*c*v-r*c*y+r*d*f-o*h*f)+t[11]*(+e*d*m-e*l*y-o*c*m+n*c*y+o*l*f-n*d*f)+t[15]*(-r*l*f-e*h*m+e*l*v+r*c*m-n*c*v+n*h*f)},transpose:function(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(t,e,n){const r=this.elements;return t.isVector3?(r[12]=t.x,r[13]=t.y,r[14]=t.z):(r[12]=t,r[13]=e,r[14]=n),this},getInverse:function(t,e){void 0!==e&&console.warn("THREE.Matrix4: .getInverse() can no longer be configured to throw on degenerate.");const n=this.elements,r=t.elements,o=r[0],c=r[1],l=r[2],h=r[3],d=r[4],f=r[5],m=r[6],v=r[7],y=r[8],x=r[9],w=r[10],_=r[11],S=r[12],M=r[13],E=r[14],T=r[15],A=x*E*v-M*w*v+M*m*_-f*E*_-x*m*T+f*w*T,C=S*w*v-y*E*v-S*m*_+d*E*_+y*m*T-d*w*T,R=y*M*v-S*x*v+S*f*_-d*M*_-y*f*T+d*x*T,I=S*x*m-y*M*m-S*f*w+d*M*w+y*f*E-d*x*E,N=o*A+c*C+l*R+h*I;if(0===N)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const O=1/N;return n[0]=A*O,n[1]=(M*w*h-x*E*h-M*l*_+c*E*_+x*l*T-c*w*T)*O,n[2]=(f*E*h-M*m*h+M*l*v-c*E*v-f*l*T+c*m*T)*O,n[3]=(x*m*h-f*w*h-x*l*v+c*w*v+f*l*_-c*m*_)*O,n[4]=C*O,n[5]=(y*E*h-S*w*h+S*l*_-o*E*_-y*l*T+o*w*T)*O,n[6]=(S*m*h-d*E*h-S*l*v+o*E*v+d*l*T-o*m*T)*O,n[7]=(d*w*h-y*m*h+y*l*v-o*w*v-d*l*_+o*m*_)*O,n[8]=R*O,n[9]=(S*x*h-y*M*h-S*c*_+o*M*_+y*c*T-o*x*T)*O,n[10]=(d*M*h-S*f*h+S*c*v-o*M*v-d*c*T+o*f*T)*O,n[11]=(y*f*h-d*x*h-y*c*v+o*x*v+d*c*_-o*f*_)*O,n[12]=I*O,n[13]=(y*M*l-S*x*l+S*c*w-o*M*w-y*c*E+o*x*E)*O,n[14]=(S*f*l-d*M*l-S*c*m+o*M*m+d*c*E-o*f*E)*O,n[15]=(d*x*l-y*f*l+y*c*m-o*x*m-d*c*w+o*f*w)*O,this},scale:function(t){const e=this.elements,n=t.x,r=t.y,o=t.z;return e[0]*=n,e[4]*=r,e[8]*=o,e[1]*=n,e[5]*=r,e[9]*=o,e[2]*=n,e[6]*=r,e[10]*=o,e[3]*=n,e[7]*=r,e[11]*=o,this},getMaxScaleOnAxis:function(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],n=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],r=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,n,r))},makeTranslation:function(t,e,n){return this.set(1,0,0,t,0,1,0,e,0,0,1,n,0,0,0,1),this},makeRotationX:function(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this},makeRotationY:function(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this},makeRotationZ:function(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(t,e){const n=Math.cos(e),s=Math.sin(e),r=1-n,o=t.x,c=t.y,l=t.z,h=r*o,d=r*c;return this.set(h*o+n,h*c-s*l,h*l+s*c,0,h*c+s*l,d*c+n,d*l-s*o,0,h*l-s*c,d*l+s*o,r*l*l+n,0,0,0,0,1),this},makeScale:function(t,e,n){return this.set(t,0,0,0,0,e,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(t,e,n){return this.set(1,e,n,0,t,1,n,0,t,e,1,0,0,0,0,1),this},compose:function(t,e,n){const r=this.elements,o=e._x,c=e._y,l=e._z,h=e._w,d=o+o,f=c+c,m=l+l,v=o*d,y=o*f,x=o*m,w=c*f,_=c*m,S=l*m,M=h*d,E=h*f,T=h*m,A=n.x,C=n.y,R=n.z;return r[0]=(1-(w+S))*A,r[1]=(y+T)*A,r[2]=(x-E)*A,r[3]=0,r[4]=(y-T)*C,r[5]=(1-(v+S))*C,r[6]=(_+M)*C,r[7]=0,r[8]=(x+E)*R,r[9]=(_-M)*R,r[10]=(1-(v+w))*R,r[11]=0,r[12]=t.x,r[13]=t.y,r[14]=t.z,r[15]=1,this},decompose:function(t,e,n){const r=this.elements;let o=X.set(r[0],r[1],r[2]).length(),c=X.set(r[4],r[5],r[6]).length(),l=X.set(r[8],r[9],r[10]).length();this.determinant()<0&&(o=-o),t.x=r[12],t.y=r[13],t.z=r[14],Y.copy(this);const h=1/o,d=1/c,f=1/l;return Y.elements[0]*=h,Y.elements[1]*=h,Y.elements[2]*=h,Y.elements[4]*=d,Y.elements[5]*=d,Y.elements[6]*=d,Y.elements[8]*=f,Y.elements[9]*=f,Y.elements[10]*=f,e.setFromRotationMatrix(Y),n.x=o,n.y=c,n.z=l,this},makePerspective:function(t,e,n,r,o,c){void 0===c&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const l=this.elements,h=2*o/(e-t),d=2*o/(n-r),a=(e+t)/(e-t),b=(n+r)/(n-r),f=-(c+o)/(c-o),m=-2*c*o/(c-o);return l[0]=h,l[4]=0,l[8]=a,l[12]=0,l[1]=0,l[5]=d,l[9]=b,l[13]=0,l[2]=0,l[6]=0,l[10]=f,l[14]=m,l[3]=0,l[7]=0,l[11]=-1,l[15]=0,this},makeOrthographic:function(t,e,n,r,o,c){const l=this.elements,h=1/(e-t),d=1/(n-r),p=1/(c-o),f=(e+t)*h,m=(n+r)*d,v=(c+o)*p;return l[0]=2*h,l[4]=0,l[8]=0,l[12]=-f,l[1]=0,l[5]=2*d,l[9]=0,l[13]=-m,l[2]=0,l[6]=0,l[10]=-2*p,l[14]=-v,l[3]=0,l[7]=0,l[11]=0,l[15]=1,this},equals:function(t){const e=this.elements,n=t.elements;for(let i=0;i<16;i++)if(e[i]!==n[i])return!1;return!0},fromArray:function(t,e){void 0===e&&(e=0);for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.elements;return t[e]=n[0],t[e+1]=n[1],t[e+2]=n[2],t[e+3]=n[3],t[e+4]=n[4],t[e+5]=n[5],t[e+6]=n[6],t[e+7]=n[7],t[e+8]=n[8],t[e+9]=n[9],t[e+10]=n[10],t[e+11]=n[11],t[e+12]=n[12],t[e+13]=n[13],t[e+14]=n[14],t[e+15]=n[15],t}});const et=new tt,nt=new G;function it(t=0,e=0,n=0,r=it.DefaultOrder){this._x=t,this._y=e,this._z=n,this._order=r}function ot(){this.mask=1}it.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],it.DefaultOrder="XYZ",Object.defineProperties(it.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(t){this._y=t,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(t){this._z=t,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(t){this._order=t,this._onChangeCallback()}}}),Object.assign(it.prototype,{isEuler:!0,set:function(t,e,n,r){return this._x=t,this._y=e,this._z=n,this._order=r||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this},setFromRotationMatrix:function(t,e,n){const r=O.clamp,o=t.elements,c=o[0],l=o[4],h=o[8],d=o[1],f=o[5],m=o[9],v=o[2],y=o[6],x=o[10];switch(e=e||this._order){case"XYZ":this._y=Math.asin(r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(-m,x),this._z=Math.atan2(-l,c)):(this._x=Math.atan2(y,f),this._z=0);break;case"YXZ":this._x=Math.asin(-r(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(h,x),this._z=Math.atan2(d,f)):(this._y=Math.atan2(-v,c),this._z=0);break;case"ZXY":this._x=Math.asin(r(y,-1,1)),Math.abs(y)<.9999999?(this._y=Math.atan2(-v,x),this._z=Math.atan2(-l,f)):(this._y=0,this._z=Math.atan2(d,c));break;case"ZYX":this._y=Math.asin(-r(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(y,x),this._z=Math.atan2(d,c)):(this._x=0,this._z=Math.atan2(-l,f));break;case"YZX":this._z=Math.asin(r(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(-m,f),this._y=Math.atan2(-v,c)):(this._x=0,this._y=Math.atan2(h,x));break;case"XZY":this._z=Math.asin(-r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(y,f),this._y=Math.atan2(h,c)):(this._x=Math.atan2(-m,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!1!==n&&this._onChangeCallback(),this},setFromQuaternion:function(q,t,e){return et.makeRotationFromQuaternion(q),this.setFromRotationMatrix(et,t,e)},setFromVector3:function(t,e){return this.set(t.x,t.y,t.z,e||this._order)},reorder:function(t){return nt.setFromEuler(this),this.setFromQuaternion(nt,t)},equals:function(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order},fromArray:function(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t},toVector3:function(t){return t?t.set(this._x,this._y,this._z):new W(this._x,this._y,this._z)},_onChange:function(t){return this._onChangeCallback=t,this},_onChangeCallback:function(){}}),Object.assign(ot.prototype,{set:function(t){this.mask=1<<t|0},enable:function(t){this.mask|=1<<t|0},enableAll:function(){this.mask=-1},toggle:function(t){this.mask^=1<<t|0},disable:function(t){this.mask&=~(1<<t|0)},disableAll:function(){this.mask=0},test:function(t){return 0!=(this.mask&t.mask)}});let at=0;const st=new W,ut=new G,ct=new tt,lt=new W,ht=new W,pt=new W,ft=new G,mt=new W(1,0,0),gt=new W(0,1,0),vt=new W(0,0,1),yt={type:"added"},xt={type:"removed"};function bt(){Object.defineProperty(this,"id",{value:at++}),this.uuid=O.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=bt.DefaultUp.clone();const t=new W,e=new it,n=new G,r=new W(1,1,1);e._onChange((function(){n.setFromEuler(e,!1)})),n._onChange((function(){e.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new tt},normalMatrix:{value:new L}}),this.matrix=new tt,this.matrixWorld=new tt,this.matrixAutoUpdate=bt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ot,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function wt(){bt.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}bt.DefaultUp=new W(0,1,0),bt.DefaultMatrixAutoUpdate=!0,bt.prototype=Object.assign(Object.create(I.prototype),{constructor:bt,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(q){return this.quaternion.premultiply(q),this},setRotationFromAxisAngle:function(t,e){this.quaternion.setFromAxisAngle(t,e)},setRotationFromEuler:function(t){this.quaternion.setFromEuler(t,!0)},setRotationFromMatrix:function(t){this.quaternion.setFromRotationMatrix(t)},setRotationFromQuaternion:function(q){this.quaternion.copy(q)},rotateOnAxis:function(t,e){return ut.setFromAxisAngle(t,e),this.quaternion.multiply(ut),this},rotateOnWorldAxis:function(t,e){return ut.setFromAxisAngle(t,e),this.quaternion.premultiply(ut),this},rotateX:function(t){return this.rotateOnAxis(mt,t)},rotateY:function(t){return this.rotateOnAxis(gt,t)},rotateZ:function(t){return this.rotateOnAxis(vt,t)},translateOnAxis:function(t,e){return st.copy(t).applyQuaternion(this.quaternion),this.position.add(st.multiplyScalar(e)),this},translateX:function(t){return this.translateOnAxis(mt,t)},translateY:function(t){return this.translateOnAxis(gt,t)},translateZ:function(t){return this.translateOnAxis(vt,t)},localToWorld:function(t){return t.applyMatrix4(this.matrixWorld)},worldToLocal:function(t){return t.applyMatrix4(ct.getInverse(this.matrixWorld))},lookAt:function(t,e,n){t.isVector3?lt.copy(t):lt.set(t,e,n);const r=this.parent;this.updateWorldMatrix(!0,!1),ht.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ct.lookAt(ht,lt,this.up):ct.lookAt(lt,ht,this.up),this.quaternion.setFromRotationMatrix(ct),r&&(ct.extractRotation(r.matrixWorld),ut.setFromRotationMatrix(ct),this.quaternion.premultiply(ut.inverse()))},add:function(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return object===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",object),this):(object&&object.isObject3D?(null!==object.parent&&object.parent.remove(object),object.parent=this,this.children.push(object),object.dispatchEvent(yt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object),this)},remove:function(object){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(object);return-1!==t&&(object.parent=null,this.children.splice(t,1),object.dispatchEvent(xt)),this},attach:function(object){return this.updateWorldMatrix(!0,!1),ct.getInverse(this.matrixWorld),null!==object.parent&&(object.parent.updateWorldMatrix(!0,!1),ct.multiply(object.parent.matrixWorld)),object.applyMatrix4(ct),object.updateWorldMatrix(!1,!1),this.add(object),this},getObjectById:function(t){return this.getObjectByProperty("id",t)},getObjectByName:function(t){return this.getObjectByProperty("name",t)},getObjectByProperty:function(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const object=this.children[i].getObjectByProperty(t,e);if(void 0!==object)return object}},getWorldPosition:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),t=new W),this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),t=new G),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ht,t,pt),t},getWorldScale:function(t){return void 0===t&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),t=new W),this.updateMatrixWorld(!0),this.matrixWorld.decompose(ht,ft,t),t},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),t=new W),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()},raycast:function(){},traverse:function(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)},traverseVisible:function(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)},traverseAncestors:function(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].updateMatrixWorld(t)},updateWorldMatrix:function(t,e){const n=this.parent;if(!0===t&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let i=0,e=t.length;i<e;i++)t[i].updateWorldMatrix(!1,!0)}},toJSON:function(meta){const t=void 0===meta||"string"==typeof meta,output={};t&&(meta={geometries:{},materials:{},textures:{},images:{},shapes:{}},output.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const object={};function e(t,element){return void 0===t[element.uuid]&&(t[element.uuid]=element.toJSON(meta)),element.uuid}if(object.uuid=this.uuid,object.type=this.type,""!==this.name&&(object.name=this.name),!0===this.castShadow&&(object.castShadow=!0),!0===this.receiveShadow&&(object.receiveShadow=!0),!1===this.visible&&(object.visible=!1),!1===this.frustumCulled&&(object.frustumCulled=!1),0!==this.renderOrder&&(object.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(object.userData=this.userData),object.layers=this.layers.mask,object.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(object.matrixAutoUpdate=!1),this.isInstancedMesh&&(object.type="InstancedMesh",object.count=this.count,object.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){object.geometry=e(meta.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const n=t.shapes;if(Array.isArray(n))for(let i=0,t=n.length;i<t;i++){const t=n[i];e(meta.shapes,t)}else e(meta.shapes,n)}}if(void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(e(meta.materials,this.material[i]));object.material=t}else object.material=e(meta.materials,this.material);if(this.children.length>0){object.children=[];for(let i=0;i<this.children.length;i++)object.children.push(this.children[i].toJSON(meta).object)}if(t){const t=n(meta.geometries),e=n(meta.materials),r=n(meta.textures),o=n(meta.images),c=n(meta.shapes);t.length>0&&(output.geometries=t),e.length>0&&(output.materials=e),r.length>0&&(output.textures=r),o.length>0&&(output.images=o),c.length>0&&(output.shapes=c)}return output.object=object,output;function n(t){const e=[];for(const n in t){const data=t[n];delete data.metadata,e.push(data)}return e}},clone:function(t){return(new this.constructor).copy(this,t)},copy:function(source,t){if(void 0===t&&(t=!0),this.name=source.name,this.up.copy(source.up),this.position.copy(source.position),this.quaternion.copy(source.quaternion),this.scale.copy(source.scale),this.matrix.copy(source.matrix),this.matrixWorld.copy(source.matrixWorld),this.matrixAutoUpdate=source.matrixAutoUpdate,this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate,this.layers.mask=source.layers.mask,this.visible=source.visible,this.castShadow=source.castShadow,this.receiveShadow=source.receiveShadow,this.frustumCulled=source.frustumCulled,this.renderOrder=source.renderOrder,this.userData=JSON.parse(JSON.stringify(source.userData)),!0===t)for(let i=0;i<source.children.length;i++){const t=source.children[i];this.add(t.clone())}return this}}),wt.prototype=Object.assign(Object.create(bt.prototype),{constructor:wt,isScene:!0,copy:function(source,t){return bt.prototype.copy.call(this,source,t),null!==source.background&&(this.background=source.background.clone()),null!==source.environment&&(this.environment=source.environment.clone()),null!==source.fog&&(this.fog=source.fog.clone()),null!==source.overrideMaterial&&(this.overrideMaterial=source.overrideMaterial.clone()),this.autoUpdate=source.autoUpdate,this.matrixAutoUpdate=source.matrixAutoUpdate,this},toJSON:function(meta){const data=bt.prototype.toJSON.call(this,meta);return null!==this.background&&(data.object.background=this.background.toJSON(meta)),null!==this.environment&&(data.object.environment=this.environment.toJSON(meta)),null!==this.fog&&(data.object.fog=this.fog.toJSON()),data},dispose:function(){this.dispatchEvent({type:"dispose"})}});const _t=[new W,new W,new W,new W,new W,new W,new W,new W],St=new W,Mt=new kt,Et=new W,Tt=new W,At=new W,Ct=new W,Rt=new W,It=new W,Nt=new W,Ot=new W,Dt=new W,Lt=new W;function kt(t,e){this.min=void 0!==t?t:new W(1/0,1/0,1/0),this.max=void 0!==e?e:new W(-1/0,-1/0,-1/0)}function Pt(t,e,n,r,o){for(let i=0,c=t.length-3;i<=c;i+=3){Lt.fromArray(t,i);const c=o.x*Math.abs(Lt.x)+o.y*Math.abs(Lt.y)+o.z*Math.abs(Lt.z),l=e.dot(Lt),h=n.dot(Lt),d=r.dot(Lt);if(Math.max(-Math.max(l,h,d),Math.min(l,h,d))>c)return!1}return!0}Object.assign(kt.prototype,{isBox3:!0,set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromArray:function(t){let e=1/0,n=1/0,r=1/0,o=-1/0,c=-1/0,l=-1/0;for(let i=0,h=t.length;i<h;i+=3){const h=t[i],d=t[i+1],f=t[i+2];h<e&&(e=h),d<n&&(n=d),f<r&&(r=f),h>o&&(o=h),d>c&&(c=d),f>l&&(l=f)}return this.min.set(e,n,r),this.max.set(o,c,l),this},setFromBufferAttribute:function(t){let e=1/0,n=1/0,r=1/0,o=-1/0,c=-1/0,l=-1/0;for(let i=0,h=t.count;i<h;i++){const h=t.getX(i),d=t.getY(i),f=t.getZ(i);h<e&&(e=h),d<n&&(n=d),f<r&&(r=f),h>o&&(o=h),d>c&&(c=d),f>l&&(l=f)}return this.min.set(e,n,r),this.max.set(o,c,l),this},setFromPoints:function(t){this.makeEmpty();for(let i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,e){const n=St.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},setFromObject:function(object){return this.makeEmpty(),this.expandByObject(object)},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box3: .getCenter() target is now required"),t=new W),this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box3: .getSize() target is now required"),t=new W),this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},expandByObject:function(object){object.updateWorldMatrix(!1,!1);const t=object.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Mt.copy(t.boundingBox),Mt.applyMatrix4(object.matrixWorld),this.union(Mt));const e=object.children;for(let i=0,t=e.length;i<t;i++)this.expandByObject(e[i]);return this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .getParameter() target is now required"),e=new W),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)},intersectsSphere:function(t){return this.clampPoint(t.center,St),St.distanceToSquared(t.center)<=t.radius*t.radius},intersectsPlane:function(t){let e,n;return t.normal.x>0?(e=t.normal.x*this.min.x,n=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,n=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,n+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,n+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,n+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,n+=t.normal.z*this.min.z),e<=-t.constant&&n>=-t.constant},intersectsTriangle:function(t){if(this.isEmpty())return!1;this.getCenter(Nt),Ot.subVectors(this.max,Nt),Et.subVectors(t.a,Nt),Tt.subVectors(t.b,Nt),At.subVectors(t.c,Nt),Ct.subVectors(Tt,Et),Rt.subVectors(At,Tt),It.subVectors(Et,At);let e=[0,-Ct.z,Ct.y,0,-Rt.z,Rt.y,0,-It.z,It.y,Ct.z,0,-Ct.x,Rt.z,0,-Rt.x,It.z,0,-It.x,-Ct.y,Ct.x,0,-Rt.y,Rt.x,0,-It.y,It.x,0];return!!Pt(e,Et,Tt,At,Ot)&&(e=[1,0,0,0,1,0,0,0,1],!!Pt(e,Et,Tt,At,Ot)&&(Dt.crossVectors(Ct,Rt),e=[Dt.x,Dt.y,Dt.z],Pt(e,Et,Tt,At,Ot)))},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box3: .clampPoint() target is now required"),e=new W),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return St.copy(t).clamp(this.min,this.max).sub(t).length()},getBoundingSphere:function(t){return void 0===t&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(t.center),t.radius=.5*this.getSize(St).length(),t},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},applyMatrix4:function(t){return this.isEmpty()||(_t[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),_t[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),_t[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),_t[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),_t[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),_t[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),_t[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),_t[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(_t)),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Ft=new kt;function Bt(t,e){this.center=void 0!==t?t:new W,this.radius=void 0!==e?e:-1}Object.assign(Bt.prototype,{set:function(t,e){return this.center.copy(t),this.radius=e,this},setFromPoints:function(t,e){const n=this.center;void 0!==e?n.copy(e):Ft.setFromPoints(t).getCenter(n);let r=0;for(let i=0,e=t.length;i<e;i++)r=Math.max(r,n.distanceToSquared(t[i]));return this.radius=Math.sqrt(r),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.center.copy(t.center),this.radius=t.radius,this},isEmpty:function(){return this.radius<0},makeEmpty:function(){return this.center.set(0,0,0),this.radius=-1,this},containsPoint:function(t){return t.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(t){return t.distanceTo(this.center)-this.radius},intersectsSphere:function(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e},intersectsBox:function(t){return t.intersectsSphere(this)},intersectsPlane:function(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius},clampPoint:function(t,e){const n=this.center.distanceToSquared(t);return void 0===e&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),e=new W),e.copy(t),n>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e},getBoundingBox:function(t){return void 0===t&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),t=new kt),this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)},applyMatrix4:function(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this},translate:function(t){return this.center.add(t),this},equals:function(t){return t.center.equals(this.center)&&t.radius===this.radius}});const zt=new W,Ut=new W,Vt=new W,Gt=new W,Ht=new W,jt=new W,Wt=new W;function qt(t,e){this.origin=void 0!==t?t:new W,this.direction=void 0!==e?e:new W(0,0,-1)}Object.assign(qt.prototype,{set:function(t,e){return this.origin.copy(t),this.direction.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this},at:function(t,e){return void 0===e&&(console.warn("THREE.Ray: .at() target is now required"),e=new W),e.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function(t){return this.direction.copy(t).sub(this.origin).normalize(),this},recast:function(t){return this.origin.copy(this.at(t,zt)),this},closestPointToPoint:function(t,e){void 0===e&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),e=new W),e.subVectors(t,this.origin);const n=e.dot(this.direction);return n<0?e.copy(this.origin):e.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(t){return Math.sqrt(this.distanceSqToPoint(t))},distanceSqToPoint:function(t){const e=zt.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(zt.copy(this.direction).multiplyScalar(e).add(this.origin),zt.distanceToSquared(t))},distanceSqToSegment:function(t,e,n,r){Ut.copy(t).add(e).multiplyScalar(.5),Vt.copy(e).sub(t).normalize(),Gt.copy(this.origin).sub(Ut);const o=.5*t.distanceTo(e),c=-this.direction.dot(Vt),l=Gt.dot(this.direction),h=-Gt.dot(Vt),d=Gt.lengthSq(),f=Math.abs(1-c*c);let m,v,y,x;if(f>0)if(m=c*h-l,v=c*l-h,x=o*f,m>=0)if(v>=-x)if(v<=x){const t=1/f;m*=t,v*=t,y=m*(m+c*v+2*l)+v*(c*m+v+2*h)+d}else v=o,m=Math.max(0,-(c*v+l)),y=-m*m+v*(v+2*h)+d;else v=-o,m=Math.max(0,-(c*v+l)),y=-m*m+v*(v+2*h)+d;else v<=-x?(m=Math.max(0,-(-c*o+l)),v=m>0?-o:Math.min(Math.max(-o,-h),o),y=-m*m+v*(v+2*h)+d):v<=x?(m=0,v=Math.min(Math.max(-o,-h),o),y=v*(v+2*h)+d):(m=Math.max(0,-(c*o+l)),v=m>0?o:Math.min(Math.max(-o,-h),o),y=-m*m+v*(v+2*h)+d);else v=c>0?-o:o,m=Math.max(0,-(c*v+l)),y=-m*m+v*(v+2*h)+d;return n&&n.copy(this.direction).multiplyScalar(m).add(this.origin),r&&r.copy(Vt).multiplyScalar(v).add(Ut),y},intersectSphere:function(t,e){zt.subVectors(t.center,this.origin);const n=zt.dot(this.direction),r=zt.dot(zt)-n*n,o=t.radius*t.radius;if(r>o)return null;const c=Math.sqrt(o-r),l=n-c,h=n+c;return l<0&&h<0?null:l<0?this.at(h,e):this.at(l,e)},intersectsSphere:function(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius},distanceToPlane:function(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const n=-(this.origin.dot(t.normal)+t.constant)/e;return n>=0?n:null},intersectPlane:function(t,e){const n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},intersectsPlane:function(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0},intersectBox:function(t,e){let n,r,o,c,l,h;const d=1/this.direction.x,f=1/this.direction.y,m=1/this.direction.z,v=this.origin;return d>=0?(n=(t.min.x-v.x)*d,r=(t.max.x-v.x)*d):(n=(t.max.x-v.x)*d,r=(t.min.x-v.x)*d),f>=0?(o=(t.min.y-v.y)*f,c=(t.max.y-v.y)*f):(o=(t.max.y-v.y)*f,c=(t.min.y-v.y)*f),n>c||o>r?null:((o>n||n!=n)&&(n=o),(c<r||r!=r)&&(r=c),m>=0?(l=(t.min.z-v.z)*m,h=(t.max.z-v.z)*m):(l=(t.max.z-v.z)*m,h=(t.min.z-v.z)*m),n>h||l>r?null:((l>n||n!=n)&&(n=l),(h<r||r!=r)&&(r=h),r<0?null:this.at(n>=0?n:r,e)))},intersectsBox:function(t){return null!==this.intersectBox(t,zt)},intersectTriangle:function(a,b,t,e,n){Ht.subVectors(b,a),jt.subVectors(t,a),Wt.crossVectors(Ht,jt);let r,o=this.direction.dot(Wt);if(o>0){if(e)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}Gt.subVectors(this.origin,a);const c=r*this.direction.dot(jt.crossVectors(Gt,jt));if(c<0)return null;const l=r*this.direction.dot(Ht.cross(Gt));if(l<0)return null;if(c+l>o)return null;const h=-r*Gt.dot(Wt);return h<0?null:this.at(h/o,n)},applyMatrix4:function(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this},equals:function(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}});const Xt=new W,Yt=new W,Kt=new L;function Jt(t,e){this.normal=void 0!==t?t:new W(1,0,0),this.constant=void 0!==e?e:0}Object.assign(Jt.prototype,{isPlane:!0,set:function(t,e){return this.normal.copy(t),this.constant=e,this},setComponents:function(t,e,n,r){return this.normal.set(t,e,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this},setFromCoplanarPoints:function(a,b,t){const e=Xt.subVectors(t,b).cross(Yt.subVectors(a,b)).normalize();return this.setFromNormalAndCoplanarPoint(e,a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.normal.copy(t.normal),this.constant=t.constant,this},normalize:function(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(t){return this.normal.dot(t)+this.constant},distanceToSphere:function(t){return this.distanceToPoint(t.center)-t.radius},projectPoint:function(t,e){return void 0===e&&(console.warn("THREE.Plane: .projectPoint() target is now required"),e=new W),e.copy(this.normal).multiplyScalar(-this.distanceToPoint(t)).add(t)},intersectLine:function(line,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new W);const e=line.delta(Xt),n=this.normal.dot(e);if(0===n)return 0===this.distanceToPoint(line.start)?t.copy(line.start):void 0;const r=-(line.start.dot(this.normal)+this.constant)/n;return r<0||r>1?void 0:t.copy(e).multiplyScalar(r).add(line.start)},intersectsLine:function(line){const t=this.distanceToPoint(line.start),e=this.distanceToPoint(line.end);return t<0&&e>0||e<0&&t>0},intersectsBox:function(t){return t.intersectsPlane(this)},intersectsSphere:function(t){return t.intersectsPlane(this)},coplanarPoint:function(t){return void 0===t&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),t=new W),t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(t,e){const n=e||Kt.getNormalMatrix(t),r=this.coplanarPoint(Xt).applyMatrix4(t),o=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(o),this},translate:function(t){return this.constant-=t.dot(this.normal),this},equals:function(t){return t.normal.equals(this.normal)&&t.constant===this.constant}});const Zt=new W,Qt=new W,$t=new W,te=new W,ee=new W,ne=new W,re=new W,ie=new W,oe=new W,ae=new W;function se(a,b,t){this.a=void 0!==a?a:new W,this.b=void 0!==b?b:new W,this.c=void 0!==t?t:new W}Object.assign(se,{getNormal:function(a,b,t,e){void 0===e&&(console.warn("THREE.Triangle: .getNormal() target is now required"),e=new W),e.subVectors(t,b),Zt.subVectors(a,b),e.cross(Zt);const n=e.lengthSq();return n>0?e.multiplyScalar(1/Math.sqrt(n)):e.set(0,0,0)},getBarycoord:function(t,a,b,e,n){Zt.subVectors(e,a),Qt.subVectors(b,a),$t.subVectors(t,a);const r=Zt.dot(Zt),o=Zt.dot(Qt),c=Zt.dot($t),l=Qt.dot(Qt),h=Qt.dot($t),d=r*l-o*o;if(void 0===n&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),n=new W),0===d)return n.set(-2,-1,-1);const f=1/d,u=(l*c-o*h)*f,m=(r*h-o*c)*f;return n.set(1-u-m,m,u)},containsPoint:function(t,a,b,e){return se.getBarycoord(t,a,b,e,te),te.x>=0&&te.y>=0&&te.x+te.y<=1},getUV:function(t,e,n,r,o,c,l,h){return this.getBarycoord(t,e,n,r,te),h.set(0,0),h.addScaledVector(o,te.x),h.addScaledVector(c,te.y),h.addScaledVector(l,te.z),h},isFrontFacing:function(a,b,t,e){return Zt.subVectors(t,b),Qt.subVectors(a,b),Zt.cross(Qt).dot(e)<0}}),Object.assign(se.prototype,{set:function(a,b,t){return this.a.copy(a),this.b.copy(b),this.c.copy(t),this},setFromPointsAndIndices:function(t,e,n,r){return this.a.copy(t[e]),this.b.copy(t[n]),this.c.copy(t[r]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this},getArea:function(){return Zt.subVectors(this.c,this.b),Qt.subVectors(this.a,this.b),.5*Zt.cross(Qt).length()},getMidpoint:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),t=new W),t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(t){return se.getNormal(this.a,this.b,this.c,t)},getPlane:function(t){return void 0===t&&(console.warn("THREE.Triangle: .getPlane() target is now required"),t=new Jt),t.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(t,e){return se.getBarycoord(t,this.a,this.b,this.c,e)},getUV:function(t,e,n,r,o){return se.getUV(t,this.a,this.b,this.c,e,n,r,o)},containsPoint:function(t){return se.containsPoint(t,this.a,this.b,this.c)},isFrontFacing:function(t){return se.isFrontFacing(this.a,this.b,this.c,t)},intersectsBox:function(t){return t.intersectsTriangle(this)},closestPointToPoint:function(p,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new W);const a=this.a,b=this.b,e=this.c;let n,r;ee.subVectors(b,a),ne.subVectors(e,a),ie.subVectors(p,a);const o=ee.dot(ie),c=ne.dot(ie);if(o<=0&&c<=0)return t.copy(a);oe.subVectors(p,b);const l=ee.dot(oe),h=ne.dot(oe);if(l>=0&&h<=l)return t.copy(b);const d=o*h-l*c;if(d<=0&&o>=0&&l<=0)return n=o/(o-l),t.copy(a).addScaledVector(ee,n);ae.subVectors(p,e);const f=ee.dot(ae),m=ne.dot(ae);if(m>=0&&f<=m)return t.copy(e);const v=f*c-o*m;if(v<=0&&c>=0&&m<=0)return r=c/(c-m),t.copy(a).addScaledVector(ne,r);const y=l*m-f*h;if(y<=0&&h-l>=0&&f-m>=0)return re.subVectors(e,b),r=(h-l)/(h-l+(f-m)),t.copy(b).addScaledVector(re,r);const x=1/(y+v+d);return n=v*x,r=d*x,t.copy(a).addScaledVector(ee,n).addScaledVector(ne,r)},equals:function(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}});const ue={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ce={h:0,s:0,l:0},le={h:0,s:0,l:0};function he(t,g,b){return void 0===g&&void 0===b?this.set(t):this.setRGB(t,g,b)}function pe(p,q,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?p+6*(q-p)*t:t<.5?q:t<2/3?p+6*(q-p)*(2/3-t):p}function de(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function fe(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}function me(a,b,t,e,n,r){this.a=a,this.b=b,this.c=t,this.normal=e&&e.isVector3?e:new W,this.vertexNormals=Array.isArray(e)?e:[],this.color=n&&n.isColor?n:new he,this.vertexColors=Array.isArray(n)?n:[],this.materialIndex=void 0!==r?r:0}Object.assign(he.prototype,{isColor:!0,r:1,g:1,b:1,set:function(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this},setScalar:function(t){return this.r=t,this.g=t,this.b=t,this},setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,g,b){return this.r=t,this.g=g,this.b=b,this},setHSL:function(t,s,e){if(t=O.euclideanModulo(t,1),s=O.clamp(s,0,1),e=O.clamp(e,0,1),0===s)this.r=this.g=this.b=e;else{const p=e<=.5?e*(1+s):e+s-e*s,q=2*e-p;this.r=pe(q,p,t+1/3),this.g=pe(q,p,t),this.b=pe(q,p,t-1/3)}return this},setStyle:function(style){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+style+" will be ignored.")}let e;if(e=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){let n;const r=e[1],o=e[2];switch(r){case"rgb":case"rgba":if(n=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(n[1],10))/255,this.g=Math.min(255,parseInt(n[2],10))/255,this.b=Math.min(255,parseInt(n[3],10))/255,t(n[5]),this;if(n=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(n[1],10))/100,this.g=Math.min(100,parseInt(n[2],10))/100,this.b=Math.min(100,parseInt(n[3],10))/100,t(n[5]),this;break;case"hsl":case"hsla":if(n=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(o)){const e=parseFloat(n[1])/360,s=parseInt(n[2],10)/100,r=parseInt(n[3],10)/100;return t(n[5]),this.setHSL(e,s,r)}}}else if(e=/^\#([A-Fa-f0-9]+)$/.exec(style)){const t=e[1],n=t.length;if(3===n)return this.r=parseInt(t.charAt(0)+t.charAt(0),16)/255,this.g=parseInt(t.charAt(1)+t.charAt(1),16)/255,this.b=parseInt(t.charAt(2)+t.charAt(2),16)/255,this;if(6===n)return this.r=parseInt(t.charAt(0)+t.charAt(1),16)/255,this.g=parseInt(t.charAt(2)+t.charAt(3),16)/255,this.b=parseInt(t.charAt(4)+t.charAt(5),16)/255,this}return style&&style.length>0?this.setColorName(style):this},setColorName:function(style){const t=ue[style];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+style),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this},copyGammaToLinear:function(t,e){return void 0===e&&(e=2),this.r=Math.pow(t.r,e),this.g=Math.pow(t.g,e),this.b=Math.pow(t.b,e),this},copyLinearToGamma:function(t,e){void 0===e&&(e=2);const n=e>0?1/e:1;return this.r=Math.pow(t.r,n),this.g=Math.pow(t.g,n),this.b=Math.pow(t.b,n),this},convertGammaToLinear:function(t){return this.copyGammaToLinear(this,t),this},convertLinearToGamma:function(t){return this.copyLinearToGamma(this,t),this},copySRGBToLinear:function(t){return this.r=de(t.r),this.g=de(t.g),this.b=de(t.b),this},copyLinearToSRGB:function(t){return this.r=fe(t.r),this.g=fe(t.g),this.b=fe(t.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(t){void 0===t&&(console.warn("THREE.Color: .getHSL() target is now required"),t={h:0,s:0,l:0});const e=this.r,g=this.g,b=this.b,n=Math.max(e,g,b),r=Math.min(e,g,b);let o,c;const l=(r+n)/2;if(r===n)o=0,c=0;else{const t=n-r;switch(c=l<=.5?t/(n+r):t/(2-n-r),n){case e:o=(g-b)/t+(g<b?6:0);break;case g:o=(b-e)/t+2;break;case b:o=(e-g)/t+4}o/=6}return t.h=o,t.s=c,t.l=l,t},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(t,s,e){return this.getHSL(ce),ce.h+=t,ce.s+=s,ce.l+=e,this.setHSL(ce.h,ce.s,ce.l),this},add:function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this},addColors:function(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this},addScalar:function(s){return this.r+=s,this.g+=s,this.b+=s,this},sub:function(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this},multiply:function(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this},multiplyScalar:function(s){return this.r*=s,this.g*=s,this.b*=s,this},lerp:function(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this},lerpHSL:function(t,e){this.getHSL(ce),t.getHSL(le);const n=O.lerp(ce.h,le.h,e),s=O.lerp(ce.s,le.s,e),r=O.lerp(ce.l,le.l,e);return this.setHSL(n,s,r),this},equals:function(t){return t.r===this.r&&t.g===this.g&&t.b===this.b},fromArray:function(t,e){return void 0===e&&(e=0),this.r=t[e],this.g=t[e+1],this.b=t[e+2],this},toArray:function(t,e){return void 0===t&&(t=[]),void 0===e&&(e=0),t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t},fromBufferAttribute:function(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),!0===t.normalized&&(this.r/=255,this.g/=255,this.b/=255),this},toJSON:function(){return this.getHex()}}),he.NAMES=ue,Object.assign(me.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.a=source.a,this.b=source.b,this.c=source.c,this.normal.copy(source.normal),this.color.copy(source.color),this.materialIndex=source.materialIndex;for(let i=0,t=source.vertexNormals.length;i<t;i++)this.vertexNormals[i]=source.vertexNormals[i].clone();for(let i=0,t=source.vertexColors.length;i<t;i++)this.vertexColors[i]=source.vertexColors[i].clone();return this}});let ge=0;function ve(){Object.defineProperty(this,"id",{value:ge++}),this.uuid=O.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=r,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function ye(t){ve.call(this),this.type="MeshBasicMaterial",this.color=new he(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(t)}ve.prototype=Object.assign(Object.create(I.prototype),{constructor:ve,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(t){if(void 0!==t)for(const e in t){const n=t[e];if(void 0===n){console.warn("THREE.Material: '"+e+"' parameter is undefined.");continue}if("shading"===e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;continue}const r=this[e];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[e]=n:console.warn("THREE."+this.type+": '"+e+"' is not a property of this material.")}},toJSON:function(meta){const t=void 0===meta||"string"==typeof meta;t&&(meta={textures:{},images:{}});const data={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function e(t){const e=[];for(const n in t){const data=t[n];delete data.metadata,e.push(data)}return e}if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),this.color&&this.color.isColor&&(data.color=this.color.getHex()),void 0!==this.roughness&&(data.roughness=this.roughness),void 0!==this.metalness&&(data.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(data.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(data.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(data.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(data.specular=this.specular.getHex()),void 0!==this.shininess&&(data.shininess=this.shininess),void 0!==this.clearcoat&&(data.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(data.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(data.clearcoatMap=this.clearcoatMap.toJSON(meta).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(data.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(meta).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(data.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(meta).uuid,data.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(data.map=this.map.toJSON(meta).uuid),this.matcap&&this.matcap.isTexture&&(data.matcap=this.matcap.toJSON(meta).uuid),this.alphaMap&&this.alphaMap.isTexture&&(data.alphaMap=this.alphaMap.toJSON(meta).uuid),this.lightMap&&this.lightMap.isTexture&&(data.lightMap=this.lightMap.toJSON(meta).uuid),this.aoMap&&this.aoMap.isTexture&&(data.aoMap=this.aoMap.toJSON(meta).uuid,data.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(data.bumpMap=this.bumpMap.toJSON(meta).uuid,data.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(data.normalMap=this.normalMap.toJSON(meta).uuid,data.normalMapType=this.normalMapType,data.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(data.displacementMap=this.displacementMap.toJSON(meta).uuid,data.displacementScale=this.displacementScale,data.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(data.roughnessMap=this.roughnessMap.toJSON(meta).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(data.metalnessMap=this.metalnessMap.toJSON(meta).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(data.emissiveMap=this.emissiveMap.toJSON(meta).uuid),this.specularMap&&this.specularMap.isTexture&&(data.specularMap=this.specularMap.toJSON(meta).uuid),this.envMap&&this.envMap.isTexture&&(data.envMap=this.envMap.toJSON(meta).uuid,data.reflectivity=this.reflectivity,data.refractionRatio=this.refractionRatio,void 0!==this.combine&&(data.combine=this.combine),void 0!==this.envMapIntensity&&(data.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(data.gradientMap=this.gradientMap.toJSON(meta).uuid),void 0!==this.size&&(data.size=this.size),void 0!==this.sizeAttenuation&&(data.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(data.blending=this.blending),!0===this.flatShading&&(data.flatShading=this.flatShading),this.side!==r&&(data.side=this.side),this.vertexColors&&(data.vertexColors=!0),this.opacity<1&&(data.opacity=this.opacity),!0===this.transparent&&(data.transparent=this.transparent),data.depthFunc=this.depthFunc,data.depthTest=this.depthTest,data.depthWrite=this.depthWrite,data.stencilWrite=this.stencilWrite,data.stencilWriteMask=this.stencilWriteMask,data.stencilFunc=this.stencilFunc,data.stencilRef=this.stencilRef,data.stencilFuncMask=this.stencilFuncMask,data.stencilFail=this.stencilFail,data.stencilZFail=this.stencilZFail,data.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(data.rotation=this.rotation),!0===this.polygonOffset&&(data.polygonOffset=!0),0!==this.polygonOffsetFactor&&(data.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(data.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(data.linewidth=this.linewidth),void 0!==this.dashSize&&(data.dashSize=this.dashSize),void 0!==this.gapSize&&(data.gapSize=this.gapSize),void 0!==this.scale&&(data.scale=this.scale),!0===this.dithering&&(data.dithering=!0),this.alphaTest>0&&(data.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(data.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(data.wireframe=this.wireframe),this.wireframeLinewidth>1&&(data.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(data.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(data.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(data.morphTargets=!0),!0===this.morphNormals&&(data.morphNormals=!0),!0===this.skinning&&(data.skinning=!0),!1===this.visible&&(data.visible=!1),!1===this.toneMapped&&(data.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(data.userData=this.userData),t){const t=e(meta.textures),n=e(meta.images);t.length>0&&(data.textures=t),n.length>0&&(data.images=n)}return data},clone:function(){return(new this.constructor).copy(this)},copy:function(source){this.name=source.name,this.fog=source.fog,this.blending=source.blending,this.side=source.side,this.flatShading=source.flatShading,this.vertexColors=source.vertexColors,this.opacity=source.opacity,this.transparent=source.transparent,this.blendSrc=source.blendSrc,this.blendDst=source.blendDst,this.blendEquation=source.blendEquation,this.blendSrcAlpha=source.blendSrcAlpha,this.blendDstAlpha=source.blendDstAlpha,this.blendEquationAlpha=source.blendEquationAlpha,this.depthFunc=source.depthFunc,this.depthTest=source.depthTest,this.depthWrite=source.depthWrite,this.stencilWriteMask=source.stencilWriteMask,this.stencilFunc=source.stencilFunc,this.stencilRef=source.stencilRef,this.stencilFuncMask=source.stencilFuncMask,this.stencilFail=source.stencilFail,this.stencilZFail=source.stencilZFail,this.stencilZPass=source.stencilZPass,this.stencilWrite=source.stencilWrite;const t=source.clippingPlanes;let e=null;if(null!==t){const n=t.length;e=new Array(n);for(let i=0;i!==n;++i)e[i]=t[i].clone()}return this.clippingPlanes=e,this.clipIntersection=source.clipIntersection,this.clipShadows=source.clipShadows,this.shadowSide=source.shadowSide,this.colorWrite=source.colorWrite,this.precision=source.precision,this.polygonOffset=source.polygonOffset,this.polygonOffsetFactor=source.polygonOffsetFactor,this.polygonOffsetUnits=source.polygonOffsetUnits,this.dithering=source.dithering,this.alphaTest=source.alphaTest,this.premultipliedAlpha=source.premultipliedAlpha,this.visible=source.visible,this.toneMapped=source.toneMapped,this.userData=JSON.parse(JSON.stringify(source.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(ve.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),ye.prototype=Object.create(ve.prototype),ye.prototype.constructor=ye,ye.prototype.isMeshBasicMaterial=!0,ye.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this};const xe=new W,be=new D;function we(t,e,n){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=!0===n,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}function _e(t,e,n){we.call(this,new Int8Array(t),e,n)}function Se(t,e,n){we.call(this,new Uint8Array(t),e,n)}function Me(t,e,n){we.call(this,new Uint8ClampedArray(t),e,n)}function Ee(t,e,n){we.call(this,new Int16Array(t),e,n)}function Te(t,e,n){we.call(this,new Uint16Array(t),e,n)}function Ae(t,e,n){we.call(this,new Int32Array(t),e,n)}function Ce(t,e,n){we.call(this,new Uint32Array(t),e,n)}function Re(t,e,n){we.call(this,new Float32Array(t),e,n)}function Ie(t,e,n){we.call(this,new Float64Array(t),e,n)}function Ne(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Oe(t){if(0===t.length)return-1/0;let e=t[0];for(let i=1,n=t.length;i<n;++i)t[i]>e&&(e=t[i]);return e}Object.defineProperty(we.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(we.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(source){return this.name=source.name,this.array=new source.array.constructor(source.array),this.itemSize=source.itemSize,this.count=source.count,this.normalized=source.normalized,this.usage=source.usage,this},copyAt:function(t,e,n){t*=this.itemSize,n*=e.itemSize;for(let i=0,r=this.itemSize;i<r;i++)this.array[t+i]=e.array[n+i];return this},copyArray:function(t){return this.array.set(t),this},copyColorsArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),r=new he),e[n++]=r.r,e[n++]=r.g,e[n++]=r.b}return this},copyVector2sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),r=new D),e[n++]=r.x,e[n++]=r.y}return this},copyVector3sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),r=new W),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z}return this},copyVector4sArray:function(t){const e=this.array;let n=0;for(let i=0,r=t.length;i<r;i++){let r=t[i];void 0===r&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),r=new z),e[n++]=r.x,e[n++]=r.y,e[n++]=r.z,e[n++]=r.w}return this},applyMatrix3:function(t){if(2===this.itemSize)for(let i=0,e=this.count;i<e;i++)be.fromBufferAttribute(this,i),be.applyMatrix3(t),this.setXY(i,be.x,be.y);else if(3===this.itemSize)for(let i=0,e=this.count;i<e;i++)xe.fromBufferAttribute(this,i),xe.applyMatrix3(t),this.setXYZ(i,xe.x,xe.y,xe.z);return this},applyMatrix4:function(t){for(let i=0,e=this.count;i<e;i++)xe.x=this.getX(i),xe.y=this.getY(i),xe.z=this.getZ(i),xe.applyMatrix4(t),this.setXYZ(i,xe.x,xe.y,xe.z);return this},applyNormalMatrix:function(t){for(let i=0,e=this.count;i<e;i++)xe.x=this.getX(i),xe.y=this.getY(i),xe.z=this.getZ(i),xe.applyNormalMatrix(t),this.setXYZ(i,xe.x,xe.y,xe.z);return this},transformDirection:function(t){for(let i=0,e=this.count;i<e;i++)xe.x=this.getX(i),xe.y=this.getY(i),xe.z=this.getZ(i),xe.transformDirection(t),this.setXYZ(i,xe.x,xe.y,xe.z);return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},getX:function(t){return this.array[t*this.itemSize]},setX:function(t,e){return this.array[t*this.itemSize]=e,this},getY:function(t){return this.array[t*this.itemSize+1]},setY:function(t,e){return this.array[t*this.itemSize+1]=e,this},getZ:function(t){return this.array[t*this.itemSize+2]},setZ:function(t,e){return this.array[t*this.itemSize+2]=e,this},getW:function(t){return this.array[t*this.itemSize+3]},setW:function(t,e){return this.array[t*this.itemSize+3]=e,this},setXY:function(t,e,n){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this},setXYZW:function(t,e,n,r,o){return t*=this.itemSize,this.array[t+0]=e,this.array[t+1]=n,this.array[t+2]=r,this.array[t+3]=o,this},onUpload:function(t){return this.onUploadCallback=t,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),_e.prototype=Object.create(we.prototype),_e.prototype.constructor=_e,Se.prototype=Object.create(we.prototype),Se.prototype.constructor=Se,Me.prototype=Object.create(we.prototype),Me.prototype.constructor=Me,Ee.prototype=Object.create(we.prototype),Ee.prototype.constructor=Ee,Te.prototype=Object.create(we.prototype),Te.prototype.constructor=Te,Ae.prototype=Object.create(we.prototype),Ae.prototype.constructor=Ae,Ce.prototype=Object.create(we.prototype),Ce.prototype.constructor=Ce,Re.prototype=Object.create(we.prototype),Re.prototype.constructor=Re,Ie.prototype=Object.create(we.prototype),Ie.prototype.constructor=Ie,Object.assign(Ne.prototype,{computeGroups:function(t){const e=[];let n,i,r=void 0;const o=t.faces;for(i=0;i<o.length;i++){const t=o[i];t.materialIndex!==r&&(r=t.materialIndex,void 0!==n&&(n.count=3*i-n.start,e.push(n)),n={start:3*i,materialIndex:r})}void 0!==n&&(n.count=3*i-n.start,e.push(n)),this.groups=e},fromGeometry:function(t){const e=t.faces,n=t.vertices,r=t.faceVertexUvs,o=r[0]&&r[0].length>0,c=r[1]&&r[1].length>0,l=t.morphTargets,h=l.length;let d;if(h>0){d=[];for(let i=0;i<h;i++)d[i]={name:l[i].name,data:[]};this.morphTargets.position=d}const f=t.morphNormals,m=f.length;let v;if(m>0){v=[];for(let i=0;i<m;i++)v[i]={name:f[i].name,data:[]};this.morphTargets.normal=v}const y=t.skinIndices,x=t.skinWeights,w=y.length===n.length,_=x.length===n.length;n.length>0&&0===e.length&&console.error("THREE.DirectGeometry: Faceless geometries are not supported.");for(let i=0;i<e.length;i++){const t=e[i];this.vertices.push(n[t.a],n[t.b],n[t.c]);const S=t.vertexNormals;if(3===S.length)this.normals.push(S[0],S[1],S[2]);else{const e=t.normal;this.normals.push(e,e,e)}const M=t.vertexColors;if(3===M.length)this.colors.push(M[0],M[1],M[2]);else{const e=t.color;this.colors.push(e,e,e)}if(!0===o){const t=r[0][i];void 0!==t?this.uvs.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",i),this.uvs.push(new D,new D,new D))}if(!0===c){const t=r[1][i];void 0!==t?this.uvs2.push(t[0],t[1],t[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i),this.uvs2.push(new D,new D,new D))}for(let e=0;e<h;e++){const n=l[e].vertices;d[e].data.push(n[t.a],n[t.b],n[t.c])}for(let t=0;t<m;t++){const e=f[t].vertexNormals[i];v[t].data.push(e.a,e.b,e.c)}w&&this.skinIndices.push(y[t.a],y[t.b],y[t.c]),_&&this.skinWeights.push(x[t.a],x[t.b],x[t.c])}return this.computeGroups(t),this.verticesNeedUpdate=t.verticesNeedUpdate,this.normalsNeedUpdate=t.normalsNeedUpdate,this.colorsNeedUpdate=t.colorsNeedUpdate,this.uvsNeedUpdate=t.uvsNeedUpdate,this.groupsNeedUpdate=t.groupsNeedUpdate,null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this}});let De=1;const Le=new tt,ke=new bt,Pe=new W,Fe=new kt,Be=new kt,ze=new W;function Ue(){Object.defineProperty(this,"id",{value:De+=2}),this.uuid=O.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}Ue.prototype=Object.assign(Object.create(I.prototype),{constructor:Ue,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(t){Array.isArray(t)?this.index=new(Oe(t)>65535?Ce:Te)(t,1):this.index=t},getAttribute:function(t){return this.attributes[t]},setAttribute:function(t,e){return this.attributes[t]=e,this},deleteAttribute:function(t){return delete this.attributes[t],this},addGroup:function(t,e,n){this.groups.push({start:t,count:e,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(t,e){this.drawRange.start=t,this.drawRange.count=e},applyMatrix4:function(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const n=this.attributes.normal;if(void 0!==n){const e=(new L).getNormalMatrix(t);n.applyNormalMatrix(e),n.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(t),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(t){return Le.makeRotationX(t),this.applyMatrix4(Le),this},rotateY:function(t){return Le.makeRotationY(t),this.applyMatrix4(Le),this},rotateZ:function(t){return Le.makeRotationZ(t),this.applyMatrix4(Le),this},translate:function(t,e,n){return Le.makeTranslation(t,e,n),this.applyMatrix4(Le),this},scale:function(t,e,n){return Le.makeScale(t,e,n),this.applyMatrix4(Le),this},lookAt:function(t){return ke.lookAt(t),ke.updateMatrix(),this.applyMatrix4(ke.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(Pe).negate(),this.translate(Pe.x,Pe.y,Pe.z),this},setFromObject:function(object){const t=object.geometry;if(object.isPoints||object.isLine){const e=new Re(3*t.vertices.length,3),n=new Re(3*t.colors.length,3);if(this.setAttribute("position",e.copyVector3sArray(t.vertices)),this.setAttribute("color",n.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){const e=new Re(t.lineDistances.length,1);this.setAttribute("lineDistance",e.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else object.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Re(e,3)),this},updateFromObject:function(object){let t=object.geometry;if(object.isMesh){let e=t.__directGeometry;if(!0===t.elementsNeedUpdate&&(e=void 0,t.elementsNeedUpdate=!1),void 0===e)return this.fromGeometry(t);e.verticesNeedUpdate=t.verticesNeedUpdate,e.normalsNeedUpdate=t.normalsNeedUpdate,e.colorsNeedUpdate=t.colorsNeedUpdate,e.uvsNeedUpdate=t.uvsNeedUpdate,e.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=e}if(!0===t.verticesNeedUpdate){const e=this.attributes.position;void 0!==e&&(e.copyVector3sArray(t.vertices),e.needsUpdate=!0),t.verticesNeedUpdate=!1}if(!0===t.normalsNeedUpdate){const e=this.attributes.normal;void 0!==e&&(e.copyVector3sArray(t.normals),e.needsUpdate=!0),t.normalsNeedUpdate=!1}if(!0===t.colorsNeedUpdate){const e=this.attributes.color;void 0!==e&&(e.copyColorsArray(t.colors),e.needsUpdate=!0),t.colorsNeedUpdate=!1}if(t.uvsNeedUpdate){const e=this.attributes.uv;void 0!==e&&(e.copyVector2sArray(t.uvs),e.needsUpdate=!0),t.uvsNeedUpdate=!1}if(t.lineDistancesNeedUpdate){const e=this.attributes.lineDistance;void 0!==e&&(e.copyArray(t.lineDistances),e.needsUpdate=!0),t.lineDistancesNeedUpdate=!1}return t.groupsNeedUpdate&&(t.computeGroups(object.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(t){return t.__directGeometry=(new Ne).fromGeometry(t),this.fromDirectGeometry(t.__directGeometry)},fromDirectGeometry:function(t){const e=new Float32Array(3*t.vertices.length);if(this.setAttribute("position",new we(e,3).copyVector3sArray(t.vertices)),t.normals.length>0){const e=new Float32Array(3*t.normals.length);this.setAttribute("normal",new we(e,3).copyVector3sArray(t.normals))}if(t.colors.length>0){const e=new Float32Array(3*t.colors.length);this.setAttribute("color",new we(e,3).copyColorsArray(t.colors))}if(t.uvs.length>0){const e=new Float32Array(2*t.uvs.length);this.setAttribute("uv",new we(e,2).copyVector2sArray(t.uvs))}if(t.uvs2.length>0){const e=new Float32Array(2*t.uvs2.length);this.setAttribute("uv2",new we(e,2).copyVector2sArray(t.uvs2))}this.groups=t.groups;for(const e in t.morphTargets){const n=[],r=t.morphTargets[e];for(let i=0,t=r.length;i<t;i++){const t=r[i],e=new Re(3*t.data.length,3);e.name=t.name,n.push(e.copyVector3sArray(t.data))}this.morphAttributes[e]=n}if(t.skinIndices.length>0){const e=new Re(4*t.skinIndices.length,4);this.setAttribute("skinIndex",e.copyVector4sArray(t.skinIndices))}if(t.skinWeights.length>0){const e=new Re(4*t.skinWeights.length,4);this.setAttribute("skinWeight",e.copyVector4sArray(t.skinWeights))}return null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new kt);const t=this.attributes.position,e=this.morphAttributes.position;if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let i=0,t=e.length;i<t;i++){const t=e[i];Fe.setFromBufferAttribute(t),this.morphTargetsRelative?(ze.addVectors(this.boundingBox.min,Fe.min),this.boundingBox.expandByPoint(ze),ze.addVectors(this.boundingBox.max,Fe.max),this.boundingBox.expandByPoint(ze)):(this.boundingBox.expandByPoint(Fe.min),this.boundingBox.expandByPoint(Fe.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Bt);const t=this.attributes.position,e=this.morphAttributes.position;if(t){const n=this.boundingSphere.center;if(Fe.setFromBufferAttribute(t),e)for(let i=0,t=e.length;i<t;i++){const t=e[i];Be.setFromBufferAttribute(t),this.morphTargetsRelative?(ze.addVectors(Fe.min,Be.min),Fe.expandByPoint(ze),ze.addVectors(Fe.max,Be.max),Fe.expandByPoint(ze)):(Fe.expandByPoint(Be.min),Fe.expandByPoint(Be.max))}Fe.getCenter(n);let r=0;for(let i=0,e=t.count;i<e;i++)ze.fromBufferAttribute(t,i),r=Math.max(r,n.distanceToSquared(ze));if(e)for(let i=0,o=e.length;i<o;i++){const o=e[i],c=this.morphTargetsRelative;for(let e=0,l=o.count;e<l;e++)ze.fromBufferAttribute(o,e),c&&(Pe.fromBufferAttribute(t,e),ze.add(Pe)),r=Math.max(r,n.distanceToSquared(ze))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let n=this.getAttribute("normal");if(void 0===n)n=new we(new Float32Array(3*e.count),3),this.setAttribute("normal",n);else for(let i=0,t=n.count;i<t;i++)n.setXYZ(i,0,0,0);const r=new W,o=new W,c=new W,l=new W,h=new W,d=new W,f=new W,m=new W;if(t)for(let i=0,v=t.count;i<v;i+=3){const v=t.getX(i+0),y=t.getX(i+1),x=t.getX(i+2);r.fromBufferAttribute(e,v),o.fromBufferAttribute(e,y),c.fromBufferAttribute(e,x),f.subVectors(c,o),m.subVectors(r,o),f.cross(m),l.fromBufferAttribute(n,v),h.fromBufferAttribute(n,y),d.fromBufferAttribute(n,x),l.add(f),h.add(f),d.add(f),n.setXYZ(v,l.x,l.y,l.z),n.setXYZ(y,h.x,h.y,h.z),n.setXYZ(x,d.x,d.y,d.z)}else for(let i=0,t=e.count;i<t;i+=3)r.fromBufferAttribute(e,i+0),o.fromBufferAttribute(e,i+1),c.fromBufferAttribute(e,i+2),f.subVectors(c,o),m.subVectors(r,o),f.cross(m),n.setXYZ(i+0,f.x,f.y,f.z),n.setXYZ(i+1,f.x,f.y,f.z),n.setXYZ(i+2,f.x,f.y,f.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(t,e){if(!t||!t.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",t);void 0===e&&(e=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const n=this.attributes;for(const r in n){if(void 0===t.attributes[r])continue;const o=n[r].array,c=t.attributes[r],l=c.array,h=c.itemSize*e,d=Math.min(l.length,o.length-h);for(let i=0,t=h;i<d;i++,t++)o[t]=l[i]}return this},normalizeNormals:function(){const t=this.attributes.normal;for(let i=0,e=t.count;i<e;i++)ze.fromBufferAttribute(t,i),ze.normalize(),t.setXYZ(i,ze.x,ze.y,ze.z)},toNonIndexed:function(){function t(t,e){const n=t.array,r=t.itemSize,o=t.normalized,c=new n.constructor(e.length*r);let l=0,h=0;for(let i=0,t=e.length;i<t;i++){l=e[i]*r;for(let t=0;t<r;t++)c[h++]=n[l++]}return new we(c,r,o)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;const e=new Ue,n=this.index.array,r=this.attributes;for(const o in r){const c=t(r[o],n);e.setAttribute(o,c)}const o=this.morphAttributes;for(const r in o){const c=[],l=o[r];for(let i=0,e=l.length;i<e;i++){const e=t(l[i],n);c.push(e)}e.morphAttributes[r]=c}e.morphTargetsRelative=this.morphTargetsRelative;const c=this.groups;for(let i=0,t=c.length;i<t;i++){const t=c[i];e.addGroup(t.start,t.count,t.materialIndex)}return e},toJSON:function(){const data={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),Object.keys(this.userData).length>0&&(data.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const e in t)void 0!==t[e]&&(data[e]=t[e]);return data}data.data={attributes:{}};const t=this.index;null!==t&&(data.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const e=this.attributes;for(const t in e){const n=e[t],r=n.toJSON(data.data);""!==n.name&&(r.name=n.name),data.data.attributes[t]=r}const n={};let r=!1;for(const t in this.morphAttributes){const e=this.morphAttributes[t],o=[];for(let i=0,t=e.length;i<t;i++){const t=e[i],n=t.toJSON(data.data);""!==t.name&&(n.name=t.name),o.push(n)}o.length>0&&(n[t]=o,r=!0)}r&&(data.data.morphAttributes=n,data.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(data.data.groups=JSON.parse(JSON.stringify(o)));const c=this.boundingSphere;return null!==c&&(data.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),data},clone:function(){return(new Ue).copy(this)},copy:function(source){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const data={};this.name=source.name;const t=source.index;null!==t&&this.setIndex(t.clone(data));const e=source.attributes;for(const t in e){const n=e[t];this.setAttribute(t,n.clone(data))}const n=source.morphAttributes;for(const t in n){const e=[],r=n[t];for(let i=0,t=r.length;i<t;i++)e.push(r[i].clone(data));this.morphAttributes[t]=e}this.morphTargetsRelative=source.morphTargetsRelative;const r=source.groups;for(let i=0,t=r.length;i<t;i++){const t=r[i];this.addGroup(t.start,t.count,t.materialIndex)}const o=source.boundingBox;null!==o&&(this.boundingBox=o.clone());const c=source.boundingSphere;return null!==c&&(this.boundingSphere=c.clone()),this.drawRange.start=source.drawRange.start,this.drawRange.count=source.drawRange.count,this.userData=source.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});const Ve=new tt,Ge=new qt,He=new Bt,je=new W,We=new W,qe=new W,Xe=new W,Ye=new W,Ke=new W,Je=new W,Ze=new W,Qe=new W,$e=new D,tn=new D,en=new D,nn=new W,rn=new W;function on(t,e){bt.call(this),this.type="Mesh",this.geometry=void 0!==t?t:new Ue,this.material=void 0!==e?e:new ye,this.updateMorphTargets()}function an(object,t,e,n,r,c,l,h){let d;if(d=1===t.side?n.intersectTriangle(l,c,r,!0,h):n.intersectTriangle(r,c,l,t.side!==o,h),null===d)return null;rn.copy(h),rn.applyMatrix4(object.matrixWorld);const f=e.ray.origin.distanceTo(rn);return f<e.near||f>e.far?null:{distance:f,point:rn.clone(),object:object}}function sn(object,t,e,n,r,o,c,l,h,a,b,d){je.fromBufferAttribute(r,a),We.fromBufferAttribute(r,b),qe.fromBufferAttribute(r,d);const f=object.morphTargetInfluences;if(t.morphTargets&&o&&f){Je.set(0,0,0),Ze.set(0,0,0),Qe.set(0,0,0);for(let i=0,t=o.length;i<t;i++){const t=f[i],e=o[i];0!==t&&(Xe.fromBufferAttribute(e,a),Ye.fromBufferAttribute(e,b),Ke.fromBufferAttribute(e,d),c?(Je.addScaledVector(Xe,t),Ze.addScaledVector(Ye,t),Qe.addScaledVector(Ke,t)):(Je.addScaledVector(Xe.sub(je),t),Ze.addScaledVector(Ye.sub(We),t),Qe.addScaledVector(Ke.sub(qe),t)))}je.add(Je),We.add(Ze),qe.add(Qe)}object.isSkinnedMesh&&(object.boneTransform(a,je),object.boneTransform(b,We),object.boneTransform(d,qe));const m=an(object,t,e,n,je,We,qe,nn);if(m){l&&($e.fromBufferAttribute(l,a),tn.fromBufferAttribute(l,b),en.fromBufferAttribute(l,d),m.uv=se.getUV(nn,je,We,qe,$e,tn,en,new D)),h&&($e.fromBufferAttribute(h,a),tn.fromBufferAttribute(h,b),en.fromBufferAttribute(h,d),m.uv2=se.getUV(nn,je,We,qe,$e,tn,en,new D));const t=new me(a,b,d);se.getNormal(je,We,qe,t.normal),m.face=t}return m}on.prototype=Object.assign(Object.create(bt.prototype),{constructor:on,isMesh:!0,copy:function(source){return bt.prototype.copy.call(this,source),void 0!==source.morphTargetInfluences&&(this.morphTargetInfluences=source.morphTargetInfluences.slice()),void 0!==source.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},source.morphTargetDictionary)),this.material=source.material,this.geometry=source.geometry,this},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(t,e){const n=this.geometry,r=this.material,o=this.matrixWorld;if(void 0===r)return;if(null===n.boundingSphere&&n.computeBoundingSphere(),He.copy(n.boundingSphere),He.applyMatrix4(o),!1===t.ray.intersectsSphere(He))return;if(Ve.getInverse(o),Ge.copy(t.ray).applyMatrix4(Ve),null!==n.boundingBox&&!1===Ge.intersectsBox(n.boundingBox))return;let c;if(n.isBufferGeometry){const o=n.index,l=n.attributes.position,h=n.morphAttributes.position,d=n.morphTargetsRelative,f=n.attributes.uv,m=n.attributes.uv2,v=n.groups,y=n.drawRange;if(null!==o)if(Array.isArray(r))for(let i=0,n=v.length;i<n;i++){const n=v[i],x=r[n.materialIndex];for(let r=Math.max(n.start,y.start),v=Math.min(n.start+n.count,y.start+y.count);r<v;r+=3){const a=o.getX(r),b=o.getX(r+1),v=o.getX(r+2);c=sn(this,x,t,Ge,l,h,d,f,m,a,b,v),c&&(c.faceIndex=Math.floor(r/3),c.face.materialIndex=n.materialIndex,e.push(c))}}else{for(let i=Math.max(0,y.start),n=Math.min(o.count,y.start+y.count);i<n;i+=3){const a=o.getX(i),b=o.getX(i+1),n=o.getX(i+2);c=sn(this,r,t,Ge,l,h,d,f,m,a,b,n),c&&(c.faceIndex=Math.floor(i/3),e.push(c))}}else if(void 0!==l)if(Array.isArray(r))for(let i=0,n=v.length;i<n;i++){const n=v[i],o=r[n.materialIndex];for(let r=Math.max(n.start,y.start),v=Math.min(n.start+n.count,y.start+y.count);r<v;r+=3){c=sn(this,o,t,Ge,l,h,d,f,m,r,r+1,r+2),c&&(c.faceIndex=Math.floor(r/3),c.face.materialIndex=n.materialIndex,e.push(c))}}else{for(let i=Math.max(0,y.start),n=Math.min(l.count,y.start+y.count);i<n;i+=3){c=sn(this,r,t,Ge,l,h,d,f,m,i,i+1,i+2),c&&(c.faceIndex=Math.floor(i/3),e.push(c))}}}else if(n.isGeometry){const o=Array.isArray(r),l=n.vertices,h=n.faces;let d;const f=n.faceVertexUvs[0];f.length>0&&(d=f);for(let n=0,f=h.length;n<f;n++){const f=h[n],m=o?r[f.materialIndex]:r;if(void 0===m)continue;const v=l[f.a],y=l[f.b],x=l[f.c];if(c=an(this,m,t,Ge,v,y,x,nn),c){if(d&&d[n]){const t=d[n];$e.copy(t[0]),tn.copy(t[1]),en.copy(t[2]),c.uv=se.getUV(nn,v,y,x,$e,tn,en,new D)}c.face=f,c.faceIndex=n,e.push(c)}}}}});let un=0;const cn=new tt,ln=new bt,hn=new W;function pn(){Object.defineProperty(this,"id",{value:un+=2}),this.uuid=O.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}pn.prototype=Object.assign(Object.create(I.prototype),{constructor:pn,isGeometry:!0,applyMatrix4:function(t){const e=(new L).getNormalMatrix(t);for(let i=0,e=this.vertices.length;i<e;i++){this.vertices[i].applyMatrix4(t)}for(let i=0,t=this.faces.length;i<t;i++){const t=this.faces[i];t.normal.applyMatrix3(e).normalize();for(let n=0,r=t.vertexNormals.length;n<r;n++)t.vertexNormals[n].applyMatrix3(e).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(t){return cn.makeRotationX(t),this.applyMatrix4(cn),this},rotateY:function(t){return cn.makeRotationY(t),this.applyMatrix4(cn),this},rotateZ:function(t){return cn.makeRotationZ(t),this.applyMatrix4(cn),this},translate:function(t,e,n){return cn.makeTranslation(t,e,n),this.applyMatrix4(cn),this},scale:function(t,e,n){return cn.makeScale(t,e,n),this.applyMatrix4(cn),this},lookAt:function(t){return ln.lookAt(t),ln.updateMatrix(),this.applyMatrix4(ln.matrix),this},fromBufferGeometry:function(t){const e=this,n=null!==t.index?t.index:void 0,r=t.attributes;if(void 0===r.position)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;const o=r.position,c=r.normal,l=r.color,h=r.uv,d=r.uv2;void 0!==d&&(this.faceVertexUvs[1]=[]);for(let i=0;i<o.count;i++)e.vertices.push((new W).fromBufferAttribute(o,i)),void 0!==l&&e.colors.push((new he).fromBufferAttribute(l,i));function f(a,b,t,n){const r=void 0===l?[]:[e.colors[a].clone(),e.colors[b].clone(),e.colors[t].clone()],o=new me(a,b,t,void 0===c?[]:[(new W).fromBufferAttribute(c,a),(new W).fromBufferAttribute(c,b),(new W).fromBufferAttribute(c,t)],r,n);e.faces.push(o),void 0!==h&&e.faceVertexUvs[0].push([(new D).fromBufferAttribute(h,a),(new D).fromBufferAttribute(h,b),(new D).fromBufferAttribute(h,t)]),void 0!==d&&e.faceVertexUvs[1].push([(new D).fromBufferAttribute(d,a),(new D).fromBufferAttribute(d,b),(new D).fromBufferAttribute(d,t)])}const m=t.groups;if(m.length>0)for(let i=0;i<m.length;i++){const t=m[i],e=t.start;for(let r=e,o=e+t.count;r<o;r+=3)void 0!==n?f(n.getX(r),n.getX(r+1),n.getX(r+2),t.materialIndex):f(r,r+1,r+2,t.materialIndex)}else if(void 0!==n)for(let i=0;i<n.count;i+=3)f(n.getX(i),n.getX(i+1),n.getX(i+2));else for(let i=0;i<o.count;i+=3)f(i,i+1,i+2);return this.computeFaceNormals(),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(hn).negate(),this.translate(hn.x,hn.y,hn.z),this},normalize:function(){this.computeBoundingSphere();const t=this.boundingSphere.center,e=this.boundingSphere.radius,s=0===e?1:1/e,n=new tt;return n.set(s,0,0,-s*t.x,0,s,0,-s*t.y,0,0,s,-s*t.z,0,0,0,1),this.applyMatrix4(n),this},computeFaceNormals:function(){const t=new W,e=new W;for(let n=0,r=this.faces.length;n<r;n++){const r=this.faces[n],o=this.vertices[r.a],c=this.vertices[r.b],l=this.vertices[r.c];t.subVectors(l,c),e.subVectors(o,c),t.cross(e),t.normalize(),r.normal.copy(t)}},computeVertexNormals:function(t){void 0===t&&(t=!0);const e=new Array(this.vertices.length);for(let t=0,n=this.vertices.length;t<n;t++)e[t]=new W;if(t){const t=new W,n=new W;for(let r=0,o=this.faces.length;r<o;r++){const o=this.faces[r],c=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c];t.subVectors(h,l),n.subVectors(c,l),t.cross(n),e[o.a].add(t),e[o.b].add(t),e[o.c].add(t)}}else{this.computeFaceNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t];e[n.a].add(n.normal),e[n.b].add(n.normal),e[n.c].add(n.normal)}}for(let t=0,n=this.vertices.length;t<n;t++)e[t].normalize();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],r=n.vertexNormals;3===r.length?(r[0].copy(e[n.a]),r[1].copy(e[n.b]),r[2].copy(e[n.c])):(r[0]=e[n.a].clone(),r[1]=e[n.b].clone(),r[2]=e[n.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){this.computeFaceNormals();for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t],n=e.vertexNormals;3===n.length?(n[0].copy(e.normal),n[1].copy(e.normal),n[2].copy(e.normal)):(n[0]=e.normal.clone(),n[1]=e.normal.clone(),n[2]=e.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.__originalFaceNormal?e.__originalFaceNormal.copy(e.normal):e.__originalFaceNormal=e.normal.clone(),e.__originalVertexNormals||(e.__originalVertexNormals=[]);for(let i=0,t=e.vertexNormals.length;i<t;i++)e.__originalVertexNormals[i]?e.__originalVertexNormals[i].copy(e.vertexNormals[i]):e.__originalVertexNormals[i]=e.vertexNormals[i].clone()}const t=new pn;t.faces=this.faces;for(let i=0,e=this.morphTargets.length;i<e;i++){if(!this.morphNormals[i]){this.morphNormals[i]={},this.morphNormals[i].faceNormals=[],this.morphNormals[i].vertexNormals=[];const t=this.morphNormals[i].faceNormals,e=this.morphNormals[i].vertexNormals;for(let n=0,r=this.faces.length;n<r;n++){const n=new W,r={a:new W,b:new W,c:new W};t.push(n),e.push(r)}}const e=this.morphNormals[i];t.vertices=this.morphTargets[i].vertices,t.computeFaceNormals(),t.computeVertexNormals();for(let t=0,n=this.faces.length;t<n;t++){const n=this.faces[t],r=e.faceNormals[t],o=e.vertexNormals[t];r.copy(n.normal),o.a.copy(n.vertexNormals[0]),o.b.copy(n.vertexNormals[1]),o.c.copy(n.vertexNormals[2])}}for(let t=0,e=this.faces.length;t<e;t++){const e=this.faces[t];e.normal=e.__originalFaceNormal,e.vertexNormals=e.__originalVertexNormals}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new kt),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Bt),this.boundingSphere.setFromPoints(this.vertices)},merge:function(t,e,n){if(!t||!t.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",t);let r,o=this.vertices.length,c=this.vertices,l=t.vertices,h=this.faces,d=t.faces,f=this.colors,m=t.colors;void 0===n&&(n=0),void 0!==e&&(r=(new L).getNormalMatrix(e));for(let i=0,t=l.length;i<t;i++){const t=l[i].clone();void 0!==e&&t.applyMatrix4(e),c.push(t)}for(let i=0,t=m.length;i<t;i++)f.push(m[i].clone());for(let i=0,t=d.length;i<t;i++){let t,e,c,l=d[i],f=l.vertexNormals,m=l.vertexColors;t=new me(l.a+o,l.b+o,l.c+o),t.normal.copy(l.normal),void 0!==r&&t.normal.applyMatrix3(r).normalize();for(let n=0,o=f.length;n<o;n++)e=f[n].clone(),void 0!==r&&e.applyMatrix3(r).normalize(),t.vertexNormals.push(e);t.color.copy(l.color);for(let e=0,n=m.length;e<n;e++)c=m[e],t.vertexColors.push(c.clone());t.materialIndex=l.materialIndex+n,h.push(t)}for(let i=0,e=t.faceVertexUvs.length;i<e;i++){const e=t.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=[];for(let t=0,e=n.length;t<e;t++)r.push(n[t].clone());this.faceVertexUvs[i].push(r)}}},mergeMesh:function(t){t&&t.isMesh?(t.matrixAutoUpdate&&t.updateMatrix(),this.merge(t.geometry,t.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",t)},mergeVertices:function(){const t={},e=[],n=[],r=Math.pow(10,4);for(let i=0,o=this.vertices.length;i<o;i++){const o=this.vertices[i],c=Math.round(o.x*r)+"_"+Math.round(o.y*r)+"_"+Math.round(o.z*r);void 0===t[c]?(t[c]=i,e.push(this.vertices[i]),n[i]=e.length-1):n[i]=n[t[c]]}const o=[];for(let i=0,t=this.faces.length;i<t;i++){const t=this.faces[i];t.a=n[t.a],t.b=n[t.b],t.c=n[t.c];const e=[t.a,t.b,t.c];for(let t=0;t<3;t++)if(e[t]===e[(t+1)%3]){o.push(i);break}}for(let i=o.length-1;i>=0;i--){const t=o[i];this.faces.splice(t,1);for(let e=0,n=this.faceVertexUvs.length;e<n;e++)this.faceVertexUvs[e].splice(t,1)}const c=this.vertices.length-e.length;return this.vertices=e,c},setFromPoints:function(t){this.vertices=[];for(let i=0,e=t.length;i<e;i++){const e=t[i];this.vertices.push(new W(e.x,e.y,e.z||0))}return this},sortFacesByMaterialIndex:function(){const t=this.faces,e=t.length;for(let i=0;i<e;i++)t[i]._id=i;t.sort((function(a,b){return a.materialIndex-b.materialIndex}));const n=this.faceVertexUvs[0],r=this.faceVertexUvs[1];let o,c;n&&n.length===e&&(o=[]),r&&r.length===e&&(c=[]);for(let i=0;i<e;i++){const e=t[i]._id;o&&o.push(n[e]),c&&c.push(r[e])}o&&(this.faceVertexUvs[0]=o),c&&(this.faceVertexUvs[1]=c)},toJSON:function(){const data={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(data.uuid=this.uuid,data.type=this.type,""!==this.name&&(data.name=this.name),void 0!==this.parameters){const t=this.parameters;for(const e in t)void 0!==t[e]&&(data[e]=t[e]);return data}const t=[];for(let i=0;i<this.vertices.length;i++){const e=this.vertices[i];t.push(e.x,e.y,e.z)}const e=[],n=[],r={},o=[],c={},l=[],h={};for(let i=0;i<this.faces.length;i++){const t=this.faces[i],n=!0,r=!1,o=void 0!==this.faceVertexUvs[0][i],c=t.normal.length()>0,l=t.vertexNormals.length>0,h=1!==t.color.r||1!==t.color.g||1!==t.color.b,y=t.vertexColors.length>0;let x=0;if(x=d(x,0,0),x=d(x,1,n),x=d(x,2,r),x=d(x,3,o),x=d(x,4,c),x=d(x,5,l),x=d(x,6,h),x=d(x,7,y),e.push(x),e.push(t.a,t.b,t.c),e.push(t.materialIndex),o){const t=this.faceVertexUvs[0][i];e.push(v(t[0]),v(t[1]),v(t[2]))}if(c&&e.push(f(t.normal)),l){const n=t.vertexNormals;e.push(f(n[0]),f(n[1]),f(n[2]))}if(h&&e.push(m(t.color)),y){const n=t.vertexColors;e.push(m(n[0]),m(n[1]),m(n[2]))}}function d(t,e,n){return n?t|1<<e:t&~(1<<e)}function f(t){const e=t.x.toString()+t.y.toString()+t.z.toString();return void 0!==r[e]||(r[e]=n.length/3,n.push(t.x,t.y,t.z)),r[e]}function m(t){const e=t.r.toString()+t.g.toString()+t.b.toString();return void 0!==c[e]||(c[e]=o.length,o.push(t.getHex())),c[e]}function v(t){const e=t.x.toString()+t.y.toString();return void 0!==h[e]||(h[e]=l.length/2,l.push(t.x,t.y)),h[e]}return data.data={},data.data.vertices=t,data.data.normals=n,o.length>0&&(data.data.colors=o),l.length>0&&(data.data.uvs=[l]),data.data.faces=e,data},clone:function(){return(new pn).copy(this)},copy:function(source){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=source.name;const t=source.vertices;for(let i=0,e=t.length;i<e;i++)this.vertices.push(t[i].clone());const e=source.colors;for(let i=0,t=e.length;i<t;i++)this.colors.push(e[i].clone());const n=source.faces;for(let i=0,t=n.length;i<t;i++)this.faces.push(n[i].clone());for(let i=0,t=source.faceVertexUvs.length;i<t;i++){const t=source.faceVertexUvs[i];void 0===this.faceVertexUvs[i]&&(this.faceVertexUvs[i]=[]);for(let e=0,n=t.length;e<n;e++){const n=t[e],r=[];for(let t=0,e=n.length;t<e;t++){const e=n[t];r.push(e.clone())}this.faceVertexUvs[i].push(r)}}const r=source.morphTargets;for(let i=0,t=r.length;i<t;i++){const t={};if(t.name=r[i].name,void 0!==r[i].vertices){t.vertices=[];for(let e=0,n=r[i].vertices.length;e<n;e++)t.vertices.push(r[i].vertices[e].clone())}if(void 0!==r[i].normals){t.normals=[];for(let e=0,n=r[i].normals.length;e<n;e++)t.normals.push(r[i].normals[e].clone())}this.morphTargets.push(t)}const o=source.morphNormals;for(let i=0,t=o.length;i<t;i++){const t={};if(void 0!==o[i].vertexNormals){t.vertexNormals=[];for(let e=0,n=o[i].vertexNormals.length;e<n;e++){const n=o[i].vertexNormals[e],r={};r.a=n.a.clone(),r.b=n.b.clone(),r.c=n.c.clone(),t.vertexNormals.push(r)}}if(void 0!==o[i].faceNormals){t.faceNormals=[];for(let e=0,n=o[i].faceNormals.length;e<n;e++)t.faceNormals.push(o[i].faceNormals[e].clone())}this.morphNormals.push(t)}const c=source.skinWeights;for(let i=0,t=c.length;i<t;i++)this.skinWeights.push(c[i].clone());const l=source.skinIndices;for(let i=0,t=l.length;i<t;i++)this.skinIndices.push(l[i].clone());const h=source.lineDistances;for(let i=0,t=h.length;i<t;i++)this.lineDistances.push(h[i]);const d=source.boundingBox;null!==d&&(this.boundingBox=d.clone());const f=source.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.elementsNeedUpdate=source.elementsNeedUpdate,this.verticesNeedUpdate=source.verticesNeedUpdate,this.uvsNeedUpdate=source.uvsNeedUpdate,this.normalsNeedUpdate=source.normalsNeedUpdate,this.colorsNeedUpdate=source.colorsNeedUpdate,this.lineDistancesNeedUpdate=source.lineDistancesNeedUpdate,this.groupsNeedUpdate=source.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});class dn extends Ue{constructor(t,e,n,r,o,c){super(),this.type="BoxBufferGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:o,depthSegments:c};const l=this;t=t||1,e=e||1,n=n||1,r=Math.floor(r)||1,o=Math.floor(o)||1,c=Math.floor(c)||1;const h=[],d=[],f=[],m=[];let v=0,y=0;function x(u,t,e,n,r,o,c,x,w,_,S){const M=o/w,E=c/_,T=o/2,A=c/2,C=x/2,R=w+1,I=_+1;let N=0,O=0;const D=new W;for(let o=0;o<I;o++){const c=o*E-A;for(let l=0;l<R;l++){const h=l*M-T;D[u]=h*n,D[t]=c*r,D[e]=C,d.push(D.x,D.y,D.z),D[u]=0,D[t]=0,D[e]=x>0?1:-1,f.push(D.x,D.y,D.z),m.push(l/w),m.push(1-o/_),N+=1}}for(let t=0;t<_;t++)for(let e=0;e<w;e++){const a=v+e+R*t,b=v+e+R*(t+1),n=v+(e+1)+R*(t+1),r=v+(e+1)+R*t;h.push(a,b,r),h.push(b,n,r),O+=6}l.addGroup(y,O,S),y+=O,v+=N}x("z","y","x",-1,-1,n,e,t,c,o,0),x("z","y","x",1,-1,n,e,-t,c,o,1),x("x","z","y",1,1,t,n,e,r,c,2),x("x","z","y",1,-1,t,n,-e,r,c,3),x("x","y","z",1,-1,t,e,n,r,o,4),x("x","y","z",-1,-1,t,e,-n,r,o,5),this.setIndex(h),this.setAttribute("position",new Re(d,3)),this.setAttribute("normal",new Re(f,3)),this.setAttribute("uv",new Re(m,2))}}function fn(t){const e={};for(const u in t){e[u]={};for(const p in t[u]){const n=t[u][p];n&&(n.isColor||n.isMatrix3||n.isMatrix4||n.isVector2||n.isVector3||n.isVector4||n.isTexture)?e[u][p]=n.clone():Array.isArray(n)?e[u][p]=n.slice():e[u][p]=n}}return e}function mn(t){const e={};for(let u=0;u<t.length;u++){const n=fn(t[u]);for(const p in n)e[p]=n[p]}return e}const gn={clone:fn,merge:mn};function vn(t){ve.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,void 0!==t&&(void 0!==t.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(t))}function yn(){bt.call(this),this.type="Camera",this.matrixWorldInverse=new tt,this.projectionMatrix=new tt,this.projectionMatrixInverse=new tt}function xn(t,e,n,r){yn.call(this),this.type="PerspectiveCamera",this.fov=void 0!==t?t:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.focus=10,this.aspect=void 0!==e?e:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}vn.prototype=Object.create(ve.prototype),vn.prototype.constructor=vn,vn.prototype.isShaderMaterial=!0,vn.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.fragmentShader=source.fragmentShader,this.vertexShader=source.vertexShader,this.uniforms=fn(source.uniforms),this.defines=Object.assign({},source.defines),this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.lights=source.lights,this.clipping=source.clipping,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this.extensions=Object.assign({},source.extensions),this},vn.prototype.toJSON=function(meta){const data=ve.prototype.toJSON.call(this,meta);data.uniforms={};for(const t in this.uniforms){const e=this.uniforms[t].value;e&&e.isTexture?data.uniforms[t]={type:"t",value:e.toJSON(meta).uuid}:e&&e.isColor?data.uniforms[t]={type:"c",value:e.getHex()}:e&&e.isVector2?data.uniforms[t]={type:"v2",value:e.toArray()}:e&&e.isVector3?data.uniforms[t]={type:"v3",value:e.toArray()}:e&&e.isVector4?data.uniforms[t]={type:"v4",value:e.toArray()}:e&&e.isMatrix3?data.uniforms[t]={type:"m3",value:e.toArray()}:e&&e.isMatrix4?data.uniforms[t]={type:"m4",value:e.toArray()}:data.uniforms[t]={value:e}}Object.keys(this.defines).length>0&&(data.defines=this.defines),data.vertexShader=this.vertexShader,data.fragmentShader=this.fragmentShader;const t={};for(const e in this.extensions)!0===this.extensions[e]&&(t[e]=!0);return Object.keys(t).length>0&&(data.extensions=t),data},yn.prototype=Object.assign(Object.create(bt.prototype),{constructor:yn,isCamera:!0,copy:function(source,t){return bt.prototype.copy.call(this,source,t),this.matrixWorldInverse.copy(source.matrixWorldInverse),this.projectionMatrix.copy(source.projectionMatrix),this.projectionMatrixInverse.copy(source.projectionMatrixInverse),this},getWorldDirection:function(t){void 0===t&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),t=new W),this.updateMatrixWorld(!0);const e=this.matrixWorld.elements;return t.set(-e[8],-e[9],-e[10]).normalize()},updateMatrixWorld:function(t){bt.prototype.updateMatrixWorld.call(this,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(t,e){bt.prototype.updateWorldMatrix.call(this,t,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),xn.prototype=Object.assign(Object.create(yn.prototype),{constructor:xn,isPerspectiveCamera:!0,copy:function(source,t){return yn.prototype.copy.call(this,source,t),this.fov=source.fov,this.zoom=source.zoom,this.near=source.near,this.far=source.far,this.focus=source.focus,this.aspect=source.aspect,this.view=null===source.view?null:Object.assign({},source.view),this.filmGauge=source.filmGauge,this.filmOffset=source.filmOffset,this},setFocalLength:function(t){const e=.5*this.getFilmHeight()/t;this.fov=2*O.RAD2DEG*Math.atan(e),this.updateProjectionMatrix()},getFocalLength:function(){const t=Math.tan(.5*O.DEG2RAD*this.fov);return.5*this.getFilmHeight()/t},getEffectiveFOV:function(){return 2*O.RAD2DEG*Math.atan(Math.tan(.5*O.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(t,e,n,r,o,c){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){let t=this.near,e=t*Math.tan(.5*O.DEG2RAD*this.fov)/this.zoom,n=2*e,r=this.aspect*n,o=-.5*r,view=this.view;if(null!==this.view&&this.view.enabled){const t=view.fullWidth,c=view.fullHeight;o+=view.offsetX*r/t,e-=view.offsetY*n/c,r*=view.width/t,n*=view.height/c}const c=this.filmOffset;0!==c&&(o+=t*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+r,e,e-n,t,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){const data=bt.prototype.toJSON.call(this,meta);return data.object.fov=this.fov,data.object.zoom=this.zoom,data.object.near=this.near,data.object.far=this.far,data.object.focus=this.focus,data.object.aspect=this.aspect,null!==this.view&&(data.object.view=Object.assign({},this.view)),data.object.filmGauge=this.filmGauge,data.object.filmOffset=this.filmOffset,data}});function bn(t,e,n){if(bt.call(this),this.type="CubeCamera",!0!==n.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=n;const r=new xn(90,1,t,e);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new W(1,0,0)),this.add(r);const o=new xn(90,1,t,e);o.layers=this.layers,o.up.set(0,-1,0),o.lookAt(new W(-1,0,0)),this.add(o);const c=new xn(90,1,t,e);c.layers=this.layers,c.up.set(0,0,1),c.lookAt(new W(0,1,0)),this.add(c);const l=new xn(90,1,t,e);l.layers=this.layers,l.up.set(0,0,-1),l.lookAt(new W(0,-1,0)),this.add(l);const h=new xn(90,1,t,e);h.layers=this.layers,h.up.set(0,-1,0),h.lookAt(new W(0,0,1)),this.add(h);const d=new xn(90,1,t,e);d.layers=this.layers,d.up.set(0,-1,0),d.lookAt(new W(0,0,-1)),this.add(d),this.update=function(t,e){null===this.parent&&this.updateMatrixWorld();const f=t.xr.enabled,m=t.getRenderTarget();t.xr.enabled=!1;const v=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,t.setRenderTarget(n,0),t.render(e,r),t.setRenderTarget(n,1),t.render(e,o),t.setRenderTarget(n,2),t.render(e,c),t.setRenderTarget(n,3),t.render(e,l),t.setRenderTarget(n,4),t.render(e,h),n.texture.generateMipmaps=v,t.setRenderTarget(n,5),t.render(e,d),t.setRenderTarget(m),t.xr.enabled=f},this.clear=function(t,e,r,o){const c=t.getRenderTarget();for(let i=0;i<6;i++)t.setRenderTarget(n,i),t.clear(e,r,o);t.setRenderTarget(c)}}function wn(t,e,n){Number.isInteger(e)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),e=n),U.call(this,t,t,e)}function _n(data,t,e,n,r,o,c,l,h,f,m,v){B.call(this,null,o,c,l,h,f,n,r,m,v),this.image={data:data||null,width:t||1,height:e||1},this.magFilter=void 0!==h?h:d,this.minFilter=void 0!==f?f:d,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}bn.prototype=Object.create(bt.prototype),bn.prototype.constructor=bn,wn.prototype=Object.create(U.prototype),wn.prototype.constructor=wn,wn.prototype.isWebGLCubeRenderTarget=!0,wn.prototype.fromEquirectangularTexture=function(t,e){this.texture.type=e.type,this.texture.format=e.format,this.texture.encoding=e.encoding;const n=new wt,r={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","\tvWorldDirection = transformDirection( position, modelMatrix );","\t#include <begin_vertex>","\t#include <project_vertex>","}"].join("\n"),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#include <common>","void main() {","\tvec3 direction = normalize( vWorldDirection );","\tvec2 sampleUV = equirectUv( direction );","\tgl_FragColor = texture2D( tEquirect, sampleUV );","}"].join("\n")},o=new vn({name:"CubemapFromEquirect",uniforms:fn(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:1,blending:0});o.uniforms.tEquirect.value=e;const c=new on(new dn(5,5,5),o);n.add(c);return new bn(1,10,this).update(t,n),c.geometry.dispose(),c.material.dispose(),this},_n.prototype=Object.create(B.prototype),_n.prototype.constructor=_n,_n.prototype.isDataTexture=!0;const Sn=new Bt,Mn=new W;function En(t,e,n,r,o,c){this.planes=[void 0!==t?t:new Jt,void 0!==e?e:new Jt,void 0!==n?n:new Jt,void 0!==r?r:new Jt,void 0!==o?o:new Jt,void 0!==c?c:new Jt]}Object.assign(En.prototype,{set:function(t,e,n,r,o,c){const l=this.planes;return l[0].copy(t),l[1].copy(e),l[2].copy(n),l[3].copy(r),l[4].copy(o),l[5].copy(c),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this},setFromProjectionMatrix:function(t){const e=this.planes,n=t.elements,r=n[0],o=n[1],c=n[2],l=n[3],h=n[4],d=n[5],f=n[6],m=n[7],v=n[8],y=n[9],x=n[10],w=n[11],_=n[12],S=n[13],M=n[14],E=n[15];return e[0].setComponents(l-r,m-h,w-v,E-_).normalize(),e[1].setComponents(l+r,m+h,w+v,E+_).normalize(),e[2].setComponents(l+o,m+d,w+y,E+S).normalize(),e[3].setComponents(l-o,m-d,w-y,E-S).normalize(),e[4].setComponents(l-c,m-f,w-x,E-M).normalize(),e[5].setComponents(l+c,m+f,w+x,E+M).normalize(),this},intersectsObject:function(object){const t=object.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Sn.copy(t.boundingSphere).applyMatrix4(object.matrixWorld),this.intersectsSphere(Sn)},intersectsSprite:function(t){return Sn.center.set(0,0,0),Sn.radius=.7071067811865476,Sn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Sn)},intersectsSphere:function(t){const e=this.planes,n=t.center,r=-t.radius;for(let i=0;i<6;i++){if(e[i].distanceToPoint(n)<r)return!1}return!0},intersectsBox:function(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(Mn.x=n.normal.x>0?t.max.x:t.min.x,Mn.y=n.normal.y>0?t.max.y:t.min.y,Mn.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(Mn)<0)return!1}return!0},containsPoint:function(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}});const Tn={common:{diffuse:{value:new he(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new L},uv2Transform:{value:new L},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new D(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new he(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new he(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new L}},sprite:{diffuse:{value:new he(15658734)},opacity:{value:1},center:{value:new D(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new L}}};function An(){let t=null,e=!1,n=null,r=null;function o(time,e){n(time,e),r=t.requestAnimationFrame(o)}return{start:function(){!0!==e&&null!==n&&(r=t.requestAnimationFrame(o),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(t){n=t},setContext:function(e){t=e}}}function Cn(t,e){const n=e.isWebGL2,r=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),r.get(t)},remove:function(e){e.isInterleavedBufferAttribute&&(e=e.data);const data=r.get(e);data&&(t.deleteBuffer(data.buffer),r.delete(e))},update:function(e,o){e.isInterleavedBufferAttribute&&(e=e.data);const data=r.get(e);void 0===data?r.set(e,function(e,n){const r=e.array,o=e.usage,c=t.createBuffer();t.bindBuffer(n,c),t.bufferData(n,r,o),e.onUploadCallback();let l=5126;return r instanceof Float32Array?l=5126:r instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):r instanceof Uint16Array?l=5123:r instanceof Int16Array?l=5122:r instanceof Uint32Array?l=5125:r instanceof Int32Array?l=5124:r instanceof Int8Array?l=5120:r instanceof Uint8Array&&(l=5121),{buffer:c,type:l,bytesPerElement:r.BYTES_PER_ELEMENT,version:e.version}}(e,o)):data.version<e.version&&(!function(e,r,o){const c=r.array,l=r.updateRange;t.bindBuffer(o,e),-1===l.count?t.bufferSubData(o,0,c):(n?t.bufferSubData(o,l.offset*c.BYTES_PER_ELEMENT,c,l.offset,l.count):t.bufferSubData(o,l.offset*c.BYTES_PER_ELEMENT,c.subarray(l.offset,l.offset+l.count)),l.count=-1)}(data.buffer,e,o),data.version=e.version)}}}function Rn(t,e,n,r){pn.call(this),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r},this.fromBufferGeometry(new In(t,e,n,r)),this.mergeVertices()}function In(t,e,n,r){Ue.call(this),this.type="PlaneBufferGeometry",this.parameters={width:t,height:e,widthSegments:n,heightSegments:r};const o=(t=t||1)/2,c=(e=e||1)/2,l=Math.floor(n)||1,h=Math.floor(r)||1,d=l+1,f=h+1,m=t/l,v=e/h,y=[],x=[],w=[],_=[];for(let t=0;t<f;t++){const e=t*v-c;for(let n=0;n<d;n++){const r=n*m-o;x.push(r,-e,0),w.push(0,0,1),_.push(n/l),_.push(1-t/h)}}for(let t=0;t<h;t++)for(let e=0;e<l;e++){const a=e+d*t,b=e+d*(t+1),n=e+1+d*(t+1),r=e+1+d*t;y.push(a,b,r),y.push(b,n,r)}this.setIndex(y),this.setAttribute("position",new Re(x,3)),this.setAttribute("normal",new Re(w,3)),this.setAttribute("uv",new Re(_,2))}Rn.prototype=Object.create(pn.prototype),Rn.prototype.constructor=Rn,In.prototype=Object.create(Ue.prototype),In.prototype.constructor=In;const Nn={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha  = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n  return m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_maxMipLevel 8.0\n#define cubeUV_minMipLevel 4.0\n#define cubeUV_maxTileSize 256.0\n#define cubeUV_minTileSize 16.0\nfloat getFace(vec3 direction) {\n    vec3 absDirection = abs(direction);\n    float face = -1.0;\n    if (absDirection.x > absDirection.z) {\n      if (absDirection.x > absDirection.y)\n        face = direction.x > 0.0 ? 0.0 : 3.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    } else {\n      if (absDirection.z > absDirection.y)\n        face = direction.z > 0.0 ? 2.0 : 5.0;\n      else\n        face = direction.y > 0.0 ? 1.0 : 4.0;\n    }\n    return face;\n}\nvec2 getUV(vec3 direction, float face) {\n    vec2 uv;\n    if (face == 0.0) {\n      uv = vec2(direction.z, direction.y) / abs(direction.x);    } else if (face == 1.0) {\n      uv = vec2(-direction.x, -direction.z) / abs(direction.y);    } else if (face == 2.0) {\n      uv = vec2(-direction.x, direction.y) / abs(direction.z);    } else if (face == 3.0) {\n      uv = vec2(-direction.z, direction.y) / abs(direction.x);    } else if (face == 4.0) {\n      uv = vec2(-direction.x, direction.z) / abs(direction.y);    } else {\n      uv = vec2(direction.x, direction.y) / abs(direction.z);    }\n    return 0.5 * (uv + 1.0);\n}\nvec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {\n  float face = getFace(direction);\n  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);\n  mipInt = max(mipInt, cubeUV_minMipLevel);\n  float faceSize = exp2(mipInt);\n  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);\n  vec2 uv = getUV(direction, face) * (faceSize - 1.0);\n  vec2 f = fract(uv);\n  uv += 0.5 - f;\n  if (face > 2.0) {\n    uv.y += faceSize;\n    face -= 3.0;\n  }\n  uv.x += face * faceSize;\n  if(mipInt < cubeUV_maxMipLevel){\n    uv.y += 2.0 * cubeUV_maxTileSize;\n  }\n  uv.y += filterInt * 2.0 * cubeUV_minTileSize;\n  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);\n  uv *= texelSize;\n  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x += texelSize;\n  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.y += texelSize;\n  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  uv.x -= texelSize;\n  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n  vec3 tm = mix(tl, tr, f.x);\n  vec3 bm = mix(bl, br, f.x);\n  return mix(tm, bm, f.y);\n}\n#define r0 1.0\n#define v0 0.339\n#define m0 -2.0\n#define r1 0.8\n#define v1 0.276\n#define m1 -1.0\n#define r4 0.4\n#define v4 0.046\n#define m4 2.0\n#define r5 0.305\n#define v5 0.016\n#define m5 3.0\n#define r6 0.21\n#define v6 0.0038\n#define m6 4.0\nfloat roughnessToMip(float roughness) {\n  float mip = 0.0;\n  if (roughness >= r1) {\n    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;\n  } else if (roughness >= r4) {\n    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;\n  } else if (roughness >= r5) {\n    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;\n  } else if (roughness >= r6) {\n    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;\n  } else {\n    mip = -2.0 * log2(1.16 * roughness);  }\n  return mip;\n}\nvec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {\n  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);\n  float mipF = fract(mip);\n  float mipInt = floor(mip);\n  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);\n  if (mipF == 0.0) {\n    return vec4(color0, 1.0);\n  } else {\n    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);\n    return vec4(mix(color0, color1, mipF), 1.0);\n  }\n}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\t\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t}  else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\treflectVec = normalize( reflectVec );\n\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t  vec3 reflectVec = reflect( -viewDir, normal );\n\t\t  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV = equirectUv( reflectVec );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) { \n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = -mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3\tdiffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSPARENCY\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSPARENCY\n\tuniform float transparency;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSPARENCY\n\t\tdiffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},On={basic:{uniforms:mn([Tn.common,Tn.specularmap,Tn.envmap,Tn.aomap,Tn.lightmap,Tn.fog]),vertexShader:Nn.meshbasic_vert,fragmentShader:Nn.meshbasic_frag},lambert:{uniforms:mn([Tn.common,Tn.specularmap,Tn.envmap,Tn.aomap,Tn.lightmap,Tn.emissivemap,Tn.fog,Tn.lights,{emissive:{value:new he(0)}}]),vertexShader:Nn.meshlambert_vert,fragmentShader:Nn.meshlambert_frag},phong:{uniforms:mn([Tn.common,Tn.specularmap,Tn.envmap,Tn.aomap,Tn.lightmap,Tn.emissivemap,Tn.bumpmap,Tn.normalmap,Tn.displacementmap,Tn.fog,Tn.lights,{emissive:{value:new he(0)},specular:{value:new he(1118481)},shininess:{value:30}}]),vertexShader:Nn.meshphong_vert,fragmentShader:Nn.meshphong_frag},standard:{uniforms:mn([Tn.common,Tn.envmap,Tn.aomap,Tn.lightmap,Tn.emissivemap,Tn.bumpmap,Tn.normalmap,Tn.displacementmap,Tn.roughnessmap,Tn.metalnessmap,Tn.fog,Tn.lights,{emissive:{value:new he(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Nn.meshphysical_vert,fragmentShader:Nn.meshphysical_frag},toon:{uniforms:mn([Tn.common,Tn.aomap,Tn.lightmap,Tn.emissivemap,Tn.bumpmap,Tn.normalmap,Tn.displacementmap,Tn.gradientmap,Tn.fog,Tn.lights,{emissive:{value:new he(0)}}]),vertexShader:Nn.meshtoon_vert,fragmentShader:Nn.meshtoon_frag},matcap:{uniforms:mn([Tn.common,Tn.bumpmap,Tn.normalmap,Tn.displacementmap,Tn.fog,{matcap:{value:null}}]),vertexShader:Nn.meshmatcap_vert,fragmentShader:Nn.meshmatcap_frag},points:{uniforms:mn([Tn.points,Tn.fog]),vertexShader:Nn.points_vert,fragmentShader:Nn.points_frag},dashed:{uniforms:mn([Tn.common,Tn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Nn.linedashed_vert,fragmentShader:Nn.linedashed_frag},depth:{uniforms:mn([Tn.common,Tn.displacementmap]),vertexShader:Nn.depth_vert,fragmentShader:Nn.depth_frag},normal:{uniforms:mn([Tn.common,Tn.bumpmap,Tn.normalmap,Tn.displacementmap,{opacity:{value:1}}]),vertexShader:Nn.normal_vert,fragmentShader:Nn.normal_frag},sprite:{uniforms:mn([Tn.sprite,Tn.fog]),vertexShader:Nn.sprite_vert,fragmentShader:Nn.sprite_frag},background:{uniforms:{uvTransform:{value:new L},t2D:{value:null}},vertexShader:Nn.background_vert,fragmentShader:Nn.background_frag},cube:{uniforms:mn([Tn.envmap,{opacity:{value:1}}]),vertexShader:Nn.cube_vert,fragmentShader:Nn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Nn.equirect_vert,fragmentShader:Nn.equirect_frag},distanceRGBA:{uniforms:mn([Tn.common,Tn.displacementmap,{referencePosition:{value:new W},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Nn.distanceRGBA_vert,fragmentShader:Nn.distanceRGBA_frag},shadow:{uniforms:mn([Tn.lights,Tn.fog,{color:{value:new he(0)},opacity:{value:1}}]),vertexShader:Nn.shadow_vert,fragmentShader:Nn.shadow_frag}};function Dn(t,e,n,o){const c=new he(0);let l,h,d=0,f=null,m=0,v=null;function y(t,n){e.buffers.color.setClear(t.r,t.g,t.b,n,o)}return{getClearColor:function(){return c},setClearColor:function(t,e){c.set(t),d=void 0!==e?e:1,y(c,d)},getClearAlpha:function(){return d},setClearAlpha:function(t){d=t,y(c,d)},render:function(e,o,x,w){let _=!0===o.isScene?o.background:null;const S=t.xr,M=S.getSession&&S.getSession();if(M&&"additive"===M.environmentBlendMode&&(_=null),null===_?y(c,d):_&&_.isColor&&(y(_,1),w=!0),(t.autoClear||w)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil),_&&(_.isCubeTexture||_.isWebGLCubeRenderTarget||306===_.mapping)){void 0===h&&(h=new on(new dn(1,1,1),new vn({name:"BackgroundCubeMaterial",uniforms:fn(On.cube.uniforms),vertexShader:On.cube.vertexShader,fragmentShader:On.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(t,e,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(h));const r=_.isWebGLCubeRenderTarget?_.texture:_;h.material.uniforms.envMap.value=r,h.material.uniforms.flipEnvMap.value=r.isCubeTexture?-1:1,f===_&&m===r.version&&v===t.toneMapping||(h.material.needsUpdate=!0,f=_,m=r.version,v=t.toneMapping),e.unshift(h,h.geometry,h.material,0,0,null)}else _&&_.isTexture&&(void 0===l&&(l=new on(new In(2,2),new vn({name:"BackgroundMaterial",uniforms:fn(On.background.uniforms),vertexShader:On.background.vertexShader,fragmentShader:On.background.fragmentShader,side:r,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(l)),l.material.uniforms.t2D.value=_,!0===_.matrixAutoUpdate&&_.updateMatrix(),l.material.uniforms.uvTransform.value.copy(_.matrix),f===_&&m===_.version&&v===t.toneMapping||(l.material.needsUpdate=!0,f=_,m=_.version,v=t.toneMapping),e.unshift(l,l.geometry,l.material,0,0,null))}}}function Ln(t,e,n,r){const o=t.getParameter(34921),c=r.isWebGL2?null:e.get("OES_vertex_array_object"),l=r.isWebGL2||null!==c,h={},d=y(null);let f=d;function m(e){return r.isWebGL2?t.bindVertexArray(e):c.bindVertexArrayOES(e)}function v(e){return r.isWebGL2?t.deleteVertexArray(e):c.deleteVertexArrayOES(e)}function y(t){const e=[],n=[],r=[];for(let i=0;i<o;i++)e[i]=0,n[i]=0,r[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:r,object:t,attributes:{}}}function x(){const t=f.newAttributes;for(let i=0,e=t.length;i<e;i++)t[i]=0}function w(t){_(t,0)}function _(n,o){const c=f.newAttributes,l=f.enabledAttributes,h=f.attributeDivisors;if(c[n]=1,0===l[n]&&(t.enableVertexAttribArray(n),l[n]=1),h[n]!==o){(r.isWebGL2?t:e.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,o),h[n]=o}}function S(){const e=f.newAttributes,n=f.enabledAttributes;for(let i=0,r=n.length;i<r;i++)n[i]!==e[i]&&(t.disableVertexAttribArray(i),n[i]=0)}function M(e,n,o,c,l,h){!0!==r.isWebGL2||5124!==o&&5125!==o?t.vertexAttribPointer(e,n,o,c,l,h):t.vertexAttribIPointer(e,n,o,c,l,h)}function E(){T(),f!==d&&(f=d,m(f.object))}function T(){d.geometry=null,d.program=null,d.wireframe=!1}return{setup:function(object,o,d,v,E){let T=!1;if(l){const e=function(e,n,o){const l=!0===o.wireframe;let d=h[e.id];void 0===d&&(d={},h[e.id]=d);let f=d[n.id];void 0===f&&(f={},d[n.id]=f);let m=f[l];void 0===m&&(m=y(r.isWebGL2?t.createVertexArray():c.createVertexArrayOES()),f[l]=m);return m}(v,d,o);f!==e&&(f=e,m(f.object)),T=function(t){const e=f.attributes,n=t.attributes;if(Object.keys(e).length!==Object.keys(n).length)return!0;for(const t in n){const r=e[t],o=n[t];if(r.attribute!==o)return!0;if(r.data!==o.data)return!0}return!1}(v),T&&function(t){const e={},n=t.attributes;for(const t in n){const r=n[t],data={};data.attribute=r,r.data&&(data.data=r.data),e[t]=data}f.attributes=e}(v)}else{const t=!0===o.wireframe;f.geometry===v.id&&f.program===d.id&&f.wireframe===t||(f.geometry=v.id,f.program=d.id,f.wireframe=t,T=!0)}!0===object.isInstancedMesh&&(T=!0),null!==E&&n.update(E,34963),T&&(!function(object,o,c,l){if(!1===r.isWebGL2&&(object.isInstancedMesh||l.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;x();const h=l.attributes,d=c.getAttributes(),f=o.defaultAttributeValues;for(const e in d){const r=d[e];if(r>=0){const o=h[e];if(void 0!==o){const e=o.normalized,c=o.itemSize,h=n.get(o);if(void 0===h)continue;const d=h.buffer,f=h.type,m=h.bytesPerElement;if(o.isInterleavedBufferAttribute){const data=o.data,n=data.stride,h=o.offset;data&&data.isInstancedInterleavedBuffer?(_(r,data.meshPerAttribute),void 0===l._maxInstanceCount&&(l._maxInstanceCount=data.meshPerAttribute*data.count)):w(r),t.bindBuffer(34962,d),M(r,c,f,e,n*m,h*m)}else o.isInstancedBufferAttribute?(_(r,o.meshPerAttribute),void 0===l._maxInstanceCount&&(l._maxInstanceCount=o.meshPerAttribute*o.count)):w(r),t.bindBuffer(34962,d),M(r,c,f,e,0,0)}else if("instanceMatrix"===e){const e=n.get(object.instanceMatrix);if(void 0===e)continue;const o=e.buffer,c=e.type;_(r+0,1),_(r+1,1),_(r+2,1),_(r+3,1),t.bindBuffer(34962,o),t.vertexAttribPointer(r+0,4,c,!1,64,0),t.vertexAttribPointer(r+1,4,c,!1,64,16),t.vertexAttribPointer(r+2,4,c,!1,64,32),t.vertexAttribPointer(r+3,4,c,!1,64,48)}else if(void 0!==f){const n=f[e];if(void 0!==n)switch(n.length){case 2:t.vertexAttrib2fv(r,n);break;case 3:t.vertexAttrib3fv(r,n);break;case 4:t.vertexAttrib4fv(r,n);break;default:t.vertexAttrib1fv(r,n)}}}}S()}(object,o,d,v),null!==E&&t.bindBuffer(34963,n.get(E).buffer))},reset:E,resetDefaultState:T,dispose:function(){E();for(const t in h){const e=h[t];for(const t in e){const n=e[t];for(const t in n)v(n[t].object),delete n[t];delete e[t]}delete h[t]}},releaseStatesOfGeometry:function(t){if(void 0===h[t.id])return;const e=h[t.id];for(const t in e){const n=e[t];for(const t in n)v(n[t].object),delete n[t];delete e[t]}delete h[t.id]},releaseStatesOfProgram:function(t){for(const e in h){const n=h[e];if(void 0===n[t.id])continue;const r=n[t.id];for(const t in r)v(r[t].object),delete r[t];delete n[t.id]}},initAttributes:x,enableAttribute:w,disableUnusedAttributes:S}}function kn(t,e,n,r){const o=r.isWebGL2;let c;this.setMode=function(t){c=t},this.render=function(e,r){t.drawArrays(c,e,r),n.update(r,c)},this.renderInstances=function(r,l,h,d){if(0===d)return;let f,m;if(o)f=t,m="drawArraysInstanced";else if(f=e.get("ANGLE_instanced_arrays"),m="drawArraysInstancedANGLE",null===f)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");f[m](c,l,h,d),n.update(h,c,d)}}function Pn(t,e,n){let r;function o(e){if("highp"===e){if(t.getShaderPrecisionFormat(35633,36338).precision>0&&t.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(35633,36337).precision>0&&t.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const c="undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&t instanceof WebGL2ComputeRenderingContext;let l=void 0!==n.precision?n.precision:"highp";const h=o(l);h!==l&&(console.warn("THREE.WebGLRenderer:",l,"not supported, using",h,"instead."),l=h);const d=!0===n.logarithmicDepthBuffer,f=t.getParameter(34930),m=t.getParameter(35660),v=t.getParameter(3379),y=t.getParameter(34076),x=t.getParameter(34921),w=t.getParameter(36347),_=t.getParameter(36348),S=t.getParameter(36349),M=m>0,E=c||!!e.get("OES_texture_float");return{isWebGL2:c,getMaxAnisotropy:function(){if(void 0!==r)return r;const n=e.get("EXT_texture_filter_anisotropic");return r=null!==n?t.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,r},getMaxPrecision:o,precision:l,logarithmicDepthBuffer:d,maxTextures:f,maxVertexTextures:m,maxTextureSize:v,maxCubemapSize:y,maxAttributes:x,maxVertexUniforms:w,maxVaryings:_,maxFragmentUniforms:S,vertexTextures:M,floatFragmentTextures:E,floatVertexTextures:M&&E,maxSamples:c?t.getParameter(36183):0}}function Fn(){const t=this;let e=null,n=0,r=!1,o=!1;const c=new Jt,l=new L,h={value:null,needsUpdate:!1};function d(){h.value!==e&&(h.value=e,h.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function f(e,n,r,o){let d=null!==e?e.length:0,f=null;if(0!==d){if(f=h.value,!0!==o||null===f){const t=r+4*d,o=n.matrixWorldInverse;l.getNormalMatrix(o),(null===f||f.length<t)&&(f=new Float32Array(t));for(let i=0,t=r;i!==d;++i,t+=4)c.copy(e[i]).applyMatrix4(o,l),c.normal.toArray(f,t),f[t+3]=c.constant}h.value=f,h.needsUpdate=!0}return t.numPlanes=d,t.numIntersection=0,f}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(t,o,c){const l=0!==t.length||o||0!==n||r;return r=o,e=f(t,c,0),n=t.length,l},this.beginShadows=function(){o=!0,f(null)},this.endShadows=function(){o=!1,d()},this.setState=function(t,c,l,m,v,y){if(!r||null===t||0===t.length||o&&!l)o?f(null):d();else{const r=o?0:n,l=4*r;let d=v.clippingState||null;h.value=d,d=f(t,m,l,y);for(let i=0;i!==l;++i)d[i]=e[i];v.clippingState=d,this.numIntersection=c?this.numPlanes:0,this.numPlanes+=r}}}function Bn(t){const e={};return{get:function(n){if(void 0!==e[n])return e[n];let r;switch(n){case"WEBGL_depth_texture":r=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=t.getExtension(n)}return null===r&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),e[n]=r,r}}}function zn(t,e,n,r){const o=new WeakMap,c=new WeakMap;function l(t){const h=t.target,d=o.get(h);null!==d.index&&e.remove(d.index);for(const t in d.attributes)e.remove(d.attributes[t]);h.removeEventListener("dispose",l),o.delete(h);const f=c.get(d);f&&(e.remove(f),c.delete(d)),r.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,n.memory.geometries--}function h(t){const n=[],r=t.index,o=t.attributes.position;let l=0;if(null!==r){const t=r.array;l=r.version;for(let i=0,e=t.length;i<e;i+=3){const a=t[i+0],b=t[i+1],e=t[i+2];n.push(a,b,b,e,e,a)}}else{const t=o.array;l=o.version;for(let i=0,e=t.length/3-1;i<e;i+=3){const a=i+0,b=i+1,t=i+2;n.push(a,b,b,t,t,a)}}const h=new(Oe(n)>65535?Ce:Te)(n,1);h.version=l;const d=c.get(t);d&&e.remove(d),c.set(t,h)}return{get:function(object,t){let e=o.get(t);return e||(t.addEventListener("dispose",l),t.isBufferGeometry?e=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ue).setFromObject(object)),e=t._bufferGeometry),o.set(t,e),n.memory.geometries++,e)},update:function(t){const n=t.attributes;for(const t in n)e.update(n[t],34962);const r=t.morphAttributes;for(const t in r){const n=r[t];for(let i=0,t=n.length;i<t;i++)e.update(n[i],34962)}},getWireframeAttribute:function(t){const e=c.get(t);if(e){const n=t.index;null!==n&&e.version<n.version&&h(t)}else h(t);return c.get(t)}}}function Un(t,e,n,r){const o=r.isWebGL2;let c,l,h;this.setMode=function(t){c=t},this.setIndex=function(t){l=t.type,h=t.bytesPerElement},this.render=function(e,r){t.drawElements(c,r,l,e*h),n.update(r,c)},this.renderInstances=function(r,d,f,m){if(0===m)return;let v,y;if(o)v=t,y="drawElementsInstanced";else if(v=e.get("ANGLE_instanced_arrays"),y="drawElementsInstancedANGLE",null===v)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");v[y](c,f,l,d*h,m),n.update(f,c,m)}}function Vn(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.frame++,e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(t,n,r){switch(r=r||1,e.calls++,n){case 4:e.triangles+=r*(t/3);break;case 1:e.lines+=r*(t/2);break;case 3:e.lines+=r*(t-1);break;case 2:e.lines+=r*t;break;case 0:e.points+=r*t;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Gn(a,b){return a[0]-b[0]}function Hn(a,b){return Math.abs(b[1])-Math.abs(a[1])}function jn(t){const e={},n=new Float32Array(8),r=[];for(let i=0;i<8;i++)r[i]=[i,0];return{update:function(object,o,c,l){const h=object.morphTargetInfluences,d=void 0===h?0:h.length;let f=e[o.id];if(void 0===f){f=[];for(let i=0;i<d;i++)f[i]=[i,0];e[o.id]=f}for(let i=0;i<d;i++){const t=f[i];t[0]=i,t[1]=h[i]}f.sort(Hn);for(let i=0;i<8;i++)i<d&&f[i][1]?(r[i][0]=f[i][0],r[i][1]=f[i][1]):(r[i][0]=Number.MAX_SAFE_INTEGER,r[i][1]=0);r.sort(Gn);const m=c.morphTargets&&o.morphAttributes.position,v=c.morphNormals&&o.morphAttributes.normal;let y=0;for(let i=0;i<8;i++){const t=r[i],e=t[0],c=t[1];e!==Number.MAX_SAFE_INTEGER&&c?(m&&o.getAttribute("morphTarget"+i)!==m[e]&&o.setAttribute("morphTarget"+i,m[e]),v&&o.getAttribute("morphNormal"+i)!==v[e]&&o.setAttribute("morphNormal"+i,v[e]),n[i]=c,y+=c):(m&&void 0!==o.getAttribute("morphTarget"+i)&&o.deleteAttribute("morphTarget"+i),v&&void 0!==o.getAttribute("morphNormal"+i)&&o.deleteAttribute("morphNormal"+i),n[i]=0)}const x=o.morphTargetsRelative?1:1-y;l.getUniforms().setValue(t,"morphTargetBaseInfluence",x),l.getUniforms().setValue(t,"morphTargetInfluences",n)}}}function Wn(t,e,n,r){let o=new WeakMap;return{update:function(object){const t=r.render.frame,c=object.geometry,l=e.get(object,c);return o.get(l)!==t&&(c.isGeometry&&l.updateFromObject(object),e.update(l),o.set(l,t)),object.isInstancedMesh&&n.update(object.instanceMatrix,34962),l},dispose:function(){o=new WeakMap}}}function qn(t,e,n,r,o,c,l,h,d,f){t=void 0!==t?t:[],e=void 0!==e?e:301,l=void 0!==l?l:w,B.call(this,t,e,n,r,o,c,l,h,d,f),this.flipY=!1}function Xn(data,t,e,n){B.call(this,null),this.image={data:data||null,width:t||1,height:e||1,depth:n||1},this.magFilter=d,this.minFilter=d,this.wrapR=l,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Yn(data,t,e,n){B.call(this,null),this.image={data:data||null,width:t||1,height:e||1,depth:n||1},this.magFilter=d,this.minFilter=d,this.wrapR=l,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}On.physical={uniforms:mn([On.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new D(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new he(0)},transparency:{value:0}}]),vertexShader:Nn.meshphysical_vert,fragmentShader:Nn.meshphysical_frag},qn.prototype=Object.create(B.prototype),qn.prototype.constructor=qn,qn.prototype.isCubeTexture=!0,Object.defineProperty(qn.prototype,"images",{get:function(){return this.image},set:function(t){this.image=t}}),Xn.prototype=Object.create(B.prototype),Xn.prototype.constructor=Xn,Xn.prototype.isDataTexture2DArray=!0,Yn.prototype=Object.create(B.prototype),Yn.prototype.constructor=Yn,Yn.prototype.isDataTexture3D=!0;const Kn=new B,Jn=new Xn,Zn=new Yn,Qn=new qn,$n=[],er=[],nr=new Float32Array(16),rr=new Float32Array(9),ir=new Float32Array(4);function or(t,e,n){const r=t[0];if(r<=0||r>0)return t;let o=e*n,c=$n[o];if(void 0===c&&(c=new Float32Array(o),$n[o]=c),0!==e){r.toArray(c,0);for(let i=1,r=0;i!==e;++i)r+=n,t[i].toArray(c,r)}return c}function ar(a,b){if(a.length!==b.length)return!1;for(let i=0,t=a.length;i<t;i++)if(a[i]!==b[i])return!1;return!0}function sr(a,b){for(let i=0,t=b.length;i<t;i++)a[i]=b[i]}function ur(t,e){let n=er[e];void 0===n&&(n=new Int32Array(e),er[e]=n);for(let i=0;i!==e;++i)n[i]=t.allocateTextureUnit();return n}function cr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function lr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(ar(n,e))return;t.uniform2fv(this.addr,e),sr(n,e)}}function pr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(void 0!==e.r)n[0]===e.r&&n[1]===e.g&&n[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(ar(n,e))return;t.uniform3fv(this.addr,e),sr(n,e)}}function dr(t,e){const n=this.cache;if(void 0!==e.x)n[0]===e.x&&n[1]===e.y&&n[2]===e.z&&n[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(ar(n,e))return;t.uniform4fv(this.addr,e),sr(n,e)}}function fr(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ar(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),sr(n,e)}else{if(ar(n,r))return;ir.set(r),t.uniformMatrix2fv(this.addr,!1,ir),sr(n,r)}}function mr(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ar(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),sr(n,e)}else{if(ar(n,r))return;rr.set(r),t.uniformMatrix3fv(this.addr,!1,rr),sr(n,r)}}function gr(t,e){const n=this.cache,r=e.elements;if(void 0===r){if(ar(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),sr(n,e)}else{if(ar(n,r))return;nr.set(r),t.uniformMatrix4fv(this.addr,!1,nr),sr(n,r)}}function vr(t,e,n){const r=this.cache,o=n.allocateTextureUnit();r[0]!==o&&(t.uniform1i(this.addr,o),r[0]=o),n.safeSetTexture2D(e||Kn,o)}function yr(t,e,n){const r=this.cache,o=n.allocateTextureUnit();r[0]!==o&&(t.uniform1i(this.addr,o),r[0]=o),n.setTexture2DArray(e||Jn,o)}function xr(t,e,n){const r=this.cache,o=n.allocateTextureUnit();r[0]!==o&&(t.uniform1i(this.addr,o),r[0]=o),n.setTexture3D(e||Zn,o)}function wr(t,e,n){const r=this.cache,o=n.allocateTextureUnit();r[0]!==o&&(t.uniform1i(this.addr,o),r[0]=o),n.safeSetTextureCube(e||Qn,o)}function _r(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function Sr(t,e){const n=this.cache;ar(n,e)||(t.uniform2iv(this.addr,e),sr(n,e))}function Mr(t,e){const n=this.cache;ar(n,e)||(t.uniform3iv(this.addr,e),sr(n,e))}function Er(t,e){const n=this.cache;ar(n,e)||(t.uniform4iv(this.addr,e),sr(n,e))}function Tr(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function Ar(t,e){t.uniform1fv(this.addr,e)}function Cr(t,e){t.uniform1iv(this.addr,e)}function Rr(t,e){t.uniform2iv(this.addr,e)}function Ir(t,e){t.uniform3iv(this.addr,e)}function Nr(t,e){t.uniform4iv(this.addr,e)}function Or(t,e){const data=or(e,this.size,2);t.uniform2fv(this.addr,data)}function Dr(t,e){const data=or(e,this.size,3);t.uniform3fv(this.addr,data)}function Lr(t,e){const data=or(e,this.size,4);t.uniform4fv(this.addr,data)}function kr(t,e){const data=or(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,data)}function Pr(t,e){const data=or(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,data)}function Fr(t,e){const data=or(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,data)}function Br(t,e,n){const r=e.length,o=ur(n,r);t.uniform1iv(this.addr,o);for(let i=0;i!==r;++i)n.safeSetTexture2D(e[i]||Kn,o[i])}function zr(t,e,n){const r=e.length,o=ur(n,r);t.uniform1iv(this.addr,o);for(let i=0;i!==r;++i)n.safeSetTextureCube(e[i]||Qn,o[i])}function Ur(t,e,n){this.id=t,this.addr=n,this.cache=[],this.setValue=function(t){switch(t){case 5126:return cr;case 35664:return lr;case 35665:return pr;case 35666:return dr;case 35674:return fr;case 35675:return mr;case 35676:return gr;case 5124:case 35670:return _r;case 35667:case 35671:return Sr;case 35668:case 35672:return Mr;case 35669:case 35673:return Er;case 5125:return Tr;case 35678:case 36198:case 36298:case 36306:case 35682:return vr;case 35679:case 36299:case 36307:return xr;case 35680:case 36300:case 36308:case 36293:return wr;case 36289:case 36303:case 36311:case 36292:return yr}}(e.type)}function Vr(t,e,n){this.id=t,this.addr=n,this.cache=[],this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Ar;case 35664:return Or;case 35665:return Dr;case 35666:return Lr;case 35674:return kr;case 35675:return Pr;case 35676:return Fr;case 5124:case 35670:return Cr;case 35667:case 35671:return Rr;case 35668:case 35672:return Ir;case 35669:case 35673:return Nr;case 35678:case 36198:case 36298:case 36306:case 35682:return Br;case 35680:case 36300:case 36308:case 36293:return zr}}(e.type)}function Gr(t){this.id=t,this.seq=[],this.map={}}Vr.prototype.updateCache=function(data){let t=this.cache;data instanceof Float32Array&&t.length!==data.length&&(this.cache=new Float32Array(data.length)),sr(t,data)},Gr.prototype.setValue=function(t,e,n){const r=this.seq;for(let i=0,o=r.length;i!==o;++i){const u=r[i];u.setValue(t,e[u.id],n)}};const Hr=/([\w\d_]+)(\])?(\[|\.)?/g;function jr(t,e){t.seq.push(e),t.map[e.id]=e}function Wr(t,e,n){const path=t.name,r=path.length;for(Hr.lastIndex=0;;){const o=Hr.exec(path),c=Hr.lastIndex;let l=o[1],h="]"===o[2],d=o[3];if(h&&(l|=0),void 0===d||"["===d&&c+2===r){jr(n,void 0===d?new Ur(l,t,e):new Vr(l,t,e));break}{let t=n.map[l];void 0===t&&(t=new Gr(l),jr(n,t)),n=t}}}function qr(t,e){this.seq=[],this.map={};const n=t.getProgramParameter(e,35718);for(let i=0;i<n;++i){const n=t.getActiveUniform(e,i);Wr(n,t.getUniformLocation(e,n.name),this)}}function Xr(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}qr.prototype.setValue=function(t,e,n,r){const u=this.map[e];void 0!==u&&u.setValue(t,n,r)},qr.prototype.setOptional=function(t,object,e){const n=object[e];void 0!==n&&this.setValue(t,e,n)},qr.upload=function(t,e,n,r){for(let i=0,o=e.length;i!==o;++i){const u=e[i],o=n[u.id];!1!==o.needsUpdate&&u.setValue(t,o.value,r)}},qr.seqWithValue=function(t,e){const n=[];for(let i=0,r=t.length;i!==r;++i){const u=t[i];u.id in e&&n.push(u)}return n};let Yr=0;function Kr(t){switch(t){case 3e3:return["Linear","( value )"];case C:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",t),["Linear","( value )"]}}function Jr(t,e,n){const r=t.getShaderParameter(e,35713),o=t.getShaderInfoLog(e).trim();if(r&&""===o)return"";return"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+o+function(t){const e=t.split("\n");for(let i=0;i<e.length;i++)e[i]=i+1+": "+e[i];return e.join("\n")}(t.getShaderSource(e))}function Zr(t,e){const n=Kr(e);return"vec4 "+t+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Qr(t,e){const n=Kr(e);return"vec4 "+t+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function $r(t,e){let n;switch(e){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ti(t){return""!==t}function ei(t,e){return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function ni(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const ri=/^[ \t]*#include +<([\w\d./]+)>/gm;function ii(t){return t.replace(ri,oi)}function oi(t,e){const n=Nn[e];if(void 0===n)throw new Error("Can not resolve #include <"+e+">");return ii(n)}const ai=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,si=/#pragma unroll_loop_start[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}[\s]+?#pragma unroll_loop_end/g;function ui(t){return t.replace(si,hi).replace(ai,ci)}function ci(t,e,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),hi(t,e,n,r)}function hi(t,e,n,r){let o="";for(let i=parseInt(e);i<parseInt(n);i++)o+=r.replace(/\[ i \]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return o}function pi(t){let e="precision "+t.precision+" float;\nprecision "+t.precision+" int;";return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function di(t,e,n,r){const o=t.getContext(),c=n.defines;let l=n.vertexShader,h=n.fragmentShader;const d=function(t){let e="SHADOWMAP_TYPE_BASIC";return 1===t.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===t.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===t.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(n),f=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:case 307:e="ENVMAP_TYPE_CUBE_UV";break;case 303:case 304:e="ENVMAP_TYPE_EQUIREC"}return e}(n),m=function(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case 302:case 304:e="ENVMAP_MODE_REFRACTION"}return e}(n),v=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(n),y=t.gammaFactor>0?t.gammaFactor:1,x=n.isWebGL2?"":function(t){return[t.extensionDerivatives||t.envMapCubeUV||t.bumpMap||t.tangentSpaceNormalMap||t.clearcoatNormalMap||t.flatShading||"physical"===t.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(t.extensionFragDepth||t.logarithmicDepthBuffer)&&t.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",t.extensionDrawBuffers&&t.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(t.extensionShaderTextureLOD||t.envMap)&&t.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ti).join("\n")}(n),w=function(t){const e=[];for(const n in t){const r=t[n];!1!==r&&e.push("#define "+n+" "+r)}return e.join("\n")}(c),_=o.createProgram();let S,M;if(n.isRawShaderMaterial?(S=[w].filter(ti).join("\n"),S.length>0&&(S+="\n"),M=[x,w].filter(ti).join("\n"),M.length>0&&(M+="\n")):(S=[pi(n),"#define SHADER_NAME "+n.shaderName,w,n.instancing?"#define USE_INSTANCING":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+y,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+m:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ti).join("\n"),M=[x,pi(n),"#define SHADER_NAME "+n.shaderName,w,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+y,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.envMap?"#define "+m:"",n.envMap?"#define "+v:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+d:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?Nn.tonemapping_pars_fragment:"",0!==n.toneMapping?$r("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",Nn.encodings_pars_fragment,n.map?Zr("mapTexelToLinear",n.mapEncoding):"",n.matcap?Zr("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Zr("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Zr("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Zr("lightMapTexelToLinear",n.lightMapEncoding):"",Qr("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ti).join("\n")),l=ii(l),l=ei(l,n),l=ni(l,n),h=ii(h),h=ei(h,n),h=ni(h,n),l=ui(l),h=ui(h),n.isWebGL2&&!n.isRawShaderMaterial){let t=!1;const e=/^\s*#version\s+300\s+es\s*\n/;n.isShaderMaterial&&null!==l.match(e)&&null!==h.match(e)&&(t=!0,l=l.replace(e,""),h=h.replace(e,"")),S=["#version 300 es\n","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+S,M=["#version 300 es\n","#define varying in",t?"":"out highp vec4 pc_fragColor;",t?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+M}const E=M+h,T=Xr(o,35633,S+l),A=Xr(o,35632,E);if(o.attachShader(_,T),o.attachShader(_,A),void 0!==n.index0AttributeName?o.bindAttribLocation(_,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(_,0,"position"),o.linkProgram(_),t.debug.checkShaderErrors){const t=o.getProgramInfoLog(_).trim(),e=o.getShaderInfoLog(T).trim(),n=o.getShaderInfoLog(A).trim();let r=!0,c=!0;if(!1===o.getProgramParameter(_,35714)){r=!1;const e=Jr(o,T,"vertex"),n=Jr(o,A,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(_,35715),"gl.getProgramInfoLog",t,e,n)}else""!==t?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",t):""!==e&&""!==n||(c=!1);c&&(this.diagnostics={runnable:r,programLog:t,vertexShader:{log:e,prefix:S},fragmentShader:{log:n,prefix:M}})}let C,R;return o.deleteShader(T),o.deleteShader(A),this.getUniforms=function(){return void 0===C&&(C=new qr(o,_)),C},this.getAttributes=function(){return void 0===R&&(R=function(t,e){const n={},r=t.getProgramParameter(e,35721);for(let i=0;i<r;i++){const r=t.getActiveAttrib(e,i).name;n[r]=t.getAttribLocation(e,r)}return n}(o,_)),R},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(_),this.program=void 0},this.name=n.shaderName,this.id=Yr++,this.cacheKey=e,this.usedTimes=1,this.program=_,this.vertexShader=T,this.fragmentShader=A,this}function fi(t,e,n,r){const c=[],l=n.isWebGL2,h=n.logarithmicDepthBuffer,d=n.floatVertexTextures,f=n.maxVertexUniforms,m=n.vertexTextures;let v=n.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},x=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function w(map){let t;return map?map.isTexture?t=map.encoding:map.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=map.texture.encoding):t=3e3,t}return{getParameters:function(r,c,x,_,S,M,object){const E=_.fog,T=r.isMeshStandardMaterial?_.environment:null,A=r.envMap||T,C=y[r.type],I=object.isSkinnedMesh?function(object){const t=object.skeleton.bones;if(d)return 1024;{const e=f,n=Math.floor((e-20)/4),r=Math.min(n,t.length);return r<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+r+"."),0):r}}(object):0;null!==r.precision&&(v=n.getMaxPrecision(r.precision),v!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",v,"instead."));const N=function(t,e){let n;if(e){const r=On[e];n={name:t.name||t.type,uniforms:gn.clone(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}}else n={name:t.name||t.type,uniforms:t.uniforms,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader};return n}(r,C);r.onBeforeCompile(N,t);const O=t.getRenderTarget();return{isWebGL2:l,shaderID:C,shaderName:N.name,uniforms:N.uniforms,vertexShader:N.vertexShader,fragmentShader:N.fragmentShader,defines:r.defines,isRawShaderMaterial:r.isRawShaderMaterial,isShaderMaterial:r.isShaderMaterial,precision:v,instancing:!0===object.isInstancedMesh,supportsVertexTextures:m,outputEncoding:null!==O?w(O.texture):t.outputEncoding,map:!!r.map,mapEncoding:w(r.map),matcap:!!r.matcap,matcapEncoding:w(r.matcap),envMap:!!A,envMapMode:A&&A.mapping,envMapEncoding:w(A),envMapCubeUV:!!A&&(306===A.mapping||307===A.mapping),lightMap:!!r.lightMap,lightMapEncoding:w(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:w(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:1===r.normalMapType,tangentSpaceNormalMap:r.normalMapType===R,clearcoatMap:!!r.clearcoatMap,clearcoatRoughnessMap:!!r.clearcoatRoughnessMap,clearcoatNormalMap:!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,sheen:!!r.sheen,combine:r.combine,vertexTangents:r.normalMap&&r.vertexTangents,vertexColors:r.vertexColors,vertexUvs:!!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatMap||r.clearcoatRoughnessMap||r.clearcoatNormalMap||r.displacementMap),uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||!r.displacementMap),fog:!!E,useFog:r.fog,fogExp2:E&&E.isFogExp2,flatShading:r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:h,skinning:r.skinning&&I>0,maxBones:I,useVertexTexture:d,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:t.maxMorphTargets,maxMorphNormals:t.maxMorphNormals,numDirLights:c.directional.length,numPointLights:c.point.length,numSpotLights:c.spot.length,numRectAreaLights:c.rectArea.length,numHemiLights:c.hemi.length,numDirLightShadows:c.directionalShadowMap.length,numPointLightShadows:c.pointShadowMap.length,numSpotLightShadows:c.spotShadowMap.length,numClippingPlanes:S,numClipIntersection:M,dithering:r.dithering,shadowMapEnabled:t.shadowMap.enabled&&x.length>0,shadowMapType:t.shadowMap.type,toneMapping:r.toneMapped?t.toneMapping:0,physicallyCorrectLights:t.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===o,flipSided:1===r.side,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||null!==e.get("EXT_frag_depth"),rendererExtensionDrawBuffers:l||null!==e.get("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||null!==e.get("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(e){const n=[];if(e.shaderID?n.push(e.shaderID):(n.push(e.fragmentShader),n.push(e.vertexShader)),void 0!==e.defines)for(const t in e.defines)n.push(t),n.push(e.defines[t]);if(void 0===e.isRawShaderMaterial){for(let i=0;i<x.length;i++)n.push(e[x[i]]);n.push(t.outputEncoding),n.push(t.gammaFactor)}return n.push(e.customProgramCacheKey),n.join()},acquireProgram:function(e,n){let o;for(let p=0,t=c.length;p<t;p++){const t=c[p];if(t.cacheKey===n){o=t,++o.usedTimes;break}}return void 0===o&&(o=new di(t,n,e,r),c.push(o)),o},releaseProgram:function(t){if(0==--t.usedTimes){const i=c.indexOf(t);c[i]=c[c.length-1],c.pop(),t.destroy()}},programs:c}}function mi(){let t=new WeakMap;return{get:function(object){let map=t.get(object);return void 0===map&&(map={},t.set(object,map)),map},remove:function(object){t.delete(object)},update:function(object,e,n){t.get(object)[e]=n},dispose:function(){t=new WeakMap}}}function gi(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.program!==b.program?a.program.id-b.program.id:a.material.id!==b.material.id?a.material.id-b.material.id:a.z!==b.z?a.z-b.z:a.id-b.id}function vi(a,b){return a.groupOrder!==b.groupOrder?a.groupOrder-b.groupOrder:a.renderOrder!==b.renderOrder?a.renderOrder-b.renderOrder:a.z!==b.z?b.z-a.z:a.id-b.id}function yi(){const t=[];let e=0;const n=[],r=[],o={id:-1};function c(object,n,r,c,l,h){let d=t[e];return void 0===d?(d={id:object.id,object:object,geometry:n,material:r,program:r.program||o,groupOrder:c,renderOrder:object.renderOrder,z:l,group:h},t[e]=d):(d.id=object.id,d.object=object,d.geometry=n,d.material=r,d.program=r.program||o,d.groupOrder=c,d.renderOrder=object.renderOrder,d.z=l,d.group=h),e++,d}return{opaque:n,transparent:r,init:function(){e=0,n.length=0,r.length=0},push:function(object,t,e,o,l,h){const d=c(object,t,e,o,l,h);(!0===e.transparent?r:n).push(d)},unshift:function(object,t,e,o,l,h){const d=c(object,t,e,o,l,h);(!0===e.transparent?r:n).unshift(d)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.program=null,e.group=null}},sort:function(t,e){n.length>1&&n.sort(t||gi),r.length>1&&r.sort(e||vi)}}}function xi(){let t=new WeakMap;function e(n){const r=n.target;r.removeEventListener("dispose",e),t.delete(r)}return{get:function(n,r){const o=t.get(n);let c;return void 0===o?(c=new yi,t.set(n,new WeakMap),t.get(n).set(r,c),n.addEventListener("dispose",e)):(c=o.get(r),void 0===c&&(c=new yi,o.set(r,c))),c},dispose:function(){t=new WeakMap}}}function bi(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new W,color:new he};break;case"SpotLight":n={position:new W,direction:new W,color:new he,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new W,color:new he,distance:0,decay:0};break;case"HemisphereLight":n={direction:new W,skyColor:new he,groundColor:new he};break;case"RectAreaLight":n={color:new he,position:new W,halfWidth:new W,halfHeight:new W}}return t[e.id]=n,n}}}let wi=0;function _i(t,e){return(e.castShadow?1:0)-(t.castShadow?1:0)}function Si(){const t=new bi,e=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let n;switch(e.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new D};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new D,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=n,n}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let i=0;i<9;i++)n.probe.push(new W);const r=new W,o=new tt,c=new tt;return{setup:function(l,h,d){let f=0,g=0,b=0;for(let i=0;i<9;i++)n.probe[i].set(0,0,0);let m=0,v=0,y=0,x=0,w=0,_=0,S=0,M=0;const E=d.matrixWorldInverse;l.sort(_i);for(let i=0,h=l.length;i<h;i++){const h=l[i],d=h.color,T=h.intensity,A=h.distance,C=h.shadow&&h.shadow.map?h.shadow.map.texture:null;if(h.isAmbientLight)f+=d.r*T,g+=d.g*T,b+=d.b*T;else if(h.isLightProbe)for(let t=0;t<9;t++)n.probe[t].addScaledVector(h.sh.coefficients[t],T);else if(h.isDirectionalLight){const o=t.get(h);if(o.color.copy(h.color).multiplyScalar(h.intensity),o.direction.setFromMatrixPosition(h.matrixWorld),r.setFromMatrixPosition(h.target.matrixWorld),o.direction.sub(r),o.direction.transformDirection(E),h.castShadow){const shadow=h.shadow,t=e.get(h);t.shadowBias=shadow.bias,t.shadowNormalBias=shadow.normalBias,t.shadowRadius=shadow.radius,t.shadowMapSize=shadow.mapSize,n.directionalShadow[m]=t,n.directionalShadowMap[m]=C,n.directionalShadowMatrix[m]=h.shadow.matrix,_++}n.directional[m]=o,m++}else if(h.isSpotLight){const o=t.get(h);if(o.position.setFromMatrixPosition(h.matrixWorld),o.position.applyMatrix4(E),o.color.copy(d).multiplyScalar(T),o.distance=A,o.direction.setFromMatrixPosition(h.matrixWorld),r.setFromMatrixPosition(h.target.matrixWorld),o.direction.sub(r),o.direction.transformDirection(E),o.coneCos=Math.cos(h.angle),o.penumbraCos=Math.cos(h.angle*(1-h.penumbra)),o.decay=h.decay,h.castShadow){const shadow=h.shadow,t=e.get(h);t.shadowBias=shadow.bias,t.shadowNormalBias=shadow.normalBias,t.shadowRadius=shadow.radius,t.shadowMapSize=shadow.mapSize,n.spotShadow[y]=t,n.spotShadowMap[y]=C,n.spotShadowMatrix[y]=h.shadow.matrix,M++}n.spot[y]=o,y++}else if(h.isRectAreaLight){const e=t.get(h);e.color.copy(d).multiplyScalar(T),e.position.setFromMatrixPosition(h.matrixWorld),e.position.applyMatrix4(E),c.identity(),o.copy(h.matrixWorld),o.premultiply(E),c.extractRotation(o),e.halfWidth.set(.5*h.width,0,0),e.halfHeight.set(0,.5*h.height,0),e.halfWidth.applyMatrix4(c),e.halfHeight.applyMatrix4(c),n.rectArea[x]=e,x++}else if(h.isPointLight){const r=t.get(h);if(r.position.setFromMatrixPosition(h.matrixWorld),r.position.applyMatrix4(E),r.color.copy(h.color).multiplyScalar(h.intensity),r.distance=h.distance,r.decay=h.decay,h.castShadow){const shadow=h.shadow,t=e.get(h);t.shadowBias=shadow.bias,t.shadowNormalBias=shadow.normalBias,t.shadowRadius=shadow.radius,t.shadowMapSize=shadow.mapSize,t.shadowCameraNear=shadow.camera.near,t.shadowCameraFar=shadow.camera.far,n.pointShadow[v]=t,n.pointShadowMap[v]=C,n.pointShadowMatrix[v]=h.shadow.matrix,S++}n.point[v]=r,v++}else if(h.isHemisphereLight){const e=t.get(h);e.direction.setFromMatrixPosition(h.matrixWorld),e.direction.transformDirection(E),e.direction.normalize(),e.skyColor.copy(h.color).multiplyScalar(T),e.groundColor.copy(h.groundColor).multiplyScalar(T),n.hemi[w]=e,w++}}n.ambient[0]=f,n.ambient[1]=g,n.ambient[2]=b;const T=n.hash;T.directionalLength===m&&T.pointLength===v&&T.spotLength===y&&T.rectAreaLength===x&&T.hemiLength===w&&T.numDirectionalShadows===_&&T.numPointShadows===S&&T.numSpotShadows===M||(n.directional.length=m,n.spot.length=y,n.rectArea.length=x,n.point.length=v,n.hemi.length=w,n.directionalShadow.length=_,n.directionalShadowMap.length=_,n.pointShadow.length=S,n.pointShadowMap.length=S,n.spotShadow.length=M,n.spotShadowMap.length=M,n.directionalShadowMatrix.length=_,n.pointShadowMatrix.length=S,n.spotShadowMatrix.length=M,T.directionalLength=m,T.pointLength=v,T.spotLength=y,T.rectAreaLength=x,T.hemiLength=w,T.numDirectionalShadows=_,T.numPointShadows=S,T.numSpotShadows=M,n.version=wi++)},state:n}}function Mi(){const t=new Si,e=[],n=[];return{init:function(){e.length=0,n.length=0},state:{lightsArray:e,shadowsArray:n,lights:t},setupLights:function(r){t.setup(e,n,r)},pushLight:function(t){e.push(t)},pushShadow:function(t){n.push(t)}}}function Ei(){let t=new WeakMap;function e(n){const r=n.target;r.removeEventListener("dispose",e),t.delete(r)}return{get:function(n,r){let o;return!1===t.has(n)?(o=new Mi,t.set(n,new WeakMap),t.get(n).set(r,o),n.addEventListener("dispose",e)):!1===t.get(n).has(r)?(o=new Mi,t.get(n).set(r,o)):o=t.get(n).get(r),o},dispose:function(){t=new WeakMap}}}function Ti(t){ve.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(t)}function Ai(t){ve.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new W,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(t)}Ti.prototype=Object.create(ve.prototype),Ti.prototype.constructor=Ti,Ti.prototype.isMeshDepthMaterial=!0,Ti.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.depthPacking=source.depthPacking,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this},Ai.prototype=Object.create(ve.prototype),Ai.prototype.constructor=Ai,Ai.prototype.isMeshDistanceMaterial=!0,Ai.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.referencePosition.copy(source.referencePosition),this.nearDistance=source.nearDistance,this.farDistance=source.farDistance,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.map=source.map,this.alphaMap=source.alphaMap,this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this};function Ci(t,e,n){let c=new En;const l=new D,h=new D,f=new z,m=[],y=[],x={},w={0:1,1:r,2:o},S=new vn({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new D},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n  float mean = 0.0;\n  float squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );\n  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n    #ifdef HORIZONAL_PASS\n      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n      mean += distribution.x;\n      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n    #else\n      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );\n      mean += depth;\n      squared_mean += depth * depth;\n    #endif\n  }\n  mean = mean * HALF_SAMPLE_RATE;\n  squared_mean = squared_mean * HALF_SAMPLE_RATE;\n  float std_dev = sqrt( squared_mean - mean * mean );\n  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),M=S.clone();M.defines.HORIZONAL_PASS=1;const E=new Ue;E.setAttribute("position",new we(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const T=new on(E,S),A=this;function C(shadow,n){const r=e.update(T);S.uniforms.shadow_pass.value=shadow.map.texture,S.uniforms.resolution.value=shadow.mapSize,S.uniforms.radius.value=shadow.radius,t.setRenderTarget(shadow.mapPass),t.clear(),t.renderBufferDirect(n,null,r,S,T,null),M.uniforms.shadow_pass.value=shadow.mapPass.texture,M.uniforms.resolution.value=shadow.mapSize,M.uniforms.radius.value=shadow.radius,t.setRenderTarget(shadow.map),t.clear(),t.renderBufferDirect(n,null,r,M,T,null)}function R(t,e,n){const r=t<<0|e<<1|n<<2;let o=m[r];return void 0===o&&(o=new Ti({depthPacking:3201,morphTargets:t,skinning:e}),m[r]=o),o}function I(t,e,n){const r=t<<0|e<<1|n<<2;let o=y[r];return void 0===o&&(o=new Ai({morphTargets:t,skinning:e}),y[r]=o),o}function N(object,e,n,r,o,c,l){let h=null,d=R,f=object.customDepthMaterial;if(!0===r.isPointLight&&(d=I,f=object.customDistanceMaterial),void 0===f){let t=!1;!0===n.morphTargets&&(t=e.morphAttributes&&e.morphAttributes.position&&e.morphAttributes.position.length>0);let r=!1;!0===object.isSkinnedMesh&&(!0===n.skinning?r=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",object));h=d(t,r,!0===object.isInstancedMesh)}else h=f;if(t.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length){const t=h.uuid,e=n.uuid;let r=x[t];void 0===r&&(r={},x[t]=r);let o=r[e];void 0===o&&(o=h.clone(),r[e]=o),h=o}return h.visible=n.visible,h.wireframe=n.wireframe,h.side=3===l?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:w[n.side],h.clipShadows=n.clipShadows,h.clippingPlanes=n.clippingPlanes,h.clipIntersection=n.clipIntersection,h.wireframeLinewidth=n.wireframeLinewidth,h.linewidth=n.linewidth,!0===r.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(r.matrixWorld),h.nearDistance=o,h.farDistance=c),h}function O(object,n,r,o,l){if(!1===object.visible)return;if(object.layers.test(n.layers)&&(object.isMesh||object.isLine||object.isPoints)&&(object.castShadow||object.receiveShadow&&3===l)&&(!object.frustumCulled||c.intersectsObject(object))){object.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,object.matrixWorld);const n=e.update(object),c=object.material;if(Array.isArray(c)){const e=n.groups;for(let h=0,d=e.length;h<d;h++){const d=e[h],f=c[d.materialIndex];if(f&&f.visible){const e=N(object,n,f,o,r.near,r.far,l);t.renderBufferDirect(r,null,n,e,object,d)}}}else if(c.visible){const e=N(object,n,c,o,r.near,r.far,l);t.renderBufferDirect(r,null,n,e,object,null)}}const h=object.children;for(let i=0,t=h.length;i<t;i++)O(h[i],n,r,o,l)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(e,r,o){if(!1===A.enabled)return;if(!1===A.autoUpdate&&!1===A.needsUpdate)return;if(0===e.length)return;const m=t.getRenderTarget(),y=t.getActiveCubeFace(),x=t.getActiveMipmapLevel(),w=t.state;w.setBlending(0),w.buffers.color.setClear(1,1,1,1),w.buffers.depth.setTest(!0),w.setScissorTest(!1);for(let i=0,m=e.length;i<m;i++){const m=e[i],shadow=m.shadow;if(!1===shadow.autoUpdate&&!1===shadow.needsUpdate)continue;if(void 0===shadow){console.warn("THREE.WebGLShadowMap:",m,"has no shadow.");continue}l.copy(shadow.mapSize);const y=shadow.getFrameExtents();if(l.multiply(y),h.copy(shadow.mapSize),(l.x>n||l.y>n)&&(l.x>n&&(h.x=Math.floor(n/y.x),l.x=h.x*y.x,shadow.mapSize.x=h.x),l.y>n&&(h.y=Math.floor(n/y.y),l.y=h.y*y.y,shadow.mapSize.y=h.y)),null===shadow.map&&!shadow.isPointLightShadow&&3===this.type){const t={minFilter:v,magFilter:v,format:_};shadow.map=new U(l.x,l.y,t),shadow.map.texture.name=m.name+".shadowMap",shadow.mapPass=new U(l.x,l.y,t),shadow.camera.updateProjectionMatrix()}if(null===shadow.map){const t={minFilter:d,magFilter:d,format:_};shadow.map=new U(l.x,l.y,t),shadow.map.texture.name=m.name+".shadowMap",shadow.camera.updateProjectionMatrix()}t.setRenderTarget(shadow.map),t.clear();const x=shadow.getViewportCount();for(let t=0;t<x;t++){const e=shadow.getViewport(t);f.set(h.x*e.x,h.y*e.y,h.x*e.z,h.y*e.w),w.viewport(f),shadow.updateMatrices(m,t),c=shadow.getFrustum(),O(r,o,shadow.camera,m,this.type)}shadow.isPointLightShadow||3!==this.type||C(shadow,o),shadow.needsUpdate=!1}A.needsUpdate=!1,t.setRenderTarget(m,y,x)}}function Ri(t,e,n){const r=n.isWebGL2;const c=new function(){let e=!1;const n=new z;let r=null;const o=new z(0,0,0,0);return{setMask:function(n){r===n||e||(t.colorMask(n,n,n,n),r=n)},setLocked:function(t){e=t},setClear:function(e,g,b,a,r){!0===r&&(e*=a,g*=a,b*=a),n.set(e,g,b,a),!1===o.equals(n)&&(t.clearColor(e,g,b,a),o.copy(n))},reset:function(){e=!1,r=null,o.set(-1,0,0,0)}}},l=new function(){let e=!1,n=null,r=null,o=null;return{setTest:function(t){t?G(2929):H(2929)},setMask:function(r){n===r||e||(t.depthMask(r),n=r)},setFunc:function(e){if(r!==e){if(e)switch(e){case 0:t.depthFunc(512);break;case 1:t.depthFunc(519);break;case 2:t.depthFunc(513);break;case 3:t.depthFunc(515);break;case 4:t.depthFunc(514);break;case 5:t.depthFunc(518);break;case 6:t.depthFunc(516);break;case 7:t.depthFunc(517);break;default:t.depthFunc(515)}else t.depthFunc(515);r=e}},setLocked:function(t){e=t},setClear:function(e){o!==e&&(t.clearDepth(e),o=e)},reset:function(){e=!1,n=null,r=null,o=null}}},h=new function(){let e=!1,n=null,r=null,o=null,c=null,l=null,h=null,d=null,f=null;return{setTest:function(t){e||(t?G(2960):H(2960))},setMask:function(r){n===r||e||(t.stencilMask(r),n=r)},setFunc:function(e,n,l){r===e&&o===n&&c===l||(t.stencilFunc(e,n,l),r=e,o=n,c=l)},setOp:function(e,n,r){l===e&&h===n&&d===r||(t.stencilOp(e,n,r),l=e,h=n,d=r)},setLocked:function(t){e=t},setClear:function(e){f!==e&&(t.clearStencil(e),f=e)},reset:function(){e=!1,n=null,r=null,o=null,c=null,l=null,h=null,d=null,f=null}}};let d={},f=null,m=null,v=null,y=null,x=null,w=null,_=null,S=null,M=null,E=!1,T=null,A=null,C=null,R=null,I=null;const N=t.getParameter(35661);let O=!1,D=0;const L=t.getParameter(7938);-1!==L.indexOf("WebGL")?(D=parseFloat(/^WebGL\ ([0-9])/.exec(L)[1]),O=D>=1):-1!==L.indexOf("OpenGL ES")&&(D=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(L)[1]),O=D>=2);let k=null,P={};const F=new z,B=new z;function U(e,n,r){const data=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,10241,9728),t.texParameteri(e,10240,9728);for(let i=0;i<r;i++)t.texImage2D(n+i,0,6408,1,1,0,6408,5121,data);return o}const V={};function G(e){!0!==d[e]&&(t.enable(e),d[e]=!0)}function H(e){!1!==d[e]&&(t.disable(e),d[e]=!1)}V[3553]=U(3553,3553,1),V[34067]=U(34067,34069,6),c.setClear(0,0,0,1),l.setClear(1),h.setClear(0),G(2929),l.setFunc(3),Y(!1),K(1),G(2884),X(0);const j={100:32774,101:32778,102:32779};if(r)j[103]=32775,j[104]=32776;else{const t=e.get("EXT_blend_minmax");null!==t&&(j[103]=t.MIN_EXT,j[104]=t.MAX_EXT)}const W={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function X(e,n,r,o,c,l,h,d){if(0!==e){if(m||(G(3042),m=!0),5===e)c=c||n,l=l||r,h=h||o,n===y&&c===_||(t.blendEquationSeparate(j[n],j[c]),y=n,_=c),r===x&&o===w&&l===S&&h===M||(t.blendFuncSeparate(W[r],W[o],W[l],W[h]),x=r,w=o,S=l,M=h),v=e,E=null;else if(e!==v||d!==E){if(100===y&&100===_||(t.blendEquation(32774),y=100,_=100),d)switch(e){case 1:t.blendFuncSeparate(1,771,1,771);break;case 2:t.blendFunc(1,1);break;case 3:t.blendFuncSeparate(0,0,769,771);break;case 4:t.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(770,771,1,771);break;case 2:t.blendFunc(770,1);break;case 3:t.blendFunc(0,769);break;case 4:t.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}x=null,w=null,S=null,M=null,v=e,E=d}}else m&&(H(3042),m=!1)}function Y(e){T!==e&&(e?t.frontFace(2304):t.frontFace(2305),T=e)}function K(e){0!==e?(G(2884),e!==A&&(1===e?t.cullFace(1029):2===e?t.cullFace(1028):t.cullFace(1032))):H(2884),A=e}function J(e,n,r){e?(G(32823),R===n&&I===r||(t.polygonOffset(n,r),R=n,I=r)):H(32823)}function Z(e){void 0===e&&(e=33984+N-1),k!==e&&(t.activeTexture(e),k=e)}return{buffers:{color:c,depth:l,stencil:h},enable:G,disable:H,useProgram:function(e){return f!==e&&(t.useProgram(e),f=e,!0)},setBlending:X,setMaterial:function(t,e){t.side===o?H(2884):G(2884);let n=1===t.side;e&&(n=!n),Y(n),1===t.blending&&!1===t.transparent?X(0):X(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),l.setFunc(t.depthFunc),l.setTest(t.depthTest),l.setMask(t.depthWrite),c.setMask(t.colorWrite);const r=t.stencilWrite;h.setTest(r),r&&(h.setMask(t.stencilWriteMask),h.setFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),h.setOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),J(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)},setFlipSided:Y,setCullFace:K,setLineWidth:function(e){e!==C&&(O&&t.lineWidth(e),C=e)},setPolygonOffset:J,setScissorTest:function(t){t?G(3089):H(3089)},activeTexture:Z,bindTexture:function(e,n){null===k&&Z();let r=P[k];void 0===r&&(r={type:void 0,texture:void 0},P[k]=r),r.type===e&&r.texture===n||(t.bindTexture(e,n||V[e]),r.type=e,r.texture=n)},unbindTexture:function(){const e=P[k];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===F.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),F.copy(e))},viewport:function(e){!1===B.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),B.copy(e))},reset:function(){d={},k=null,P={},f=null,v=null,T=null,A=null,c.reset(),l.reset(),h.reset()}}}function Ii(t,e,n,r,o,S,M){const E=o.isWebGL2,T=o.maxTextures,A=o.maxCubemapSize,C=o.maxTextureSize,R=o.maxSamples,I=new WeakMap;let N,D=!1;try{D="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function L(t,e){return D?new OffscreenCanvas(t,e):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function k(image,t,e,n){let r=1;if((image.width>n||image.height>n)&&(r=n/Math.max(image.width,image.height)),r<1||!0===t){if("undefined"!=typeof HTMLImageElement&&image instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&image instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&image instanceof ImageBitmap){const n=t?O.floorPowerOfTwo:Math.floor,o=n(r*image.width),c=n(r*image.height);void 0===N&&(N=L(o,c));const canvas=e?L(o,c):N;canvas.width=o,canvas.height=c;return canvas.getContext("2d").drawImage(image,0,0,o,c),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+image.width+"x"+image.height+") to ("+o+"x"+c+")."),canvas}return"data"in image&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+image.width+"x"+image.height+")."),image}return image}function P(image){return O.isPowerOfTwo(image.width)&&O.isPowerOfTwo(image.height)}function F(t,e){return t.generateMipmaps&&e&&t.minFilter!==d&&t.minFilter!==v}function B(e,n,o,c){t.generateMipmap(e);r.get(n).__maxMipLevel=Math.log(Math.max(o,c))*Math.LOG2E}function z(n,r,o){if(!1===E)return r;if(null!==n){if(void 0!==t[n])return t[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}let c=r;return 6403===r&&(5126===o&&(c=33326),5131===o&&(c=33325),5121===o&&(c=33321)),6407===r&&(5126===o&&(c=34837),5131===o&&(c=34843),5121===o&&(c=32849)),6408===r&&(5126===o&&(c=34836),5131===o&&(c=34842),5121===o&&(c=32856)),33325!==c&&33326!==c&&34842!==c&&34836!==c||e.get("EXT_color_buffer_float"),c}function U(t){return t===d||t===f||t===m?9728:9729}function V(e){const n=e.target;n.removeEventListener("dispose",V),function(e){const n=r.get(e);if(void 0===n.__webglInit)return;t.deleteTexture(n.__webglTexture),r.remove(e)}(n),n.isVideoTexture&&I.delete(n),M.memory.textures--}function G(e){const n=e.target;n.removeEventListener("dispose",G),function(e){const n=r.get(e),o=r.get(e.texture);if(!e)return;void 0!==o.__webglTexture&&t.deleteTexture(o.__webglTexture);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let i=0;i<6;i++)t.deleteFramebuffer(n.__webglFramebuffer[i]),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer[i]);else t.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&t.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&t.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&t.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&t.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(e.texture),r.remove(e)}(n),M.memory.textures--}let H=0;function j(t,slot){const e=r.get(t);if(t.isVideoTexture&&function(t){const e=M.render.frame;I.get(t)!==e&&(I.set(t,e),t.update())}(t),t.version>0&&e.__version!==t.version){const image=t.image;if(void 0===image)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==image.complete)return void Q(e,t,slot);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+slot),n.bindTexture(3553,e.__webglTexture)}function W(e,slot){if(6!==e.image.length)return;const o=r.get(e);if(e.version>0&&o.__version!==e.version){Z(o,e),n.activeTexture(33984+slot),n.bindTexture(34067,o.__webglTexture),t.pixelStorei(37440,e.flipY);const r=e&&(e.isCompressedTexture||e.image[0].isCompressedTexture),c=e.image[0]&&e.image[0].isDataTexture,l=[];for(let i=0;i<6;i++)l[i]=r||c?c?e.image[i].image:e.image[i]:k(e.image[i],!1,!0,A);const image=l[0],h=P(image)||E,d=S.convert(e.format),f=S.convert(e.type),m=z(e.internalFormat,d,f);let v;if(J(34067,e,h),r){for(let i=0;i<6;i++){v=l[i].mipmaps;for(let t=0;t<v.length;t++){const r=v[t];e.format!==_&&e.format!==w?null!==d?n.compressedTexImage2D(34069+i,t,m,r.width,r.height,0,r.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+i,t,m,r.width,r.height,0,d,f,r.data)}}o.__maxMipLevel=v.length-1}else{v=e.mipmaps;for(let i=0;i<6;i++)if(c){n.texImage2D(34069+i,0,m,l[i].width,l[i].height,0,d,f,l[i].data);for(let t=0;t<v.length;t++){const e=v[t].image[i].image;n.texImage2D(34069+i,t+1,m,e.width,e.height,0,d,f,e.data)}}else{n.texImage2D(34069+i,0,m,d,f,l[i]);for(let t=0;t<v.length;t++){const e=v[t];n.texImage2D(34069+i,t+1,m,d,f,e.image[i])}}o.__maxMipLevel=v.length}F(e,h)&&B(34067,e,image.width,image.height),o.__version=e.version,e.onUpdate&&e.onUpdate(e)}else n.activeTexture(33984+slot),n.bindTexture(34067,o.__webglTexture)}function X(t,slot){n.activeTexture(33984+slot),n.bindTexture(34067,r.get(t).__webglTexture)}const Y={[c]:10497,[l]:33071,[h]:33648},K={[d]:9728,[f]:9984,[m]:9986,[v]:9729,[y]:9985,[x]:9987};function J(n,c,h){h?(t.texParameteri(n,10242,Y[c.wrapS]),t.texParameteri(n,10243,Y[c.wrapT]),32879!==n&&35866!==n||t.texParameteri(n,32882,Y[c.wrapR]),t.texParameteri(n,10240,K[c.magFilter]),t.texParameteri(n,10241,K[c.minFilter])):(t.texParameteri(n,10242,33071),t.texParameteri(n,10243,33071),32879!==n&&35866!==n||t.texParameteri(n,32882,33071),c.wrapS===l&&c.wrapT===l||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),t.texParameteri(n,10240,U(c.magFilter)),t.texParameteri(n,10241,U(c.minFilter)),c.minFilter!==d&&c.minFilter!==v&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));const f=e.get("EXT_texture_filter_anisotropic");if(f){if(1015===c.type&&null===e.get("OES_texture_float_linear"))return;if(1016===c.type&&null===(E||e.get("OES_texture_half_float_linear")))return;(c.anisotropy>1||r.get(c).__currentAnisotropy)&&(t.texParameterf(n,f.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(c.anisotropy,o.getMaxAnisotropy())),r.get(c).__currentAnisotropy=c.anisotropy)}}function Z(e,n){void 0===e.__webglInit&&(e.__webglInit=!0,n.addEventListener("dispose",V),e.__webglTexture=t.createTexture(),M.memory.textures++)}function Q(e,r,slot){let o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),Z(e,r),n.activeTexture(33984+slot),n.bindTexture(o,e.__webglTexture),t.pixelStorei(37440,r.flipY),t.pixelStorei(37441,r.premultiplyAlpha),t.pixelStorei(3317,r.unpackAlignment);const c=function(t){return!E&&(t.wrapS!==l||t.wrapT!==l||t.minFilter!==d&&t.minFilter!==v)}(r)&&!1===P(r.image),image=k(r.image,c,!1,C),h=P(image)||E,f=S.convert(r.format);let m,y=S.convert(r.type),x=z(r.internalFormat,f,y);J(o,r,h);const M=r.mipmaps;if(r.isDepthTexture)x=6402,E?x=1015===r.type?36012:1014===r.type?33190:1020===r.type?35056:33189:1015===r.type&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),1026===r.format&&6402===x&&1012!==r.type&&1014!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=1012,y=S.convert(r.type)),1027===r.format&&6402===x&&(x=34041,1020!==r.type&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=1020,y=S.convert(r.type))),n.texImage2D(3553,0,x,image.width,image.height,0,f,y,null);else if(r.isDataTexture)if(M.length>0&&h){for(let i=0,t=M.length;i<t;i++)m=M[i],n.texImage2D(3553,i,x,m.width,m.height,0,f,y,m.data);r.generateMipmaps=!1,e.__maxMipLevel=M.length-1}else n.texImage2D(3553,0,x,image.width,image.height,0,f,y,image.data),e.__maxMipLevel=0;else if(r.isCompressedTexture){for(let i=0,t=M.length;i<t;i++)m=M[i],r.format!==_&&r.format!==w?null!==f?n.compressedTexImage2D(3553,i,x,m.width,m.height,0,m.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,i,x,m.width,m.height,0,f,y,m.data);e.__maxMipLevel=M.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,x,image.width,image.height,image.depth,0,f,y,image.data),e.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,x,image.width,image.height,image.depth,0,f,y,image.data),e.__maxMipLevel=0;else if(M.length>0&&h){for(let i=0,t=M.length;i<t;i++)m=M[i],n.texImage2D(3553,i,x,f,y,m);r.generateMipmaps=!1,e.__maxMipLevel=M.length-1}else n.texImage2D(3553,0,x,f,y,image),e.__maxMipLevel=0;F(r,h)&&B(o,r,image.width,image.height),e.__version=r.version,r.onUpdate&&r.onUpdate(r)}function $(e,o,c,l){const h=S.convert(o.texture.format),d=S.convert(o.texture.type),f=z(o.texture.internalFormat,h,d);n.texImage2D(l,0,f,o.width,o.height,0,h,d,null),t.bindFramebuffer(36160,e),t.framebufferTexture2D(36160,c,l,r.get(o.texture).__webglTexture,0),t.bindFramebuffer(36160,null)}function tt(e,n,r){if(t.bindRenderbuffer(36161,e),n.depthBuffer&&!n.stencilBuffer){let o=33189;if(r){const e=n.depthTexture;e&&e.isDepthTexture&&(1015===e.type?o=36012:1014===e.type&&(o=33190));const r=nt(n);t.renderbufferStorageMultisample(36161,r,o,n.width,n.height)}else t.renderbufferStorage(36161,o,n.width,n.height);t.framebufferRenderbuffer(36160,36096,36161,e)}else if(n.depthBuffer&&n.stencilBuffer){if(r){const e=nt(n);t.renderbufferStorageMultisample(36161,e,35056,n.width,n.height)}else t.renderbufferStorage(36161,34041,n.width,n.height);t.framebufferRenderbuffer(36160,33306,36161,e)}else{const e=S.convert(n.texture.format),o=S.convert(n.texture.type),c=z(n.texture.internalFormat,e,o);if(r){const e=nt(n);t.renderbufferStorageMultisample(36161,e,c,n.width,n.height)}else t.renderbufferStorage(36161,c,n.width,n.height)}t.bindRenderbuffer(36161,null)}function et(e){const n=r.get(e),o=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture){if(o)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,e),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),j(n.depthTexture,0);const o=r.get(n.depthTexture).__webglTexture;if(1026===n.depthTexture.format)t.framebufferTexture2D(36160,36096,3553,o,0);else{if(1027!==n.depthTexture.format)throw new Error("Unknown depthTexture format");t.framebufferTexture2D(36160,33306,3553,o,0)}}(n.__webglFramebuffer,e)}else if(o){n.__webglDepthbuffer=[];for(let i=0;i<6;i++)t.bindFramebuffer(36160,n.__webglFramebuffer[i]),n.__webglDepthbuffer[i]=t.createRenderbuffer(),tt(n.__webglDepthbuffer[i],e,!1)}else t.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=t.createRenderbuffer(),tt(n.__webglDepthbuffer,e,!1);t.bindFramebuffer(36160,null)}function nt(t){return E&&t.isWebGLMultisampleRenderTarget?Math.min(R,t.samples):0}let it=!1,ot=!1;this.allocateTextureUnit=function(){const t=H;return t>=T&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+T),H+=1,t},this.resetTextureUnits=function(){H=0},this.setTexture2D=j,this.setTexture2DArray=function(t,slot){const e=r.get(t);t.version>0&&e.__version!==t.version?Q(e,t,slot):(n.activeTexture(33984+slot),n.bindTexture(35866,e.__webglTexture))},this.setTexture3D=function(t,slot){const e=r.get(t);t.version>0&&e.__version!==t.version?Q(e,t,slot):(n.activeTexture(33984+slot),n.bindTexture(32879,e.__webglTexture))},this.setTextureCube=W,this.setTextureCubeDynamic=X,this.setupRenderTarget=function(e){const o=r.get(e),c=r.get(e.texture);e.addEventListener("dispose",G),c.__webglTexture=t.createTexture(),M.memory.textures++;const l=!0===e.isWebGLCubeRenderTarget,h=!0===e.isWebGLMultisampleRenderTarget,d=P(e)||E;if(!E||e.texture.format!==w||1015!==e.texture.type&&1016!==e.texture.type||(e.texture.format=_,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){o.__webglFramebuffer=[];for(let i=0;i<6;i++)o.__webglFramebuffer[i]=t.createFramebuffer()}else if(o.__webglFramebuffer=t.createFramebuffer(),h)if(E){o.__webglMultisampledFramebuffer=t.createFramebuffer(),o.__webglColorRenderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,o.__webglColorRenderbuffer);const n=S.convert(e.texture.format),r=S.convert(e.texture.type),c=z(e.texture.internalFormat,n,r),l=nt(e);t.renderbufferStorageMultisample(36161,l,c,e.width,e.height),t.bindFramebuffer(36160,o.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(36160,36064,36161,o.__webglColorRenderbuffer),t.bindRenderbuffer(36161,null),e.depthBuffer&&(o.__webglDepthRenderbuffer=t.createRenderbuffer(),tt(o.__webglDepthRenderbuffer,e,!0)),t.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,c.__webglTexture),J(34067,e.texture,d);for(let i=0;i<6;i++)$(o.__webglFramebuffer[i],e,36064,34069+i);F(e.texture,d)&&B(34067,e.texture,e.width,e.height),n.bindTexture(34067,null)}else n.bindTexture(3553,c.__webglTexture),J(3553,e.texture,d),$(o.__webglFramebuffer,e,36064,3553),F(e.texture,d)&&B(3553,e.texture,e.width,e.height),n.bindTexture(3553,null);e.depthBuffer&&et(e)},this.updateRenderTargetMipmap=function(t){const e=t.texture;if(F(e,P(t)||E)){const o=t.isWebGLCubeRenderTarget?34067:3553,c=r.get(e).__webglTexture;n.bindTexture(o,c),B(o,e,t.width,t.height),n.bindTexture(o,null)}},this.updateMultisampleRenderTarget=function(e){if(e.isWebGLMultisampleRenderTarget)if(E){const n=r.get(e);t.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,n.__webglFramebuffer);const o=e.width,c=e.height;let mask=16384;e.depthBuffer&&(mask|=256),e.stencilBuffer&&(mask|=1024),t.blitFramebuffer(0,0,o,c,0,0,o,c,mask,9728),t.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(t,slot){t&&t.isWebGLRenderTarget&&(!1===it&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),it=!0),t=t.texture),j(t,slot)},this.safeSetTextureCube=function(t,slot){t&&t.isWebGLCubeRenderTarget&&(!1===ot&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ot=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?W(t,slot):X(t,slot)}}function Ni(t,e,n){const r=n.isWebGL2;return{convert:function(p){let t;if(1009===p)return 5121;if(1017===p)return 32819;if(1018===p)return 32820;if(1019===p)return 33635;if(1010===p)return 5120;if(1011===p)return 5122;if(1012===p)return 5123;if(1013===p)return 5124;if(1014===p)return 5125;if(1015===p)return 5126;if(1016===p)return r?5131:(t=e.get("OES_texture_half_float"),null!==t?t.HALF_FLOAT_OES:null);if(1021===p)return 6406;if(p===w)return 6407;if(p===_)return 6408;if(1024===p)return 6409;if(1025===p)return 6410;if(1026===p)return 6402;if(1027===p)return 34041;if(1028===p)return 6403;if(1029===p)return 36244;if(1030===p)return 33319;if(1031===p)return 33320;if(1032===p)return 36248;if(1033===p)return 36249;if(33776===p||33777===p||33778===p||33779===p){if(t=e.get("WEBGL_compressed_texture_s3tc"),null===t)return null;if(33776===p)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===p)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===p)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===p)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===p||35841===p||35842===p||35843===p){if(t=e.get("WEBGL_compressed_texture_pvrtc"),null===t)return null;if(35840===p)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===p)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===p)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===p)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===p)return t=e.get("WEBGL_compressed_texture_etc1"),null!==t?t.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===p||37496===p)&&(t=e.get("WEBGL_compressed_texture_etc"),null!==t)){if(37492===p)return t.COMPRESSED_RGB8_ETC2;if(37496===p)return t.COMPRESSED_RGBA8_ETC2_EAC}return 37808===p||37809===p||37810===p||37811===p||37812===p||37813===p||37814===p||37815===p||37816===p||37817===p||37818===p||37819===p||37820===p||37821===p||37840===p||37841===p||37842===p||37843===p||37844===p||37845===p||37846===p||37847===p||37848===p||37849===p||37850===p||37851===p||37852===p||37853===p?(t=e.get("WEBGL_compressed_texture_astc"),null!==t?p:null):36492===p?(t=e.get("EXT_texture_compression_bptc"),null!==t?p:null):1020===p?r?34042:(t=e.get("WEBGL_depth_texture"),null!==t?t.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}function Oi(t){xn.call(this),this.cameras=t||[]}function Di(){bt.call(this),this.type="Group"}function Li(){this._targetRay=null,this._grip=null}function ki(t,e){const n=this;let r=null,o=1,c=null,l="local-floor",h=null;const d=[],f=new Map,m=new xn;m.layers.enable(1),m.viewport=new z;const v=new xn;v.layers.enable(2),v.viewport=new z;const y=[m,v],x=new Oi;x.layers.enable(1),x.layers.enable(2);let w=null,_=null;function S(t){const e=f.get(t.inputSource);e&&e.dispatchEvent({type:t.type})}function M(){f.forEach((function(t,e){t.disconnect(e)})),f.clear(),t.setFramebuffer(null),t.setRenderTarget(t.getRenderTarget()),N.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function E(t){c=t,N.setContext(r),N.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}function T(t){const e=r.inputSources;for(let i=0;i<d.length;i++)f.set(e[i],d[i]);for(let i=0;i<t.removed.length;i++){const e=t.removed[i],n=f.get(e);n&&(n.dispatchEvent({type:"disconnected",data:e}),f.delete(e))}for(let i=0;i<t.added.length;i++){const e=t.added[i],n=f.get(e);n&&n.dispatchEvent({type:"connected",data:e})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=d[t];return void 0===e&&(e=new Li,d[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=d[t];return void 0===e&&(e=new Li,d[t]=e),e.getGripSpace()},this.setFramebufferScaleFactor=function(t){o=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){l=t,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return c},this.getSession=function(){return r},this.setSession=function(t){if(r=t,null!==r){r.addEventListener("select",S),r.addEventListener("selectstart",S),r.addEventListener("selectend",S),r.addEventListener("squeeze",S),r.addEventListener("squeezestart",S),r.addEventListener("squeezeend",S),r.addEventListener("end",M);const t=e.getContextAttributes();!0!==t.xrCompatible&&e.makeXRCompatible();const n={antialias:t.antialias,alpha:t.alpha,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:o},c=new XRWebGLLayer(r,e,n);r.updateRenderState({baseLayer:c}),r.requestReferenceSpace(l).then(E),r.addEventListener("inputsourceschange",T)}};const A=new W,C=new W;function R(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.getInverse(t.matrixWorld)}this.getCamera=function(t){x.near=v.near=m.near=t.near,x.far=v.far=m.far=t.far,w===x.near&&_===x.far||(r.updateRenderState({depthNear:x.near,depthFar:x.far}),w=x.near,_=x.far);const e=t.parent,n=x.cameras;R(x,e);for(let i=0;i<n.length;i++)R(n[i],e);t.matrixWorld.copy(x.matrixWorld);const o=t.children;for(let i=0,t=o.length;i<t;i++)o[i].updateMatrixWorld(!0);return 2===n.length?function(t,e,n){A.setFromMatrixPosition(e.matrixWorld),C.setFromMatrixPosition(n.matrixWorld);const r=A.distanceTo(C),o=e.projectionMatrix.elements,c=n.projectionMatrix.elements,l=o[14]/(o[10]-1),h=o[14]/(o[10]+1),d=(o[9]+1)/o[5],f=(o[9]-1)/o[5],m=(o[8]-1)/o[0],v=(c[8]+1)/c[0],y=l*m,x=l*v,w=r/(-m+v),_=w*-m;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(_),t.translateZ(w),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.getInverse(t.matrixWorld);const S=l+w,M=h+w,E=y-_,T=x+(r-_),R=d*h/M*S,I=f*h/M*S;t.projectionMatrix.makePerspective(E,T,R,I,S,M)}(x,m,v):x.projectionMatrix.copy(m.projectionMatrix),x};let I=null;const N=new An;N.setAnimationLoop((function(time,e){if(h=e.getViewerPose(c),null!==h){const e=h.views,n=r.renderState.baseLayer;t.setFramebuffer(n.framebuffer);let o=!1;e.length!==x.cameras.length&&(x.cameras.length=0,o=!0);for(let i=0;i<e.length;i++){const view=e[i],t=n.getViewport(view),r=y[i];r.matrix.fromArray(view.transform.matrix),r.projectionMatrix.fromArray(view.projectionMatrix),r.viewport.set(t.x,t.y,t.width,t.height),0===i&&x.matrix.copy(r.matrix),!0===o&&x.cameras.push(r)}}const n=r.inputSources;for(let i=0;i<d.length;i++){const t=d[i],r=n[i];t.update(r,e,c)}I&&I(time,e)})),this.setAnimationLoop=function(t){I=t},this.dispose=function(){}}function Pi(t){function e(e,n,r){e.opacity.value=n.opacity,n.color&&e.diffuse.value.copy(n.color),n.emissive&&e.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(e.map.value=n.map),n.alphaMap&&(e.alphaMap.value=n.alphaMap),n.specularMap&&(e.specularMap.value=n.specularMap);const o=n.envMap||r;let c,l;o&&(e.envMap.value=o,e.flipEnvMap.value=o.isCubeTexture?-1:1,e.reflectivity.value=n.reflectivity,e.refractionRatio.value=n.refractionRatio,e.maxMipLevel.value=t.get(o).__maxMipLevel),n.lightMap&&(e.lightMap.value=n.lightMap,e.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(e.aoMap.value=n.aoMap,e.aoMapIntensity.value=n.aoMapIntensity),n.map?c=n.map:n.specularMap?c=n.specularMap:n.displacementMap?c=n.displacementMap:n.normalMap?c=n.normalMap:n.bumpMap?c=n.bumpMap:n.roughnessMap?c=n.roughnessMap:n.metalnessMap?c=n.metalnessMap:n.alphaMap?c=n.alphaMap:n.emissiveMap&&(c=n.emissiveMap),void 0!==c&&(c.isWebGLRenderTarget&&(c=c.texture),!0===c.matrixAutoUpdate&&c.updateMatrix(),e.uvTransform.value.copy(c.matrix)),n.aoMap?l=n.aoMap:n.lightMap&&(l=n.lightMap),void 0!==l&&(l.isWebGLRenderTarget&&(l=l.texture),!0===l.matrixAutoUpdate&&l.updateMatrix(),e.uv2Transform.value.copy(l.matrix))}function n(t,e,n){t.roughness.value=e.roughness,t.metalness.value=e.metalness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap),e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap),e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1)),e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate()),e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias),(e.envMap||n)&&(t.envMapIntensity.value=e.envMapIntensity)}return{refreshFogUniforms:function(t,e){t.fogColor.value.copy(e.color),e.isFog?(t.fogNear.value=e.near,t.fogFar.value=e.far):e.isFogExp2&&(t.fogDensity.value=e.density)},refreshMaterialUniforms:function(t,r,o,c,l){r.isMeshBasicMaterial?e(t,r):r.isMeshLambertMaterial?(e(t,r),function(t,e){e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap)}(t,r)):r.isMeshToonMaterial?(e(t,r),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap);e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshPhongMaterial?(e(t,r),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4),e.emissiveMap&&(t.emissiveMap.value=e.emissiveMap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshStandardMaterial?(e(t,r,o),r.isMeshPhysicalMaterial?function(t,e,r){n(t,e,r),t.reflectivity.value=e.reflectivity,t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.sheen&&t.sheen.value.copy(e.sheen);e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap);e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap);e.clearcoatNormalMap&&(t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),t.clearcoatNormalMap.value=e.clearcoatNormalMap,1===e.side&&t.clearcoatNormalScale.value.negate());t.transparency.value=e.transparency}(t,r,o):n(t,r,o)):r.isMeshMatcapMaterial?(e(t,r),function(t,e){e.matcap&&(t.matcap.value=e.matcap);e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDepthMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isMeshDistanceMaterial?(e(t,r),function(t,e){e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias);t.referencePosition.value.copy(e.referencePosition),t.nearDistance.value=e.nearDistance,t.farDistance.value=e.farDistance}(t,r)):r.isMeshNormalMaterial?(e(t,r),function(t,e){e.bumpMap&&(t.bumpMap.value=e.bumpMap,t.bumpScale.value=e.bumpScale,1===e.side&&(t.bumpScale.value*=-1));e.normalMap&&(t.normalMap.value=e.normalMap,t.normalScale.value.copy(e.normalScale),1===e.side&&t.normalScale.value.negate());e.displacementMap&&(t.displacementMap.value=e.displacementMap,t.displacementScale.value=e.displacementScale,t.displacementBias.value=e.displacementBias)}(t,r)):r.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity}(t,r),r.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,r)):r.isPointsMaterial?function(t,e,n,r){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*r,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let o;e.map?o=e.map:e.alphaMap&&(o=e.alphaMap);void 0!==o&&(!0===o.matrixAutoUpdate&&o.updateMatrix(),t.uvTransform.value.copy(o.matrix))}(t,r,c,l):r.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map);e.alphaMap&&(t.alphaMap.value=e.alphaMap);let n;e.map?n=e.map:e.alphaMap&&(n=e.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),t.uvTransform.value.copy(n.matrix))}(t,r):r.isShadowMaterial?(t.color.value.copy(r.color),t.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function Fi(t){const e=void 0!==(t=t||{}).canvas?t.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=void 0!==t.context?t.context:null,r=void 0!==t.alpha&&t.alpha,o=void 0===t.depth||t.depth,c=void 0===t.stencil||t.stencil,l=void 0!==t.antialias&&t.antialias,h=void 0===t.premultipliedAlpha||t.premultipliedAlpha,d=void 0!==t.preserveDrawingBuffer&&t.preserveDrawingBuffer,f=void 0!==t.powerPreference?t.powerPreference:"default",m=void 0!==t.failIfMajorPerformanceCaveat&&t.failIfMajorPerformanceCaveat;let v=null,y=null;this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=3e3,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;const x=this;let w=!1,S=null,M=0,E=0,T=null,A=null,C=-1,R=null,I=null;const N=new z,L=new z;let k=null,P=e.width,F=e.height,B=1,U=null,V=null;const G=new z(0,0,P,F),H=new z(0,0,P,F);let j=!1;const X=new En,Y=new Fn;let K=!1,J=!1;const Z=new tt,Q=new W,$={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function et(){return null===T?B:1}let nt,it,ot,at,st,ut,ct,lt,ht,pt,ft,mt,gt,vt,yt,xt,bt,wt,_t,St=n;function Mt(t,n){for(let i=0;i<t.length;i++){const r=t[i],o=e.getContext(r,n);if(null!==o)return o}return null}try{const t={alpha:r,depth:o,stencil:c,antialias:l,premultipliedAlpha:h,preserveDrawingBuffer:d,powerPreference:f,failIfMajorPerformanceCaveat:m};if(e.addEventListener("webglcontextlost",Ct,!1),e.addEventListener("webglcontextrestored",Rt,!1),null===St){const e=["webgl2","webgl","experimental-webgl"];if(!0===x.isWebGL1Renderer&&e.shift(),St=Mt(e,t),null===St)throw Mt(e)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===St.getShaderPrecisionFormat&&(St.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function Et(){nt=new Bn(St),it=new Pn(St,nt,t),!1===it.isWebGL2&&(nt.get("WEBGL_depth_texture"),nt.get("OES_texture_float"),nt.get("OES_texture_half_float"),nt.get("OES_texture_half_float_linear"),nt.get("OES_standard_derivatives"),nt.get("OES_element_index_uint"),nt.get("OES_vertex_array_object"),nt.get("ANGLE_instanced_arrays")),nt.get("OES_texture_float_linear"),wt=new Ni(St,nt,it),ot=new Ri(St,nt,it),ot.scissor(L.copy(H).multiplyScalar(B).floor()),ot.viewport(N.copy(G).multiplyScalar(B).floor()),at=new Vn(St),st=new mi,ut=new Ii(St,nt,ot,st,it,wt,at),ct=new Cn(St,it),_t=new Ln(St,nt,ct,it),lt=new zn(St,ct,at,_t),ht=new Wn(St,lt,ct,at),yt=new jn(St),pt=new fi(x,nt,it,_t),ft=new Pi(st),mt=new xi,gt=new Ei,vt=new Dn(x,ot,ht,h),xt=new kn(St,nt,at,it),bt=new Un(St,nt,at,it),at.programs=pt.programs,x.capabilities=it,x.extensions=nt,x.properties=st,x.renderLists=mt,x.state=ot,x.info=at}Et();const Tt=new ki(x,St);this.xr=Tt;const At=new Ci(x,ht,it.maxTextureSize);function Ct(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),w=!0}function Rt(){console.log("THREE.WebGLRenderer: Context Restored."),w=!1,Et()}function It(t){const e=t.target;e.removeEventListener("dispose",It),function(t){Nt(t),st.remove(t)}(e)}function Nt(t){const e=st.get(t).program;t.program=void 0,void 0!==e&&pt.releaseProgram(e)}this.shadowMap=At,this.getContext=function(){return St},this.getContextAttributes=function(){return St.getContextAttributes()},this.forceContextLoss=function(){const t=nt.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=nt.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return B},this.setPixelRatio=function(t){void 0!==t&&(B=t,this.setSize(P,F,!1))},this.getSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),t=new D),t.set(P,F)},this.setSize=function(t,n,r){Tt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(P=t,F=n,e.width=Math.floor(t*B),e.height=Math.floor(n*B),!1!==r&&(e.style.width=t+"px",e.style.height=n+"px"),this.setViewport(0,0,t,n))},this.getDrawingBufferSize=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),t=new D),t.set(P*B,F*B).floor()},this.setDrawingBufferSize=function(t,n,r){P=t,F=n,B=r,e.width=Math.floor(t*r),e.height=Math.floor(n*r),this.setViewport(0,0,t,n)},this.getCurrentViewport=function(t){return void 0===t&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),t=new z),t.copy(N)},this.getViewport=function(t){return t.copy(G)},this.setViewport=function(t,e,n,r){t.isVector4?G.set(t.x,t.y,t.z,t.w):G.set(t,e,n,r),ot.viewport(N.copy(G).multiplyScalar(B).floor())},this.getScissor=function(t){return t.copy(H)},this.setScissor=function(t,e,n,r){t.isVector4?H.set(t.x,t.y,t.z,t.w):H.set(t,e,n,r),ot.scissor(L.copy(H).multiplyScalar(B).floor())},this.getScissorTest=function(){return j},this.setScissorTest=function(t){ot.setScissorTest(j=t)},this.setOpaqueSort=function(t){U=t},this.setTransparentSort=function(t){V=t},this.getClearColor=function(){return vt.getClearColor()},this.setClearColor=function(){vt.setClearColor.apply(vt,arguments)},this.getClearAlpha=function(){return vt.getClearAlpha()},this.setClearAlpha=function(){vt.setClearAlpha.apply(vt,arguments)},this.clear=function(t,e,n){let r=0;(void 0===t||t)&&(r|=16384),(void 0===e||e)&&(r|=256),(void 0===n||n)&&(r|=1024),St.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Ct,!1),e.removeEventListener("webglcontextrestored",Rt,!1),mt.dispose(),gt.dispose(),st.dispose(),ht.dispose(),_t.dispose(),Tt.dispose(),Dt.stop()},this.renderBufferImmediate=function(object,t){_t.initAttributes();const e=st.get(object);object.hasPositions&&!e.position&&(e.position=St.createBuffer()),object.hasNormals&&!e.normal&&(e.normal=St.createBuffer()),object.hasUvs&&!e.uv&&(e.uv=St.createBuffer()),object.hasColors&&!e.color&&(e.color=St.createBuffer());const n=t.getAttributes();object.hasPositions&&(St.bindBuffer(34962,e.position),St.bufferData(34962,object.positionArray,35048),_t.enableAttribute(n.position),St.vertexAttribPointer(n.position,3,5126,!1,0,0)),object.hasNormals&&(St.bindBuffer(34962,e.normal),St.bufferData(34962,object.normalArray,35048),_t.enableAttribute(n.normal),St.vertexAttribPointer(n.normal,3,5126,!1,0,0)),object.hasUvs&&(St.bindBuffer(34962,e.uv),St.bufferData(34962,object.uvArray,35048),_t.enableAttribute(n.uv),St.vertexAttribPointer(n.uv,2,5126,!1,0,0)),object.hasColors&&(St.bindBuffer(34962,e.color),St.bufferData(34962,object.colorArray,35048),_t.enableAttribute(n.color),St.vertexAttribPointer(n.color,3,5126,!1,0,0)),_t.disableUnusedAttributes(),St.drawArrays(4,0,object.count),object.count=0},this.renderBufferDirect=function(t,e,n,r,object,o){null===e&&(e=$);const c=object.isMesh&&object.matrixWorld.determinant()<0,l=Bt(t,e,r,object);ot.setMaterial(r,c);let h=n.index;const d=n.attributes.position;if(null===h){if(void 0===d||0===d.count)return}else if(0===h.count)return;let f,m=1;!0===r.wireframe&&(h=lt.getWireframeAttribute(n),m=2),(r.morphTargets||r.morphNormals)&&yt.update(object,n,r,l),_t.setup(object,r,l,n,h);let v=xt;null!==h&&(f=ct.get(h),v=bt,v.setIndex(f));const y=null!==h?h.count:d.count,x=n.drawRange.start*m,w=n.drawRange.count*m,_=null!==o?o.start*m:0,S=null!==o?o.count*m:1/0,M=Math.max(x,_),E=Math.min(y,x+w,_+S)-1,T=Math.max(0,E-M+1);if(0!==T){if(object.isMesh)!0===r.wireframe?(ot.setLineWidth(r.wireframeLinewidth*et()),v.setMode(1)):v.setMode(4);else if(object.isLine){let t=r.linewidth;void 0===t&&(t=1),ot.setLineWidth(t*et()),object.isLineSegments?v.setMode(1):object.isLineLoop?v.setMode(2):v.setMode(3)}else object.isPoints?v.setMode(0):object.isSprite&&v.setMode(4);if(object.isInstancedMesh)v.renderInstances(n,M,T,object.count);else if(n.isInstancedBufferGeometry){const t=Math.min(n.instanceCount,n._maxInstanceCount);v.renderInstances(n,M,T,t)}else v.render(M,T)}},this.compile=function(t,e){y=gt.get(t,e),y.init(),t.traverse((function(object){object.isLight&&(y.pushLight(object),object.castShadow&&y.pushShadow(object))})),y.setupLights(e);const n=new WeakMap;t.traverse((function(object){let e=object.material;if(e)if(Array.isArray(e))for(let i=0;i<e.length;i++){let r=e[i];!1===n.has(r)&&(Ft(r,t,object),n.set(r))}else!1===n.has(e)&&(Ft(e,t,object),n.set(e))}))};let Ot=null;const Dt=new An;function Lt(object,t,e,n){if(!1===object.visible)return;if(object.layers.test(t.layers))if(object.isGroup)e=object.renderOrder;else if(object.isLOD)!0===object.autoUpdate&&object.update(t);else if(object.isLight)y.pushLight(object),object.castShadow&&y.pushShadow(object);else if(object.isSprite){if(!object.frustumCulled||X.intersectsSprite(object)){n&&Q.setFromMatrixPosition(object.matrixWorld).applyMatrix4(Z);const t=ht.update(object),r=object.material;r.visible&&v.push(object,t,r,e,Q.z,null)}}else if(object.isImmediateRenderObject)n&&Q.setFromMatrixPosition(object.matrixWorld).applyMatrix4(Z),v.push(object,null,object.material,e,Q.z,null);else if((object.isMesh||object.isLine||object.isPoints)&&(object.isSkinnedMesh&&object.skeleton.frame!==at.render.frame&&(object.skeleton.update(),object.skeleton.frame=at.render.frame),!object.frustumCulled||X.intersectsObject(object))){n&&Q.setFromMatrixPosition(object.matrixWorld).applyMatrix4(Z);const t=ht.update(object),r=object.material;if(Array.isArray(r)){const n=t.groups;for(let i=0,o=n.length;i<o;i++){const o=n[i],c=r[o.materialIndex];c&&c.visible&&v.push(object,t,c,e,Q.z,o)}}else r.visible&&v.push(object,t,r,e,Q.z,null)}const r=object.children;for(let i=0,o=r.length;i<o;i++)Lt(r[i],t,e,n)}function kt(t,e,n){const r=!0===e.isScene?e.overrideMaterial:null;for(let i=0,o=t.length;i<o;i++){const o=t[i],object=o.object,c=o.geometry,l=null===r?o.material:r,h=o.group;if(n.isArrayCamera){I=n;const t=n.cameras;for(let n=0,r=t.length;n<r;n++){const r=t[n];object.layers.test(r.layers)&&(ot.viewport(N.copy(r.viewport)),y.setupLights(r),Pt(object,e,r,c,l,h))}}else I=null,Pt(object,e,n,c,l,h)}}function Pt(object,t,e,n,r,o){if(object.onBeforeRender(x,t,e,n,r,o),y=gt.get(t,I||e),object.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,object.matrixWorld),object.normalMatrix.getNormalMatrix(object.modelViewMatrix),object.isImmediateRenderObject){const n=Bt(e,t,r,object);ot.setMaterial(r),_t.reset(),function(object,t){object.render((function(object){x.renderBufferImmediate(object,t)}))}(object,n)}else x.renderBufferDirect(e,t,n,r,object,o);object.onAfterRender(x,t,e,n,r,o),y=gt.get(t,I||e)}function Ft(t,e,object){!0!==e.isScene&&(e=$);const n=st.get(t),r=y.state.lights,o=y.state.shadowsArray,c=r.state.version,l=pt.getParameters(t,r.state,o,e,Y.numPlanes,Y.numIntersection,object),h=pt.getProgramCacheKey(l);let d=n.program,f=!0;if(void 0===d)t.addEventListener("dispose",It);else if(d.cacheKey!==h)Nt(t);else if(n.lightsStateVersion!==c)n.lightsStateVersion=c,f=!1;else{if(void 0!==l.shaderID)return;f=!1}f&&(d=pt.acquireProgram(l,h),n.program=d,n.uniforms=l.uniforms,n.outputEncoding=l.outputEncoding,t.program=d);const m=d.getAttributes();if(t.morphTargets){t.numSupportedMorphTargets=0;for(let i=0;i<x.maxMorphTargets;i++)m["morphTarget"+i]>=0&&t.numSupportedMorphTargets++}if(t.morphNormals){t.numSupportedMorphNormals=0;for(let i=0;i<x.maxMorphNormals;i++)m["morphNormal"+i]>=0&&t.numSupportedMorphNormals++}const v=n.uniforms;(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(n.numClippingPlanes=Y.numPlanes,n.numIntersection=Y.numIntersection,v.clippingPlanes=Y.uniform),n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=c,n.needsLights&&(v.ambientLightColor.value=r.state.ambient,v.lightProbe.value=r.state.probe,v.directionalLights.value=r.state.directional,v.directionalLightShadows.value=r.state.directionalShadow,v.spotLights.value=r.state.spot,v.spotLightShadows.value=r.state.spotShadow,v.rectAreaLights.value=r.state.rectArea,v.pointLights.value=r.state.point,v.pointLightShadows.value=r.state.pointShadow,v.hemisphereLights.value=r.state.hemi,v.directionalShadowMap.value=r.state.directionalShadowMap,v.directionalShadowMatrix.value=r.state.directionalShadowMatrix,v.spotShadowMap.value=r.state.spotShadowMap,v.spotShadowMatrix.value=r.state.spotShadowMatrix,v.pointShadowMap.value=r.state.pointShadowMap,v.pointShadowMatrix.value=r.state.pointShadowMatrix);const w=n.program.getUniforms(),_=qr.seqWithValue(w.seq,v);n.uniformsList=_}function Bt(t,e,n,object){!0!==e.isScene&&(e=$),ut.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,c=null===T?x.outputEncoding:T.texture.encoding,l=st.get(n),h=y.state.lights;if(!0===K&&(!0===J||t!==R)){const e=t===R&&n.id===C;Y.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,t,l,e)}n.version===l.__version?void 0===l.program||n.fog&&l.fog!==r||l.environment!==o||l.needsLights&&l.lightsStateVersion!==h.state.version?Ft(n,e,object):void 0===l.numClippingPlanes||l.numClippingPlanes===Y.numPlanes&&l.numIntersection===Y.numIntersection?l.outputEncoding!==c&&Ft(n,e,object):Ft(n,e,object):(Ft(n,e,object),l.__version=n.version);let d=!1,f=!1,m=!1;const v=l.program,w=v.getUniforms(),S=l.uniforms;if(ot.useProgram(v.program)&&(d=!0,f=!0,m=!0),n.id!==C&&(C=n.id,f=!0),d||R!==t){if(w.setValue(St,"projectionMatrix",t.projectionMatrix),it.logarithmicDepthBuffer&&w.setValue(St,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),R!==t&&(R=t,f=!0,m=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const e=w.map.cameraPosition;void 0!==e&&e.setValue(St,Q.setFromMatrixPosition(t.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&w.setValue(St,"isOrthographic",!0===t.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&w.setValue(St,"viewMatrix",t.matrixWorldInverse)}if(n.skinning){w.setOptional(St,object,"bindMatrix"),w.setOptional(St,object,"bindMatrixInverse");const t=object.skeleton;if(t){const e=t.bones;if(it.floatVertexTextures){if(void 0===t.boneTexture){let n=Math.sqrt(4*e.length);n=O.ceilPowerOfTwo(n),n=Math.max(n,4);const r=new Float32Array(n*n*4);r.set(t.boneMatrices);const o=new _n(r,n,n,_,1015);t.boneMatrices=r,t.boneTexture=o,t.boneTextureSize=n}w.setValue(St,"boneTexture",t.boneTexture,ut),w.setValue(St,"boneTextureSize",t.boneTextureSize)}else w.setOptional(St,t,"boneMatrices")}}var M,E;return(f||l.receiveShadow!==object.receiveShadow)&&(l.receiveShadow=object.receiveShadow,w.setValue(St,"receiveShadow",object.receiveShadow)),f&&(w.setValue(St,"toneMappingExposure",x.toneMappingExposure),l.needsLights&&(E=m,(M=S).ambientLightColor.needsUpdate=E,M.lightProbe.needsUpdate=E,M.directionalLights.needsUpdate=E,M.directionalLightShadows.needsUpdate=E,M.pointLights.needsUpdate=E,M.pointLightShadows.needsUpdate=E,M.spotLights.needsUpdate=E,M.spotLightShadows.needsUpdate=E,M.rectAreaLights.needsUpdate=E,M.hemisphereLights.needsUpdate=E),r&&n.fog&&ft.refreshFogUniforms(S,r),ft.refreshMaterialUniforms(S,n,o,B,F),void 0!==S.ltc_1&&(S.ltc_1.value=Tn.LTC_1),void 0!==S.ltc_2&&(S.ltc_2.value=Tn.LTC_2),qr.upload(St,l.uniformsList,S,ut)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(qr.upload(St,l.uniformsList,S,ut),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&w.setValue(St,"center",object.center),w.setValue(St,"modelViewMatrix",object.modelViewMatrix),w.setValue(St,"normalMatrix",object.normalMatrix),w.setValue(St,"modelMatrix",object.matrixWorld),v}Dt.setAnimationLoop((function(time){Tt.isPresenting||Ot&&Ot(time)})),"undefined"!=typeof window&&Dt.setContext(window),this.setAnimationLoop=function(t){Ot=t,Tt.setAnimationLoop(t),null===t?Dt.stop():Dt.start()},this.render=function(t,e){let n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===w)return;_t.resetDefaultState(),C=-1,R=null,!0===t.autoUpdate&&t.updateMatrixWorld(),null===e.parent&&e.updateMatrixWorld(),!0===Tt.enabled&&!0===Tt.isPresenting&&(e=Tt.getCamera(e)),!0===t.isScene&&t.onBeforeRender(x,t,e,n||T),y=gt.get(t,e),y.init(),Z.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),X.setFromProjectionMatrix(Z),J=this.localClippingEnabled,K=Y.init(this.clippingPlanes,J,e),v=mt.get(t,e),v.init(),Lt(t,e,0,x.sortObjects),v.finish(),!0===x.sortObjects&&v.sort(U,V),!0===K&&Y.beginShadows();const o=y.state.shadowsArray;At.render(o,t,e),y.setupLights(e),!0===K&&Y.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),vt.render(v,t,e,r);const c=v.opaque,l=v.transparent;c.length>0&&kt(c,t,e),l.length>0&&kt(l,t,e),!0===t.isScene&&t.onAfterRender(x,t,e),null!==T&&(ut.updateRenderTargetMipmap(T),ut.updateMultisampleRenderTarget(T)),ot.buffers.depth.setTest(!0),ot.buffers.depth.setMask(!0),ot.buffers.color.setMask(!0),ot.setPolygonOffset(!1),v=null,y=null},this.setFramebuffer=function(t){S!==t&&null===T&&St.bindFramebuffer(36160,t),S=t},this.getActiveCubeFace=function(){return M},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return T},this.setRenderTarget=function(t,e,n){T=t,M=e,E=n,t&&void 0===st.get(t).__webglFramebuffer&&ut.setupRenderTarget(t);let r=S,o=!1;if(t){const n=st.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(r=n[e||0],o=!0):r=t.isWebGLMultisampleRenderTarget?st.get(t).__webglMultisampledFramebuffer:n,N.copy(t.viewport),L.copy(t.scissor),k=t.scissorTest}else N.copy(G).multiplyScalar(B).floor(),L.copy(H).multiplyScalar(B).floor(),k=j;if(A!==r&&(St.bindFramebuffer(36160,r),A=r),ot.viewport(N),ot.scissor(L),ot.setScissorTest(k),o){const r=st.get(t.texture);St.framebufferTexture2D(36160,36064,34069+(e||0),r.__webglTexture,n||0)}},this.readRenderTargetPixels=function(t,e,n,r,o,c,l){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let h=st.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==l&&(h=h[l]),h){let l=!1;h!==A&&(St.bindFramebuffer(36160,h),l=!0);try{const h=t.texture,d=h.format,f=h.type;if(d!==_&&wt.convert(d)!==St.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(1009===f||wt.convert(f)===St.getParameter(35738)||1015===f&&(it.isWebGL2||nt.get("OES_texture_float")||nt.get("WEBGL_color_buffer_float"))||1016===f&&(it.isWebGL2?nt.get("EXT_color_buffer_float"):nt.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===St.checkFramebufferStatus(36160)?e>=0&&e<=t.width-r&&n>=0&&n<=t.height-o&&St.readPixels(e,n,r,o,wt.convert(d),wt.convert(f),c):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&St.bindFramebuffer(36160,A)}}},this.copyFramebufferToTexture=function(t,e,n){void 0===n&&(n=0);const r=Math.pow(2,-n),o=Math.floor(e.image.width*r),c=Math.floor(e.image.height*r),l=wt.convert(e.format);ut.setTexture2D(e,0),St.copyTexImage2D(3553,n,l,t.x,t.y,o,c,0),ot.unbindTexture()},this.copyTextureToTexture=function(t,e,n,r){void 0===r&&(r=0);const o=e.image.width,c=e.image.height,l=wt.convert(n.format),h=wt.convert(n.type);ut.setTexture2D(n,0),St.pixelStorei(37440,n.flipY),St.pixelStorei(37441,n.premultiplyAlpha),St.pixelStorei(3317,n.unpackAlignment),e.isDataTexture?St.texSubImage2D(3553,r,t.x,t.y,o,c,l,h,e.image.data):e.isCompressedTexture?St.compressedTexSubImage2D(3553,r,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,l,e.mipmaps[0].data):St.texSubImage2D(3553,r,t.x,t.y,l,h,e.image),0===r&&n.generateMipmaps&&St.generateMipmap(3553),ot.unbindTexture()},this.initTexture=function(t){ut.setTexture2D(t,0),ot.unbindTexture()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function Bi(t){Fi.call(this,t)}function zi(t,e){this.name="",this.color=new he(t),this.density=void 0!==e?e:25e-5}function Ui(t,e,n){this.name="",this.color=new he(t),this.near=void 0!==e?e:1,this.far=void 0!==n?n:1e3}function Vi(t,e){this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=O.generateUUID()}Oi.prototype=Object.assign(Object.create(xn.prototype),{constructor:Oi,isArrayCamera:!0}),Di.prototype=Object.assign(Object.create(bt.prototype),{constructor:Di,isGroup:!0}),Object.assign(Li.prototype,{constructor:Li,getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new Di,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new Di,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),this},disconnect:function(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),this},update:function(t,e,n){let r=null,o=null;const c=this._targetRay,l=this._grip;return t&&(null!==c&&(r=e.getPose(t.targetRaySpace,n),null!==r&&(c.matrix.fromArray(r.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale))),null!==l&&t.gripSpace&&(o=e.getPose(t.gripSpace,n),null!==o&&(l.matrix.fromArray(o.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale)))),null!==c&&(c.visible=null!==r),null!==l&&(l.visible=null!==o),this}}),Object.assign(ki.prototype,I.prototype),Bi.prototype=Object.assign(Object.create(Fi.prototype),{constructor:Bi,isWebGL1Renderer:!0}),Object.assign(zi.prototype,{isFogExp2:!0,clone:function(){return new zi(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Ui.prototype,{isFog:!0,clone:function(){return new Ui(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Vi.prototype,"needsUpdate",{set:function(t){!0===t&&this.version++}}),Object.assign(Vi.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(t){return this.usage=t,this},copy:function(source){return this.array=new source.array.constructor(source.array),this.count=source.count,this.stride=source.stride,this.usage=source.usage,this},copyAt:function(t,e,n){t*=this.stride,n*=e.stride;for(let i=0,r=this.stride;i<r;i++)this.array[t+i]=e.array[n+i];return this},set:function(t,e){return void 0===e&&(e=0),this.array.set(t,e),this},clone:function(data){void 0===data.arrayBuffers&&(data.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=O.generateUUID()),void 0===data.arrayBuffers[this.array.buffer._uuid]&&(data.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new Vi(new this.array.constructor(data.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(t){return this.onUploadCallback=t,this},toJSON:function(data){return void 0===data.arrayBuffers&&(data.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=O.generateUUID()),void 0===data.arrayBuffers[this.array.buffer._uuid]&&(data.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});const Gi=new W;function Hi(t,e,n,r){this.name="",this.data=t,this.itemSize=e,this.offset=n,this.normalized=!0===r}function ji(t){ve.call(this),this.type="SpriteMaterial",this.color=new he(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(t)}let Wi;Object.defineProperties(Hi.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Hi.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(t){for(let i=0,e=this.data.count;i<e;i++)Gi.x=this.getX(i),Gi.y=this.getY(i),Gi.z=this.getZ(i),Gi.applyMatrix4(t),this.setXYZ(i,Gi.x,Gi.y,Gi.z);return this},setX:function(t,e){return this.data.array[t*this.data.stride+this.offset]=e,this},setY:function(t,e){return this.data.array[t*this.data.stride+this.offset+1]=e,this},setZ:function(t,e){return this.data.array[t*this.data.stride+this.offset+2]=e,this},setW:function(t,e){return this.data.array[t*this.data.stride+this.offset+3]=e,this},getX:function(t){return this.data.array[t*this.data.stride+this.offset]},getY:function(t){return this.data.array[t*this.data.stride+this.offset+1]},getZ:function(t){return this.data.array[t*this.data.stride+this.offset+2]},getW:function(t){return this.data.array[t*this.data.stride+this.offset+3]},setXY:function(t,e,n){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this},setXYZ:function(t,e,n,r){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this},setXYZW:function(t,e,n,r,o){return t=t*this.data.stride+this.offset,this.data.array[t+0]=e,this.data.array[t+1]=n,this.data.array[t+2]=r,this.data.array[t+3]=o,this},clone:function(data){if(void 0===data){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const e=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[e+n])}return new we(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===data.interleavedBuffers&&(data.interleavedBuffers={}),void 0===data.interleavedBuffers[this.data.uuid]&&(data.interleavedBuffers[this.data.uuid]=this.data.clone(data)),new Hi(data.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(data){if(void 0===data){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const t=[];for(let i=0;i<this.count;i++){const e=i*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)t.push(this.data.array[e+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===data.interleavedBuffers&&(data.interleavedBuffers={}),void 0===data.interleavedBuffers[this.data.uuid]&&(data.interleavedBuffers[this.data.uuid]=this.data.toJSON(data)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),ji.prototype=Object.create(ve.prototype),ji.prototype.constructor=ji,ji.prototype.isSpriteMaterial=!0,ji.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.alphaMap=source.alphaMap,this.rotation=source.rotation,this.sizeAttenuation=source.sizeAttenuation,this};const qi=new W,Xi=new W,Yi=new W,Ki=new D,Ji=new D,Zi=new tt,Qi=new W,$i=new W,to=new W,eo=new D,no=new D,ro=new D;function io(t){if(bt.call(this),this.type="Sprite",void 0===Wi){Wi=new Ue;const t=new Vi(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Wi.setIndex([0,1,2,0,2,3]),Wi.setAttribute("position",new Hi(t,3,0,!1)),Wi.setAttribute("uv",new Hi(t,2,3,!1))}this.geometry=Wi,this.material=void 0!==t?t:new ji,this.center=new D(.5,.5)}function oo(t,e,n,r,o,c){Ki.subVectors(t,n).addScalar(.5).multiply(r),void 0!==o?(Ji.x=c*Ki.x-o*Ki.y,Ji.y=o*Ki.x+c*Ki.y):Ji.copy(Ki),t.copy(e),t.x+=Ji.x,t.y+=Ji.y,t.applyMatrix4(Zi)}io.prototype=Object.assign(Object.create(bt.prototype),{constructor:io,isSprite:!0,raycast:function(t,e){null===t.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Xi.setFromMatrixScale(this.matrixWorld),Zi.copy(t.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(t.camera.matrixWorldInverse,this.matrixWorld),Yi.setFromMatrixPosition(this.modelViewMatrix),t.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Xi.multiplyScalar(-Yi.z);const n=this.material.rotation;let r,o;0!==n&&(o=Math.cos(n),r=Math.sin(n));const c=this.center;oo(Qi.set(-.5,-.5,0),Yi,c,Xi,r,o),oo($i.set(.5,-.5,0),Yi,c,Xi,r,o),oo(to.set(.5,.5,0),Yi,c,Xi,r,o),eo.set(0,0),no.set(1,0),ro.set(1,1);let l=t.ray.intersectTriangle(Qi,$i,to,!1,qi);if(null===l&&(oo($i.set(-.5,.5,0),Yi,c,Xi,r,o),no.set(0,1),l=t.ray.intersectTriangle(Qi,to,$i,!1,qi),null===l))return;const h=t.ray.origin.distanceTo(qi);h<t.near||h>t.far||e.push({distance:h,point:qi.clone(),uv:se.getUV(qi,Qi,$i,to,eo,no,ro,new D),face:null,object:this})},copy:function(source){return bt.prototype.copy.call(this,source),void 0!==source.center&&this.center.copy(source.center),this.material=source.material,this}});const ao=new W,so=new W;function uo(){bt.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function co(t,e){t&&t.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),on.call(this,t,e),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new tt,this.bindMatrixInverse=new tt}uo.prototype=Object.assign(Object.create(bt.prototype),{constructor:uo,isLOD:!0,copy:function(source){bt.prototype.copy.call(this,source,!1);const t=source.levels;for(let i=0,e=t.length;i<e;i++){const e=t[i];this.addLevel(e.object.clone(),e.distance)}return this.autoUpdate=source.autoUpdate,this},addLevel:function(object,t){void 0===t&&(t=0),t=Math.abs(t);const e=this.levels;let n;for(n=0;n<e.length&&!(t<e[n].distance);n++);return e.splice(n,0,{distance:t,object:object}),this.add(object),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(t){const e=this.levels;if(e.length>0){let i,n;for(i=1,n=e.length;i<n&&!(t<e[i].distance);i++);return e[i-1].object}return null},raycast:function(t,e){if(this.levels.length>0){ao.setFromMatrixPosition(this.matrixWorld);const n=t.ray.origin.distanceTo(ao);this.getObjectForDistance(n).raycast(t,e)}},update:function(t){const e=this.levels;if(e.length>1){ao.setFromMatrixPosition(t.matrixWorld),so.setFromMatrixPosition(this.matrixWorld);const n=ao.distanceTo(so)/t.zoom;let i,r;for(e[0].object.visible=!0,i=1,r=e.length;i<r&&n>=e[i].distance;i++)e[i-1].object.visible=!1,e[i].object.visible=!0;for(this._currentLevel=i-1;i<r;i++)e[i].object.visible=!1}},toJSON:function(meta){const data=bt.prototype.toJSON.call(this,meta);!1===this.autoUpdate&&(data.object.autoUpdate=!1),data.object.levels=[];const t=this.levels;for(let i=0,e=t.length;i<e;i++){const e=t[i];data.object.levels.push({object:e.object.uuid,distance:e.distance})}return data}}),co.prototype=Object.assign(Object.create(on.prototype),{constructor:co,isSkinnedMesh:!0,copy:function(source){return on.prototype.copy.call(this,source),this.bindMode=source.bindMode,this.bindMatrix.copy(source.bindMatrix),this.bindMatrixInverse.copy(source.bindMatrixInverse),this.skeleton=source.skeleton,this},bind:function(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.getInverse(e)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){const t=new z,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.x=e.getX(i),t.y=e.getY(i),t.z=e.getZ(i),t.w=e.getW(i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}},updateMatrixWorld:function(t){on.prototype.updateMatrixWorld.call(this,t),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(){const t=new W,e=new z,n=new z,r=new W,o=new tt;return function(c,l){const h=this.skeleton,d=this.geometry;e.fromBufferAttribute(d.attributes.skinIndex,c),n.fromBufferAttribute(d.attributes.skinWeight,c),t.fromBufferAttribute(d.attributes.position,c).applyMatrix4(this.bindMatrix),l.set(0,0,0);for(let i=0;i<4;i++){const c=n.getComponent(i);if(0!==c){const n=e.getComponent(i);o.multiplyMatrices(h.bones[n].matrixWorld,h.boneInverses[n]),l.addScaledVector(r.copy(t).applyMatrix4(o),c)}}return l.applyMatrix4(this.bindMatrixInverse)}}()});const lo=new tt,ho=new tt;function po(t,e){if(t=t||[],this.bones=t.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,void 0===e)this.calculateInverses();else if(this.bones.length===e.length)this.boneInverses=e.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(let i=0,t=this.bones.length;i<t;i++)this.boneInverses.push(new tt)}}function fo(){bt.call(this),this.type="Bone"}Object.assign(po.prototype,{calculateInverses:function(){this.boneInverses=[];for(let i=0,t=this.bones.length;i<t;i++){const t=new tt;this.bones[i]&&t.getInverse(this.bones[i].matrixWorld),this.boneInverses.push(t)}},pose:function(){for(let i=0,t=this.bones.length;i<t;i++){const t=this.bones[i];t&&t.matrixWorld.getInverse(this.boneInverses[i])}for(let i=0,t=this.bones.length;i<t;i++){const t=this.bones[i];t&&(t.parent&&t.parent.isBone?(t.matrix.getInverse(t.parent.matrixWorld),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}},update:function(){const t=this.bones,e=this.boneInverses,n=this.boneMatrices,r=this.boneTexture;for(let i=0,r=t.length;i<r;i++){const r=t[i]?t[i].matrixWorld:ho;lo.multiplyMatrices(r,e[i]),lo.toArray(n,16*i)}void 0!==r&&(r.needsUpdate=!0)},clone:function(){return new po(this.bones,this.boneInverses)},getBoneByName:function(t){for(let i=0,e=this.bones.length;i<e;i++){const e=this.bones[i];if(e.name===t)return e}},dispose:function(){this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=void 0)}}),fo.prototype=Object.assign(Object.create(bt.prototype),{constructor:fo,isBone:!0});const mo=new tt,go=new tt,vo=[],yo=new on;function xo(t,e,n){on.call(this,t,e),this.instanceMatrix=new we(new Float32Array(16*n),16),this.count=n,this.frustumCulled=!1}function bo(t){ve.call(this),this.type="LineBasicMaterial",this.color=new he(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(t)}xo.prototype=Object.assign(Object.create(on.prototype),{constructor:xo,isInstancedMesh:!0,copy:function(source){return on.prototype.copy.call(this,source),this.instanceMatrix.copy(source.instanceMatrix),this.count=source.count,this},getMatrixAt:function(t,e){e.fromArray(this.instanceMatrix.array,16*t)},raycast:function(t,e){const n=this.matrixWorld,r=this.count;if(yo.geometry=this.geometry,yo.material=this.material,void 0!==yo.material)for(let o=0;o<r;o++){this.getMatrixAt(o,mo),go.multiplyMatrices(n,mo),yo.matrixWorld=go,yo.raycast(t,vo);for(let i=0,t=vo.length;i<t;i++){const t=vo[i];t.instanceId=o,t.object=this,e.push(t)}vo.length=0}},setMatrixAt:function(t,e){e.toArray(this.instanceMatrix.array,16*t)},updateMorphTargets:function(){}}),bo.prototype=Object.create(ve.prototype),bo.prototype.constructor=bo,bo.prototype.isLineBasicMaterial=!0,bo.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.linewidth=source.linewidth,this.linecap=source.linecap,this.linejoin=source.linejoin,this.morphTargets=source.morphTargets,this};const wo=new W,_o=new W,So=new tt,Mo=new qt,Eo=new Bt;function To(t,e,n){1===n&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),bt.call(this),this.type="Line",this.geometry=void 0!==t?t:new Ue,this.material=void 0!==e?e:new bo,this.updateMorphTargets()}To.prototype=Object.assign(Object.create(bt.prototype),{constructor:To,isLine:!0,copy:function(source){return bt.prototype.copy.call(this,source),this.material=source.material,this.geometry=source.geometry,this},computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[0];for(let i=1,t=e.count;i<t;i++)wo.fromBufferAttribute(e,i-1),_o.fromBufferAttribute(e,i),n[i]=n[i-1],n[i]+=wo.distanceTo(_o);t.setAttribute("lineDistance",new Re(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;n[0]=0;for(let i=1,t=e.length;i<t;i++)n[i]=n[i-1],n[i]+=e[i-1].distanceTo(e[i])}return this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,o=t.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Eo.copy(n.boundingSphere),Eo.applyMatrix4(r),Eo.radius+=o,!1===t.ray.intersectsSphere(Eo))return;So.getInverse(r),Mo.copy(t.ray).applyMatrix4(So);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c,h=new W,d=new W,f=new W,m=new W,v=this&&this.isLineSegments?2:1;if(n.isBufferGeometry){const r=n.index,o=n.attributes.position.array;if(null!==r){const n=r.array;for(let i=0,r=n.length-1;i<r;i+=v){const a=n[i],b=n[i+1];h.fromArray(o,3*a),d.fromArray(o,3*b);if(Mo.distanceSqToSegment(h,d,m,f)>l)continue;m.applyMatrix4(this.matrixWorld);const r=t.ray.origin.distanceTo(m);r<t.near||r>t.far||e.push({distance:r,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else for(let i=0,n=o.length/3-1;i<n;i+=v){h.fromArray(o,3*i),d.fromArray(o,3*i+3);if(Mo.distanceSqToSegment(h,d,m,f)>l)continue;m.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(m);n<t.near||n>t.far||e.push({distance:n,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else if(n.isGeometry){const r=n.vertices,o=r.length;for(let i=0;i<o-1;i+=v){if(Mo.distanceSqToSegment(r[i],r[i+1],m,f)>l)continue;m.applyMatrix4(this.matrixWorld);const n=t.ray.origin.distanceTo(m);n<t.near||n>t.far||e.push({distance:n,point:f.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});const Ao=new W,Co=new W;function Ro(t,e){To.call(this,t,e),this.type="LineSegments"}function Io(t,e){To.call(this,t,e),this.type="LineLoop"}function No(t){ve.call(this),this.type="PointsMaterial",this.color=new he(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(t)}Ro.prototype=Object.assign(Object.create(To.prototype),{constructor:Ro,isLineSegments:!0,computeLineDistances:function(){const t=this.geometry;if(t.isBufferGeometry)if(null===t.index){const e=t.attributes.position,n=[];for(let i=0,t=e.count;i<t;i+=2)Ao.fromBufferAttribute(e,i),Co.fromBufferAttribute(e,i+1),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Ao.distanceTo(Co);t.setAttribute("lineDistance",new Re(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(t.isGeometry){const e=t.vertices,n=t.lineDistances;for(let i=0,t=e.length;i<t;i+=2)Ao.copy(e[i]),Co.copy(e[i+1]),n[i]=0===i?0:n[i-1],n[i+1]=n[i]+Ao.distanceTo(Co)}return this}}),Io.prototype=Object.assign(Object.create(To.prototype),{constructor:Io,isLineLoop:!0}),No.prototype=Object.create(ve.prototype),No.prototype.constructor=No,No.prototype.isPointsMaterial=!0,No.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.alphaMap=source.alphaMap,this.size=source.size,this.sizeAttenuation=source.sizeAttenuation,this.morphTargets=source.morphTargets,this};const Oo=new tt,Do=new qt,Lo=new Bt,ko=new W;function Po(t,e){bt.call(this),this.type="Points",this.geometry=void 0!==t?t:new Ue,this.material=void 0!==e?e:new No,this.updateMorphTargets()}function Fo(t,e,n,r,o,c,object){const l=Do.distanceSqToPoint(t);if(l<n){const n=new W;Do.closestPointToPoint(t,n),n.applyMatrix4(r);const h=o.ray.origin.distanceTo(n);if(h<o.near||h>o.far)return;c.push({distance:h,distanceToRay:Math.sqrt(l),point:n,index:e,face:null,object:object})}}function Bo(video,t,e,n,r,o,c,l,h){B.call(this,video,t,e,n,r,o,c,l,h),this.format=void 0!==c?c:w,this.minFilter=void 0!==o?o:v,this.magFilter=void 0!==r?r:v,this.generateMipmaps=!1}function zo(t,e,n,r,o,c,l,h,d,f,m,v){B.call(this,null,c,l,h,d,f,r,o,m,v),this.image={width:e,height:n},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}function Uo(canvas,t,e,n,r,o,c,l,h){B.call(this,canvas,t,e,n,r,o,c,l,h),this.needsUpdate=!0}function Vo(t,e,n,r,o,c,l,h,f,m){if(1026!==(m=void 0!==m?m:1026)&&1027!==m)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&1026===m&&(n=1012),void 0===n&&1027===m&&(n=1020),B.call(this,null,r,o,c,l,h,m,n,f),this.image={width:t,height:e},this.magFilter=void 0!==l?l:d,this.minFilter=void 0!==h?h:d,this.flipY=!1,this.generateMipmaps=!1}function Go(t){Ue.call(this),this.type="WireframeGeometry";const e=[],n=[0,0],r={},o=["a","b","c"];if(t&&t.isGeometry){const c=t.faces;for(let i=0,t=c.length;i<t;i++){const t=c[i];for(let e=0;e<3;e++){const c=t[o[e]],l=t[o[(e+1)%3]];n[0]=Math.min(c,l),n[1]=Math.max(c,l);const h=n[0]+","+n[1];void 0===r[h]&&(r[h]={index1:n[0],index2:n[1]})}}for(const n in r){const o=r[n];let c=t.vertices[o.index1];e.push(c.x,c.y,c.z),c=t.vertices[o.index2],e.push(c.x,c.y,c.z)}}else if(t&&t.isBufferGeometry){let o=new W;if(null!==t.index){const c=t.attributes.position,l=t.index;let h=t.groups;0===h.length&&(h=[{start:0,count:l.count,materialIndex:0}]);for(let t=0,ol=h.length;t<ol;++t){const e=h[t],o=e.start;for(let i=o,t=o+e.count;i<t;i+=3)for(let t=0;t<3;t++){const e=l.getX(i+t),o=l.getX(i+(t+1)%3);n[0]=Math.min(e,o),n[1]=Math.max(e,o);const c=n[0]+","+n[1];void 0===r[c]&&(r[c]={index1:n[0],index2:n[1]})}}for(const t in r){const n=r[t];o.fromBufferAttribute(c,n.index1),e.push(o.x,o.y,o.z),o.fromBufferAttribute(c,n.index2),e.push(o.x,o.y,o.z)}}else{const n=t.attributes.position;for(let i=0,t=n.count/3;i<t;i++)for(let t=0;t<3;t++){const r=3*i+t;o.fromBufferAttribute(n,r),e.push(o.x,o.y,o.z);const c=3*i+(t+1)%3;o.fromBufferAttribute(n,c),e.push(o.x,o.y,o.z)}}}this.setAttribute("position",new Re(e,3))}function Ho(t,e,n){pn.call(this),this.type="ParametricGeometry",this.parameters={func:t,slices:e,stacks:n},this.fromBufferGeometry(new jo(t,e,n)),this.mergeVertices()}function jo(t,e,n){Ue.call(this),this.type="ParametricBufferGeometry",this.parameters={func:t,slices:e,stacks:n};const r=[],o=[],c=[],l=[],h=1e-5,d=new W,f=new W,m=new W,v=new W,y=new W;t.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");const x=e+1;for(let i=0;i<=n;i++){const r=i/n;for(let n=0;n<=e;n++){const u=n/e;t(u,r,f),o.push(f.x,f.y,f.z),u-h>=0?(t(u-h,r,m),v.subVectors(f,m)):(t(u+h,r,m),v.subVectors(m,f)),r-h>=0?(t(u,r-h,m),y.subVectors(f,m)):(t(u,r+h,m),y.subVectors(m,f)),d.crossVectors(v,y).normalize(),c.push(d.x,d.y,d.z),l.push(u,r)}}for(let i=0;i<n;i++)for(let t=0;t<e;t++){const a=i*x+t,b=i*x+t+1,e=(i+1)*x+t+1,n=(i+1)*x+t;r.push(a,b,n),r.push(b,e,n)}this.setIndex(r),this.setAttribute("position",new Re(o,3)),this.setAttribute("normal",new Re(c,3)),this.setAttribute("uv",new Re(l,2))}function Wo(t,e,n,r){pn.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},this.fromBufferGeometry(new qo(t,e,n,r)),this.mergeVertices()}function qo(t,e,n,r){Ue.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:t,indices:e,radius:n,detail:r},n=n||1;const o=[],c=[];function l(a,b,t,e){const n=Math.pow(2,e),r=[];for(let i=0;i<=n;i++){r[i]=[];const e=a.clone().lerp(t,i/n),o=b.clone().lerp(t,i/n),c=n-i;for(let t=0;t<=c;t++)r[i][t]=0===t&&i===n?e:e.clone().lerp(o,t/c)}for(let i=0;i<n;i++)for(let t=0;t<2*(n-i)-1;t++){const e=Math.floor(t/2);t%2==0?(h(r[i][e+1]),h(r[i+1][e]),h(r[i][e])):(h(r[i][e+1]),h(r[i+1][e+1]),h(r[i+1][e]))}}function h(t){o.push(t.x,t.y,t.z)}function d(e,n){const r=3*e;n.x=t[r+0],n.y=t[r+1],n.z=t[r+2]}function f(t,e,n,r){r<0&&1===t.x&&(c[e]=t.x-1),0===n.x&&0===n.z&&(c[e]=r/2/Math.PI+.5)}function m(t){return Math.atan2(t.z,-t.x)}!function(t){const a=new W,b=new W,n=new W;for(let i=0;i<e.length;i+=3)d(e[i+0],a),d(e[i+1],b),d(e[i+2],n),l(a,b,n,t)}(r=r||0),function(t){const e=new W;for(let i=0;i<o.length;i+=3)e.x=o[i+0],e.y=o[i+1],e.z=o[i+2],e.normalize().multiplyScalar(t),o[i+0]=e.x,o[i+1]=e.y,o[i+2]=e.z}(n),function(){const t=new W;for(let i=0;i<o.length;i+=3){t.x=o[i+0],t.y=o[i+1],t.z=o[i+2];const u=m(t)/2/Math.PI+.5,n=(e=t,Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5);c.push(u,1-n)}var e;(function(){const a=new W,b=new W,t=new W,e=new W,n=new D,r=new D,l=new D;for(let i=0,h=0;i<o.length;i+=9,h+=6){a.set(o[i+0],o[i+1],o[i+2]),b.set(o[i+3],o[i+4],o[i+5]),t.set(o[i+6],o[i+7],o[i+8]),n.set(c[h+0],c[h+1]),r.set(c[h+2],c[h+3]),l.set(c[h+4],c[h+5]),e.copy(a).add(b).add(t).divideScalar(3);const d=m(e);f(n,h+0,a,d),f(r,h+2,b,d),f(l,h+4,t,d)}})(),function(){for(let i=0;i<c.length;i+=6){const t=c[i+0],e=c[i+2],n=c[i+4],r=Math.max(t,e,n),o=Math.min(t,e,n);r>.9&&o<.1&&(t<.2&&(c[i+0]+=1),e<.2&&(c[i+2]+=1),n<.2&&(c[i+4]+=1))}}()}(),this.setAttribute("position",new Re(o,3)),this.setAttribute("normal",new Re(o.slice(),3)),this.setAttribute("uv",new Re(c,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Xo(t,e){pn.call(this),this.type="TetrahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Yo(t,e)),this.mergeVertices()}function Yo(t,e){qo.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],t,e),this.type="TetrahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Ko(t,e){pn.call(this),this.type="OctahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Jo(t,e)),this.mergeVertices()}function Jo(t,e){qo.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],t,e),this.type="OctahedronBufferGeometry",this.parameters={radius:t,detail:e}}function Zo(t,e){pn.call(this),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new Qo(t,e)),this.mergeVertices()}function Qo(t,e){const n=(1+Math.sqrt(5))/2,r=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1];qo.call(this,r,[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],t,e),this.type="IcosahedronBufferGeometry",this.parameters={radius:t,detail:e}}function $o(t,e){pn.call(this),this.type="DodecahedronGeometry",this.parameters={radius:t,detail:e},this.fromBufferGeometry(new ta(t,e)),this.mergeVertices()}function ta(t,e){const n=(1+Math.sqrt(5))/2,r=1/n,o=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-n,0,-r,n,0,r,-n,0,r,n,-r,-n,0,-r,n,0,r,-n,0,r,n,0,-n,0,-r,n,0,-r,-n,0,r,n,0,r];qo.call(this,o,[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],t,e),this.type="DodecahedronBufferGeometry",this.parameters={radius:t,detail:e}}function ea(path,t,e,n,r,o){pn.call(this),this.type="TubeGeometry",this.parameters={path:path,tubularSegments:t,radius:e,radialSegments:n,closed:r},void 0!==o&&console.warn("THREE.TubeGeometry: taper has been removed.");const c=new na(path,t,e,n,r);this.tangents=c.tangents,this.normals=c.normals,this.binormals=c.binormals,this.fromBufferGeometry(c),this.mergeVertices()}function na(path,t,e,n,r){Ue.call(this),this.type="TubeBufferGeometry",this.parameters={path:path,tubularSegments:t,radius:e,radialSegments:n,closed:r},t=t||64,e=e||1,n=n||8,r=r||!1;const o=path.computeFrenetFrames(t,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const c=new W,l=new W,h=new D;let d=new W;const f=[],m=[],v=[],y=[];function x(i){d=path.getPointAt(i/t,d);const r=o.normals[i],h=o.binormals[i];for(let t=0;t<=n;t++){const o=t/n*Math.PI*2,v=Math.sin(o),y=-Math.cos(o);l.x=y*r.x+v*h.x,l.y=y*r.y+v*h.y,l.z=y*r.z+v*h.z,l.normalize(),m.push(l.x,l.y,l.z),c.x=d.x+e*l.x,c.y=d.y+e*l.y,c.z=d.z+e*l.z,f.push(c.x,c.y,c.z)}}!function(){for(let i=0;i<t;i++)x(i);x(!1===r?t:0),function(){for(let i=0;i<=t;i++)for(let e=0;e<=n;e++)h.x=i/t,h.y=e/n,v.push(h.x,h.y)}(),function(){for(let e=1;e<=t;e++)for(let i=1;i<=n;i++){const a=(n+1)*(e-1)+(i-1),b=(n+1)*e+(i-1),t=(n+1)*e+i,r=(n+1)*(e-1)+i;y.push(a,b,r),y.push(b,t,r)}}()}(),this.setIndex(y),this.setAttribute("position",new Re(f,3)),this.setAttribute("normal",new Re(m,3)),this.setAttribute("uv",new Re(v,2))}function ra(t,e,n,r,p,q,o){pn.call(this),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:p,q:q},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new ia(t,e,n,r,p,q)),this.mergeVertices()}function ia(t,e,n,r,p,q){Ue.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:t,tube:e,tubularSegments:n,radialSegments:r,p:p,q:q},t=t||1,e=e||.4,n=Math.floor(n)||64,r=Math.floor(r)||8,p=p||2,q=q||3;const o=[],c=[],l=[],h=[],d=new W,f=new W,m=new W,v=new W,y=new W,x=new W,w=new W;for(let i=0;i<=n;++i){const u=i/n*p*Math.PI*2;_(u,p,q,t,m),_(u+.01,p,q,t,v),x.subVectors(v,m),w.addVectors(v,m),y.crossVectors(x,w),w.crossVectors(y,x),y.normalize(),w.normalize();for(let t=0;t<=r;++t){const o=t/r*Math.PI*2,v=-e*Math.cos(o),x=e*Math.sin(o);d.x=m.x+(v*w.x+x*y.x),d.y=m.y+(v*w.y+x*y.y),d.z=m.z+(v*w.z+x*y.z),c.push(d.x,d.y,d.z),f.subVectors(d,m).normalize(),l.push(f.x,f.y,f.z),h.push(i/n),h.push(t/r)}}for(let t=1;t<=n;t++)for(let i=1;i<=r;i++){const a=(r+1)*(t-1)+(i-1),b=(r+1)*t+(i-1),e=(r+1)*t+i,n=(r+1)*(t-1)+i;o.push(a,b,n),o.push(b,e,n)}function _(u,p,q,t,e){const n=Math.cos(u),r=Math.sin(u),o=q/p*u,c=Math.cos(o);e.x=t*(2+c)*.5*n,e.y=t*(2+c)*r*.5,e.z=t*Math.sin(o)*.5}this.setIndex(o),this.setAttribute("position",new Re(c,3)),this.setAttribute("normal",new Re(l,3)),this.setAttribute("uv",new Re(h,2))}function oa(t,e,n,r,o){pn.call(this),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:o},this.fromBufferGeometry(new aa(t,e,n,r,o)),this.mergeVertices()}function aa(t,e,n,r,o){Ue.call(this),this.type="TorusBufferGeometry",this.parameters={radius:t,tube:e,radialSegments:n,tubularSegments:r,arc:o},t=t||1,e=e||.4,n=Math.floor(n)||8,r=Math.floor(r)||6,o=o||2*Math.PI;const c=[],l=[],h=[],d=[],f=new W,m=new W,v=new W;for(let c=0;c<=n;c++)for(let i=0;i<=r;i++){const u=i/r*o,y=c/n*Math.PI*2;m.x=(t+e*Math.cos(y))*Math.cos(u),m.y=(t+e*Math.cos(y))*Math.sin(u),m.z=e*Math.sin(y),l.push(m.x,m.y,m.z),f.x=t*Math.cos(u),f.y=t*Math.sin(u),v.subVectors(m,f).normalize(),h.push(v.x,v.y,v.z),d.push(i/r),d.push(c/n)}for(let t=1;t<=n;t++)for(let i=1;i<=r;i++){const a=(r+1)*t+i-1,b=(r+1)*(t-1)+i-1,e=(r+1)*(t-1)+i,n=(r+1)*t+i;c.push(a,b,n),c.push(b,e,n)}this.setIndex(c),this.setAttribute("position",new Re(l,3)),this.setAttribute("normal",new Re(h,3)),this.setAttribute("uv",new Re(d,2))}Po.prototype=Object.assign(Object.create(bt.prototype),{constructor:Po,isPoints:!0,copy:function(source){return bt.prototype.copy.call(this,source),this.material=source.material,this.geometry=source.geometry,this},raycast:function(t,e){const n=this.geometry,r=this.matrixWorld,o=t.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),Lo.copy(n.boundingSphere),Lo.applyMatrix4(r),Lo.radius+=o,!1===t.ray.intersectsSphere(Lo))return;Oo.getInverse(r),Do.copy(t.ray).applyMatrix4(Oo);const c=o/((this.scale.x+this.scale.y+this.scale.z)/3),l=c*c;if(n.isBufferGeometry){const o=n.index,c=n.attributes.position.array;if(null!==o){const n=o.array;for(let i=0,o=n.length;i<o;i++){const a=n[i];ko.fromArray(c,3*a),Fo(ko,a,l,r,t,e,this)}}else for(let i=0,n=c.length/3;i<n;i++)ko.fromArray(c,3*i),Fo(ko,i,l,r,t,e,this)}else{const o=n.vertices;for(let i=0,n=o.length;i<n;i++)Fo(o[i],i,l,r,t,e,this)}},updateMorphTargets:function(){const t=this.geometry;if(t.isBufferGeometry){const e=t.morphAttributes,n=Object.keys(e);if(n.length>0){const t=e[n[0]];if(void 0!==t){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let e=0,n=t.length;e<n;e++){const n=t[e].name||String(e);this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}}}else{const e=t.morphTargets;void 0!==e&&e.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),Bo.prototype=Object.assign(Object.create(B.prototype),{constructor:Bo,isVideoTexture:!0,update:function(){const video=this.image;video.readyState>=video.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),zo.prototype=Object.create(B.prototype),zo.prototype.constructor=zo,zo.prototype.isCompressedTexture=!0,Uo.prototype=Object.create(B.prototype),Uo.prototype.constructor=Uo,Uo.prototype.isCanvasTexture=!0,Vo.prototype=Object.create(B.prototype),Vo.prototype.constructor=Vo,Vo.prototype.isDepthTexture=!0,Go.prototype=Object.create(Ue.prototype),Go.prototype.constructor=Go,Ho.prototype=Object.create(pn.prototype),Ho.prototype.constructor=Ho,jo.prototype=Object.create(Ue.prototype),jo.prototype.constructor=jo,Wo.prototype=Object.create(pn.prototype),Wo.prototype.constructor=Wo,qo.prototype=Object.create(Ue.prototype),qo.prototype.constructor=qo,Xo.prototype=Object.create(pn.prototype),Xo.prototype.constructor=Xo,Yo.prototype=Object.create(qo.prototype),Yo.prototype.constructor=Yo,Ko.prototype=Object.create(pn.prototype),Ko.prototype.constructor=Ko,Jo.prototype=Object.create(qo.prototype),Jo.prototype.constructor=Jo,Zo.prototype=Object.create(pn.prototype),Zo.prototype.constructor=Zo,Qo.prototype=Object.create(qo.prototype),Qo.prototype.constructor=Qo,$o.prototype=Object.create(pn.prototype),$o.prototype.constructor=$o,ta.prototype=Object.create(qo.prototype),ta.prototype.constructor=ta,ea.prototype=Object.create(pn.prototype),ea.prototype.constructor=ea,na.prototype=Object.create(Ue.prototype),na.prototype.constructor=na,na.prototype.toJSON=function(){const data=Ue.prototype.toJSON.call(this);return data.path=this.parameters.path.toJSON(),data},ra.prototype=Object.create(pn.prototype),ra.prototype.constructor=ra,ia.prototype=Object.create(Ue.prototype),ia.prototype.constructor=ia,oa.prototype=Object.create(pn.prototype),oa.prototype.constructor=oa,aa.prototype=Object.create(Ue.prototype),aa.prototype.constructor=aa;const sa=function(data,t,e){e=e||2;let n,r,o,c,l,h,d,f=t&&t.length,m=f?t[0]*e:data.length,v=ua(data,0,m,e,!0),y=[];if(!v||v.next===v.prev)return y;if(f&&(v=function(data,t,e,n){let i,r,o,c,l,h=[];for(i=0,r=t.length;i<r;i++)o=t[i]*n,c=i<r-1?t[i+1]*n:data.length,l=ua(data,o,c,n,!1),l===l.next&&(l.steiner=!0),h.push(xa(l));for(h.sort(ma),i=0;i<h.length;i++)ga(h[i],e),e=ca(e,e.next);return e}(data,t,v,e)),data.length>80*e){n=o=data[0],r=c=data[1];for(let i=e;i<m;i+=e)l=data[i],h=data[i+1],l<n&&(n=l),h<r&&(r=h),l>o&&(o=l),h>c&&(c=h);d=Math.max(o-n,c-r),d=0!==d?1/d:0}return la(v,y,e,n,r,d),y};function ua(data,t,e,n,r){let i,o;if(r===function(data,t,e,n){let r=0;for(let i=t,o=e-n;i<e;i+=n)r+=(data[o]-data[i])*(data[i+1]+data[o+1]),o=i;return r}(data,t,e,n)>0)for(i=t;i<e;i+=n)o=Ca(i,data[i],data[i+1],o);else for(i=e-n;i>=t;i-=n)o=Ca(i,data[i],data[i+1],o);return o&&_a(o,o.next)&&(Ra(o),o=o.next),o}function ca(t,e){if(!t)return t;e||(e=t);let n,p=t;do{if(n=!1,p.steiner||!_a(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(Ra(p),p=e=p.prev,p===p.next)break;n=!0}}while(n||p!==e);return e}function la(t,e,n,r,o,c,l){if(!t)return;!l&&c&&function(t,e,n,r){let p=t;do{null===p.z&&(p.z=ya(p.x,p.y,e,n,r)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==t);p.prevZ.nextZ=null,p.prevZ=null,function(t){let i,p,q,e,n,r,o,c,l=1;do{for(p=t,t=null,n=null,r=0;p;){for(r++,q=p,o=0,i=0;i<l&&(o++,q=q.nextZ,q);i++);for(c=l;o>0||c>0&&q;)0!==o&&(0===c||!q||p.z<=q.z)?(e=p,p=p.nextZ,o--):(e=q,q=q.nextZ,c--),n?n.nextZ=e:t=e,e.prevZ=n,n=e;p=q}n.nextZ=null,l*=2}while(r>1)}(p)}(t,r,o,c);let h,d,f=t;for(;t.prev!==t.next;)if(h=t.prev,d=t.next,c?pa(t,r,o,c):ha(t))e.push(h.i/n),e.push(t.i/n),e.push(d.i/n),Ra(t),t=d.next,f=d.next;else if((t=d)===f){l?1===l?la(t=da(ca(t),e,n),e,n,r,o,c,2):2===l&&fa(t,e,n,r,o,c):la(ca(t),e,n,r,o,c,1);break}}function ha(t){let a=t.prev,b=t,e=t.next;if(area(a,b,e)>=0)return!1;let p=t.next.next;for(;p!==t.prev;){if(ba(a.x,a.y,b.x,b.y,e.x,e.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function pa(t,e,n,r){let a=t.prev,b=t,o=t.next;if(area(a,b,o)>=0)return!1;let c=a.x<b.x?a.x<o.x?a.x:o.x:b.x<o.x?b.x:o.x,l=a.y<b.y?a.y<o.y?a.y:o.y:b.y<o.y?b.y:o.y,h=a.x>b.x?a.x>o.x?a.x:o.x:b.x>o.x?b.x:o.x,d=a.y>b.y?a.y>o.y?a.y:o.y:b.y>o.y?b.y:o.y,f=ya(c,l,e,n,r),m=ya(h,d,e,n,r),p=t.prevZ,v=t.nextZ;for(;p&&p.z>=f&&v&&v.z<=m;){if(p!==t.prev&&p!==t.next&&ba(a.x,a.y,b.x,b.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,v!==t.prev&&v!==t.next&&ba(a.x,a.y,b.x,b.y,o.x,o.y,v.x,v.y)&&area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;p&&p.z>=f;){if(p!==t.prev&&p!==t.next&&ba(a.x,a.y,b.x,b.y,o.x,o.y,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;v&&v.z<=m;){if(v!==t.prev&&v!==t.next&&ba(a.x,a.y,b.x,b.y,o.x,o.y,v.x,v.y)&&area(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function da(t,e,n){let p=t;do{let a=p.prev,b=p.next.next;!_a(a,b)&&Sa(a,p,p.next,b)&&Ta(a,b)&&Ta(b,a)&&(e.push(a.i/n),e.push(p.i/n),e.push(b.i/n),Ra(p),Ra(p.next),p=t=b),p=p.next}while(p!==t);return ca(p)}function fa(t,e,n,r,o,c){let a=t;do{let b=a.next.next;for(;b!==a.prev;){if(a.i!==b.i&&wa(a,b)){let t=Aa(a,b);return a=ca(a,a.next),t=ca(t,t.next),la(a,e,n,r,o,c),void la(t,e,n,r,o,c)}b=b.next}a=a.next}while(a!==t)}function ma(a,b){return a.x-b.x}function ga(t,e){if(e=function(t,e){let n,p=e,r=t.x,o=t.y,c=-1/0;do{if(o<=p.y&&o>=p.next.y&&p.next.y!==p.y){let t=p.x+(o-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(t<=r&&t>c){if(c=t,t===r){if(o===p.y)return p;if(o===p.next.y)return p.next}n=p.x<p.next.x?p:p.next}}p=p.next}while(p!==e);if(!n)return null;if(r===c)return n;let l,h=n,d=n.x,f=n.y,m=1/0;p=n;do{r>=p.x&&p.x>=d&&r!==p.x&&ba(o<f?r:c,o,d,f,o<f?c:r,o,p.x,p.y)&&(l=Math.abs(o-p.y)/(r-p.x),Ta(p,t)&&(l<m||l===m&&(p.x>n.x||p.x===n.x&&va(n,p)))&&(n=p,m=l)),p=p.next}while(p!==h);return n}(t,e)){const b=Aa(e,t);ca(e,e.next),ca(b,b.next)}}function va(t,p){return area(t.prev,t,p.prev)<0&&area(p.next,t,t.next)<0}function ya(t,e,n,r,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*o)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*o)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function xa(t){let p=t,e=t;do{(p.x<e.x||p.x===e.x&&p.y<e.y)&&(e=p),p=p.next}while(p!==t);return e}function ba(t,e,n,r,o,c,l,h){return(o-l)*(e-h)-(t-l)*(c-h)>=0&&(t-l)*(r-h)-(n-l)*(e-h)>=0&&(n-l)*(c-h)-(o-l)*(r-h)>=0}function wa(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){let p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&Sa(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(Ta(a,b)&&Ta(b,a)&&function(a,b){let p=a,t=!1,e=(a.x+b.x)/2,n=(a.y+b.y)/2;do{p.y>n!=p.next.y>n&&p.next.y!==p.y&&e<(p.next.x-p.x)*(n-p.y)/(p.next.y-p.y)+p.x&&(t=!t),p=p.next}while(p!==a);return t}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||_a(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,t){return(q.y-p.y)*(t.x-q.x)-(q.x-p.x)*(t.y-q.y)}function _a(t,e){return t.x===e.x&&t.y===e.y}function Sa(t,e,n,r){const o=Ea(area(t,e,n)),c=Ea(area(t,e,r)),l=Ea(area(n,r,t)),h=Ea(area(n,r,e));return o!==c&&l!==h||(!(0!==o||!Ma(t,n,e))||(!(0!==c||!Ma(t,r,e))||(!(0!==l||!Ma(n,t,r))||!(0!==h||!Ma(n,e,r)))))}function Ma(p,q,t){return q.x<=Math.max(p.x,t.x)&&q.x>=Math.min(p.x,t.x)&&q.y<=Math.max(p.y,t.y)&&q.y>=Math.min(p.y,t.y)}function Ea(t){return t>0?1:t<0?-1:0}function Ta(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function Aa(a,b){let t=new Ia(a.i,a.x,a.y),e=new Ia(b.i,b.x,b.y),n=a.next,r=b.prev;return a.next=b,b.prev=a,t.next=n,n.prev=t,e.next=t,t.prev=e,r.next=e,e.prev=r,e}function Ca(i,t,e,n){const p=new Ia(i,t,e);return n?(p.next=n.next,p.prev=n,n.next.prev=p,n.next=p):(p.prev=p,p.next=p),p}function Ra(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Ia(i,t,e){this.i=i,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}const Na={area:function(t){const e=t.length;let a=0;for(let p=e-1,q=0;q<e;p=q++)a+=t[p].x*t[q].y-t[q].x*t[p].y;return.5*a},isClockWise:function(t){return Na.area(t)<0},triangulateShape:function(t,e){const n=[],r=[],o=[];Oa(t),Da(n,t);let c=t.length;e.forEach(Oa);for(let i=0;i<e.length;i++)r.push(c),c+=e[i].length,Da(n,e[i]);const l=sa(n,r);for(let i=0;i<l.length;i+=3)o.push(l.slice(i,i+3));return o}};function Oa(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function Da(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}function La(t,e){pn.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:t,options:e},this.fromBufferGeometry(new ka(t,e)),this.mergeVertices()}function ka(t,e){Ue.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:t,options:e},t=Array.isArray(t)?t:[t];const n=this,r=[],o=[];for(let i=0,e=t.length;i<e;i++){c(t[i])}function c(t){const c=[],l=void 0!==e.curveSegments?e.curveSegments:12,h=void 0!==e.steps?e.steps:1;let d=void 0!==e.depth?e.depth:100,f=void 0===e.bevelEnabled||e.bevelEnabled,m=void 0!==e.bevelThickness?e.bevelThickness:6,v=void 0!==e.bevelSize?e.bevelSize:m-2,y=void 0!==e.bevelOffset?e.bevelOffset:0,x=void 0!==e.bevelSegments?e.bevelSegments:3;const w=e.extrudePath,_=void 0!==e.UVGenerator?e.UVGenerator:Pa;void 0!==e.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),d=e.amount);let S,M,E,T,A,C=!1;w&&(S=w.getSpacedPoints(h),C=!0,f=!1,M=w.computeFrenetFrames(h,!1),E=new W,T=new W,A=new W),f||(x=0,m=0,v=0,y=0);const R=t.extractPoints(l);let I=R.shape;const N=R.holes;if(!Na.isClockWise(I)){I=I.reverse();for(let t=0,e=N.length;t<e;t++){const e=N[t];Na.isClockWise(e)&&(N[t]=e.reverse())}}const O=Na.triangulateShape(I,N),L=I;for(let t=0,e=N.length;t<e;t++){const e=N[t];I=I.concat(e)}function k(t,e,n){return e||console.error("THREE.ExtrudeGeometry: vec does not exist"),e.clone().multiplyScalar(n).add(t)}const P=I.length,F=O.length;function B(t,e,n){let r,o,c;const l=t.x-e.x,h=t.y-e.y,d=n.x-t.x,f=n.y-t.y,m=l*l+h*h,v=l*f-h*d;if(Math.abs(v)>Number.EPSILON){const v=Math.sqrt(m),y=Math.sqrt(d*d+f*f),x=e.x-h/v,w=e.y+l/v,_=((n.x-f/y-x)*f-(n.y+d/y-w)*d)/(l*f-h*d);r=x+l*_-t.x,o=w+h*_-t.y;const S=r*r+o*o;if(S<=2)return new D(r,o);c=Math.sqrt(S/2)}else{let t=!1;l>Number.EPSILON?d>Number.EPSILON&&(t=!0):l<-Number.EPSILON?d<-Number.EPSILON&&(t=!0):Math.sign(h)===Math.sign(f)&&(t=!0),t?(r=-h,o=l,c=Math.sqrt(m)):(r=l,o=h,c=Math.sqrt(m/2))}return new D(r/c,o/c)}const z=[];for(let i=0,t=L.length,e=t-1,n=i+1;i<t;i++,e++,n++)e===t&&(e=0),n===t&&(n=0),z[i]=B(L[i],L[e],L[n]);const U=[];let V,G=z.concat();for(let t=0,e=N.length;t<e;t++){const e=N[t];V=[];for(let i=0,t=e.length,n=t-1,r=i+1;i<t;i++,n++,r++)n===t&&(n=0),r===t&&(r=0),V[i]=B(e[i],e[n],e[r]);U.push(V),G=G.concat(V)}for(let b=0;b<x;b++){const t=b/x,e=m*Math.cos(t*Math.PI/2),n=v*Math.sin(t*Math.PI/2)+y;for(let i=0,t=L.length;i<t;i++){const t=k(L[i],z[i],n);X(t.x,t.y,-e)}for(let t=0,r=N.length;t<r;t++){const r=N[t];V=U[t];for(let i=0,t=r.length;i<t;i++){const t=k(r[i],V[i],n);X(t.x,t.y,-e)}}}const H=v+y;for(let i=0;i<P;i++){const t=f?k(I[i],G[i],H):I[i];C?(T.copy(M.normals[0]).multiplyScalar(t.x),E.copy(M.binormals[0]).multiplyScalar(t.y),A.copy(S[0]).add(T).add(E),X(A.x,A.y,A.z)):X(t.x,t.y,0)}for(let s=1;s<=h;s++)for(let i=0;i<P;i++){const t=f?k(I[i],G[i],H):I[i];C?(T.copy(M.normals[s]).multiplyScalar(t.x),E.copy(M.binormals[s]).multiplyScalar(t.y),A.copy(S[s]).add(T).add(E),X(A.x,A.y,A.z)):X(t.x,t.y,d/h*s)}for(let b=x-1;b>=0;b--){const t=b/x,e=m*Math.cos(t*Math.PI/2),n=v*Math.sin(t*Math.PI/2)+y;for(let i=0,t=L.length;i<t;i++){const t=k(L[i],z[i],n);X(t.x,t.y,d+e)}for(let t=0,r=N.length;t<r;t++){const r=N[t];V=U[t];for(let i=0,t=r.length;i<t;i++){const t=k(r[i],V[i],n);C?X(t.x,t.y+S[h-1].y,S[h-1].x+e):X(t.x,t.y,d+e)}}}function j(t,e){let i=t.length;for(;--i>=0;){const n=i;let r=i-1;r<0&&(r=t.length-1);for(let s=0,t=h+2*x;s<t;s++){const t=P*s,o=P*(s+1);K(e+n+t,e+r+t,e+r+o,e+n+o)}}}function X(t,e,n){c.push(t),c.push(e),c.push(n)}function Y(a,b,t){J(a),J(b),J(t);const e=r.length/3,o=_.generateTopUV(n,r,e-3,e-2,e-1);Z(o[0]),Z(o[1]),Z(o[2])}function K(a,b,t,e){J(a),J(b),J(e),J(b),J(t),J(e);const o=r.length/3,c=_.generateSideWallUV(n,r,o-6,o-3,o-2,o-1);Z(c[0]),Z(c[1]),Z(c[3]),Z(c[1]),Z(c[2]),Z(c[3])}function J(t){r.push(c[3*t+0]),r.push(c[3*t+1]),r.push(c[3*t+2])}function Z(t){o.push(t.x),o.push(t.y)}!function(){const t=r.length/3;if(f){let t=0,e=P*t;for(let i=0;i<F;i++){const t=O[i];Y(t[2]+e,t[1]+e,t[0]+e)}t=h+2*x,e=P*t;for(let i=0;i<F;i++){const t=O[i];Y(t[0]+e,t[1]+e,t[2]+e)}}else{for(let i=0;i<F;i++){const t=O[i];Y(t[2],t[1],t[0])}for(let i=0;i<F;i++){const t=O[i];Y(t[0]+P*h,t[1]+P*h,t[2]+P*h)}}n.addGroup(t,r.length/3-t,0)}(),function(){const t=r.length/3;let e=0;j(L,e),e+=L.length;for(let t=0,n=N.length;t<n;t++){const n=N[t];j(n,e),e+=n.length}n.addGroup(t,r.length/3-t,1)}()}this.setAttribute("position",new Re(r,3)),this.setAttribute("uv",new Re(o,2)),this.computeVertexNormals()}La.prototype=Object.create(pn.prototype),La.prototype.constructor=La,La.prototype.toJSON=function(){const data=pn.prototype.toJSON.call(this);return Fa(this.parameters.shapes,this.parameters.options,data)},ka.prototype=Object.create(Ue.prototype),ka.prototype.constructor=ka,ka.prototype.toJSON=function(){const data=Ue.prototype.toJSON.call(this);return Fa(this.parameters.shapes,this.parameters.options,data)};const Pa={generateTopUV:function(t,e,n,r,o){const c=e[3*n],l=e[3*n+1],h=e[3*r],d=e[3*r+1],f=e[3*o],m=e[3*o+1];return[new D(c,l),new D(h,d),new D(f,m)]},generateSideWallUV:function(t,e,n,r,o,c){const l=e[3*n],h=e[3*n+1],d=e[3*n+2],f=e[3*r],m=e[3*r+1],v=e[3*r+2],y=e[3*o],x=e[3*o+1],w=e[3*o+2],_=e[3*c],S=e[3*c+1],M=e[3*c+2];return Math.abs(h-m)<.01?[new D(l,1-d),new D(f,1-v),new D(y,1-w),new D(_,1-M)]:[new D(h,1-d),new D(m,1-v),new D(x,1-w),new D(S,1-M)]}};function Fa(t,e,data){if(data.shapes=[],Array.isArray(t))for(let i=0,e=t.length;i<e;i++){const e=t[i];data.shapes.push(e.uuid)}else data.shapes.push(t.uuid);return void 0!==e.extrudePath&&(data.options.extrudePath=e.extrudePath.toJSON()),data}function Ba(text,t){pn.call(this),this.type="TextGeometry",this.parameters={text:text,parameters:t},this.fromBufferGeometry(new za(text,t)),this.mergeVertices()}function za(text,t){const e=(t=t||{}).font;if(!e||!e.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new pn;const n=e.generateShapes(text,t.size);t.depth=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),ka.call(this,n,t),this.type="TextBufferGeometry"}function Ua(t,e,n,r,o,c,l){pn.call(this),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:o,thetaStart:c,thetaLength:l},this.fromBufferGeometry(new Va(t,e,n,r,o,c,l)),this.mergeVertices()}function Va(t,e,n,r,o,c,l){Ue.call(this),this.type="SphereBufferGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:n,phiStart:r,phiLength:o,thetaStart:c,thetaLength:l},t=t||1,e=Math.max(3,Math.floor(e)||8),n=Math.max(2,Math.floor(n)||6),r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,c=void 0!==c?c:0,l=void 0!==l?l:Math.PI;const h=Math.min(c+l,Math.PI);let d=0;const f=[],m=new W,v=new W,y=[],x=[],w=[],_=[];for(let y=0;y<=n;y++){const S=[],M=y/n;let E=0;0==y&&0==c?E=.5/e:y==n&&h==Math.PI&&(E=-.5/e);for(let n=0;n<=e;n++){const u=n/e;m.x=-t*Math.cos(r+u*o)*Math.sin(c+M*l),m.y=t*Math.cos(c+M*l),m.z=t*Math.sin(r+u*o)*Math.sin(c+M*l),x.push(m.x,m.y,m.z),v.copy(m).normalize(),w.push(v.x,v.y,v.z),_.push(u+E,1-M),S.push(d++)}f.push(S)}for(let t=0;t<n;t++)for(let r=0;r<e;r++){const a=f[t][r+1],b=f[t][r],e=f[t+1][r],o=f[t+1][r+1];(0!==t||c>0)&&y.push(a,b,o),(t!==n-1||h<Math.PI)&&y.push(b,e,o)}this.setIndex(y),this.setAttribute("position",new Re(x,3)),this.setAttribute("normal",new Re(w,3)),this.setAttribute("uv",new Re(_,2))}function Ga(t,e,n,r,o,c){pn.call(this),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:o,thetaLength:c},this.fromBufferGeometry(new Ha(t,e,n,r,o,c)),this.mergeVertices()}function Ha(t,e,n,r,o,c){Ue.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:n,phiSegments:r,thetaStart:o,thetaLength:c},t=t||.5,e=e||1,o=void 0!==o?o:0,c=void 0!==c?c:2*Math.PI,n=void 0!==n?Math.max(3,n):8;const l=[],h=[],d=[],f=[];let m=t;const v=(e-t)/(r=void 0!==r?Math.max(1,r):1),y=new W,x=new D;for(let t=0;t<=r;t++){for(let i=0;i<=n;i++){const t=o+i/n*c;y.x=m*Math.cos(t),y.y=m*Math.sin(t),h.push(y.x,y.y,y.z),d.push(0,0,1),x.x=(y.x/e+1)/2,x.y=(y.y/e+1)/2,f.push(x.x,x.y)}m+=v}for(let t=0;t<r;t++){const e=t*(n+1);for(let i=0;i<n;i++){const t=i+e,a=t,b=t+n+1,r=t+n+2,o=t+1;l.push(a,b,o),l.push(b,r,o)}}this.setIndex(l),this.setAttribute("position",new Re(h,3)),this.setAttribute("normal",new Re(d,3)),this.setAttribute("uv",new Re(f,2))}function ja(t,e,n,r){pn.call(this),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},this.fromBufferGeometry(new Wa(t,e,n,r)),this.mergeVertices()}function Wa(t,e,n,r){Ue.call(this),this.type="LatheBufferGeometry",this.parameters={points:t,segments:e,phiStart:n,phiLength:r},e=Math.floor(e)||12,n=n||0,r=r||2*Math.PI,r=O.clamp(r,0,2*Math.PI);const o=[],c=[],l=[],h=1/e,d=new W,f=new D;for(let i=0;i<=e;i++){const o=n+i*h*r,m=Math.sin(o),v=Math.cos(o);for(let n=0;n<=t.length-1;n++)d.x=t[n].x*m,d.y=t[n].y,d.z=t[n].x*v,c.push(d.x,d.y,d.z),f.x=i/e,f.y=n/(t.length-1),l.push(f.x,f.y)}for(let i=0;i<e;i++)for(let e=0;e<t.length-1;e++){const base=e+i*t.length,a=base,b=base+t.length,n=base+t.length+1,r=base+1;o.push(a,b,r),o.push(b,n,r)}if(this.setIndex(o),this.setAttribute("position",new Re(c,3)),this.setAttribute("uv",new Re(l,2)),this.computeVertexNormals(),r===2*Math.PI){const n=this.attributes.normal.array,r=new W,o=new W,c=new W,base=e*t.length*3;for(let i=0,e=0;i<t.length;i++,e+=3)r.x=n[e+0],r.y=n[e+1],r.z=n[e+2],o.x=n[base+e+0],o.y=n[base+e+1],o.z=n[base+e+2],c.addVectors(r,o).normalize(),n[e+0]=n[base+e+0]=c.x,n[e+1]=n[base+e+1]=c.y,n[e+2]=n[base+e+2]=c.z}}function qa(t,e){pn.call(this),this.type="ShapeGeometry","object"==typeof e&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),e=e.curveSegments),this.parameters={shapes:t,curveSegments:e},this.fromBufferGeometry(new Xa(t,e)),this.mergeVertices()}function Xa(t,e){Ue.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:t,curveSegments:e},e=e||12;const n=[],r=[],o=[],c=[];let l=0,h=0;if(!1===Array.isArray(t))d(t);else for(let i=0;i<t.length;i++)d(t[i]),this.addGroup(l,h,i),l+=h,h=0;function d(t){const l=r.length/3,d=t.extractPoints(e);let f=d.shape;const m=d.holes;!1===Na.isClockWise(f)&&(f=f.reverse());for(let i=0,t=m.length;i<t;i++){const t=m[i];!0===Na.isClockWise(t)&&(m[i]=t.reverse())}const v=Na.triangulateShape(f,m);for(let i=0,t=m.length;i<t;i++){const t=m[i];f=f.concat(t)}for(let i=0,t=f.length;i<t;i++){const t=f[i];r.push(t.x,t.y,0),o.push(0,0,1),c.push(t.x,t.y)}for(let i=0,t=v.length;i<t;i++){const t=v[i],a=t[0]+l,b=t[1]+l,e=t[2]+l;n.push(a,b,e),h+=3}}this.setIndex(n),this.setAttribute("position",new Re(r,3)),this.setAttribute("normal",new Re(o,3)),this.setAttribute("uv",new Re(c,2))}function Ya(t,data){if(data.shapes=[],Array.isArray(t))for(let i=0,e=t.length;i<e;i++){const e=t[i];data.shapes.push(e.uuid)}else data.shapes.push(t.uuid);return data}function Ka(t,e){Ue.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:e},e=void 0!==e?e:1;const n=[],r=Math.cos(O.DEG2RAD*e),o=[0,0],c={};let l,h,d;const f=["a","b","c"];let m;t.isBufferGeometry?(m=new pn,m.fromBufferGeometry(t)):m=t.clone(),m.mergeVertices(),m.computeFaceNormals();const v=m.vertices,y=m.faces;for(let i=0,t=y.length;i<t;i++){const t=y[i];for(let e=0;e<3;e++)l=t[f[e]],h=t[f[(e+1)%3]],o[0]=Math.min(l,h),o[1]=Math.max(l,h),d=o[0]+","+o[1],void 0===c[d]?c[d]={index1:o[0],index2:o[1],face1:i,face2:void 0}:c[d].face2=i}for(d in c){const t=c[d];if(void 0===t.face2||y[t.face1].normal.dot(y[t.face2].normal)<=r){let e=v[t.index1];n.push(e.x,e.y,e.z),e=v[t.index2],n.push(e.x,e.y,e.z)}}this.setAttribute("position",new Re(n,3))}function Ja(t,e,n,r,o,c,l,h){pn.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:o,openEnded:c,thetaStart:l,thetaLength:h},this.fromBufferGeometry(new Za(t,e,n,r,o,c,l,h)),this.mergeVertices()}function Za(t,e,n,r,o,c,l,h){Ue.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:n,radialSegments:r,heightSegments:o,openEnded:c,thetaStart:l,thetaLength:h};const d=this;t=void 0!==t?t:1,e=void 0!==e?e:1,n=n||1,r=Math.floor(r)||8,o=Math.floor(o)||1,c=void 0!==c&&c,l=void 0!==l?l:0,h=void 0!==h?h:2*Math.PI;const f=[],m=[],v=[],y=[];let x=0;const w=[],_=n/2;let S=0;function M(n){let o,c;const w=new D,M=new W;let E=0;const T=!0===n?t:e,A=!0===n?1:-1;o=x;for(let t=1;t<=r;t++)m.push(0,_*A,0),v.push(0,A,0),y.push(.5,.5),x++;c=x;for(let t=0;t<=r;t++){const e=t/r*h+l,n=Math.cos(e),o=Math.sin(e);M.x=T*o,M.y=_*A,M.z=T*n,m.push(M.x,M.y,M.z),v.push(0,A,0),w.x=.5*n+.5,w.y=.5*o*A+.5,y.push(w.x,w.y),x++}for(let t=0;t<r;t++){const e=o+t,i=c+t;!0===n?f.push(i,i+1,e):f.push(i+1,i,e),E+=3}d.addGroup(S,E,!0===n?1:2),S+=E}!function(){const c=new W,M=new W;let E=0;const T=(e-t)/n;for(let d=0;d<=o;d++){const f=[],S=d/o,E=S*(e-t)+t;for(let t=0;t<=r;t++){const u=t/r,e=u*h+l,o=Math.sin(e),d=Math.cos(e);M.x=E*o,M.y=-S*n+_,M.z=E*d,m.push(M.x,M.y,M.z),c.set(o,T,d).normalize(),v.push(c.x,c.y,c.z),y.push(u,1-S),f.push(x++)}w.push(f)}for(let t=0;t<r;t++)for(let e=0;e<o;e++){const a=w[e][t],b=w[e+1][t],n=w[e+1][t+1],r=w[e][t+1];f.push(a,b,r),f.push(b,n,r),E+=6}d.addGroup(S,E,0),S+=E}(),!1===c&&(t>0&&M(!0),e>0&&M(!1)),this.setIndex(f),this.setAttribute("position",new Re(m,3)),this.setAttribute("normal",new Re(v,3)),this.setAttribute("uv",new Re(y,2))}function Qa(t,e,n,r,o,c,l){Ja.call(this,0,t,e,n,r,o,c,l),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:c,thetaLength:l}}function $a(t,e,n,r,o,c,l){Za.call(this,0,t,e,n,r,o,c,l),this.type="ConeBufferGeometry",this.parameters={radius:t,height:e,radialSegments:n,heightSegments:r,openEnded:o,thetaStart:c,thetaLength:l}}function ts(t,e,n,r){pn.call(this),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},this.fromBufferGeometry(new es(t,e,n,r)),this.mergeVertices()}function es(t,e,n,r){Ue.call(this),this.type="CircleBufferGeometry",this.parameters={radius:t,segments:e,thetaStart:n,thetaLength:r},t=t||1,e=void 0!==e?Math.max(3,e):8,n=void 0!==n?n:0,r=void 0!==r?r:2*Math.PI;const o=[],c=[],l=[],h=[],d=new W,f=new D;c.push(0,0,0),l.push(0,0,1),h.push(.5,.5);for(let s=0,i=3;s<=e;s++,i+=3){const o=n+s/e*r;d.x=t*Math.cos(o),d.y=t*Math.sin(o),c.push(d.x,d.y,d.z),l.push(0,0,1),f.x=(c[i]/t+1)/2,f.y=(c[i+1]/t+1)/2,h.push(f.x,f.y)}for(let i=1;i<=e;i++)o.push(i,i+1,0);this.setIndex(o),this.setAttribute("position",new Re(c,3)),this.setAttribute("normal",new Re(l,3)),this.setAttribute("uv",new Re(h,2))}Ba.prototype=Object.create(pn.prototype),Ba.prototype.constructor=Ba,za.prototype=Object.create(ka.prototype),za.prototype.constructor=za,Ua.prototype=Object.create(pn.prototype),Ua.prototype.constructor=Ua,Va.prototype=Object.create(Ue.prototype),Va.prototype.constructor=Va,Ga.prototype=Object.create(pn.prototype),Ga.prototype.constructor=Ga,Ha.prototype=Object.create(Ue.prototype),Ha.prototype.constructor=Ha,ja.prototype=Object.create(pn.prototype),ja.prototype.constructor=ja,Wa.prototype=Object.create(Ue.prototype),Wa.prototype.constructor=Wa,qa.prototype=Object.create(pn.prototype),qa.prototype.constructor=qa,qa.prototype.toJSON=function(){const data=pn.prototype.toJSON.call(this);return Ya(this.parameters.shapes,data)},Xa.prototype=Object.create(Ue.prototype),Xa.prototype.constructor=Xa,Xa.prototype.toJSON=function(){const data=Ue.prototype.toJSON.call(this);return Ya(this.parameters.shapes,data)},Ka.prototype=Object.create(Ue.prototype),Ka.prototype.constructor=Ka,Ja.prototype=Object.create(pn.prototype),Ja.prototype.constructor=Ja,Za.prototype=Object.create(Ue.prototype),Za.prototype.constructor=Za,Qa.prototype=Object.create(Ja.prototype),Qa.prototype.constructor=Qa,$a.prototype=Object.create(Za.prototype),$a.prototype.constructor=$a,ts.prototype=Object.create(pn.prototype),ts.prototype.constructor=ts,es.prototype=Object.create(Ue.prototype),es.prototype.constructor=es;var ns=Object.freeze({__proto__:null,WireframeGeometry:Go,ParametricGeometry:Ho,ParametricBufferGeometry:jo,TetrahedronGeometry:Xo,TetrahedronBufferGeometry:Yo,OctahedronGeometry:Ko,OctahedronBufferGeometry:Jo,IcosahedronGeometry:Zo,IcosahedronBufferGeometry:Qo,DodecahedronGeometry:$o,DodecahedronBufferGeometry:ta,PolyhedronGeometry:Wo,PolyhedronBufferGeometry:qo,TubeGeometry:ea,TubeBufferGeometry:na,TorusKnotGeometry:ra,TorusKnotBufferGeometry:ia,TorusGeometry:oa,TorusBufferGeometry:aa,TextGeometry:Ba,TextBufferGeometry:za,SphereGeometry:Ua,SphereBufferGeometry:Va,RingGeometry:Ga,RingBufferGeometry:Ha,PlaneGeometry:Rn,PlaneBufferGeometry:In,LatheGeometry:ja,LatheBufferGeometry:Wa,ShapeGeometry:qa,ShapeBufferGeometry:Xa,ExtrudeGeometry:La,ExtrudeBufferGeometry:ka,EdgesGeometry:Ka,ConeGeometry:Qa,ConeBufferGeometry:$a,CylinderGeometry:Ja,CylinderBufferGeometry:Za,CircleGeometry:ts,CircleBufferGeometry:es,BoxGeometry:class extends pn{constructor(t,e,n,r,o,c){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:n,widthSegments:r,heightSegments:o,depthSegments:c},this.fromBufferGeometry(new dn(t,e,n,r,o,c)),this.mergeVertices()}},BoxBufferGeometry:dn});function rs(t){ve.call(this),this.type="ShadowMaterial",this.color=new he(0),this.transparent=!0,this.setValues(t)}function is(t){vn.call(this,t),this.type="RawShaderMaterial"}function os(t){ve.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new he(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new he(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=R,this.normalScale=new D(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(t)}function as(t){os.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new D(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,this.sheen=null,this.transparency=0,this.setValues(t)}function ss(t){ve.call(this),this.type="MeshPhongMaterial",this.color=new he(16777215),this.specular=new he(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new he(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=R,this.normalScale=new D(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function us(t){ve.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new he(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new he(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=R,this.normalScale=new D(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function cs(t){ve.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=R,this.normalScale=new D(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ls(t){ve.call(this),this.type="MeshLambertMaterial",this.color=new he(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new he(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function hs(t){ve.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new he(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=R,this.normalScale=new D(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(t)}function ps(t){bo.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}rs.prototype=Object.create(ve.prototype),rs.prototype.constructor=rs,rs.prototype.isShadowMaterial=!0,rs.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this},is.prototype=Object.create(vn.prototype),is.prototype.constructor=is,is.prototype.isRawShaderMaterial=!0,os.prototype=Object.create(ve.prototype),os.prototype.constructor=os,os.prototype.isMeshStandardMaterial=!0,os.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.defines={STANDARD:""},this.color.copy(source.color),this.roughness=source.roughness,this.metalness=source.metalness,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.roughnessMap=source.roughnessMap,this.metalnessMap=source.metalnessMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.envMapIntensity=source.envMapIntensity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this.vertexTangents=source.vertexTangents,this},as.prototype=Object.create(os.prototype),as.prototype.constructor=as,as.prototype.isMeshPhysicalMaterial=!0,as.prototype.copy=function(source){return os.prototype.copy.call(this,source),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=source.clearcoat,this.clearcoatMap=source.clearcoatMap,this.clearcoatRoughness=source.clearcoatRoughness,this.clearcoatRoughnessMap=source.clearcoatRoughnessMap,this.clearcoatNormalMap=source.clearcoatNormalMap,this.clearcoatNormalScale.copy(source.clearcoatNormalScale),this.reflectivity=source.reflectivity,source.sheen?this.sheen=(this.sheen||new he).copy(source.sheen):this.sheen=null,this.transparency=source.transparency,this},ss.prototype=Object.create(ve.prototype),ss.prototype.constructor=ss,ss.prototype.isMeshPhongMaterial=!0,ss.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.specular.copy(source.specular),this.shininess=source.shininess,this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},us.prototype=Object.create(ve.prototype),us.prototype.constructor=us,us.prototype.isMeshToonMaterial=!0,us.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.gradientMap=source.gradientMap,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.alphaMap=source.alphaMap,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},cs.prototype=Object.create(ve.prototype),cs.prototype.constructor=cs,cs.prototype.isMeshNormalMaterial=!0,cs.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},ls.prototype=Object.create(ve.prototype),ls.prototype.constructor=ls,ls.prototype.isMeshLambertMaterial=!0,ls.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.color.copy(source.color),this.map=source.map,this.lightMap=source.lightMap,this.lightMapIntensity=source.lightMapIntensity,this.aoMap=source.aoMap,this.aoMapIntensity=source.aoMapIntensity,this.emissive.copy(source.emissive),this.emissiveMap=source.emissiveMap,this.emissiveIntensity=source.emissiveIntensity,this.specularMap=source.specularMap,this.alphaMap=source.alphaMap,this.envMap=source.envMap,this.combine=source.combine,this.reflectivity=source.reflectivity,this.refractionRatio=source.refractionRatio,this.wireframe=source.wireframe,this.wireframeLinewidth=source.wireframeLinewidth,this.wireframeLinecap=source.wireframeLinecap,this.wireframeLinejoin=source.wireframeLinejoin,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},hs.prototype=Object.create(ve.prototype),hs.prototype.constructor=hs,hs.prototype.isMeshMatcapMaterial=!0,hs.prototype.copy=function(source){return ve.prototype.copy.call(this,source),this.defines={MATCAP:""},this.color.copy(source.color),this.matcap=source.matcap,this.map=source.map,this.bumpMap=source.bumpMap,this.bumpScale=source.bumpScale,this.normalMap=source.normalMap,this.normalMapType=source.normalMapType,this.normalScale.copy(source.normalScale),this.displacementMap=source.displacementMap,this.displacementScale=source.displacementScale,this.displacementBias=source.displacementBias,this.alphaMap=source.alphaMap,this.skinning=source.skinning,this.morphTargets=source.morphTargets,this.morphNormals=source.morphNormals,this},ps.prototype=Object.create(bo.prototype),ps.prototype.constructor=ps,ps.prototype.isLineDashedMaterial=!0,ps.prototype.copy=function(source){return bo.prototype.copy.call(this,source),this.scale=source.scale,this.dashSize=source.dashSize,this.gapSize=source.gapSize,this};var ds=Object.freeze({__proto__:null,ShadowMaterial:rs,SpriteMaterial:ji,RawShaderMaterial:is,ShaderMaterial:vn,PointsMaterial:No,MeshPhysicalMaterial:as,MeshStandardMaterial:os,MeshPhongMaterial:ss,MeshToonMaterial:us,MeshNormalMaterial:cs,MeshLambertMaterial:ls,MeshDepthMaterial:Ti,MeshDistanceMaterial:Ai,MeshBasicMaterial:ye,MeshMatcapMaterial:hs,LineDashedMaterial:ps,LineBasicMaterial:bo,Material:ve});const fs={arraySlice:function(t,e,n){return fs.isTypedArray(t)?new t.constructor(t.subarray(e,void 0!==n?n:t.length)):t.slice(e,n)},convertArray:function(t,e,n){return!t||!n&&t.constructor===e?t:"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t)},isTypedArray:function(object){return ArrayBuffer.isView(object)&&!(object instanceof DataView)},getKeyframeOrder:function(t){const e=t.length,n=new Array(e);for(let i=0;i!==e;++i)n[i]=i;return n.sort((function(i,e){return t[i]-t[e]})),n},sortedArray:function(t,e,n){const r=t.length,o=new t.constructor(r);for(let i=0,c=0;c!==r;++i){const r=n[i]*e;for(let n=0;n!==e;++n)o[c++]=t[r+n]}return o},flattenJSON:function(t,e,n,r){let i=1,o=t[0];for(;void 0!==o&&void 0===o[r];)o=t[i++];if(void 0===o)return;let c=o[r];if(void 0!==c)if(Array.isArray(c))do{c=o[r],void 0!==c&&(e.push(o.time),n.push.apply(n,c)),o=t[i++]}while(void 0!==o);else if(void 0!==c.toArray)do{c=o[r],void 0!==c&&(e.push(o.time),c.toArray(n,n.length)),o=t[i++]}while(void 0!==o);else do{c=o[r],void 0!==c&&(e.push(o.time),n.push(c)),o=t[i++]}while(void 0!==o)},subclip:function(t,e,n,r,o){o=o||30;const c=t.clone();c.name=e;const l=[];for(let i=0;i<c.tracks.length;++i){const track=c.tracks[i],t=track.getValueSize(),e=[],h=[];for(let c=0;c<track.times.length;++c){const l=track.times[c]*o;if(!(l<n||l>=r)){e.push(track.times[c]);for(let e=0;e<t;++e)h.push(track.values[c*t+e])}}0!==e.length&&(track.times=fs.convertArray(e,track.times.constructor),track.values=fs.convertArray(h,track.values.constructor),l.push(track))}c.tracks=l;let h=1/0;for(let i=0;i<c.tracks.length;++i)h>c.tracks[i].times[0]&&(h=c.tracks[i].times[0]);for(let i=0;i<c.tracks.length;++i)c.tracks[i].shift(-1*h);return c.resetDuration(),c},makeClipAdditive:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=t),(void 0===r||r<=0)&&(r=30);const o=t.tracks.length,c=e/r;for(let i=0;i<o;++i){const e=n.tracks[i],r=e.ValueTypeName;if("bool"===r||"string"===r)continue;const o=t.tracks.find((function(track){return track.name===e.name&&track.ValueTypeName===r}));if(void 0===o)continue;const l=e.getValueSize(),h=e.times.length-1;let d;if(c<=e.times[0])d=fs.arraySlice(e.values,0,e.valueSize);else if(c>=e.times[h]){const t=h*l;d=fs.arraySlice(e.values,t)}else{const t=e.createInterpolant();t.evaluate(c),d=t.resultBuffer}if("quaternion"===r){new G(d[0],d[1],d[2],d[3]).normalize().conjugate().toArray(d)}const f=o.times.length;for(let t=0;t<f;++t){const e=t*l;if("quaternion"===r)G.multiplyQuaternionsFlat(o.values,e,d,0,o.values,e);else for(let t=0;t<l;++t)o.values[e+t]-=d[t]}}return t.blendMode=2501,t}};function ms(t,e,n,r){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new e.constructor(n),this.sampleValues=e,this.valueSize=n}function gs(t,e,n,r){ms.call(this,t,e,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function vs(t,e,n,r){ms.call(this,t,e,n,r)}function ys(t,e,n,r){ms.call(this,t,e,n,r)}function xs(t,e,n,r){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=fs.convertArray(e,this.TimeBufferType),this.values=fs.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function bs(t,e,n){xs.call(this,t,e,n)}function ws(t,e,n,r){xs.call(this,t,e,n,r)}function _s(t,e,n,r){xs.call(this,t,e,n,r)}function Ss(t,e,n,r){ms.call(this,t,e,n,r)}function Ms(t,e,n,r){xs.call(this,t,e,n,r)}function Es(t,e,n,r){xs.call(this,t,e,n,r)}function Ts(t,e,n,r){xs.call(this,t,e,n,r)}function As(t,e,n,r){this.name=t,this.tracks=n,this.duration=void 0!==e?e:-1,this.blendMode=void 0!==r?r:2500,this.uuid=O.generateUUID(),this.duration<0&&this.resetDuration()}function Cs(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return _s;case"vector":case"vector2":case"vector3":case"vector4":return Ts;case"color":return ws;case"quaternion":return Ms;case"bool":case"boolean":return bs;case"string":return Es}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],n=[];fs.flattenJSON(t.keys,e,n,"value"),t.times=e,t.values=n}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}Object.assign(ms.prototype,{evaluate:function(t){let e=this.parameterPositions,n=this._cachedIndex,r=e[n],o=e[n-1];t:{e:{let c;n:{r:if(!(t<r)){for(let c=n+2;;){if(void 0===r){if(t<o)break r;return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,t,o)}if(n===c)break;if(o=r,r=e[++n],t<r)break e}c=e.length;break n}if(t>=o)break t;{const l=e[1];t<l&&(n=2,o=l);for(let c=n-2;;){if(void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(n===c)break;if(r=o,o=e[--n-1],t>=o)break e}c=n,n=0}}for(;n<c;){const r=n+c>>>1;t<e[r]?c=r:n=r+1}if(r=e[n],o=e[n-1],void 0===o)return this._cachedIndex=0,this.beforeStart_(0,t,r);if(void 0===r)return n=e.length,this._cachedIndex=n,this.afterEnd_(n-1,o,t)}this._cachedIndex=n,this.intervalChanged_(n,o,r)}return this.interpolate_(n,o,t,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(t){const e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=t*r;for(let i=0;i!==r;++i)e[i]=n[o+i];return e},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ms.prototype,{beforeStart_:ms.prototype.copySampleValue_,afterEnd_:ms.prototype.copySampleValue_}),gs.prototype=Object.assign(Object.create(ms.prototype),{constructor:gs,DefaultSettings_:{endingStart:2400,endingEnd:2400},intervalChanged_:function(t,e,n){let r=this.parameterPositions,o=t-2,c=t+1,l=r[o],h=r[c];if(void 0===l)switch(this.getSettings_().endingStart){case 2401:o=t,l=2*e-n;break;case 2402:o=r.length-2,l=e+r[o]-r[o+1];break;default:o=t,l=n}if(void 0===h)switch(this.getSettings_().endingEnd){case 2401:c=t,h=2*n-e;break;case 2402:c=1,h=n+r[1]-r[0];break;default:c=t-1,h=e}const d=.5*(n-e),f=this.valueSize;this._weightPrev=d/(e-l),this._weightNext=d/(h-n),this._offsetPrev=o*f,this._offsetNext=c*f},interpolate_:function(t,e,n,r){const o=this.resultBuffer,c=this.sampleValues,l=this.valueSize,h=t*l,d=h-l,f=this._offsetPrev,m=this._offsetNext,v=this._weightPrev,y=this._weightNext,p=(n-e)/(r-e),x=p*p,w=x*p,_=-v*w+2*v*x-v*p,S=(1+v)*w+(-1.5-2*v)*x+(-.5+v)*p+1,M=(-1-y)*w+(1.5+y)*x+.5*p,E=y*w-y*x;for(let i=0;i!==l;++i)o[i]=_*c[f+i]+S*c[d+i]+M*c[h+i]+E*c[m+i];return o}}),vs.prototype=Object.assign(Object.create(ms.prototype),{constructor:vs,interpolate_:function(t,e,n,r){const o=this.resultBuffer,c=this.sampleValues,l=this.valueSize,h=t*l,d=h-l,f=(n-e)/(r-e),m=1-f;for(let i=0;i!==l;++i)o[i]=c[d+i]*m+c[h+i]*f;return o}}),ys.prototype=Object.assign(Object.create(ms.prototype),{constructor:ys,interpolate_:function(t){return this.copySampleValue_(t-1)}}),Object.assign(xs,{toJSON:function(track){const t=track.constructor;let e;if(void 0!==t.toJSON)e=t.toJSON(track);else{e={name:track.name,times:fs.convertArray(track.times,Array),values:fs.convertArray(track.values,Array)};const t=track.getInterpolation();t!==track.DefaultInterpolation&&(e.interpolation=t)}return e.type=track.ValueTypeName,e}}),Object.assign(xs.prototype,{constructor:xs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:E,InterpolantFactoryMethodDiscrete:function(t){return new ys(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodLinear:function(t){return new vs(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:function(t){return new gs(this.times,this.values,this.getValueSize(),t)},setInterpolation:function(t){let e;switch(t){case M:e=this.InterpolantFactoryMethodDiscrete;break;case E:e=this.InterpolantFactoryMethodLinear;break;case 2302:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return M;case this.InterpolantFactoryMethodLinear:return E;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this},scale:function(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this},trim:function(t,e){const n=this.times,r=n.length;let o=0,c=r-1;for(;o!==r&&n[o]<t;)++o;for(;-1!==c&&n[c]>e;)--c;if(++c,0!==o||c!==r){o>=c&&(c=Math.max(c,1),o=c-1);const t=this.getValueSize();this.times=fs.arraySlice(n,o,c),this.values=fs.arraySlice(this.values,o*t,c*t)}return this},validate:function(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const n=this.times,r=this.values,o=n.length;0===o&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let c=null;for(let i=0;i!==o;i++){const e=n[i];if("number"==typeof e&&isNaN(e)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,e),t=!1;break}if(null!==c&&c>e){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,e,c),t=!1;break}c=e}if(void 0!==r&&fs.isTypedArray(r))for(let i=0,e=r.length;i!==e;++i){const e=r[i];if(isNaN(e)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,e),t=!1;break}}return t},optimize:function(){const t=fs.arraySlice(this.times),e=fs.arraySlice(this.values),n=this.getValueSize(),r=2302===this.getInterpolation(),o=t.length-1;let c=1;for(let i=1;i<o;++i){let o=!1;const time=t[i];if(time!==t[i+1]&&(1!==i||time!==time[0]))if(r)o=!0;else{const t=i*n,r=t-n,c=t+n;for(let l=0;l!==n;++l){const n=e[t+l];if(n!==e[r+l]||n!==e[c+l]){o=!0;break}}}if(o){if(i!==c){t[c]=t[i];const r=i*n,o=c*n;for(let t=0;t!==n;++t)e[o+t]=e[r+t]}++c}}if(o>0){t[c]=t[o];for(let t=o*n,r=c*n,l=0;l!==n;++l)e[r+l]=e[t+l];++c}return c!==t.length?(this.times=fs.arraySlice(t,0,c),this.values=fs.arraySlice(e,0,c*n)):(this.times=t,this.values=e),this},clone:function(){const t=fs.arraySlice(this.times,0),e=fs.arraySlice(this.values,0),track=new(0,this.constructor)(this.name,t,e);return track.createInterpolant=this.createInterpolant,track}}),bs.prototype=Object.assign(Object.create(xs.prototype),{constructor:bs,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:M,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ws.prototype=Object.assign(Object.create(xs.prototype),{constructor:ws,ValueTypeName:"color"}),_s.prototype=Object.assign(Object.create(xs.prototype),{constructor:_s,ValueTypeName:"number"}),Ss.prototype=Object.assign(Object.create(ms.prototype),{constructor:Ss,interpolate_:function(t,e,n,r){const o=this.resultBuffer,c=this.sampleValues,l=this.valueSize,h=(n-e)/(r-e);let d=t*l;for(let t=d+l;d!==t;d+=4)G.slerpFlat(o,0,c,d-l,c,d,h);return o}}),Ms.prototype=Object.assign(Object.create(xs.prototype),{constructor:Ms,ValueTypeName:"quaternion",DefaultInterpolation:E,InterpolantFactoryMethodLinear:function(t){return new Ss(this.times,this.values,this.getValueSize(),t)},InterpolantFactoryMethodSmooth:void 0}),Es.prototype=Object.assign(Object.create(xs.prototype),{constructor:Es,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:M,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Ts.prototype=Object.assign(Object.create(xs.prototype),{constructor:Ts,ValueTypeName:"vector"}),Object.assign(As,{parse:function(t){const e=[],n=t.tracks,r=1/(t.fps||1);for(let i=0,t=n.length;i!==t;++i)e.push(Cs(n[i]).scale(r));return new As(t.name,t.duration,e,t.blendMode)},toJSON:function(t){const e=[],n=t.tracks,r={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let i=0,t=n.length;i!==t;++i)e.push(xs.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(t,e,n,r){const o=e.length,c=[];for(let i=0;i<o;i++){let t=[],l=[];t.push((i+o-1)%o,i,(i+1)%o),l.push(0,1,0);const h=fs.getKeyframeOrder(t);t=fs.sortedArray(t,1,h),l=fs.sortedArray(l,1,h),r||0!==t[0]||(t.push(o),l.push(l[0])),c.push(new _s(".morphTargetInfluences["+e[i].name+"]",t,l).scale(1/n))}return new As(t,-1,c)},findByName:function(t,e){let n=t;if(!Array.isArray(t)){const e=t;n=e.geometry&&e.geometry.animations||e.animations}for(let i=0;i<n.length;i++)if(n[i].name===e)return n[i];return null},CreateClipsFromMorphTargetSequences:function(t,e,n){const r={},pattern=/^([\w-]*?)([\d]+)$/;for(let i=0,e=t.length;i<e;i++){const e=t[i],n=e.name.match(pattern);if(n&&n.length>1){const t=n[1];let o=r[t];o||(r[t]=o=[]),o.push(e)}}const o=[];for(const t in r)o.push(As.CreateFromMorphTargetSequence(t,r[t],e,n));return o},parseAnimation:function(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(t,e,n,r,o){if(0!==n.length){const c=[],l=[];fs.flattenJSON(n,c,l,r),0!==c.length&&o.push(new t(e,c,l))}},r=[],o=t.name||"default",c=t.fps||30,l=t.blendMode;let h=t.length||-1;const d=t.hierarchy||[];for(let t=0;t<d.length;t++){const o=d[t].keys;if(o&&0!==o.length)if(o[0].morphTargets){const t={};let e;for(e=0;e<o.length;e++)if(o[e].morphTargets)for(let n=0;n<o[e].morphTargets.length;n++)t[o[e].morphTargets[n]]=-1;for(const n in t){const t=[],c=[];for(let r=0;r!==o[e].morphTargets.length;++r){const r=o[e];t.push(r.time),c.push(r.morphTarget===n?1:0)}r.push(new _s(".morphTargetInfluence["+n+"]",t,c))}h=t.length*(c||1)}else{const c=".bones["+e[t].name+"]";n(Ts,c+".position",o,"pos",r),n(Ms,c+".quaternion",o,"rot",r),n(Ts,c+".scale",o,"scl",r)}}if(0===r.length)return null;return new As(o,h,r,l)}}),Object.assign(As.prototype,{resetDuration:function(){let t=0;for(let i=0,e=this.tracks.length;i!==e;++i){const track=this.tracks[i];t=Math.max(t,track.times[track.times.length-1])}return this.duration=t,this},trim:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].trim(0,this.duration);return this},validate:function(){let t=!0;for(let i=0;i<this.tracks.length;i++)t=t&&this.tracks[i].validate();return t},optimize:function(){for(let i=0;i<this.tracks.length;i++)this.tracks[i].optimize();return this},clone:function(){const t=[];for(let i=0;i<this.tracks.length;i++)t.push(this.tracks[i].clone());return new As(this.name,this.duration,t,this.blendMode)}});const Rs={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};function Is(t,e,n){const r=this;let o=!1,c=0,l=0,h=void 0;const d=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=n,this.itemStart=function(t){l++,!1===o&&void 0!==r.onStart&&r.onStart(t,c,l),o=!0},this.itemEnd=function(t){c++,void 0!==r.onProgress&&r.onProgress(t,c,l),c===l&&(o=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(t){void 0!==r.onError&&r.onError(t)},this.resolveURL=function(t){return h?h(t):t},this.setURLModifier=function(t){return h=t,this},this.addHandler=function(t,e){return d.push(t,e),this},this.removeHandler=function(t){const e=d.indexOf(t);return-1!==e&&d.splice(e,2),this},this.getHandler=function(t){for(let i=0,e=d.length;i<e;i+=2){const e=d[i],n=d[i+1];if(e.global&&(e.lastIndex=0),e.test(t))return n}return null}}const Ns=new Is;function Os(t){this.manager=void 0!==t?t:Ns,this.crossOrigin="anonymous",this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Os.prototype,{load:function(){},loadAsync:function(t,e){const n=this;return new Promise((function(r,o){n.load(t,r,e,o)}))},parse:function(){},setCrossOrigin:function(t){return this.crossOrigin=t,this},setPath:function(path){return this.path=path,this},setResourcePath:function(t){return this.resourcePath=t,this},setRequestHeader:function(t){return this.requestHeader=t,this}});const Ds={};function Ls(t){Os.call(this,t)}function ks(t){Os.call(this,t)}function Ps(t){Os.call(this,t)}function Fs(t){Os.call(this,t)}function Bs(t){Os.call(this,t)}function zs(t){Os.call(this,t)}function Us(t){Os.call(this,t)}function Vs(){this.type="Curve",this.arcLengthDivisions=200}function Gs(t,e,n,r,o,c,l,h){Vs.call(this),this.type="EllipseCurve",this.aX=t||0,this.aY=e||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=o||0,this.aEndAngle=c||2*Math.PI,this.aClockwise=l||!1,this.aRotation=h||0}function Hs(t,e,n,r,o,c){Gs.call(this,t,e,n,n,r,o,c),this.type="ArcCurve"}function js(){let t=0,e=0,n=0,r=0;function o(o,c,l,h){t=o,e=l,n=-3*o+3*c-2*l-h,r=2*o-2*c+l+h}return{initCatmullRom:function(t,e,n,r,c){o(e,n,c*(n-t),c*(r-e))},initNonuniformCatmullRom:function(t,e,n,r,c,l,h){let d=(e-t)/c-(n-t)/(c+l)+(n-e)/l,f=(n-e)/l-(r-e)/(l+h)+(r-n)/h;d*=l,f*=l,o(e,n,d,f)},calc:function(o){const c=o*o;return t+e*o+n*c+r*(c*o)}}}Ls.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ls,load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,c=Rs.get(t);if(void 0!==c)return o.manager.itemStart(t),setTimeout((function(){e&&e(c),o.manager.itemEnd(t)}),0),c;if(void 0!==Ds[t])return void Ds[t].push({onLoad:e,onProgress:n,onError:r});const l=t.match(/^data:(.*?)(;base64)?,(.*)$/);let h;if(l){const n=l[1],c=!!l[2];let data=l[3];data=decodeURIComponent(data),c&&(data=atob(data));try{let r;const c=(this.responseType||"").toLowerCase();switch(c){case"arraybuffer":case"blob":const view=new Uint8Array(data.length);for(let i=0;i<data.length;i++)view[i]=data.charCodeAt(i);r="blob"===c?new Blob([view.buffer],{type:n}):view.buffer;break;case"document":const t=new DOMParser;r=t.parseFromString(data,n);break;case"json":r=JSON.parse(data);break;default:r=data}setTimeout((function(){e&&e(r),o.manager.itemEnd(t)}),0)}catch(e){setTimeout((function(){r&&r(e),o.manager.itemError(t),o.manager.itemEnd(t)}),0)}}else{Ds[t]=[],Ds[t].push({onLoad:e,onProgress:n,onError:r}),h=new XMLHttpRequest,h.open("GET",t,!0),h.addEventListener("load",(function(e){const n=this.response,r=Ds[t];if(delete Ds[t],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),Rs.add(t,n);for(let i=0,t=r.length;i<t;i++){const t=r[i];t.onLoad&&t.onLoad(n)}o.manager.itemEnd(t)}else{for(let i=0,t=r.length;i<t;i++){const t=r[i];t.onError&&t.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}}),!1),h.addEventListener("progress",(function(e){const n=Ds[t];for(let i=0,t=n.length;i<t;i++){const t=n[i];t.onProgress&&t.onProgress(e)}}),!1),h.addEventListener("error",(function(e){const n=Ds[t];delete Ds[t];for(let i=0,t=n.length;i<t;i++){const t=n[i];t.onError&&t.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}),!1),h.addEventListener("abort",(function(e){const n=Ds[t];delete Ds[t];for(let i=0,t=n.length;i<t;i++){const t=n[i];t.onError&&t.onError(e)}o.manager.itemError(t),o.manager.itemEnd(t)}),!1),void 0!==this.responseType&&(h.responseType=this.responseType),void 0!==this.withCredentials&&(h.withCredentials=this.withCredentials),h.overrideMimeType&&h.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(const header in this.requestHeader)h.setRequestHeader(header,this.requestHeader[header]);h.send(null)}return o.manager.itemStart(t),h},setResponseType:function(t){return this.responseType=t,this},setWithCredentials:function(t){return this.withCredentials=t,this},setMimeType:function(t){return this.mimeType=t,this}}),ks.prototype=Object.assign(Object.create(Os.prototype),{constructor:ks,load:function(t,e,n,r){const o=this,c=new Ls(o.manager);c.setPath(o.path),c.load(t,(function(text){try{e(o.parse(JSON.parse(text)))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)},parse:function(t){const e=[];for(let i=0;i<t.length;i++){const n=As.parse(t[i]);e.push(n)}return e}}),Ps.prototype=Object.assign(Object.create(Os.prototype),{constructor:Ps,load:function(t,e,n,r){const o=this,c=[],l=new zo;l.image=c;const h=new Ls(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer");let d=0;function f(i){h.load(t[i],(function(t){const n=o.parse(t,!0);c[i]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},d+=1,6===d&&(1===n.mipmapCount&&(l.minFilter=v),l.format=n.format,l.needsUpdate=!0,e&&e(l))}),n,r)}if(Array.isArray(t))for(let i=0,e=t.length;i<e;++i)f(i);else h.load(t,(function(t){const n=o.parse(t,!0);if(n.isCubemap){const t=n.mipmaps.length/n.mipmapCount;for(let e=0;e<t;e++){c[e]={mipmaps:[]};for(let i=0;i<n.mipmapCount;i++)c[e].mipmaps.push(n.mipmaps[e*n.mipmapCount+i]),c[e].format=n.format,c[e].width=n.width,c[e].height=n.height}}else l.image.width=n.width,l.image.height=n.height,l.mipmaps=n.mipmaps;1===n.mipmapCount&&(l.minFilter=v),l.format=n.format,l.needsUpdate=!0,e&&e(l)}),n,r);return l}}),Fs.prototype=Object.assign(Object.create(Os.prototype),{constructor:Fs,load:function(t,e,n,r){const o=this,c=new _n,h=new Ls(this.manager);return h.setResponseType("arraybuffer"),h.setPath(this.path),h.load(t,(function(t){const n=o.parse(t);n&&(void 0!==n.image?c.image=n.image:void 0!==n.data&&(c.image.width=n.width,c.image.height=n.height,c.image.data=n.data),c.wrapS=void 0!==n.wrapS?n.wrapS:l,c.wrapT=void 0!==n.wrapT?n.wrapT:l,c.magFilter=void 0!==n.magFilter?n.magFilter:v,c.minFilter=void 0!==n.minFilter?n.minFilter:v,c.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(c.format=n.format),void 0!==n.type&&(c.type=n.type),void 0!==n.mipmaps&&(c.mipmaps=n.mipmaps,c.minFilter=x),1===n.mipmapCount&&(c.minFilter=v),c.needsUpdate=!0,e&&e(c,n))}),n,r),c}}),Bs.prototype=Object.assign(Object.create(Os.prototype),{constructor:Bs,load:function(t,e,n,r){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,c=Rs.get(t);if(void 0!==c)return o.manager.itemStart(t),setTimeout((function(){e&&e(c),o.manager.itemEnd(t)}),0),c;const image=document.createElementNS("http://www.w3.org/1999/xhtml","img");function l(){image.removeEventListener("load",l,!1),image.removeEventListener("error",h,!1),Rs.add(t,this),e&&e(this),o.manager.itemEnd(t)}function h(e){image.removeEventListener("load",l,!1),image.removeEventListener("error",h,!1),r&&r(e),o.manager.itemError(t),o.manager.itemEnd(t)}return image.addEventListener("load",l,!1),image.addEventListener("error",h,!1),"data:"!==t.substr(0,5)&&void 0!==this.crossOrigin&&(image.crossOrigin=this.crossOrigin),o.manager.itemStart(t),image.src=t,image}}),zs.prototype=Object.assign(Object.create(Os.prototype),{constructor:zs,load:function(t,e,n,r){const o=new qn,c=new Bs(this.manager);c.setCrossOrigin(this.crossOrigin),c.setPath(this.path);let l=0;function h(i){c.load(t[i],(function(image){o.images[i]=image,l++,6===l&&(o.needsUpdate=!0,e&&e(o))}),void 0,r)}for(let i=0;i<t.length;++i)h(i);return o}}),Us.prototype=Object.assign(Object.create(Os.prototype),{constructor:Us,load:function(t,e,n,r){const o=new B,c=new Bs(this.manager);return c.setCrossOrigin(this.crossOrigin),c.setPath(this.path),c.load(t,(function(image){o.image=image;const n=t.search(/\.jpe?g($|\?)/i)>0||0===t.search(/^data\:image\/jpeg/);o.format=n?w:_,o.needsUpdate=!0,void 0!==e&&e(o)}),n,r),o}}),Object.assign(Vs.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(u,t){const e=this.getUtoTmapping(u);return this.getPoint(e,t)},getPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPoint(n/t));return e},getSpacedPoints:function(t){void 0===t&&(t=5);const e=[];for(let n=0;n<=t;n++)e.push(this.getPointAt(n/t));return e},getLength:function(){const t=this.getLengths();return t[t.length-1]},getLengths:function(t){if(void 0===t&&(t=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let n,r=this.getPoint(0),o=0;e.push(0);for(let p=1;p<=t;p++)n=this.getPoint(p/t),o+=n.distanceTo(r),e.push(o),r=n;return this.cacheArcLengths=e,e},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(u,t){const e=this.getLengths();let n,i=0,r=e.length;n=t||u*e[r-1];let o,c=0,l=r-1;for(;c<=l;)if(i=Math.floor(c+(l-c)/2),o=e[i]-n,o<0)c=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(i=l,e[i]===n)return i/(r-1);const h=e[i];return(i+(n-h)/(e[i+1]-h))/(r-1)},getTangent:function(t,e){let n=t-1e-4,r=t+1e-4;n<0&&(n=0),r>1&&(r=1);const o=this.getPoint(n),c=this.getPoint(r),l=e||(o.isVector2?new D:new W);return l.copy(c).sub(o).normalize(),l},getTangentAt:function(u,t){const e=this.getUtoTmapping(u);return this.getTangent(e,t)},computeFrenetFrames:function(t,e){const n=new W,r=[],o=[],c=[],l=new W,h=new tt;for(let i=0;i<=t;i++){const u=i/t;r[i]=this.getTangentAt(u,new W),r[i].normalize()}o[0]=new W,c[0]=new W;let d=Number.MAX_VALUE;const f=Math.abs(r[0].x),m=Math.abs(r[0].y),v=Math.abs(r[0].z);f<=d&&(d=f,n.set(1,0,0)),m<=d&&(d=m,n.set(0,1,0)),v<=d&&n.set(0,0,1),l.crossVectors(r[0],n).normalize(),o[0].crossVectors(r[0],l),c[0].crossVectors(r[0],o[0]);for(let i=1;i<=t;i++){if(o[i]=o[i-1].clone(),c[i]=c[i-1].clone(),l.crossVectors(r[i-1],r[i]),l.length()>Number.EPSILON){l.normalize();const t=Math.acos(O.clamp(r[i-1].dot(r[i]),-1,1));o[i].applyMatrix4(h.makeRotationAxis(l,t))}c[i].crossVectors(r[i],o[i])}if(!0===e){let e=Math.acos(O.clamp(o[0].dot(o[t]),-1,1));e/=t,r[0].dot(l.crossVectors(o[0],o[t]))>0&&(e=-e);for(let i=1;i<=t;i++)o[i].applyMatrix4(h.makeRotationAxis(r[i],e*i)),c[i].crossVectors(r[i],o[i])}return{tangents:r,normals:o,binormals:c}},clone:function(){return(new this.constructor).copy(this)},copy:function(source){return this.arcLengthDivisions=source.arcLengthDivisions,this},toJSON:function(){const data={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return data.arcLengthDivisions=this.arcLengthDivisions,data.type=this.type,data},fromJSON:function(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}),Gs.prototype=Object.create(Vs.prototype),Gs.prototype.constructor=Gs,Gs.prototype.isEllipseCurve=!0,Gs.prototype.getPoint=function(t,e){const n=e||new D,r=2*Math.PI;let o=this.aEndAngle-this.aStartAngle;const c=Math.abs(o)<Number.EPSILON;for(;o<0;)o+=r;for(;o>r;)o-=r;o<Number.EPSILON&&(o=c?0:r),!0!==this.aClockwise||c||(o===r?o=-r:o-=r);const l=this.aStartAngle+t*o;let h=this.aX+this.xRadius*Math.cos(l),d=this.aY+this.yRadius*Math.sin(l);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),n=h-this.aX,r=d-this.aY;h=n*t-r*e+this.aX,d=n*e+r*t+this.aY}return n.set(h,d)},Gs.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.aX=source.aX,this.aY=source.aY,this.xRadius=source.xRadius,this.yRadius=source.yRadius,this.aStartAngle=source.aStartAngle,this.aEndAngle=source.aEndAngle,this.aClockwise=source.aClockwise,this.aRotation=source.aRotation,this},Gs.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.aX=this.aX,data.aY=this.aY,data.xRadius=this.xRadius,data.yRadius=this.yRadius,data.aStartAngle=this.aStartAngle,data.aEndAngle=this.aEndAngle,data.aClockwise=this.aClockwise,data.aRotation=this.aRotation,data},Gs.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this},Hs.prototype=Object.create(Gs.prototype),Hs.prototype.constructor=Hs,Hs.prototype.isArcCurve=!0;const Ws=new W,qs=new js,Xs=new js,Ys=new js;function Ks(t,e,n,r){Vs.call(this),this.type="CatmullRomCurve3",this.points=t||[],this.closed=e||!1,this.curveType=n||"centripetal",this.tension=r||.5}function Js(t,e,n,r,o){const c=.5*(r-e),l=.5*(o-n),h=t*t;return(2*n-2*r+c+l)*(t*h)+(-3*n+3*r-2*c-l)*h+c*t+n}function Zs(t,e,n,r){return function(t,p){const e=1-t;return e*e*p}(t,e)+function(t,p){return 2*(1-t)*t*p}(t,n)+function(t,p){return t*t*p}(t,r)}function Qs(t,e,n,r,o){return function(t,p){const e=1-t;return e*e*e*p}(t,e)+function(t,p){const e=1-t;return 3*e*e*t*p}(t,n)+function(t,p){return 3*(1-t)*t*t*p}(t,r)+function(t,p){return t*t*t*p}(t,o)}function $s(t,e,n,r){Vs.call(this),this.type="CubicBezierCurve",this.v0=t||new D,this.v1=e||new D,this.v2=n||new D,this.v3=r||new D}function tu(t,e,n,r){Vs.call(this),this.type="CubicBezierCurve3",this.v0=t||new W,this.v1=e||new W,this.v2=n||new W,this.v3=r||new W}function eu(t,e){Vs.call(this),this.type="LineCurve",this.v1=t||new D,this.v2=e||new D}function nu(t,e){Vs.call(this),this.type="LineCurve3",this.v1=t||new W,this.v2=e||new W}function ru(t,e,n){Vs.call(this),this.type="QuadraticBezierCurve",this.v0=t||new D,this.v1=e||new D,this.v2=n||new D}function iu(t,e,n){Vs.call(this),this.type="QuadraticBezierCurve3",this.v0=t||new W,this.v1=e||new W,this.v2=n||new W}function ou(t){Vs.call(this),this.type="SplineCurve",this.points=t||[]}Ks.prototype=Object.create(Vs.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isCatmullRomCurve3=!0,Ks.prototype.getPoint=function(t,e){const n=e||new W,r=this.points,o=r.length,p=(o-(this.closed?0:1))*t;let c,l,h,d,f=Math.floor(p),m=p-f;if(this.closed?f+=f>0?0:(Math.floor(Math.abs(f)/o)+1)*o:0===m&&f===o-1&&(f=o-2,m=1),this.closed||f>0?c=r[(f-1)%o]:(Ws.subVectors(r[0],r[1]).add(r[0]),c=Ws),l=r[f%o],h=r[(f+1)%o],this.closed||f+2<o?d=r[(f+2)%o]:(Ws.subVectors(r[o-1],r[o-2]).add(r[o-1]),d=Ws),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(c.distanceToSquared(l),t),n=Math.pow(l.distanceToSquared(h),t),r=Math.pow(h.distanceToSquared(d),t);n<1e-4&&(n=1),e<1e-4&&(e=n),r<1e-4&&(r=n),qs.initNonuniformCatmullRom(c.x,l.x,h.x,d.x,e,n,r),Xs.initNonuniformCatmullRom(c.y,l.y,h.y,d.y,e,n,r),Ys.initNonuniformCatmullRom(c.z,l.z,h.z,d.z,e,n,r)}else"catmullrom"===this.curveType&&(qs.initCatmullRom(c.x,l.x,h.x,d.x,this.tension),Xs.initCatmullRom(c.y,l.y,h.y,d.y,this.tension),Ys.initCatmullRom(c.z,l.z,h.z,d.z,this.tension));return n.set(qs.calc(m),Xs.calc(m),Ys.calc(m)),n},Ks.prototype.copy=function(source){Vs.prototype.copy.call(this,source),this.points=[];for(let i=0,t=source.points.length;i<t;i++){const t=source.points[i];this.points.push(t.clone())}return this.closed=source.closed,this.curveType=source.curveType,this.tension=source.tension,this},Ks.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);data.points=[];for(let i=0,t=this.points.length;i<t;i++){const t=this.points[i];data.points.push(t.toArray())}return data.closed=this.closed,data.curveType=this.curveType,data.tension=this.tension,data},Ks.prototype.fromJSON=function(t){Vs.prototype.fromJSON.call(this,t),this.points=[];for(let i=0,e=t.points.length;i<e;i++){const e=t.points[i];this.points.push((new W).fromArray(e))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this},$s.prototype=Object.create(Vs.prototype),$s.prototype.constructor=$s,$s.prototype.isCubicBezierCurve=!0,$s.prototype.getPoint=function(t,e){const n=e||new D,r=this.v0,o=this.v1,c=this.v2,l=this.v3;return n.set(Qs(t,r.x,o.x,c.x,l.x),Qs(t,r.y,o.y,c.y,l.y)),n},$s.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},$s.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},$s.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},tu.prototype=Object.create(Vs.prototype),tu.prototype.constructor=tu,tu.prototype.isCubicBezierCurve3=!0,tu.prototype.getPoint=function(t,e){const n=e||new W,r=this.v0,o=this.v1,c=this.v2,l=this.v3;return n.set(Qs(t,r.x,o.x,c.x,l.x),Qs(t,r.y,o.y,c.y,l.y),Qs(t,r.z,o.z,c.z,l.z)),n},tu.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this.v3.copy(source.v3),this},tu.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data.v3=this.v3.toArray(),data},tu.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this},eu.prototype=Object.create(Vs.prototype),eu.prototype.constructor=eu,eu.prototype.isLineCurve=!0,eu.prototype.getPoint=function(t,e){const n=e||new D;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},eu.prototype.getPointAt=function(u,t){return this.getPoint(u,t)},eu.prototype.getTangent=function(t,e){const n=e||new D;return n.copy(this.v2).sub(this.v1).normalize(),n},eu.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},eu.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},eu.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},nu.prototype=Object.create(Vs.prototype),nu.prototype.constructor=nu,nu.prototype.isLineCurve3=!0,nu.prototype.getPoint=function(t,e){const n=e||new W;return 1===t?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(t).add(this.v1)),n},nu.prototype.getPointAt=function(u,t){return this.getPoint(u,t)},nu.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v1.copy(source.v1),this.v2.copy(source.v2),this},nu.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},nu.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ru.prototype=Object.create(Vs.prototype),ru.prototype.constructor=ru,ru.prototype.isQuadraticBezierCurve=!0,ru.prototype.getPoint=function(t,e){const n=e||new D,r=this.v0,o=this.v1,c=this.v2;return n.set(Zs(t,r.x,o.x,c.x),Zs(t,r.y,o.y,c.y)),n},ru.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},ru.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},ru.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},iu.prototype=Object.create(Vs.prototype),iu.prototype.constructor=iu,iu.prototype.isQuadraticBezierCurve3=!0,iu.prototype.getPoint=function(t,e){const n=e||new W,r=this.v0,o=this.v1,c=this.v2;return n.set(Zs(t,r.x,o.x,c.x),Zs(t,r.y,o.y,c.y),Zs(t,r.z,o.z,c.z)),n},iu.prototype.copy=function(source){return Vs.prototype.copy.call(this,source),this.v0.copy(source.v0),this.v1.copy(source.v1),this.v2.copy(source.v2),this},iu.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);return data.v0=this.v0.toArray(),data.v1=this.v1.toArray(),data.v2=this.v2.toArray(),data},iu.prototype.fromJSON=function(t){return Vs.prototype.fromJSON.call(this,t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this},ou.prototype=Object.create(Vs.prototype),ou.prototype.constructor=ou,ou.prototype.isSplineCurve=!0,ou.prototype.getPoint=function(t,e){const n=e||new D,r=this.points,p=(r.length-1)*t,o=Math.floor(p),c=p-o,l=r[0===o?o:o-1],h=r[o],d=r[o>r.length-2?r.length-1:o+1],f=r[o>r.length-3?r.length-1:o+2];return n.set(Js(c,l.x,h.x,d.x,f.x),Js(c,l.y,h.y,d.y,f.y)),n},ou.prototype.copy=function(source){Vs.prototype.copy.call(this,source),this.points=[];for(let i=0,t=source.points.length;i<t;i++){const t=source.points[i];this.points.push(t.clone())}return this},ou.prototype.toJSON=function(){const data=Vs.prototype.toJSON.call(this);data.points=[];for(let i=0,t=this.points.length;i<t;i++){const t=this.points[i];data.points.push(t.toArray())}return data},ou.prototype.fromJSON=function(t){Vs.prototype.fromJSON.call(this,t),this.points=[];for(let i=0,e=t.points.length;i<e;i++){const e=t.points[i];this.points.push((new D).fromArray(e))}return this};var au=Object.freeze({__proto__:null,ArcCurve:Hs,CatmullRomCurve3:Ks,CubicBezierCurve:$s,CubicBezierCurve3:tu,EllipseCurve:Gs,LineCurve:eu,LineCurve3:nu,QuadraticBezierCurve:ru,QuadraticBezierCurve3:iu,SplineCurve:ou});function su(){Vs.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function uu(t){su.call(this),this.type="Path",this.currentPoint=new D,t&&this.setFromPoints(t)}function cu(t){uu.call(this,t),this.uuid=O.generateUUID(),this.type="Shape",this.holes=[]}function lu(t,e){bt.call(this),this.type="Light",this.color=new he(t),this.intensity=void 0!==e?e:1,this.receiveShadow=void 0}function hu(t,e,n){lu.call(this,t,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(bt.DefaultUp),this.updateMatrix(),this.groundColor=new he(e)}function pu(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new D(512,512),this.map=null,this.mapPass=null,this.matrix=new tt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new En,this._frameExtents=new D(1,1),this._viewportCount=1,this._viewports=[new z(0,0,1,1)]}function du(){pu.call(this,new xn(50,1,.5,500))}function fu(t,e,n,r,o,c){lu.call(this,t,e),this.type="SpotLight",this.position.copy(bt.DefaultUp),this.updateMatrix(),this.target=new bt,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(t){this.intensity=t/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==o?o:0,this.decay=void 0!==c?c:1,this.shadow=new du}function mu(){pu.call(this,new xn(90,1,.5,500)),this._frameExtents=new D(4,2),this._viewportCount=6,this._viewports=[new z(2,1,1,1),new z(0,1,1,1),new z(3,1,1,1),new z(1,1,1,1),new z(3,0,1,1),new z(1,0,1,1)],this._cubeDirections=[new W(1,0,0),new W(-1,0,0),new W(0,0,1),new W(0,0,-1),new W(0,1,0),new W(0,-1,0)],this._cubeUps=[new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,1,0),new W(0,0,1),new W(0,0,-1)]}function gu(t,e,n,r){lu.call(this,t,e),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(t){this.intensity=t/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new mu}function vu(t,e,n,r,o,c){yn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=void 0!==t?t:-1,this.right=void 0!==e?e:1,this.top=void 0!==n?n:1,this.bottom=void 0!==r?r:-1,this.near=void 0!==o?o:.1,this.far=void 0!==c?c:2e3,this.updateProjectionMatrix()}function yu(){pu.call(this,new vu(-5,5,5,-5,.5,500))}function xu(t,e){lu.call(this,t,e),this.type="DirectionalLight",this.position.copy(bt.DefaultUp),this.updateMatrix(),this.target=new bt,this.shadow=new yu}function bu(t,e){lu.call(this,t,e),this.type="AmbientLight",this.castShadow=void 0}function wu(t,e,n,r){lu.call(this,t,e),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}function _u(){this.coefficients=[];for(let i=0;i<9;i++)this.coefficients.push(new W)}function Su(t,e){lu.call(this,void 0,e),this.type="LightProbe",this.sh=void 0!==t?t:new _u}function Mu(t){Os.call(this,t),this.textures={}}su.prototype=Object.assign(Object.create(Vs.prototype),{constructor:su,add:function(t){this.curves.push(t)},closePath:function(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);t.equals(e)||this.curves.push(new eu(e,t))},getPoint:function(t){const e=t*this.getLength(),n=this.getCurveLengths();let i=0;for(;i<n.length;){if(n[i]>=e){const t=n[i]-e,r=this.curves[i],o=r.getLength(),u=0===o?0:1-t/o;return r.getPointAt(u)}i++}return null},getLength:function(){const t=this.getCurveLengths();return t[t.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t},getSpacedPoints:function(t){void 0===t&&(t=40);const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e},getPoints:function(t){t=t||12;const e=[];let n;for(let i=0,r=this.curves;i<r.length;i++){const o=r[i],c=o&&o.isEllipseCurve?2*t:o&&(o.isLineCurve||o.isLineCurve3)?1:o&&o.isSplineCurve?t*o.points.length:t,l=o.getPoints(c);for(let t=0;t<l.length;t++){const r=l[t];n&&n.equals(r)||(e.push(r),n=r)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e},copy:function(source){Vs.prototype.copy.call(this,source),this.curves=[];for(let i=0,t=source.curves.length;i<t;i++){const t=source.curves[i];this.curves.push(t.clone())}return this.autoClose=source.autoClose,this},toJSON:function(){const data=Vs.prototype.toJSON.call(this);data.autoClose=this.autoClose,data.curves=[];for(let i=0,t=this.curves.length;i<t;i++){const t=this.curves[i];data.curves.push(t.toJSON())}return data},fromJSON:function(t){Vs.prototype.fromJSON.call(this,t),this.autoClose=t.autoClose,this.curves=[];for(let i=0,e=t.curves.length;i<e;i++){const e=t.curves[i];this.curves.push((new au[e.type]).fromJSON(e))}return this}}),uu.prototype=Object.assign(Object.create(su.prototype),{constructor:uu,setFromPoints:function(t){this.moveTo(t[0].x,t[0].y);for(let i=1,e=t.length;i<e;i++)this.lineTo(t[i].x,t[i].y);return this},moveTo:function(t,e){return this.currentPoint.set(t,e),this},lineTo:function(t,e){const n=new eu(this.currentPoint.clone(),new D(t,e));return this.curves.push(n),this.currentPoint.set(t,e),this},quadraticCurveTo:function(t,e,n,r){const o=new ru(this.currentPoint.clone(),new D(t,e),new D(n,r));return this.curves.push(o),this.currentPoint.set(n,r),this},bezierCurveTo:function(t,e,n,r,o,c){const l=new $s(this.currentPoint.clone(),new D(t,e),new D(n,r),new D(o,c));return this.curves.push(l),this.currentPoint.set(o,c),this},splineThru:function(t){const e=new ou([this.currentPoint.clone()].concat(t));return this.curves.push(e),this.currentPoint.copy(t[t.length-1]),this},arc:function(t,e,n,r,o,c){const l=this.currentPoint.x,h=this.currentPoint.y;return this.absarc(t+l,e+h,n,r,o,c),this},absarc:function(t,e,n,r,o,c){return this.absellipse(t,e,n,n,r,o,c),this},ellipse:function(t,e,n,r,o,c,l,h){const d=this.currentPoint.x,f=this.currentPoint.y;return this.absellipse(t+d,e+f,n,r,o,c,l,h),this},absellipse:function(t,e,n,r,o,c,l,h){const d=new Gs(t,e,n,r,o,c,l,h);if(this.curves.length>0){const t=d.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(d);const f=d.getPoint(1);return this.currentPoint.copy(f),this},copy:function(source){return su.prototype.copy.call(this,source),this.currentPoint.copy(source.currentPoint),this},toJSON:function(){const data=su.prototype.toJSON.call(this);return data.currentPoint=this.currentPoint.toArray(),data},fromJSON:function(t){return su.prototype.fromJSON.call(this,t),this.currentPoint.fromArray(t.currentPoint),this}}),cu.prototype=Object.assign(Object.create(uu.prototype),{constructor:cu,getPointsHoles:function(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e},extractPoints:function(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}},copy:function(source){uu.prototype.copy.call(this,source),this.holes=[];for(let i=0,t=source.holes.length;i<t;i++){const t=source.holes[i];this.holes.push(t.clone())}return this},toJSON:function(){const data=uu.prototype.toJSON.call(this);data.uuid=this.uuid,data.holes=[];for(let i=0,t=this.holes.length;i<t;i++){const t=this.holes[i];data.holes.push(t.toJSON())}return data},fromJSON:function(t){uu.prototype.fromJSON.call(this,t),this.uuid=t.uuid,this.holes=[];for(let i=0,e=t.holes.length;i<e;i++){const e=t.holes[i];this.holes.push((new uu).fromJSON(e))}return this}}),lu.prototype=Object.assign(Object.create(bt.prototype),{constructor:lu,isLight:!0,copy:function(source){return bt.prototype.copy.call(this,source),this.color.copy(source.color),this.intensity=source.intensity,this},toJSON:function(meta){const data=bt.prototype.toJSON.call(this,meta);return data.object.color=this.color.getHex(),data.object.intensity=this.intensity,void 0!==this.groundColor&&(data.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(data.object.distance=this.distance),void 0!==this.angle&&(data.object.angle=this.angle),void 0!==this.decay&&(data.object.decay=this.decay),void 0!==this.penumbra&&(data.object.penumbra=this.penumbra),void 0!==this.shadow&&(data.object.shadow=this.shadow.toJSON()),data}}),hu.prototype=Object.assign(Object.create(lu.prototype),{constructor:hu,isHemisphereLight:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.groundColor.copy(source.groundColor),this}}),Object.assign(pu.prototype,{_projScreenMatrix:new tt,_lightPositionWorld:new W,_lookTarget:new W,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(t){const e=this.camera,n=this.matrix,r=this._projScreenMatrix,o=this._lookTarget,c=this._lightPositionWorld;c.setFromMatrixPosition(t.matrixWorld),e.position.copy(c),o.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(o),e.updateMatrixWorld(),r.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(e.projectionMatrix),n.multiply(e.matrixWorldInverse)},getViewport:function(t){return this._viewports[t]},getFrameExtents:function(){return this._frameExtents},copy:function(source){return this.camera=source.camera.clone(),this.bias=source.bias,this.radius=source.radius,this.mapSize.copy(source.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const object={};return 0!==this.bias&&(object.bias=this.bias),0!==this.normalBias&&(object.normalBias=this.normalBias),1!==this.radius&&(object.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(object.mapSize=this.mapSize.toArray()),object.camera=this.camera.toJSON(!1).object,delete object.camera.matrix,object}}),du.prototype=Object.assign(Object.create(pu.prototype),{constructor:du,isSpotLightShadow:!0,updateMatrices:function(t){const e=this.camera,n=2*O.RAD2DEG*t.angle,r=this.mapSize.width/this.mapSize.height,o=t.distance||e.far;n===e.fov&&r===e.aspect&&o===e.far||(e.fov=n,e.aspect=r,e.far=o,e.updateProjectionMatrix()),pu.prototype.updateMatrices.call(this,t)}}),fu.prototype=Object.assign(Object.create(lu.prototype),{constructor:fu,isSpotLight:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.distance=source.distance,this.angle=source.angle,this.penumbra=source.penumbra,this.decay=source.decay,this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),mu.prototype=Object.assign(Object.create(pu.prototype),{constructor:mu,isPointLightShadow:!0,updateMatrices:function(t,e){void 0===e&&(e=0);const n=this.camera,r=this.matrix,o=this._lightPositionWorld,c=this._lookTarget,l=this._projScreenMatrix;o.setFromMatrixPosition(t.matrixWorld),n.position.copy(o),c.copy(n.position),c.add(this._cubeDirections[e]),n.up.copy(this._cubeUps[e]),n.lookAt(c),n.updateMatrixWorld(),r.makeTranslation(-o.x,-o.y,-o.z),l.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(l)}}),gu.prototype=Object.assign(Object.create(lu.prototype),{constructor:gu,isPointLight:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.distance=source.distance,this.decay=source.decay,this.shadow=source.shadow.clone(),this}}),vu.prototype=Object.assign(Object.create(yn.prototype),{constructor:vu,isOrthographicCamera:!0,copy:function(source,t){return yn.prototype.copy.call(this,source,t),this.left=source.left,this.right=source.right,this.top=source.top,this.bottom=source.bottom,this.near=source.near,this.far=source.far,this.zoom=source.zoom,this.view=null===source.view?null:Object.assign({},source.view),this},setViewOffset:function(t,e,n,r,o,c){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=n,this.view.offsetY=r,this.view.width=o,this.view.height=c,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let o=n-t,c=n+t,l=r+e,h=r-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=t*this.view.offsetX,c=o+t*this.view.width,l-=e*this.view.offsetY,h=l-e*this.view.height}this.projectionMatrix.makeOrthographic(o,c,l,h,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(meta){const data=bt.prototype.toJSON.call(this,meta);return data.object.zoom=this.zoom,data.object.left=this.left,data.object.right=this.right,data.object.top=this.top,data.object.bottom=this.bottom,data.object.near=this.near,data.object.far=this.far,null!==this.view&&(data.object.view=Object.assign({},this.view)),data}}),yu.prototype=Object.assign(Object.create(pu.prototype),{constructor:yu,isDirectionalLightShadow:!0,updateMatrices:function(t){pu.prototype.updateMatrices.call(this,t)}}),xu.prototype=Object.assign(Object.create(lu.prototype),{constructor:xu,isDirectionalLight:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.target=source.target.clone(),this.shadow=source.shadow.clone(),this}}),bu.prototype=Object.assign(Object.create(lu.prototype),{constructor:bu,isAmbientLight:!0}),wu.prototype=Object.assign(Object.create(lu.prototype),{constructor:wu,isRectAreaLight:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.width=source.width,this.height=source.height,this},toJSON:function(meta){const data=lu.prototype.toJSON.call(this,meta);return data.object.width=this.width,data.object.height=this.height,data}}),Object.assign(_u.prototype,{isSphericalHarmonics3:!0,set:function(t){for(let i=0;i<9;i++)this.coefficients[i].copy(t[i]);return this},zero:function(){for(let i=0;i<9;i++)this.coefficients[i].set(0,0,0);return this},getAt:function(t,e){const n=t.x,r=t.y,o=t.z,c=this.coefficients;return e.copy(c[0]).multiplyScalar(.282095),e.addScaledVector(c[1],.488603*r),e.addScaledVector(c[2],.488603*o),e.addScaledVector(c[3],.488603*n),e.addScaledVector(c[4],n*r*1.092548),e.addScaledVector(c[5],r*o*1.092548),e.addScaledVector(c[6],.315392*(3*o*o-1)),e.addScaledVector(c[7],n*o*1.092548),e.addScaledVector(c[8],.546274*(n*n-r*r)),e},getIrradianceAt:function(t,e){const n=t.x,r=t.y,o=t.z,c=this.coefficients;return e.copy(c[0]).multiplyScalar(.886227),e.addScaledVector(c[1],1.023328*r),e.addScaledVector(c[2],1.023328*o),e.addScaledVector(c[3],1.023328*n),e.addScaledVector(c[4],.858086*n*r),e.addScaledVector(c[5],.858086*r*o),e.addScaledVector(c[6],.743125*o*o-.247708),e.addScaledVector(c[7],.858086*n*o),e.addScaledVector(c[8],.429043*(n*n-r*r)),e},add:function(t){for(let i=0;i<9;i++)this.coefficients[i].add(t.coefficients[i]);return this},addScaledSH:function(t,s){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(t.coefficients[i],s);return this},scale:function(s){for(let i=0;i<9;i++)this.coefficients[i].multiplyScalar(s);return this},lerp:function(t,e){for(let i=0;i<9;i++)this.coefficients[i].lerp(t.coefficients[i],e);return this},equals:function(t){for(let i=0;i<9;i++)if(!this.coefficients[i].equals(t.coefficients[i]))return!1;return!0},copy:function(t){return this.set(t.coefficients)},clone:function(){return(new this.constructor).copy(this)},fromArray:function(t,e){void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(t,e+3*i);return this},toArray:function(t,e){void 0===t&&(t=[]),void 0===e&&(e=0);const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(t,e+3*i);return t}}),Object.assign(_u,{getBasisAt:function(t,e){const n=t.x,r=t.y,o=t.z;e[0]=.282095,e[1]=.488603*r,e[2]=.488603*o,e[3]=.488603*n,e[4]=1.092548*n*r,e[5]=1.092548*r*o,e[6]=.315392*(3*o*o-1),e[7]=1.092548*n*o,e[8]=.546274*(n*n-r*r)}}),Su.prototype=Object.assign(Object.create(lu.prototype),{constructor:Su,isLightProbe:!0,copy:function(source){return lu.prototype.copy.call(this,source),this.sh.copy(source.sh),this},fromJSON:function(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this},toJSON:function(meta){const data=lu.prototype.toJSON.call(this,meta);return data.object.sh=this.sh.toArray(),data}}),Mu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Mu,load:function(t,e,n,r){const o=this,c=new Ls(o.manager);c.setPath(o.path),c.load(t,(function(text){try{e(o.parse(JSON.parse(text)))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)},parse:function(t){const e=this.textures;function n(t){return void 0===e[t]&&console.warn("THREE.MaterialLoader: Undefined texture",t),e[t]}const r=new ds[t.type];if(void 0!==t.uuid&&(r.uuid=t.uuid),void 0!==t.name&&(r.name=t.name),void 0!==t.color&&r.color.setHex(t.color),void 0!==t.roughness&&(r.roughness=t.roughness),void 0!==t.metalness&&(r.metalness=t.metalness),void 0!==t.sheen&&(r.sheen=(new he).setHex(t.sheen)),void 0!==t.emissive&&r.emissive.setHex(t.emissive),void 0!==t.specular&&r.specular.setHex(t.specular),void 0!==t.shininess&&(r.shininess=t.shininess),void 0!==t.clearcoat&&(r.clearcoat=t.clearcoat),void 0!==t.clearcoatRoughness&&(r.clearcoatRoughness=t.clearcoatRoughness),void 0!==t.fog&&(r.fog=t.fog),void 0!==t.flatShading&&(r.flatShading=t.flatShading),void 0!==t.blending&&(r.blending=t.blending),void 0!==t.combine&&(r.combine=t.combine),void 0!==t.side&&(r.side=t.side),void 0!==t.opacity&&(r.opacity=t.opacity),void 0!==t.transparent&&(r.transparent=t.transparent),void 0!==t.alphaTest&&(r.alphaTest=t.alphaTest),void 0!==t.depthTest&&(r.depthTest=t.depthTest),void 0!==t.depthWrite&&(r.depthWrite=t.depthWrite),void 0!==t.colorWrite&&(r.colorWrite=t.colorWrite),void 0!==t.stencilWrite&&(r.stencilWrite=t.stencilWrite),void 0!==t.stencilWriteMask&&(r.stencilWriteMask=t.stencilWriteMask),void 0!==t.stencilFunc&&(r.stencilFunc=t.stencilFunc),void 0!==t.stencilRef&&(r.stencilRef=t.stencilRef),void 0!==t.stencilFuncMask&&(r.stencilFuncMask=t.stencilFuncMask),void 0!==t.stencilFail&&(r.stencilFail=t.stencilFail),void 0!==t.stencilZFail&&(r.stencilZFail=t.stencilZFail),void 0!==t.stencilZPass&&(r.stencilZPass=t.stencilZPass),void 0!==t.wireframe&&(r.wireframe=t.wireframe),void 0!==t.wireframeLinewidth&&(r.wireframeLinewidth=t.wireframeLinewidth),void 0!==t.wireframeLinecap&&(r.wireframeLinecap=t.wireframeLinecap),void 0!==t.wireframeLinejoin&&(r.wireframeLinejoin=t.wireframeLinejoin),void 0!==t.rotation&&(r.rotation=t.rotation),1!==t.linewidth&&(r.linewidth=t.linewidth),void 0!==t.dashSize&&(r.dashSize=t.dashSize),void 0!==t.gapSize&&(r.gapSize=t.gapSize),void 0!==t.scale&&(r.scale=t.scale),void 0!==t.polygonOffset&&(r.polygonOffset=t.polygonOffset),void 0!==t.polygonOffsetFactor&&(r.polygonOffsetFactor=t.polygonOffsetFactor),void 0!==t.polygonOffsetUnits&&(r.polygonOffsetUnits=t.polygonOffsetUnits),void 0!==t.skinning&&(r.skinning=t.skinning),void 0!==t.morphTargets&&(r.morphTargets=t.morphTargets),void 0!==t.morphNormals&&(r.morphNormals=t.morphNormals),void 0!==t.dithering&&(r.dithering=t.dithering),void 0!==t.vertexTangents&&(r.vertexTangents=t.vertexTangents),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.toneMapped&&(r.toneMapped=t.toneMapped),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.vertexColors&&("number"==typeof t.vertexColors?r.vertexColors=t.vertexColors>0:r.vertexColors=t.vertexColors),void 0!==t.uniforms)for(const e in t.uniforms){const o=t.uniforms[e];switch(r.uniforms[e]={},o.type){case"t":r.uniforms[e].value=n(o.value);break;case"c":r.uniforms[e].value=(new he).setHex(o.value);break;case"v2":r.uniforms[e].value=(new D).fromArray(o.value);break;case"v3":r.uniforms[e].value=(new W).fromArray(o.value);break;case"v4":r.uniforms[e].value=(new z).fromArray(o.value);break;case"m3":r.uniforms[e].value=(new L).fromArray(o.value);case"m4":r.uniforms[e].value=(new tt).fromArray(o.value);break;default:r.uniforms[e].value=o.value}}if(void 0!==t.defines&&(r.defines=t.defines),void 0!==t.vertexShader&&(r.vertexShader=t.vertexShader),void 0!==t.fragmentShader&&(r.fragmentShader=t.fragmentShader),void 0!==t.extensions)for(const e in t.extensions)r.extensions[e]=t.extensions[e];if(void 0!==t.shading&&(r.flatShading=1===t.shading),void 0!==t.size&&(r.size=t.size),void 0!==t.sizeAttenuation&&(r.sizeAttenuation=t.sizeAttenuation),void 0!==t.map&&(r.map=n(t.map)),void 0!==t.matcap&&(r.matcap=n(t.matcap)),void 0!==t.alphaMap&&(r.alphaMap=n(t.alphaMap)),void 0!==t.bumpMap&&(r.bumpMap=n(t.bumpMap)),void 0!==t.bumpScale&&(r.bumpScale=t.bumpScale),void 0!==t.normalMap&&(r.normalMap=n(t.normalMap)),void 0!==t.normalMapType&&(r.normalMapType=t.normalMapType),void 0!==t.normalScale){let e=t.normalScale;!1===Array.isArray(e)&&(e=[e,e]),r.normalScale=(new D).fromArray(e)}return void 0!==t.displacementMap&&(r.displacementMap=n(t.displacementMap)),void 0!==t.displacementScale&&(r.displacementScale=t.displacementScale),void 0!==t.displacementBias&&(r.displacementBias=t.displacementBias),void 0!==t.roughnessMap&&(r.roughnessMap=n(t.roughnessMap)),void 0!==t.metalnessMap&&(r.metalnessMap=n(t.metalnessMap)),void 0!==t.emissiveMap&&(r.emissiveMap=n(t.emissiveMap)),void 0!==t.emissiveIntensity&&(r.emissiveIntensity=t.emissiveIntensity),void 0!==t.specularMap&&(r.specularMap=n(t.specularMap)),void 0!==t.envMap&&(r.envMap=n(t.envMap)),void 0!==t.envMapIntensity&&(r.envMapIntensity=t.envMapIntensity),void 0!==t.reflectivity&&(r.reflectivity=t.reflectivity),void 0!==t.refractionRatio&&(r.refractionRatio=t.refractionRatio),void 0!==t.lightMap&&(r.lightMap=n(t.lightMap)),void 0!==t.lightMapIntensity&&(r.lightMapIntensity=t.lightMapIntensity),void 0!==t.aoMap&&(r.aoMap=n(t.aoMap)),void 0!==t.aoMapIntensity&&(r.aoMapIntensity=t.aoMapIntensity),void 0!==t.gradientMap&&(r.gradientMap=n(t.gradientMap)),void 0!==t.clearcoatMap&&(r.clearcoatMap=n(t.clearcoatMap)),void 0!==t.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(t.clearcoatRoughnessMap)),void 0!==t.clearcoatNormalMap&&(r.clearcoatNormalMap=n(t.clearcoatNormalMap)),void 0!==t.clearcoatNormalScale&&(r.clearcoatNormalScale=(new D).fromArray(t.clearcoatNormalScale)),r},setTextures:function(t){return this.textures=t,this}});const Eu={decodeText:function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let s="";for(let i=0,e=t.length;i<e;i++)s+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(s))}catch(t){return s}},extractUrlBase:function(t){const e=t.lastIndexOf("/");return-1===e?"./":t.substr(0,e+1)}};function Tu(){Ue.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function Au(t,e,n,r){"number"==typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),we.call(this,t,e,n),this.meshPerAttribute=r||1}function Cu(t){Os.call(this,t)}Tu.prototype=Object.assign(Object.create(Ue.prototype),{constructor:Tu,isInstancedBufferGeometry:!0,copy:function(source){return Ue.prototype.copy.call(this,source),this.instanceCount=source.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){const data=Ue.prototype.toJSON.call(this);return data.instanceCount=this.instanceCount,data.isInstancedBufferGeometry=!0,data}}),Au.prototype=Object.assign(Object.create(we.prototype),{constructor:Au,isInstancedBufferAttribute:!0,copy:function(source){return we.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this},toJSON:function(){const data=we.prototype.toJSON.call(this);return data.meshPerAttribute=this.meshPerAttribute,data.isInstancedBufferAttribute=!0,data}}),Cu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Cu,load:function(t,e,n,r){const o=this,c=new Ls(o.manager);c.setPath(o.path),c.load(t,(function(text){try{e(o.parse(JSON.parse(text)))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)},parse:function(t){const e={},n={};function r(t,r){if(void 0!==e[r])return e[r];const o=t.interleavedBuffers[r],c=function(t,e){if(void 0!==n[e])return n[e];const r=t.arrayBuffers[e],o=new Uint32Array(r).buffer;return n[e]=o,o}(t,o.buffer),l=new Vi(new Ru[o.type](c),o.stride);return l.uuid=o.uuid,e[r]=l,l}const o=t.isInstancedBufferGeometry?new Tu:new Ue,c=t.data.index;if(void 0!==c){const t=new Ru[c.type](c.array);o.setIndex(new we(t,1))}const l=t.data.attributes;for(const e in l){const n=l[e];let c;if(n.isInterleavedBufferAttribute){c=new Hi(r(t.data,n.data),n.itemSize,n.offset,n.normalized)}else{const t=new Ru[n.type](n.array);c=new(n.isInstancedBufferAttribute?Au:we)(t,n.itemSize,n.normalized)}void 0!==n.name&&(c.name=n.name),o.setAttribute(e,c)}const h=t.data.morphAttributes;if(h)for(const e in h){const n=h[e],c=[];for(let i=0,e=n.length;i<e;i++){const e=n[i];let o;if(e.isInterleavedBufferAttribute){o=new Hi(r(t.data,e.data),e.itemSize,e.offset,e.normalized)}else{o=new we(new Ru[e.type](e.array),e.itemSize,e.normalized)}void 0!==e.name&&(o.name=e.name),c.push(o)}o.morphAttributes[e]=c}t.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const d=t.data.groups||t.data.drawcalls||t.data.offsets;if(void 0!==d)for(let i=0,t=d.length;i!==t;++i){const t=d[i];o.addGroup(t.start,t.count,t.materialIndex)}const f=t.data.boundingSphere;if(void 0!==f){const t=new W;void 0!==f.center&&t.fromArray(f.center),o.boundingSphere=new Bt(t,f.radius)}return t.name&&(o.name=t.name),t.userData&&(o.userData=t.userData),o}});const Ru={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Iu(t){Os.call(this,t)}Iu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Iu,load:function(t,e,n,r){const o=this,path=""===this.path?Eu.extractUrlBase(t):this.path;this.resourcePath=this.resourcePath||path;const c=new Ls(o.manager);c.setPath(this.path),c.load(t,(function(text){let n=null;try{n=JSON.parse(text)}catch(e){return void 0!==r&&r(e),void console.error("THREE:ObjectLoader: Can't parse "+t+".",e.message)}const c=n.metadata;void 0!==c&&void 0!==c.type&&"geometry"!==c.type.toLowerCase()?o.parse(n,e):console.error("THREE.ObjectLoader: Can't load "+t)}),n,r)},parse:function(t,e){const n=this.parseShape(t.shapes),r=this.parseGeometries(t.geometries,n),o=this.parseImages(t.images,(function(){void 0!==e&&e(object)})),c=this.parseTextures(t.textures,o),l=this.parseMaterials(t.materials,c),object=this.parseObject(t.object,r,l);return t.animations&&(object.animations=this.parseAnimations(t.animations)),void 0!==t.images&&0!==t.images.length||void 0!==e&&e(object),object},parseShape:function(t){const e={};if(void 0!==t)for(let i=0,n=t.length;i<n;i++){const n=(new cu).fromJSON(t[i]);e[n.uuid]=n}return e},parseGeometries:function(t,e){const n={};let r;if(void 0!==t){const o=new Cu;for(let i=0,c=t.length;i<c;i++){let c;const data=t[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":c=new ns[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":c=new ns[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":c=new ns[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":c=new ns[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":c=new ns[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":c=new ns[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":c=new ns[data.type](data.radius,data.detail);break;case"RingGeometry":case"RingBufferGeometry":c=new ns[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":c=new ns[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":c=new ns[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case"TubeGeometry":case"TubeBufferGeometry":c=new ns[data.type]((new au[data.path.type]).fromJSON(data.path),data.tubularSegments,data.radius,data.radialSegments,data.closed);break;case"LatheGeometry":case"LatheBufferGeometry":c=new ns[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":c=new ns[data.type](data.vertices,data.indices,data.radius,data.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":r=[];for(let t=0,n=data.shapes.length;t<n;t++){const n=e[data.shapes[t]];r.push(n)}c=new ns[data.type](r,data.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":r=[];for(let t=0,n=data.shapes.length;t<n;t++){const n=e[data.shapes[t]];r.push(n)}const t=data.options.extrudePath;void 0!==t&&(data.options.extrudePath=(new au[t.type]).fromJSON(t)),c=new ns[data.type](r,data.options);break;case"BufferGeometry":case"InstancedBufferGeometry":c=o.parse(data);break;case"Geometry":console.error('THREE.ObjectLoader: Loading "Geometry" is not supported anymore.');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+data.type+'"');continue}c.uuid=data.uuid,void 0!==data.name&&(c.name=data.name),!0===c.isBufferGeometry&&void 0!==data.userData&&(c.userData=data.userData),n[data.uuid]=c}}return n},parseMaterials:function(t,e){const n={},r={};if(void 0!==t){const o=new Mu;o.setTextures(e);for(let i=0,e=t.length;i<e;i++){const data=t[i];if("MultiMaterial"===data.type){const t=[];for(let e=0;e<data.materials.length;e++){const r=data.materials[e];void 0===n[r.uuid]&&(n[r.uuid]=o.parse(r)),t.push(n[r.uuid])}r[data.uuid]=t}else void 0===n[data.uuid]&&(n[data.uuid]=o.parse(data)),r[data.uuid]=n[data.uuid]}}return r},parseAnimations:function(t){const e=[];for(let i=0;i<t.length;i++){const data=t[i],n=As.parse(data);void 0!==data.uuid&&(n.uuid=data.uuid),e.push(n)}return e},parseImages:function(t,e){const n=this,r={};let o;function c(t){return n.manager.itemStart(t),o.load(t,(function(){n.manager.itemEnd(t)}),void 0,(function(){n.manager.itemError(t),n.manager.itemEnd(t)}))}if(void 0!==t&&t.length>0){const l=new Is(e);o=new Bs(l),o.setCrossOrigin(this.crossOrigin);for(let i=0,e=t.length;i<e;i++){const image=t[i],e=image.url;if(Array.isArray(e)){r[image.uuid]=[];for(let t=0,o=e.length;t<o;t++){const o=e[t],path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(o)?o:n.resourcePath+o;r[image.uuid].push(c(path))}}else{const path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:n.resourcePath+image.url;r[image.uuid]=c(path)}}}return r},parseTextures:function(t,e){function n(t,e){return"number"==typeof t?t:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",t),e[t])}const r={};if(void 0!==t)for(let i=0,o=t.length;i<o;i++){const data=t[i];let o;void 0===data.image&&console.warn('THREE.ObjectLoader: No "image" specified for',data.uuid),void 0===e[data.image]&&console.warn("THREE.ObjectLoader: Undefined image",data.image),o=Array.isArray(e[data.image])?new qn(e[data.image]):new B(e[data.image]),o.needsUpdate=!0,o.uuid=data.uuid,void 0!==data.name&&(o.name=data.name),void 0!==data.mapping&&(o.mapping=n(data.mapping,Nu)),void 0!==data.offset&&o.offset.fromArray(data.offset),void 0!==data.repeat&&o.repeat.fromArray(data.repeat),void 0!==data.center&&o.center.fromArray(data.center),void 0!==data.rotation&&(o.rotation=data.rotation),void 0!==data.wrap&&(o.wrapS=n(data.wrap[0],Ou),o.wrapT=n(data.wrap[1],Ou)),void 0!==data.format&&(o.format=data.format),void 0!==data.type&&(o.type=data.type),void 0!==data.encoding&&(o.encoding=data.encoding),void 0!==data.minFilter&&(o.minFilter=n(data.minFilter,Du)),void 0!==data.magFilter&&(o.magFilter=n(data.magFilter,Du)),void 0!==data.anisotropy&&(o.anisotropy=data.anisotropy),void 0!==data.flipY&&(o.flipY=data.flipY),void 0!==data.premultiplyAlpha&&(o.premultiplyAlpha=data.premultiplyAlpha),void 0!==data.unpackAlignment&&(o.unpackAlignment=data.unpackAlignment),r[data.uuid]=o}return r},parseObject:function(data,t,e){let object,n,r;function o(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(t){if(void 0!==t){if(Array.isArray(t)){const n=[];for(let i=0,r=t.length;i<r;i++){const r=t[i];void 0===e[r]&&console.warn("THREE.ObjectLoader: Undefined material",r),n.push(e[r])}return n}return void 0===e[t]&&console.warn("THREE.ObjectLoader: Undefined material",t),e[t]}}switch(data.type){case"Scene":object=new wt,void 0!==data.background&&Number.isInteger(data.background)&&(object.background=new he(data.background)),void 0!==data.fog&&("Fog"===data.fog.type?object.fog=new Ui(data.fog.color,data.fog.near,data.fog.far):"FogExp2"===data.fog.type&&(object.fog=new zi(data.fog.color,data.fog.density)));break;case"PerspectiveCamera":object=new xn(data.fov,data.aspect,data.near,data.far),void 0!==data.focus&&(object.focus=data.focus),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.filmGauge&&(object.filmGauge=data.filmGauge),void 0!==data.filmOffset&&(object.filmOffset=data.filmOffset),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"OrthographicCamera":object=new vu(data.left,data.right,data.top,data.bottom,data.near,data.far),void 0!==data.zoom&&(object.zoom=data.zoom),void 0!==data.view&&(object.view=Object.assign({},data.view));break;case"AmbientLight":object=new bu(data.color,data.intensity);break;case"DirectionalLight":object=new xu(data.color,data.intensity);break;case"PointLight":object=new gu(data.color,data.intensity,data.distance,data.decay);break;case"RectAreaLight":object=new wu(data.color,data.intensity,data.width,data.height);break;case"SpotLight":object=new fu(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case"HemisphereLight":object=new hu(data.color,data.groundColor,data.intensity);break;case"LightProbe":object=(new Su).fromJSON(data);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":n=o(data.geometry),r=c(data.material),object=new on(n,r);break;case"InstancedMesh":n=o(data.geometry),r=c(data.material);const t=data.count,e=data.instanceMatrix;object=new xo(n,r,t),object.instanceMatrix=new we(new Float32Array(e.array),16);break;case"LOD":object=new uo;break;case"Line":object=new To(o(data.geometry),c(data.material),data.mode);break;case"LineLoop":object=new Io(o(data.geometry),c(data.material));break;case"LineSegments":object=new Ro(o(data.geometry),c(data.material));break;case"PointCloud":case"Points":object=new Po(o(data.geometry),c(data.material));break;case"Sprite":object=new io(c(data.material));break;case"Group":object=new Di;break;default:object=new bt}if(object.uuid=data.uuid,void 0!==data.name&&(object.name=data.name),void 0!==data.matrix?(object.matrix.fromArray(data.matrix),void 0!==data.matrixAutoUpdate&&(object.matrixAutoUpdate=data.matrixAutoUpdate),object.matrixAutoUpdate&&object.matrix.decompose(object.position,object.quaternion,object.scale)):(void 0!==data.position&&object.position.fromArray(data.position),void 0!==data.rotation&&object.rotation.fromArray(data.rotation),void 0!==data.quaternion&&object.quaternion.fromArray(data.quaternion),void 0!==data.scale&&object.scale.fromArray(data.scale)),void 0!==data.castShadow&&(object.castShadow=data.castShadow),void 0!==data.receiveShadow&&(object.receiveShadow=data.receiveShadow),data.shadow&&(void 0!==data.shadow.bias&&(object.shadow.bias=data.shadow.bias),void 0!==data.shadow.normalBias&&(object.shadow.normalBias=data.shadow.normalBias),void 0!==data.shadow.radius&&(object.shadow.radius=data.shadow.radius),void 0!==data.shadow.mapSize&&object.shadow.mapSize.fromArray(data.shadow.mapSize),void 0!==data.shadow.camera&&(object.shadow.camera=this.parseObject(data.shadow.camera))),void 0!==data.visible&&(object.visible=data.visible),void 0!==data.frustumCulled&&(object.frustumCulled=data.frustumCulled),void 0!==data.renderOrder&&(object.renderOrder=data.renderOrder),void 0!==data.userData&&(object.userData=data.userData),void 0!==data.layers&&(object.layers.mask=data.layers),void 0!==data.children){const n=data.children;for(let i=0;i<n.length;i++)object.add(this.parseObject(n[i],t,e))}if("LOD"===data.type){void 0!==data.autoUpdate&&(object.autoUpdate=data.autoUpdate);const t=data.levels;for(let e=0;e<t.length;e++){const n=t[e],r=object.getObjectByProperty("uuid",n.object);void 0!==r&&object.addLevel(r,n.distance)}}return object}});const Nu={UVMapping:300,CubeReflectionMapping:301,CubeRefractionMapping:302,EquirectangularReflectionMapping:303,EquirectangularRefractionMapping:304,CubeUVReflectionMapping:306,CubeUVRefractionMapping:307},Ou={RepeatWrapping:c,ClampToEdgeWrapping:l,MirroredRepeatWrapping:h},Du={NearestFilter:d,NearestMipmapNearestFilter:f,NearestMipmapLinearFilter:m,LinearFilter:v,LinearMipmapNearestFilter:y,LinearMipmapLinearFilter:x};function Lu(t){"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Os.call(this,t),this.options={premultiplyAlpha:"none"}}function ku(){this.type="ShapePath",this.color=new he,this.subPaths=[],this.currentPath=null}function Pu(data){this.type="Font",this.data=data}function Fu(t,e,n,r,data){const glyph=data.glyphs[t]||data.glyphs["?"];if(!glyph)return void console.error('THREE.Font: character "'+t+'" does not exists in font family '+data.familyName+".");const path=new ku;let o,c,l,h,d,f,m,v;if(glyph.o){const t=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" "));for(let i=0,y=t.length;i<y;){switch(t[i++]){case"m":o=t[i++]*e+n,c=t[i++]*e+r,path.moveTo(o,c);break;case"l":o=t[i++]*e+n,c=t[i++]*e+r,path.lineTo(o,c);break;case"q":l=t[i++]*e+n,h=t[i++]*e+r,d=t[i++]*e+n,f=t[i++]*e+r,path.quadraticCurveTo(d,f,l,h);break;case"b":l=t[i++]*e+n,h=t[i++]*e+r,d=t[i++]*e+n,f=t[i++]*e+r,m=t[i++]*e+n,v=t[i++]*e+r,path.bezierCurveTo(d,f,m,v,l,h)}}}return{offsetX:glyph.ha*e,path:path}}function Bu(t){Os.call(this,t)}let zu;Lu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Lu,isImageBitmapLoader:!0,setOptions:function(t){return this.options=t,this},load:function(t,e,n,r){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const o=this,c=Rs.get(t);if(void 0!==c)return o.manager.itemStart(t),setTimeout((function(){e&&e(c),o.manager.itemEnd(t)}),0),c;fetch(t).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,o.options)})).then((function(n){Rs.add(t,n),e&&e(n),o.manager.itemEnd(t)})).catch((function(e){r&&r(e),o.manager.itemError(t),o.manager.itemEnd(t)})),o.manager.itemStart(t)}}),Object.assign(ku.prototype,{moveTo:function(t,e){return this.currentPath=new uu,this.subPaths.push(this.currentPath),this.currentPath.moveTo(t,e),this},lineTo:function(t,e){return this.currentPath.lineTo(t,e),this},quadraticCurveTo:function(t,e,n,r){return this.currentPath.quadraticCurveTo(t,e,n,r),this},bezierCurveTo:function(t,e,n,r,o,c){return this.currentPath.bezierCurveTo(t,e,n,r,o,c),this},splineThru:function(t){return this.currentPath.splineThru(t),this},toShapes:function(t,e){function n(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i],r=new cu;r.curves=n.curves,e.push(r)}return e}function r(t,e){const n=e.length;let r=!1;for(let p=n-1,q=0;q<n;p=q++){let n=e[p],o=e[q],c=o.x-n.x,l=o.y-n.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(n=e[q],c=-c,o=e[p],l=-l),t.y<n.y||t.y>o.y)continue;if(t.y===n.y){if(t.x===n.x)return!0}else{const e=l*(t.x-n.x)-c*(t.y-n.y);if(0===e)return!0;if(e<0)continue;r=!r}}else{if(t.y!==n.y)continue;if(o.x<=t.x&&t.x<=n.x||n.x<=t.x&&t.x<=o.x)return!0}}return r}const o=Na.isClockWise,c=this.subPaths;if(0===c.length)return[];if(!0===e)return n(c);let l,h,d,f=[];if(1===c.length)return h=c[0],d=new cu,d.curves=h.curves,f.push(d),f;let m=!o(c[0].getPoints());m=t?!m:m;const v=[],y=[];let x,w,_=[],S=0;y[S]=void 0,_[S]=[];for(let i=0,e=c.length;i<e;i++)h=c[i],x=h.getPoints(),l=o(x),l=t?!l:l,l?(!m&&y[S]&&S++,y[S]={s:new cu,p:x},y[S].s.curves=h.curves,m&&S++,_[S]=[]):_[S].push({h:h,p:x[0]});if(!y[0])return n(c);if(y.length>1){let t=!1;const e=[];for(let t=0,e=y.length;t<e;t++)v[t]=[];for(let n=0,o=y.length;n<o;n++){const o=_[n];for(let c=0;c<o.length;c++){const l=o[c];let h=!0;for(let o=0;o<y.length;o++)r(l.p,y[o].p)&&(n!==o&&e.push({froms:n,tos:o,hole:c}),h?(h=!1,v[o].push(l)):t=!0);h&&v[n].push(l)}}e.length>0&&(t||(_=v))}for(let i=0,t=y.length;i<t;i++){d=y[i].s,f.push(d),w=_[i];for(let t=0,e=w.length;t<e;t++)d.holes.push(w[t].h)}return f}}),Object.assign(Pu.prototype,{isFont:!0,generateShapes:function(text,t){void 0===t&&(t=100);const e=[],n=function(text,t,data){const e=Array.from?Array.from(text):String(text).split(""),n=t/data.resolution,r=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*n,o=[];let c=0,l=0;for(let i=0;i<e.length;i++){const t=e[i];if("\n"===t)c=0,l-=r;else{const e=Fu(t,n,c,l,data);c+=e.offsetX,o.push(e.path)}}return o}(text,t,this.data);for(let p=0,t=n.length;p<t;p++)Array.prototype.push.apply(e,n[p].toShapes());return e}}),Bu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Bu,load:function(t,e,n,r){const o=this,c=new Ls(this.manager);c.setPath(this.path),c.load(t,(function(text){let t;try{t=JSON.parse(text)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),t=JSON.parse(text.substring(65,text.length-2))}const n=o.parse(t);e&&e(n)}),n,r)},parse:function(t){return new Pu(t)}});const Uu=function(){return void 0===zu&&(zu=new(window.AudioContext||window.webkitAudioContext)),zu};function Vu(t){Os.call(this,t)}function Gu(t,e,n){Su.call(this,void 0,n);const r=(new he).set(t),o=(new he).set(e),c=new W(r.r,r.g,r.b),l=new W(o.r,o.g,o.b),h=Math.sqrt(Math.PI),d=h*Math.sqrt(.75);this.sh.coefficients[0].copy(c).add(l).multiplyScalar(h),this.sh.coefficients[1].copy(c).sub(l).multiplyScalar(d)}function Hu(t,e){Su.call(this,void 0,e);const n=(new he).set(t);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Vu.prototype=Object.assign(Object.create(Os.prototype),{constructor:Vu,load:function(t,e,n,r){const o=this,c=new Ls(o.manager);c.setResponseType("arraybuffer"),c.setPath(o.path),c.load(t,(function(n){try{const t=n.slice(0);Uu().decodeAudioData(t,(function(t){e(t)}))}catch(e){r?r(e):console.error(e),o.manager.itemError(t)}}),n,r)}}),Gu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Gu,isHemisphereLightProbe:!0,copy:function(source){return Su.prototype.copy.call(this,source),this},toJSON:function(meta){return Su.prototype.toJSON.call(this,meta)}}),Hu.prototype=Object.assign(Object.create(Su.prototype),{constructor:Hu,isAmbientLightProbe:!0,copy:function(source){return Su.prototype.copy.call(this,source),this},toJSON:function(meta){return Su.prototype.toJSON.call(this,meta)}});const ju=new tt,Wu=new tt;function qu(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new xn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new xn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(t){const e=this._cache;if(e.focus!==t.focus||e.fov!==t.fov||e.aspect!==t.aspect*this.aspect||e.near!==t.near||e.far!==t.far||e.zoom!==t.zoom||e.eyeSep!==this.eyeSep){e.focus=t.focus,e.fov=t.fov,e.aspect=t.aspect*this.aspect,e.near=t.near,e.far=t.far,e.zoom=t.zoom,e.eyeSep=this.eyeSep;const n=t.projectionMatrix.clone(),r=e.eyeSep/2,o=r*e.near/e.focus,c=e.near*Math.tan(O.DEG2RAD*e.fov*.5)/e.zoom;let l,h;Wu.elements[12]=-r,ju.elements[12]=r,l=-c*e.aspect+o,h=c*e.aspect+o,n.elements[0]=2*e.near/(h-l),n.elements[8]=(h+l)/(h-l),this.cameraL.projectionMatrix.copy(n),l=-c*e.aspect-o,h=c*e.aspect-o,n.elements[0]=2*e.near/(h-l),n.elements[8]=(h+l)/(h-l),this.cameraR.projectionMatrix.copy(n)}this.cameraL.matrixWorld.copy(t.matrixWorld).multiply(Wu),this.cameraR.matrixWorld.copy(t.matrixWorld).multiply(ju)}}),Object.assign(qu.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}});const Xu=new W,Yu=new G,Ku=new W,Ju=new W;function Zu(){bt.call(this),this.type="AudioListener",this.context=Uu(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new qu}function Qu(t){bt.call(this),this.type="Audio",this.listener=t,this.context=t.context,this.gain=this.context.createGain(),this.gain.connect(t.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._progress=0,this.filters=[]}Zu.prototype=Object.assign(Object.create(bt.prototype),{constructor:Zu,getInput:function(){return this.gain},removeFilter:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(t){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=t,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this},updateMatrixWorld:function(t){bt.prototype.updateMatrixWorld.call(this,t);const e=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Xu,Yu,Ku),Ju.set(0,0,-1).applyQuaternion(Yu),e.positionX){const t=this.context.currentTime+this.timeDelta;e.positionX.linearRampToValueAtTime(Xu.x,t),e.positionY.linearRampToValueAtTime(Xu.y,t),e.positionZ.linearRampToValueAtTime(Xu.z,t),e.forwardX.linearRampToValueAtTime(Ju.x,t),e.forwardY.linearRampToValueAtTime(Ju.y,t),e.forwardZ.linearRampToValueAtTime(Ju.z,t),e.upX.linearRampToValueAtTime(n.x,t),e.upY.linearRampToValueAtTime(n.y,t),e.upZ.linearRampToValueAtTime(n.z,t)}else e.setPosition(Xu.x,Xu.y,Xu.z),e.setOrientation(Ju.x,Ju.y,Ju.z,n.x,n.y,n.z)}}),Qu.prototype=Object.assign(Object.create(bt.prototype),{constructor:Qu,getOutput:function(){return this.gain},setNodeSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=t,this.connect(),this},setMediaElementSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(t),this.connect(),this},setMediaStreamSource:function(t){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(t),this.connect(),this},setBuffer:function(t){return this.buffer=t,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(t){if(void 0===t&&(t=0),!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+t;const source=this.context.createBufferSource();return source.buffer=this.buffer,source.loop=this.loop,source.loopStart=this.loopStart,source.loopEnd=this.loopEnd,source.onended=this.onEnded.bind(this),source.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=source,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()},pause:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let i=1,t=this.filters.length;i<t;i++)this.filters[i-1].connect(this.filters[i]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let i=1,t=this.filters.length;i<t;i++)this.filters[i-1].disconnect(this.filters[i]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(t){return t||(t=[]),!0===this.isPlaying?(this.disconnect(),this.filters=t,this.connect()):this.filters=t,this},setDetune:function(t){if(this.detune=t,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(filter){return this.setFilters(filter?[filter]:[])},setPlaybackRate:function(t){if(!1!==this.hasPlaybackControl)return this.playbackRate=t,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(t){if(!1!==this.hasPlaybackControl)return this.loop=t,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(t){return this.loopStart=t,this},setLoopEnd:function(t){return this.loopEnd=t,this},getVolume:function(){return this.gain.gain.value},setVolume:function(t){return this.gain.gain.setTargetAtTime(t,this.context.currentTime,.01),this}});const $u=new W,tc=new G,ec=new W,nc=new W;function rc(t){Qu.call(this,t),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function ic(audio,t){this.analyser=audio.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),audio.getOutput().connect(this.analyser)}function oc(t,e,n){let r,o,c;switch(this.binding=t,this.valueSize=n,e){case"quaternion":r=this._slerp,o=this._slerpAdditive,c=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,o=this._select,c=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,o=this._lerpAdditive,c=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=o,this._setIdentity=c,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}rc.prototype=Object.assign(Object.create(Qu.prototype),{constructor:rc,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(t){return this.panner.refDistance=t,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(t){return this.panner.rolloffFactor=t,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(t){return this.panner.distanceModel=t,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(t){return this.panner.maxDistance=t,this},setDirectionalCone:function(t,e,n){return this.panner.coneInnerAngle=t,this.panner.coneOuterAngle=e,this.panner.coneOuterGain=n,this},updateMatrixWorld:function(t){if(bt.prototype.updateMatrixWorld.call(this,t),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose($u,tc,ec),nc.set(0,0,1).applyQuaternion(tc);const e=this.panner;if(e.positionX){const t=this.context.currentTime+this.listener.timeDelta;e.positionX.linearRampToValueAtTime($u.x,t),e.positionY.linearRampToValueAtTime($u.y,t),e.positionZ.linearRampToValueAtTime($u.z,t),e.orientationX.linearRampToValueAtTime(nc.x,t),e.orientationY.linearRampToValueAtTime(nc.y,t),e.orientationZ.linearRampToValueAtTime(nc.z,t)}else e.setPosition($u.x,$u.y,$u.z),e.setOrientation(nc.x,nc.y,nc.z)}}),Object.assign(ic.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){let t=0;const data=this.getFrequencyData();for(let i=0;i<data.length;i++)t+=data[i];return t/data.length}}),Object.assign(oc.prototype,{accumulate:function(t,e){const n=this.buffer,r=this.valueSize,o=t*r+r;let c=this.cumulativeWeight;if(0===c){for(let i=0;i!==r;++i)n[o+i]=n[i];c=e}else{c+=e;const t=e/c;this._mixBufferRegion(n,o,0,t,r)}this.cumulativeWeight=c},accumulateAdditive:function(t){const e=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,r,0,t,n),this.cumulativeWeightAdditive+=t},apply:function(t){const e=this.valueSize,n=this.buffer,r=t*e+e,o=this.cumulativeWeight,c=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,o<1){const t=e*this._origIndex;this._mixBufferRegion(n,r,t,1-o,e)}c>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*e,1,e);for(let i=e,t=e+e;i!==t;++i)if(n[i]!==n[i+e]){l.setValue(n,r);break}},saveOriginalState:function(){const t=this.binding,e=this.buffer,n=this.valueSize,r=n*this._origIndex;t.getValue(e,r);for(let i=n,t=r;i!==t;++i)e[i]=e[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)},_setAdditiveIdentityNumeric:function(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[4*this._addIndex+3]=1},_setAdditiveIdentityOther:function(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]},_select:function(t,e,n,r,o){if(r>=.5)for(let i=0;i!==o;++i)t[e+i]=t[n+i]},_slerp:function(t,e,n,r){G.slerpFlat(t,e,t,e,t,n,r)},_slerpAdditive:function(t,e,n,r,o){const c=this._workIndex*o;G.multiplyQuaternionsFlat(t,c,t,e,t,n),G.slerpFlat(t,e,t,e,t,c,r)},_lerp:function(t,e,n,r,o){const s=1-r;for(let i=0;i!==o;++i){const o=e+i;t[o]=t[o]*s+t[n+i]*r}},_lerpAdditive:function(t,e,n,r,o){for(let i=0;i!==o;++i){const o=e+i;t[o]=t[o]+t[n+i]*r}}});const ac=new RegExp("[\\[\\]\\.:\\/]","g"),sc="[^"+"\\[\\]\\.:\\/".replace("\\.","")+"]",uc=/((?:WC+[\/:])*)/.source.replace("WC","[^\\[\\]\\.:\\/]"),cc=/(WCOD+)?/.source.replace("WCOD",sc),lc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC","[^\\[\\]\\.:\\/]"),hc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC","[^\\[\\]\\.:\\/]"),pc=new RegExp("^"+uc+cc+lc+hc+"$"),dc=["material","materials","bones"];function fc(t,path,e){const n=e||mc.parseTrackName(path);this._targetGroup=t,this._bindings=t.subscribe_(path,n)}function mc(t,path,e){this.path=path,this.parsedPath=e||mc.parseTrackName(path),this.node=mc.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t}function gc(t,e,n,r){this._mixer=t,this._clip=e,this._localRoot=n||null,this.blendMode=r||e.blendMode;const o=e.tracks,c=o.length,l=new Array(c),h={endingStart:2400,endingEnd:2400};for(let i=0;i!==c;++i){const t=o[i].createInterpolant(null);l[i]=t,t.settings=h}this._interpolantSettings=h,this._interpolants=l,this._propertyBindings=new Array(c),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function vc(t){this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function yc(t){"string"==typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}function xc(t,e,n){Vi.call(this,t,e),this.meshPerAttribute=n||1}function bc(t,e,n,r){this.ray=new qt(t,e),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new ot,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function wc(a,b){return a.distance-b.distance}function _c(object,t,e,n){if(object.layers.test(t.layers)&&object.raycast(t,e),!0===n){const n=object.children;for(let i=0,r=n.length;i<r;i++)_c(n[i],t,e,!0)}}Object.assign(fc.prototype,{getValue:function(t,e){this.bind();const n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(t,e)},setValue:function(t,e){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(t,e)},bind:function(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,e=t.length;i!==e;++i)t[i].bind()},unbind:function(){const t=this._bindings;for(let i=this._targetGroup.nCachedObjects_,e=t.length;i!==e;++i)t[i].unbind()}}),Object.assign(mc,{Composite:fc,create:function(t,path,e){return t&&t.isAnimationObjectGroup?new mc.Composite(t,path,e):new mc(t,path,e)},sanitizeNodeName:function(t){return t.replace(/\s/g,"_").replace(ac,"")},parseTrackName:function(t){const e=pc.exec(t);if(!e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const n={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){const t=n.nodeName.substring(r+1);-1!==dc.indexOf(t)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=t)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return n},findNode:function(t,e){if(!e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const n=t.skeleton.getBoneByName(e);if(void 0!==n)return n}if(t.children){const n=function(t){for(let i=0;i<t.length;i++){const r=t[i];if(r.name===e||r.uuid===e)return r;const o=n(r.children);if(o)return o}return null},r=n(t.children);if(r)return r}return null}}),Object.assign(mc.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(t,e){t[e]=this.node[this.propertyName]},function(t,e){const source=this.resolvedProperty;for(let i=0,n=source.length;i!==n;++i)t[e++]=source[i]},function(t,e){t[e]=this.resolvedProperty[this.propertyIndex]},function(t,e){this.resolvedProperty.toArray(t,e)}],SetterByBindingTypeAndVersioning:[[function(t,e){this.targetObject[this.propertyName]=t[e]},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++]},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.needsUpdate=!0},function(t,e){const n=this.resolvedProperty;for(let i=0,r=n.length;i!==r;++i)n[i]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty[this.propertyIndex]=t[e]},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(t,e){this.resolvedProperty.fromArray(t,e)},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0},function(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(t,e){this.bind(),this.getValue(t,e)},setValue:function(t,e){this.bind(),this.setValue(t,e)},bind:function(){let t=this.node,e=this.parsedPath,n=e.objectName,r=e.propertyName,o=e.propertyIndex;if(t||(t=mc.findNode(this.rootNode,e.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){let r=e.objectIndex;switch(n){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let i=0;i<t.length;i++)if(t[i].name===r){r=i;break}break;default:if(void 0===t[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[n]}if(void 0!==r){if(void 0===t[r])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[r]}}const c=t[r];if(void 0===c){const n=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+n+"."+r+" but it wasn't found.",t)}let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let h=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===r){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}h=this.BindingType.ArrayElement,this.resolvedProperty=c,this.propertyIndex=o}else void 0!==c.fromArray&&void 0!==c.toArray?(h=this.BindingType.HasFromToArray,this.resolvedProperty=c):Array.isArray(c)?(h=this.BindingType.EntireArray,this.resolvedProperty=c):this.propertyName=r;this.getValue=this.GetterByBindingType[h],this.setValue=this.SetterByBindingTypeAndVersioning[h][l]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(mc.prototype,{_getValue_unbound:mc.prototype.getValue,_setValue_unbound:mc.prototype.setValue}),Object.assign(function(){this.uuid=O.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const t={};this._indicesByUUID=t;for(let i=0,e=arguments.length;i!==e;++i)t[arguments[i].uuid]=i;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const e=this;this.stats={objects:{get total(){return e._objects.length},get inUse(){return this.total-e.nCachedObjects_}},get bindingsPerObject(){return e._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){const t=this._objects,e=this._indicesByUUID,n=this._paths,r=this._parsedPaths,o=this._bindings,c=o.length;let l=void 0,h=t.length,d=this.nCachedObjects_;for(let i=0,f=arguments.length;i!==f;++i){const object=arguments[i],f=object.uuid;let m=e[f];if(void 0===m){m=h++,e[f]=m,t.push(object);for(let t=0,e=c;t!==e;++t)o[t].push(new mc(object,n[t],r[t]))}else if(m<d){l=t[m];const h=--d,v=t[h];e[v.uuid]=m,t[m]=v,e[f]=h,t[h]=object;for(let t=0,e=c;t!==e;++t){const e=o[t],c=e[h];let l=e[m];e[m]=c,void 0===l&&(l=new mc(object,n[t],r[t])),e[h]=l}}else t[m]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d},remove:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let o=this.nCachedObjects_;for(let i=0,c=arguments.length;i!==c;++i){const object=arguments[i],c=object.uuid,l=e[c];if(void 0!==l&&l>=o){const h=o++,d=t[h];e[d.uuid]=l,t[l]=d,e[c]=h,t[h]=object;for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[h],o=e[l];e[l]=r,e[h]=o}}}this.nCachedObjects_=o},uncache:function(){const t=this._objects,e=this._indicesByUUID,n=this._bindings,r=n.length;let o=this.nCachedObjects_,c=t.length;for(let i=0,l=arguments.length;i!==l;++i){const l=arguments[i].uuid,h=e[l];if(void 0!==h)if(delete e[l],h<o){const l=--o,d=t[l],f=--c,m=t[f];e[d.uuid]=h,t[h]=d,e[m.uuid]=l,t[l]=m,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t],r=e[l],o=e[f];e[h]=r,e[l]=o,e.pop()}}else{const o=--c,l=t[o];e[l.uuid]=h,t[h]=l,t.pop();for(let t=0,e=r;t!==e;++t){const e=n[t];e[h]=e[o],e.pop()}}}this.nCachedObjects_=o},subscribe_:function(path,t){let e=this._bindingsIndicesByPath,n=e[path],r=this._bindings;if(void 0!==n)return r[n];const o=this._paths,c=this._parsedPaths,l=this._objects,h=l.length,d=this.nCachedObjects_,f=new Array(h);n=r.length,e[path]=n,o.push(path),c.push(t),r.push(f);for(let i=d,e=l.length;i!==e;++i){const object=l[i];f[i]=new mc(object,path,t)}return f},unsubscribe_:function(path){const t=this._bindingsIndicesByPath,e=t[path];if(void 0!==e){const n=this._paths,r=this._parsedPaths,o=this._bindings,c=o.length-1,l=o[c];t[path[c]]=e,o[e]=l,o.pop(),r[e]=r[c],r.pop(),n[e]=n[c],n.pop()}}}),Object.assign(gc.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(time){return this._startTime=time,this},setLoop:function(t,e){return this.loop=t,this.repetitions=e,this},setEffectiveWeight:function(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(t){return this._scheduleFading(t,0,1)},fadeOut:function(t){return this._scheduleFading(t,1,0)},crossFadeFrom:function(t,e,n){if(t.fadeOut(e),this.fadeIn(e),n){const n=this._clip.duration,r=t._clip.duration,o=r/n,c=n/r;t.warp(1,o,e),this.warp(c,1,e)}return this},crossFadeTo:function(t,e,n){return t.crossFadeFrom(this,e,n)},stopFading:function(){let t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},setEffectiveTimeScale:function(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(t){return this.timeScale=this._clip.duration/t,this.stopWarping()},syncWith:function(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()},halt:function(t){return this.warp(this._effectiveTimeScale,0,t)},warp:function(t,e,n){const r=this._mixer,o=r.time,c=this.timeScale;let l=this._timeScaleInterpolant;null===l&&(l=r._lendControlInterpolant(),this._timeScaleInterpolant=l);const h=l.parameterPositions,d=l.sampleValues;return h[0]=o,h[1]=o+n,d[0]=t/c,d[1]=e/c,this},stopWarping:function(){let t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(time,t,e,n){if(!this.enabled)return void this._updateWeight(time);const r=this._startTime;if(null!==r){const n=(time-r)*e;if(n<0||0===e)return;this._startTime=null,t=e*n}t*=this._updateTimeScale(time);const o=this._updateTime(t),c=this._updateWeight(time);if(c>0){const t=this._interpolants,e=this._propertyBindings;switch(this.blendMode){case 2501:for(let n=0,r=t.length;n!==r;++n)t[n].evaluate(o),e[n].accumulateAdditive(c);break;case 2500:default:for(let r=0,l=t.length;r!==l;++r)t[r].evaluate(o),e[r].accumulate(n,c)}}},_updateWeight:function(time){let t=0;if(this.enabled){t=this.weight;const e=this._weightInterpolant;if(null!==e){const n=e.evaluate(time)[0];t*=n,time>e.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(time){let t=0;if(!this.paused){t=this.timeScale;const e=this._timeScaleInterpolant;if(null!==e){t*=e.evaluate(time)[0],time>e.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(t){const e=this._clip.duration,n=this.loop;let time=this.time+t,r=this._loopCount;const o=2202===n;if(0===t)return-1===r?time:o&&1==(1&r)?e-time:time;if(2200===n){-1===r&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(time>=e)time=e;else{if(!(time<0)){this.time=time;break t}time=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=time,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===r&&(t>=0?(r=0,this._setEndings(!0,0===this.repetitions,o)):this._setEndings(0===this.repetitions,!0,o)),time>=e||time<0){const n=Math.floor(time/e);time-=e*n,r+=Math.abs(n);const c=this.repetitions-r;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,time=t>0?e:0,this.time=time,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===c){const e=t<0;this._setEndings(e,!e,o)}else this._setEndings(!1,!1,o);this._loopCount=r,this.time=time,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:n})}}else this.time=time;if(o&&1==(1&r))return e-time}return time},_setEndings:function(t,e,n){const r=this._interpolantSettings;n?(r.endingStart=2401,r.endingEnd=2401):(r.endingStart=t?this.zeroSlopeAtStart?2401:2400:2402,r.endingEnd=e?this.zeroSlopeAtEnd?2401:2400:2402)},_scheduleFading:function(t,e,n){const r=this._mixer,o=r.time;let c=this._weightInterpolant;null===c&&(c=r._lendControlInterpolant(),this._weightInterpolant=c);const l=c.parameterPositions,h=c.sampleValues;return l[0]=o,h[0]=e,l[1]=o+t,h[1]=n,this}}),vc.prototype=Object.assign(Object.create(I.prototype),{constructor:vc,_bindAction:function(t,e){const n=t._localRoot||this._root,r=t._clip.tracks,o=r.length,c=t._propertyBindings,l=t._interpolants,h=n.uuid,d=this._bindingsByRootAndName;let f=d[h];void 0===f&&(f={},d[h]=f);for(let i=0;i!==o;++i){const track=r[i],t=track.name;let o=f[t];if(void 0!==o)c[i]=o;else{if(o=c[i],void 0!==o){null===o._cacheIndex&&(++o.referenceCount,this._addInactiveBinding(o,h,t));continue}const path=e&&e._propertyBindings[i].binding.parsedPath;o=new oc(mc.create(n,t,path),track.ValueTypeName,track.getValueSize()),++o.referenceCount,this._addInactiveBinding(o,h,t),c[i]=o}l[i].resultBuffer=o.buffer}},_activateAction:function(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,n=t._clip.uuid,r=this._actionsByClip[n];this._bindAction(t,r&&r.knownActions[0]),this._addInactiveAction(t,n,e)}const e=t._propertyBindings;for(let i=0,t=e.length;i!==t;++i){const t=e[i];0==t.useCount++&&(this._lendBinding(t),t.saveOriginalState())}this._lendAction(t)}},_deactivateAction:function(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let i=0,t=e.length;i!==t;++i){const t=e[i];0==--t.useCount&&(t.restoreOriginalState(),this._takeBackBinding(t))}this._takeBackAction(t)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}},_isActiveAction:function(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions},_addInactiveAction:function(t,e,n){const r=this._actions,o=this._actionsByClip;let c=o[e];if(void 0===c)c={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,o[e]=c;else{const e=c.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=r.length,r.push(t),c.actionByRoot[n]=t},_removeInactiveAction:function(t){const e=this._actions,n=e[e.length-1],r=t._cacheIndex;n._cacheIndex=r,e[r]=n,e.pop(),t._cacheIndex=null;const o=t._clip.uuid,c=this._actionsByClip,l=c[o],h=l.knownActions,d=h[h.length-1],f=t._byClipCacheIndex;d._byClipCacheIndex=f,h[f]=d,h.pop(),t._byClipCacheIndex=null;delete l.actionByRoot[(t._localRoot||this._root).uuid],0===h.length&&delete c[o],this._removeInactiveBindingsForAction(t)},_removeInactiveBindingsForAction:function(t){const e=t._propertyBindings;for(let i=0,t=e.length;i!==t;++i){const t=e[i];0==--t.referenceCount&&this._removeInactiveBinding(t)}},_lendAction:function(t){const e=this._actions,n=t._cacheIndex,r=this._nActiveActions++,o=e[r];t._cacheIndex=r,e[r]=t,o._cacheIndex=n,e[n]=o},_takeBackAction:function(t){const e=this._actions,n=t._cacheIndex,r=--this._nActiveActions,o=e[r];t._cacheIndex=r,e[r]=t,o._cacheIndex=n,e[n]=o},_addInactiveBinding:function(t,e,n){const r=this._bindingsByRootAndName,o=this._bindings;let c=r[e];void 0===c&&(c={},r[e]=c),c[n]=t,t._cacheIndex=o.length,o.push(t)},_removeInactiveBinding:function(t){const e=this._bindings,n=t.binding,r=n.rootNode.uuid,o=n.path,c=this._bindingsByRootAndName,l=c[r],h=e[e.length-1],d=t._cacheIndex;h._cacheIndex=d,e[d]=h,e.pop(),delete l[o],0===Object.keys(l).length&&delete c[r]},_lendBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=this._nActiveBindings++,o=e[r];t._cacheIndex=r,e[r]=t,o._cacheIndex=n,e[n]=o},_takeBackBinding:function(t){const e=this._bindings,n=t._cacheIndex,r=--this._nActiveBindings,o=e[r];t._cacheIndex=r,e[r]=t,o._cacheIndex=n,e[n]=o},_lendControlInterpolant:function(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let n=t[e];return void 0===n&&(n=new vs(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=e,t[e]=n),n},_takeBackControlInterpolant:function(t){const e=this._controlInterpolants,n=t.__cacheIndex,r=--this._nActiveControlInterpolants,o=e[r];t.__cacheIndex=r,e[r]=t,o.__cacheIndex=n,e[n]=o},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(t,e,n){const r=e||this._root,o=r.uuid;let c="string"==typeof t?As.findByName(r,t):t;const l=null!==c?c.uuid:t;let h=this._actionsByClip[l],d=null;if(void 0===n&&(n=null!==c?c.blendMode:2500),void 0!==h){const t=h.actionByRoot[o];if(void 0!==t&&t.blendMode===n)return t;d=h.knownActions[0],null===c&&(c=d._clip)}if(null===c)return null;const f=new gc(this,c,e,n);return this._bindAction(f,d),this._addInactiveAction(f,l,o),f},existingAction:function(t,e){const n=e||this._root,r=n.uuid,o="string"==typeof t?As.findByName(n,t):t,c=o?o.uuid:t,l=this._actionsByClip[c];return void 0!==l&&l.actionByRoot[r]||null},stopAllAction:function(){const t=this._actions;for(let i=this._nActiveActions-1;i>=0;--i)t[i].stop();return this},update:function(t){t*=this.timeScale;const e=this._actions,n=this._nActiveActions,time=this.time+=t,r=Math.sign(t),o=this._accuIndex^=1;for(let i=0;i!==n;++i){e[i]._update(time,t,r,o)}const c=this._bindings,l=this._nActiveBindings;for(let i=0;i!==l;++i)c[i].apply(o);return this},setTime:function(t){this.time=0;for(let i=0;i<this._actions.length;i++)this._actions[i].time=0;return this.update(t)},getRoot:function(){return this._root},uncacheClip:function(t){const e=this._actions,n=t.uuid,r=this._actionsByClip,o=r[n];if(void 0!==o){const t=o.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const r=n._cacheIndex,o=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,o._cacheIndex=r,e[r]=o,e.pop(),this._removeInactiveBindingsForAction(n)}delete r[n]}},uncacheRoot:function(t){const e=t.uuid,n=this._actionsByClip;for(const t in n){const r=n[t].actionByRoot[e];void 0!==r&&(this._deactivateAction(r),this._removeInactiveAction(r))}const r=this._bindingsByRootAndName[e];if(void 0!==r)for(const t in r){const e=r[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}},uncacheAction:function(t,e){const n=this.existingAction(t,e);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),yc.prototype.clone=function(){return new yc(void 0===this.value.clone?this.value:this.value.clone())},xc.prototype=Object.assign(Object.create(Vi.prototype),{constructor:xc,isInstancedInterleavedBuffer:!0,copy:function(source){return Vi.prototype.copy.call(this,source),this.meshPerAttribute=source.meshPerAttribute,this},clone:function(data){const t=Vi.prototype.clone.call(this,data);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(data){const t=Vi.prototype.toJSON.call(this,data);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.assign(bc.prototype,{set:function(t,e){this.ray.set(t,e)},setFromCamera:function(t,e){e&&e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e&&e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(object,t,e){const n=e||[];return _c(object,this,n,t),n.sort(wc),n},intersectObjects:function(t,e,n){const r=n||[];if(!1===Array.isArray(t))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(let i=0,n=t.length;i<n;i++)_c(t[i],this,r,e);return r.sort(wc),r}}),Object.assign(function(t,e,n){return this.radius=void 0!==t?t:1,this.phi=void 0!==e?e:0,this.theta=void 0!==n?n:0,this}.prototype,{set:function(t,e,n){return this.radius=t,this.phi=e,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+e*e+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,n),this.phi=Math.acos(O.clamp(e/this.radius,-1,1))),this}}),Object.assign(function(t,e,n){return this.radius=void 0!==t?t:1,this.theta=void 0!==e?e:0,this.y=void 0!==n?n:0,this}.prototype,{set:function(t,e,n){return this.radius=t,this.theta=e,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.radius=t.radius,this.theta=t.theta,this.y=t.y,this},setFromVector3:function(t){return this.setFromCartesianCoords(t.x,t.y,t.z)},setFromCartesianCoords:function(t,e,n){return this.radius=Math.sqrt(t*t+n*n),this.theta=Math.atan2(t,n),this.y=e,this}});const Sc=new D;function Mc(t,e){this.min=void 0!==t?t:new D(1/0,1/0),this.max=void 0!==e?e:new D(-1/0,-1/0)}Object.assign(Mc.prototype,{set:function(t,e){return this.min.copy(t),this.max.copy(e),this},setFromPoints:function(t){this.makeEmpty();for(let i=0,e=t.length;i<e;i++)this.expandByPoint(t[i]);return this},setFromCenterAndSize:function(t,e){const n=Sc.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this},clone:function(){return(new this.constructor).copy(this)},copy:function(t){return this.min.copy(t.min),this.max.copy(t.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(t){return void 0===t&&(console.warn("THREE.Box2: .getCenter() target is now required"),t=new D),this.isEmpty()?t.set(0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(t){return void 0===t&&(console.warn("THREE.Box2: .getSize() target is now required"),t=new D),this.isEmpty()?t.set(0,0):t.subVectors(this.max,this.min)},expandByPoint:function(t){return this.min.min(t),this.max.max(t),this},expandByVector:function(t){return this.min.sub(t),this.max.add(t),this},expandByScalar:function(t){return this.min.addScalar(-t),this.max.addScalar(t),this},containsPoint:function(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y)},containsBox:function(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y},getParameter:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .getParameter() target is now required"),e=new D),e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y)},clampPoint:function(t,e){return void 0===e&&(console.warn("THREE.Box2: .clampPoint() target is now required"),e=new D),e.copy(t).clamp(this.min,this.max)},distanceToPoint:function(t){return Sc.copy(t).clamp(this.min,this.max).sub(t).length()},intersect:function(t){return this.min.max(t.min),this.max.min(t.max),this},union:function(t){return this.min.min(t.min),this.max.max(t.max),this},translate:function(t){return this.min.add(t),this.max.add(t),this},equals:function(t){return t.min.equals(this.min)&&t.max.equals(this.max)}});const Ec=new W,Tc=new W;function Ac(t,e){this.start=void 0!==t?t:new W,this.end=void 0!==e?e:new W}function Cc(t){bt.call(this),this.material=t,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}Object.assign(Ac.prototype,{set:function(t,e){return this.start.copy(t),this.end.copy(e),this},clone:function(){return(new this.constructor).copy(this)},copy:function(line){return this.start.copy(line.start),this.end.copy(line.end),this},getCenter:function(t){return void 0===t&&(console.warn("THREE.Line3: .getCenter() target is now required"),t=new W),t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(t){return void 0===t&&(console.warn("THREE.Line3: .delta() target is now required"),t=new W),t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(t,e){return void 0===e&&(console.warn("THREE.Line3: .at() target is now required"),e=new W),this.delta(e).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(t,e){Ec.subVectors(t,this.start),Tc.subVectors(this.end,this.start);const n=Tc.dot(Tc);let r=Tc.dot(Ec)/n;return e&&(r=O.clamp(r,0,1)),r},closestPointToPoint:function(t,e,n){const r=this.closestPointToPointParameter(t,e);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new W),this.delta(n).multiplyScalar(r).add(this.start)},applyMatrix4:function(t){return this.start.applyMatrix4(t),this.end.applyMatrix4(t),this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}}),Cc.prototype=Object.create(bt.prototype),Cc.prototype.constructor=Cc,Cc.prototype.isImmediateRenderObject=!0;const Rc=new W;function Ic(t,e){bt.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=e;const n=new Ue,r=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let i=0,t=1,e=32;i<e;i++,t++){const n=i/e*Math.PI*2,o=t/e*Math.PI*2;r.push(Math.cos(n),Math.sin(n),1,Math.cos(o),Math.sin(o),1)}n.setAttribute("position",new Re(r,3));const o=new bo({fog:!1,toneMapped:!1});this.cone=new Ro(n,o),this.add(this.cone),this.update()}Ic.prototype=Object.create(bt.prototype),Ic.prototype.constructor=Ic,Ic.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Ic.prototype.update=function(){this.light.updateMatrixWorld();const t=this.light.distance?this.light.distance:1e3,e=t*Math.tan(this.light.angle);this.cone.scale.set(e,e,t),Rc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Rc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};const Nc=new W,Oc=new tt,Dc=new tt;function Lc(object){const t=function t(object){const e=[];object&&object.isBone&&e.push(object);for(let i=0;i<object.children.length;i++)e.push.apply(e,t(object.children[i]));return e}(object),e=new Ue,n=[],r=[],o=new he(0,0,1),c=new he(0,1,0);for(let i=0;i<t.length;i++){const e=t[i];e.parent&&e.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),r.push(o.r,o.g,o.b),r.push(c.r,c.g,c.b))}e.setAttribute("position",new Re(n,3)),e.setAttribute("color",new Re(r,3));const l=new bo({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});Ro.call(this,e,l),this.type="SkeletonHelper",this.root=object,this.bones=t,this.matrix=object.matrixWorld,this.matrixAutoUpdate=!1}function kc(t,e,n){this.light=t,this.light.updateMatrixWorld(),this.color=n;const r=new Va(e,4,2),o=new ye({wireframe:!0,fog:!1,toneMapped:!1});on.call(this,r,o),this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}Lc.prototype=Object.create(Ro.prototype),Lc.prototype.constructor=Lc,Lc.prototype.isSkeletonHelper=!0,Lc.prototype.updateMatrixWorld=function(t){const e=this.bones,n=this.geometry,r=n.getAttribute("position");Dc.getInverse(this.root.matrixWorld);for(let i=0,t=0;i<e.length;i++){const n=e[i];n.parent&&n.parent.isBone&&(Oc.multiplyMatrices(Dc,n.matrixWorld),Nc.setFromMatrixPosition(Oc),r.setXYZ(t,Nc.x,Nc.y,Nc.z),Oc.multiplyMatrices(Dc,n.parent.matrixWorld),Nc.setFromMatrixPosition(Oc),r.setXYZ(t+1,Nc.x,Nc.y,Nc.z),t+=2)}n.getAttribute("position").needsUpdate=!0,bt.prototype.updateMatrixWorld.call(this,t)},kc.prototype=Object.create(on.prototype),kc.prototype.constructor=kc,kc.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},kc.prototype.update=function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)};const Pc=new W,Fc=new he,Bc=new he;function zc(t,e,n){bt.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n;const r=new Jo(e);r.rotateY(.5*Math.PI),this.material=new ye({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const o=r.getAttribute("position"),c=new Float32Array(3*o.count);r.setAttribute("color",new we(c,3)),this.add(new on(r,this.material)),this.update()}function Uc(t,e,n,r){t=t||10,e=e||10,n=new he(void 0!==n?n:4473924),r=new he(void 0!==r?r:8947848);const o=e/2,c=t/e,l=t/2,h=[],d=[];for(let i=0,t=0,f=-l;i<=e;i++,f+=c){h.push(-l,0,f,l,0,f),h.push(f,0,-l,f,0,l);const e=i===o?n:r;e.toArray(d,t),t+=3,e.toArray(d,t),t+=3,e.toArray(d,t),t+=3,e.toArray(d,t),t+=3}const f=new Ue;f.setAttribute("position",new Re(h,3)),f.setAttribute("color",new Re(d,3));const m=new bo({vertexColors:!0,toneMapped:!1});Ro.call(this,f,m),this.type="GridHelper"}function Vc(t,e,n,r,o,c){t=t||10,e=e||16,n=n||8,r=r||64,o=new he(void 0!==o?o:4473924),c=new he(void 0!==c?c:8947848);const l=[],h=[];for(let i=0;i<=e;i++){const n=i/e*(2*Math.PI),r=Math.sin(n)*t,d=Math.cos(n)*t;l.push(0,0,0),l.push(r,0,d);const f=1&i?o:c;h.push(f.r,f.g,f.b),h.push(f.r,f.g,f.b)}for(let i=0;i<=n;i++){const e=1&i?o:c,d=t-t/n*i;for(let t=0;t<r;t++){let n=t/r*(2*Math.PI),o=Math.sin(n)*d,c=Math.cos(n)*d;l.push(o,0,c),h.push(e.r,e.g,e.b),n=(t+1)/r*(2*Math.PI),o=Math.sin(n)*d,c=Math.cos(n)*d,l.push(o,0,c),h.push(e.r,e.g,e.b)}}const d=new Ue;d.setAttribute("position",new Re(l,3)),d.setAttribute("color",new Re(h,3));const f=new bo({vertexColors:!0,toneMapped:!1});Ro.call(this,d,f),this.type="PolarGridHelper"}zc.prototype=Object.create(bt.prototype),zc.prototype.constructor=zc,zc.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},zc.prototype.update=function(){const t=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const e=t.geometry.getAttribute("color");Fc.copy(this.light.color),Bc.copy(this.light.groundColor);for(let i=0,t=e.count;i<t;i++){const n=i<t/2?Fc:Bc;e.setXYZ(i,n.r,n.g,n.b)}e.needsUpdate=!0}t.lookAt(Pc.setFromMatrixPosition(this.light.matrixWorld).negate())},Uc.prototype=Object.assign(Object.create(Ro.prototype),{constructor:Uc,copy:function(source){return Ro.prototype.copy.call(this,source),this.geometry.copy(source.geometry),this.material.copy(source.material),this},clone:function(){return(new this.constructor).copy(this)}}),Vc.prototype=Object.create(Ro.prototype),Vc.prototype.constructor=Vc;const Gc=new W,Hc=new W,jc=new W;function Wc(t,e,n){bt.call(this),this.light=t,this.light.updateMatrixWorld(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,void 0===e&&(e=1);let r=new Ue;r.setAttribute("position",new Re([-e,e,0,e,e,0,e,-e,0,-e,-e,0,-e,e,0],3));const o=new bo({fog:!1,toneMapped:!1});this.lightPlane=new To(r,o),this.add(this.lightPlane),r=new Ue,r.setAttribute("position",new Re([0,0,0,0,0,1],3)),this.targetLine=new To(r,o),this.add(this.targetLine),this.update()}Wc.prototype=Object.create(bt.prototype),Wc.prototype.constructor=Wc,Wc.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},Wc.prototype.update=function(){Gc.setFromMatrixPosition(this.light.matrixWorld),Hc.setFromMatrixPosition(this.light.target.matrixWorld),jc.subVectors(Hc,Gc),this.lightPlane.lookAt(Hc),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Hc),this.targetLine.scale.z=jc.length()};const qc=new W,Xc=new yn;function Yc(t){const e=new Ue,n=new bo({color:16777215,vertexColors:!0,toneMapped:!1}),r=[],o=[],c={},l=new he(16755200),h=new he(16711680),d=new he(43775),f=new he(16777215),m=new he(3355443);function v(a,b,t){y(a,t),y(b,t)}function y(t,e){r.push(0,0,0),o.push(e.r,e.g,e.b),void 0===c[t]&&(c[t]=[]),c[t].push(r.length/3-1)}v("n1","n2",l),v("n2","n4",l),v("n4","n3",l),v("n3","n1",l),v("f1","f2",l),v("f2","f4",l),v("f4","f3",l),v("f3","f1",l),v("n1","f1",l),v("n2","f2",l),v("n3","f3",l),v("n4","f4",l),v("p","n1",h),v("p","n2",h),v("p","n3",h),v("p","n4",h),v("u1","u2",d),v("u2","u3",d),v("u3","u1",d),v("c","t",f),v("p","c",m),v("cn1","cn2",m),v("cn3","cn4",m),v("cf1","cf2",m),v("cf3","cf4",m),e.setAttribute("position",new Re(r,3)),e.setAttribute("color",new Re(o,3)),Ro.call(this,e,n),this.type="CameraHelper",this.camera=t,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=t.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=c,this.update()}function Kc(t,e,n,r,o,c,l){qc.set(o,c,l).unproject(r);const h=e[t];if(void 0!==h){const t=n.getAttribute("position");for(let i=0,e=h.length;i<e;i++)t.setXYZ(h[i],qc.x,qc.y,qc.z)}}Yc.prototype=Object.create(Ro.prototype),Yc.prototype.constructor=Yc,Yc.prototype.update=function(){const t=this.geometry,e=this.pointMap;Xc.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Kc("c",e,t,Xc,0,0,-1),Kc("t",e,t,Xc,0,0,1),Kc("n1",e,t,Xc,-1,-1,-1),Kc("n2",e,t,Xc,1,-1,-1),Kc("n3",e,t,Xc,-1,1,-1),Kc("n4",e,t,Xc,1,1,-1),Kc("f1",e,t,Xc,-1,-1,1),Kc("f2",e,t,Xc,1,-1,1),Kc("f3",e,t,Xc,-1,1,1),Kc("f4",e,t,Xc,1,1,1),Kc("u1",e,t,Xc,.7,1.1,-1),Kc("u2",e,t,Xc,-.7,1.1,-1),Kc("u3",e,t,Xc,0,2,-1),Kc("cf1",e,t,Xc,-1,0,1),Kc("cf2",e,t,Xc,1,0,1),Kc("cf3",e,t,Xc,0,-1,1),Kc("cf4",e,t,Xc,0,1,1),Kc("cn1",e,t,Xc,-1,0,-1),Kc("cn2",e,t,Xc,1,0,-1),Kc("cn3",e,t,Xc,0,-1,-1),Kc("cn4",e,t,Xc,0,1,-1),t.getAttribute("position").needsUpdate=!0};const Jc=new kt;function Zc(object,t){this.object=object,void 0===t&&(t=16776960);const e=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),r=new Ue;r.setIndex(new we(e,1)),r.setAttribute("position",new we(n,3)),Ro.call(this,r,new bo({color:t,toneMapped:!1})),this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}function Qc(t,e){this.type="Box3Helper",this.box=t,e=e||16776960;const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),r=new Ue;r.setIndex(new we(n,1)),r.setAttribute("position",new Re([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),Ro.call(this,r,new bo({color:e,toneMapped:!1})),this.type="Box3Helper",this.geometry.computeBoundingSphere()}function $c(t,e,n){this.plane=t,this.size=void 0===e?1:e;const r=void 0!==n?n:16776960,o=new Ue;o.setAttribute("position",new Re([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),o.computeBoundingSphere(),To.call(this,o,new bo({color:r,toneMapped:!1})),this.type="PlaneHelper";const c=new Ue;c.setAttribute("position",new Re([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),c.computeBoundingSphere(),this.add(new on(c,new ye({color:r,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}Zc.prototype=Object.create(Ro.prototype),Zc.prototype.constructor=Zc,Zc.prototype.update=function(object){if(void 0!==object&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&Jc.setFromObject(this.object),Jc.isEmpty())return;const t=Jc.min,e=Jc.max,n=this.geometry.attributes.position,r=n.array;r[0]=e.x,r[1]=e.y,r[2]=e.z,r[3]=t.x,r[4]=e.y,r[5]=e.z,r[6]=t.x,r[7]=t.y,r[8]=e.z,r[9]=e.x,r[10]=t.y,r[11]=e.z,r[12]=e.x,r[13]=e.y,r[14]=t.z,r[15]=t.x,r[16]=e.y,r[17]=t.z,r[18]=t.x,r[19]=t.y,r[20]=t.z,r[21]=e.x,r[22]=t.y,r[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()},Zc.prototype.setFromObject=function(object){return this.object=object,this.update(),this},Zc.prototype.copy=function(source){return Ro.prototype.copy.call(this,source),this.object=source.object,this},Zc.prototype.clone=function(){return(new this.constructor).copy(this)},Qc.prototype=Object.create(Ro.prototype),Qc.prototype.constructor=Qc,Qc.prototype.updateMatrixWorld=function(t){const e=this.box;e.isEmpty()||(e.getCenter(this.position),e.getSize(this.scale),this.scale.multiplyScalar(.5),bt.prototype.updateMatrixWorld.call(this,t))},$c.prototype=Object.create(To.prototype),$c.prototype.constructor=$c,$c.prototype.updateMatrixWorld=function(t){let e=-this.plane.constant;Math.abs(e)<1e-8&&(e=1e-8),this.scale.set(.5*this.size,.5*this.size,e),this.children[0].material.side=e<0?1:r,this.lookAt(this.plane.normal),bt.prototype.updateMatrixWorld.call(this,t)};const tl=new W;let el,nl;function rl(t,e,n,r,o,c){bt.call(this),this.type="ArrowHelper",void 0===t&&(t=new W(0,0,1)),void 0===e&&(e=new W(0,0,0)),void 0===n&&(n=1),void 0===r&&(r=16776960),void 0===o&&(o=.2*n),void 0===c&&(c=.2*o),void 0===el&&(el=new Ue,el.setAttribute("position",new Re([0,0,0,0,1,0],3)),nl=new Za(0,.5,1,5,1),nl.translate(0,-.5,0)),this.position.copy(e),this.line=new To(el,new bo({color:r,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new on(nl,new ye({color:r,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(t),this.setLength(n,o,c)}function il(t){const e=[0,0,0,t=t||1,0,0,0,0,0,0,t,0,0,0,0,0,0,t],n=new Ue;n.setAttribute("position",new Re(e,3)),n.setAttribute("color",new Re([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));const r=new bo({vertexColors:!0,toneMapped:!1});Ro.call(this,n,r),this.type="AxesHelper"}rl.prototype=Object.create(bt.prototype),rl.prototype.constructor=rl,rl.prototype.setDirection=function(t){if(t.y>.99999)this.quaternion.set(0,0,0,1);else if(t.y<-.99999)this.quaternion.set(1,0,0,0);else{tl.set(t.z,0,-t.x).normalize();const e=Math.acos(t.y);this.quaternion.setFromAxisAngle(tl,e)}},rl.prototype.setLength=function(t,e,n){void 0===e&&(e=.2*t),void 0===n&&(n=.2*e),this.line.scale.set(1,Math.max(1e-4,t-e),1),this.line.updateMatrix(),this.cone.scale.set(n,e,n),this.cone.position.y=t,this.cone.updateMatrix()},rl.prototype.setColor=function(t){this.line.material.color.set(t),this.cone.material.color.set(t)},rl.prototype.copy=function(source){return bt.prototype.copy.call(this,source,!1),this.line.copy(source.line),this.cone.copy(source.cone),this},rl.prototype.clone=function(){return(new this.constructor).copy(this)},il.prototype=Object.create(Ro.prototype),il.prototype.constructor=il;const al=Math.pow(2,8),sl=[.125,.215,.35,.446,.526,.582],cl=5+sl.length,ll={3e3:0,[C]:1,3002:2,3004:3,3005:4,3006:5,3007:6},hl=new vu,{_lodPlanes:pl,_sizeLods:fl,_sigmas:ml}=function(){const t=[],e=[],n=[];let r=8;for(let i=0;i<cl;i++){const o=Math.pow(2,r);e.push(o);let c=1/o;i>4?c=sl[i-8+4-1]:0==i&&(c=0),n.push(c);const l=1/(o-1),h=-l/2,d=1+l/2,f=[h,h,d,h,d,d,h,h,d,d,h,d],m=6,v=6,y=3,x=2,w=1,_=new Float32Array(y*v*m),S=new Float32Array(x*v*m),M=new Float32Array(w*v*m);for(let t=0;t<m;t++){const e=t%3*2/3-1,n=t>2?0:-1,r=[e,n,0,e+2/3,n,0,e+2/3,n+1,0,e,n,0,e+2/3,n+1,0,e,n+1,0];_.set(r,y*v*t),S.set(f,x*v*t);const o=[t,t,t,t,t,t];M.set(o,w*v*t)}const E=new Ue;E.setAttribute("position",new we(_,y)),E.setAttribute("uv",new we(S,x)),E.setAttribute("faceIndex",new we(M,w)),t.push(E),r>4&&r--}return{_lodPlanes:t,_sizeLods:e,_sigmas:n}}();let gl=null;const vl=(1+Math.sqrt(5))/2,yl=1/vl,xl=[new W(1,1,1),new W(-1,1,1),new W(1,1,-1),new W(-1,1,-1),new W(0,vl,yl),new W(0,vl,-yl),new W(yl,0,vl),new W(-yl,0,vl),new W(vl,yl,0),new W(-vl,yl,0)];function bl(t){this._renderer=t,this._pingPongRenderTarget=null,this._blurMaterial=function(t){const e=new Float32Array(t),n=new W(0,1,0);return new is({name:"SphericalGaussianBlur",defines:{n:t},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:e},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:n},inputEncoding:{value:ll[3e3]},outputEncoding:{value:ll[3e3]}},vertexShader:Tl(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform int samples;\nuniform float weights[n];\nuniform bool latitudinal;\nuniform float dTheta;\nuniform float mipInt;\nuniform vec3 poleAxis;\n\n${Al()}\n\n#define ENVMAP_TYPE_CUBE_UV\n#include <cube_uv_reflection_fragment>\n\nvec3 getSample(float theta, vec3 axis) {\n\tfloat cosTheta = cos(theta);\n\t// Rodrigues' axis-angle rotation\n\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t+ cross(axis, vOutputDirection) * sin(theta)\n\t\t+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);\n\treturn bilinearCubeUV(envMap, sampleDirection, mipInt);\n}\n\nvoid main() {\n\tvec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);\n\tif (all(equal(axis, vec3(0.0))))\n\t\taxis = vec3(vOutputDirection.z, 0.0, - vOutputDirection.x);\n\taxis = normalize(axis);\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb += weights[0] * getSample(0.0, axis);\n\tfor (int i = 1; i < n; i++) {\n\t\tif (i >= samples)\n\t\t\tbreak;\n\t\tfloat theta = dTheta * float(i);\n\t\tgl_FragColor.rgb += weights[i] * getSample(-1.0 * theta, axis);\n\t\tgl_FragColor.rgb += weights[i] * getSample(theta, axis);\n\t}\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}(20),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}function wl(t){return void 0!==t&&1009===t.type&&(3e3===t.encoding||t.encoding===C||3007===t.encoding)}function _l(t){const e=new U(3*al,3*al,t);return e.texture.mapping=306,e.texture.name="PMREM.cubeUv",e.scissorTest=!0,e}function Sl(t,e,n,r,o){t.viewport.set(e,n,r,o),t.scissor.set(e,n,r,o)}function Ml(){return new is({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:new D(1,1)},inputEncoding:{value:ll[3e3]},outputEncoding:{value:ll[3e3]}},vertexShader:Tl(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform sampler2D envMap;\nuniform vec2 texelSize;\n\n${Al()}\n\n#include <common>\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tvec3 outputDirection = normalize(vOutputDirection);\n\tvec2 uv = equirectUv( outputDirection );\n\tvec2 f = fract(uv / texelSize - 0.5);\n\tuv -= f * texelSize;\n\tvec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x += texelSize.x;\n\tvec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.y += texelSize.y;\n\tvec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tuv.x -= texelSize.x;\n\tvec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;\n\tvec3 tm = mix(tl, tr, f.x);\n\tvec3 bm = mix(bl, br, f.x);\n\tgl_FragColor.rgb = mix(tm, bm, f.y);\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function El(){return new is({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ll[3e3]},outputEncoding:{value:ll[3e3]}},vertexShader:Tl(),fragmentShader:`\nprecision mediump float;\nprecision mediump int;\nvarying vec3 vOutputDirection;\nuniform samplerCube envMap;\n\n${Al()}\n\nvoid main() {\n\tgl_FragColor = vec4(0.0);\n\tgl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;\n\tgl_FragColor = linearToOutputTexel(gl_FragColor);\n}\n\t\t`,blending:0,depthTest:!1,depthWrite:!1})}function Tl(){return"\nprecision mediump float;\nprecision mediump int;\nattribute vec3 position;\nattribute vec2 uv;\nattribute float faceIndex;\nvarying vec3 vOutputDirection;\n\n// RH coordinate system; PMREM face-indexing convention\nvec3 getDirection(vec2 uv, float face) {\n\tuv = 2.0 * uv - 1.0;\n\tvec3 direction = vec3(uv, 1.0);\n\tif (face == 0.0) {\n\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\t} else if (face == 1.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\t} else if (face == 2.0) {\n\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\t} else if (face == 3.0) {\n\t\tdirection = direction.zyx;\n\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\t} else if (face == 4.0) {\n\t\tdirection = direction.xzy;\n\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\t} else if (face == 5.0) {\n\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\t}\n\treturn direction;\n}\n\nvoid main() {\n\tvOutputDirection = getDirection(uv, faceIndex);\n\tgl_Position = vec4( position, 1.0 );\n}\n\t"}function Al(){return"\nuniform int inputEncoding;\nuniform int outputEncoding;\n\n#include <encodings_pars_fragment>\n\nvec4 inputTexelToLinear(vec4 value){\n\tif(inputEncoding == 0){\n\t\treturn value;\n\t}else if(inputEncoding == 1){\n\t\treturn sRGBToLinear(value);\n\t}else if(inputEncoding == 2){\n\t\treturn RGBEToLinear(value);\n\t}else if(inputEncoding == 3){\n\t\treturn RGBMToLinear(value, 7.0);\n\t}else if(inputEncoding == 4){\n\t\treturn RGBMToLinear(value, 16.0);\n\t}else if(inputEncoding == 5){\n\t\treturn RGBDToLinear(value, 256.0);\n\t}else{\n\t\treturn GammaToLinear(value, 2.2);\n\t}\n}\n\nvec4 linearToOutputTexel(vec4 value){\n\tif(outputEncoding == 0){\n\t\treturn value;\n\t}else if(outputEncoding == 1){\n\t\treturn LinearTosRGB(value);\n\t}else if(outputEncoding == 2){\n\t\treturn LinearToRGBE(value);\n\t}else if(outputEncoding == 3){\n\t\treturn LinearToRGBM(value, 7.0);\n\t}else if(outputEncoding == 4){\n\t\treturn LinearToRGBM(value, 16.0);\n\t}else if(outputEncoding == 5){\n\t\treturn LinearToRGBD(value, 256.0);\n\t}else{\n\t\treturn LinearToGamma(value, 2.2);\n\t}\n}\n\nvec4 envMapTexelToLinear(vec4 color) {\n\treturn inputTexelToLinear(color);\n}\n\t"}bl.prototype={constructor:bl,fromScene:function(t,e=0,n=.1,r=100){gl=this._renderer.getRenderTarget();const o=this._allocateTargets();return this._sceneToCubeUV(t,n,r,o),e>0&&this._blur(o,0,0,e),this._applyPMREM(o),this._cleanup(o),o},fromEquirectangular:function(t){return this._fromTexture(t)},fromCubemap:function(t){return this._fromTexture(t)},compileCubemapShader:function(){null===this._cubemapShader&&(this._cubemapShader=El(),this._compileMaterial(this._cubemapShader))},compileEquirectangularShader:function(){null===this._equirectShader&&(this._equirectShader=Ml(),this._compileMaterial(this._equirectShader))},dispose:function(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let i=0;i<pl.length;i++)pl[i].dispose()},_cleanup:function(t){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(gl),t.scissorTest=!1,Sl(t,0,0,t.width,t.height)},_fromTexture:function(t){gl=this._renderer.getRenderTarget();const e=this._allocateTargets(t);return this._textureToCubeUV(t,e),this._applyPMREM(e),this._cleanup(e),e},_allocateTargets:function(t){const e={magFilter:d,minFilter:d,generateMipmaps:!1,type:1009,format:S,encoding:wl(t)?t.encoding:3002,depthBuffer:!1,stencilBuffer:!1},n=_l(e);return n.depthBuffer=!t,this._pingPongRenderTarget=_l(e),n},_compileMaterial:function(t){const e=new on(pl[0],t);this._renderer.compile(e,hl)},_sceneToCubeUV:function(t,e,n,r){const o=new xn(90,1,e,n),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],h=this._renderer,d=h.outputEncoding,f=h.toneMapping,m=h.getClearColor(),v=h.getClearAlpha();h.toneMapping=0,h.outputEncoding=3e3;let y=t.background;if(y&&y.isColor){y.convertSRGBToLinear();const e=Math.max(y.r,y.g,y.b),n=Math.min(Math.max(Math.ceil(Math.log2(e)),-128),127);y=y.multiplyScalar(Math.pow(2,-n));const r=(n+128)/255;h.setClearColor(y,r),t.background=null}for(let i=0;i<6;i++){const col=i%3;0==col?(o.up.set(0,c[i],0),o.lookAt(l[i],0,0)):1==col?(o.up.set(0,0,c[i]),o.lookAt(0,l[i],0)):(o.up.set(0,c[i],0),o.lookAt(0,0,l[i])),Sl(r,col*al,i>2?al:0,al,al),h.setRenderTarget(r),h.render(t,o)}h.toneMapping=f,h.outputEncoding=d,h.setClearColor(m,v)},_textureToCubeUV:function(t,e){const n=this._renderer;t.isCubeTexture?null==this._cubemapShader&&(this._cubemapShader=El()):null==this._equirectShader&&(this._equirectShader=Ml());const r=t.isCubeTexture?this._cubemapShader:this._equirectShader,o=new on(pl[0],r),c=r.uniforms;c.envMap.value=t,t.isCubeTexture||c.texelSize.value.set(1/t.image.width,1/t.image.height),c.inputEncoding.value=ll[t.encoding],c.outputEncoding.value=ll[e.texture.encoding],Sl(e,0,0,3*al,2*al),n.setRenderTarget(e),n.render(o,hl)},_applyPMREM:function(t){const e=this._renderer,n=e.autoClear;e.autoClear=!1;for(let i=1;i<cl;i++){const e=Math.sqrt(ml[i]*ml[i]-ml[i-1]*ml[i-1]),n=xl[(i-1)%xl.length];this._blur(t,i-1,i,e,n)}e.autoClear=n},_blur:function(t,e,n,r,o){const c=this._pingPongRenderTarget;this._halfBlur(t,c,e,n,r,"latitudinal",o),this._halfBlur(c,t,n,n,r,"longitudinal",o)},_halfBlur:function(t,e,n,r,o,c,l){const h=this._renderer,d=this._blurMaterial;"latitudinal"!==c&&"longitudinal"!==c&&console.error("blur direction must be either latitudinal or longitudinal!");const f=new on(pl[r],d),m=d.uniforms,v=fl[n]-1,y=isFinite(o)?Math.PI/(2*v):2*Math.PI/39,x=o/y,w=isFinite(o)?1+Math.floor(3*x):20;w>20&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${w} samples when the maximum is set to 20`);const _=[];let S=0;for(let i=0;i<20;++i){const t=i/x,e=Math.exp(-t*t/2);_.push(e),0==i?S+=e:i<w&&(S+=2*e)}for(let i=0;i<_.length;i++)_[i]=_[i]/S;m.envMap.value=t.texture,m.samples.value=w,m.weights.value=_,m.latitudinal.value="latitudinal"===c,l&&(m.poleAxis.value=l),m.dTheta.value=y,m.mipInt.value=8-n,m.inputEncoding.value=ll[t.texture.encoding],m.outputEncoding.value=ll[t.texture.encoding];const M=fl[r];Sl(e,3*Math.max(0,al-2*M),(0===r?0:2*al)+2*M*(r>4?r-8+4:0),3*M,2*M),h.setRenderTarget(e),h.render(f,hl)}};function Cl(t){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ks.call(this,t),this.type="catmullrom"}Vs.create=function(t,e){return console.log("THREE.Curve.create() has been deprecated"),t.prototype=Object.create(Vs.prototype),t.prototype.constructor=t,t.prototype.getPoint=e,t},Object.assign(su.prototype,{createPointsGeometry:function(t){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getPoints(t);return this.createGeometry(e)},createSpacedPointsGeometry:function(t){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=this.getSpacedPoints(t);return this.createGeometry(e)},createGeometry:function(t){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");const e=new pn;for(let i=0,n=t.length;i<n;i++){const n=t[i];e.vertices.push(new W(n.x,n.y,n.z||0))}return e}}),Object.assign(uu.prototype,{fromPoints:function(t){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(t)}}),Object.create(Ks.prototype),Object.create(Ks.prototype),Cl.prototype=Object.create(Ks.prototype),Object.assign(Cl.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Uc.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Lc.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Os.prototype,{extractUrlBase:function(t){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),Eu.extractUrlBase(t)}}),Os.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(Iu.prototype,{setTexturePath:function(t){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(t)}}),Object.assign(Mc.prototype,{center:function(t){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},size:function(t){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(kt.prototype,{center:function(t){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(t)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(t){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionSphere:function(t){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)},size:function(t){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(t)}}),Object.assign(Bt.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),En.prototype.setFromMatrix=function(t){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(t)},Ac.prototype.center=function(t){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(t)},Object.assign(O,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(t){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),O.floorPowerOfTwo(t)},nextPowerOfTwo:function(t){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),O.ceilPowerOfTwo(t)}}),Object.assign(L.prototype,{flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},multiplyVector3:function(t){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),t.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(tt.prototype,{extractPosition:function(t){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(t)},flattenToArrayOffset:function(t,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(t,e)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new W).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(q){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(q)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(t){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector4:function(t){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(t){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),t.transformDirection(this)},crossVector:function(t){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(t){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),t.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(t,e,n,r,o,c){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(t,e,r,n,o,c)}}),Jt.prototype.isIntersectionLine=function(line){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(line)},G.prototype.multiplyVector3=function(t){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),t.applyQuaternion(this)},Object.assign(qt.prototype,{isIntersectionBox:function(t){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(t)},isIntersectionPlane:function(t){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(t)},isIntersectionSphere:function(t){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(t)}}),Object.assign(se.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(t,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(t,e)},midpoint:function(t){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(t)},normal:function(t){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(t)},plane:function(t){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(t)}}),Object.assign(se,{barycoordFromPoint:function(t,a,b,e,n){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),se.getBarycoord(t,a,b,e,n)},normal:function(a,b,t,e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),se.getNormal(a,b,t,e)}}),Object.assign(cu.prototype,{extractAllPoints:function(t){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(t)},extrude:function(t){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new La(this,t)},makeGeometry:function(t){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new qa(this,t)}}),Object.assign(D.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(W.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(t){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(t)},getScaleFromMatrix:function(t){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(t)},getColumnFromMatrix:function(t,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,t)},applyProjection:function(t){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(t)},fromAttribute:function(t,e,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},distanceToManhattan:function(t){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(t)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(z.prototype,{fromAttribute:function(t,e,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(t,e,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(pn.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(t){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.assign(bt.prototype,{getChildByName:function(t){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(t)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(t,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,t)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(t){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(bt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(t){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=t}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(on.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(on.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(uo.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(po.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),co.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Vs.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(t){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=t}}),xn.prototype.setLens=function(t,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==e&&(this.filmGauge=e),this.setFocalLength(t)},Object.defineProperties(lu.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(t){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=t}},shadowCameraLeft:{set:function(t){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=t}},shadowCameraRight:{set:function(t){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=t}},shadowCameraTop:{set:function(t){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=t}},shadowCameraBottom:{set:function(t){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=t}},shadowCameraNear:{set:function(t){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=t}},shadowCameraFar:{set:function(t){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=t}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(t){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=t}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(t){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=t}},shadowMapHeight:{set:function(t){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=t}}}),Object.defineProperties(we.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),35048===this.usage},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(35048)}}}),Object.assign(we.prototype,{setDynamic:function(t){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ue.prototype,{addIndex:function(t){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(t)},addAttribute:function(t,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),e&&e.isBufferAttribute||e&&e.isInterleavedBufferAttribute?"index"===t?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(t,e):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(t,new we(arguments[1],arguments[2])))},addDrawCall:function(t,e,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(t,e)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(t){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(t)},applyMatrix:function(t){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(t)}}),Object.defineProperties(Ue.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Tu.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(t){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=t}}}),Object.defineProperties(bc.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(t){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=t}}}),Object.defineProperties(Vi.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),35048===this.usage},set:function(t){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(t)}}}),Object.assign(Vi.prototype,{setDynamic:function(t){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===t?35048:35044),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(ka.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(yc.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(ve.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new he}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===t}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(t){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=t}}}),Object.defineProperties(ss.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(vn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(t){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=t}}}),Object.assign(Fi.prototype,{clearTarget:function(t,e,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(t),this.clear(e,n,r)},animate:function(t){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(t)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(t){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(t)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Fi.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=t}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(t){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=t}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(t){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===t?C:3e3}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ci.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(U.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=t}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(t){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=t}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=t}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(t){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=t}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(t){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=t}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(t){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=t}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(t){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=t}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(t){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=t}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(t){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=t}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(t){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=t}}}),Object.defineProperties(Qu.prototype,{load:{value:function(t){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const e=this;return(new Vu).load(t,(function(t){e.setBuffer(t)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),ic.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},bn.prototype.updateCubeMap=function(t,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(t,e)};P.crossOrigin=void 0,P.loadTexture=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const o=new Us;o.setCrossOrigin(this.crossOrigin);const c=o.load(t,n,void 0,r);return e&&(c.mapping=e),c},P.loadTextureCube=function(t,e,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const o=new zs;o.setCrossOrigin(this.crossOrigin);const c=o.load(t,n,void 0,r);return e&&(c.mapping=e),c},P.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},P.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"118"}}))},118:function(t,e,n){"use strict";(function(t){var r=n(182),o=n(183),c=n(184);function l(){return d.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function h(t,e){if(l()<e)throw new RangeError("Invalid typed array length");return d.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=d.prototype:(null===t&&(t=new d(e)),t.length=e),t}function d(t,e,n){if(!(d.TYPED_ARRAY_SUPPORT||this instanceof d))return new d(t,e,n);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return v(this,t)}return f(this,t,e,n)}function f(t,e,n,r){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,n,r){if(e.byteLength,n<0||e.byteLength<n)throw new RangeError("'offset' is out of bounds");if(e.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");e=void 0===n&&void 0===r?new Uint8Array(e):void 0===r?new Uint8Array(e,n):new Uint8Array(e,n,r);d.TYPED_ARRAY_SUPPORT?(t=e).__proto__=d.prototype:t=y(t,e);return t}(t,e,n,r):"string"==typeof e?function(t,e,n){"string"==typeof n&&""!==n||(n="utf8");if(!d.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|w(e,n),o=(t=h(t,r)).write(e,n);o!==r&&(t=t.slice(0,o));return t}(t,e,n):function(t,e){if(d.isBuffer(e)){var n=0|x(e.length);return 0===(t=h(t,n)).length||e.copy(t,0,0,n),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(r=e.length)!=r?h(t,0):y(t,e);if("Buffer"===e.type&&c(e.data))return y(t,e.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function m(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function v(t,e){if(m(e),t=h(t,e<0?0:0|x(e)),!d.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function y(t,e){var n=e.length<0?0:0|x(e.length);t=h(t,n);for(var i=0;i<n;i+=1)t[i]=255&e[i];return t}function x(t){if(t>=l())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+l().toString(16)+" bytes");return 0|t}function w(t,e){if(d.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var n=t.length;if(0===n)return 0;for(var r=!1;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Y(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return K(t).length;default:if(r)return Y(t).length;e=(""+e).toLowerCase(),r=!0}}function _(t,e,n){var r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return P(this,e,n);case"utf8":case"utf-8":return D(this,e,n);case"ascii":return L(this,e,n);case"latin1":case"binary":return k(this,e,n);case"base64":return O(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function S(b,t,e){var i=b[t];b[t]=b[e],b[e]=i}function M(t,e,n,r,o){if(0===t.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=o?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(o)return-1;n=t.length-1}else if(n<0){if(!o)return-1;n=0}if("string"==typeof e&&(e=d.from(e,r)),d.isBuffer(e))return 0===e.length?-1:E(t,e,n,r,o);if("number"==typeof e)return e&=255,d.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?o?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):E(t,[e],n,r,o);throw new TypeError("val must be string, number or Buffer")}function E(t,e,n,r,o){var i,c=1,l=t.length,h=e.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;c=2,l/=2,h/=2,n/=2}function d(t,i){return 1===c?t[i]:t.readUInt16BE(i*c)}if(o){var f=-1;for(i=n;i<l;i++)if(d(t,i)===d(e,-1===f?0:i-f)){if(-1===f&&(f=i),i-f+1===h)return f*c}else-1!==f&&(i-=i-f),f=-1}else for(n+h>l&&(n=l-h),i=n;i>=0;i--){for(var m=!0,v=0;v<h;v++)if(d(t,i+v)!==d(e,v)){m=!1;break}if(m)return i}return-1}function T(t,e,n,r){n=Number(n)||0;var o=t.length-n;r?(r=Number(r))>o&&(r=o):r=o;var c=e.length;if(c%2!=0)throw new TypeError("Invalid hex string");r>c/2&&(r=c/2);for(var i=0;i<r;++i){var l=parseInt(e.substr(2*i,2),16);if(isNaN(l))return i;t[n+i]=l}return i}function A(t,e,n,r){return J(Y(e,t.length-n),t,n,r)}function C(t,e,n,r){return J(function(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}(e),t,n,r)}function R(t,e,n,r){return C(t,e,n,r)}function I(t,e,n,r){return J(K(e),t,n,r)}function N(t,e,n,r){return J(function(t,e){for(var n,r,o,c=[],i=0;i<t.length&&!((e-=2)<0);++i)n=t.charCodeAt(i),r=n>>8,o=n%256,c.push(o),c.push(r);return c}(e,t.length-n),t,n,r)}function O(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function D(t,e,n){n=Math.min(t.length,n);for(var r=[],i=e;i<n;){var o,c,l,h,d=t[i],f=null,m=d>239?4:d>223?3:d>191?2:1;if(i+m<=n)switch(m){case 1:d<128&&(f=d);break;case 2:128==(192&(o=t[i+1]))&&(h=(31&d)<<6|63&o)>127&&(f=h);break;case 3:o=t[i+1],c=t[i+2],128==(192&o)&&128==(192&c)&&(h=(15&d)<<12|(63&o)<<6|63&c)>2047&&(h<55296||h>57343)&&(f=h);break;case 4:o=t[i+1],c=t[i+2],l=t[i+3],128==(192&o)&&128==(192&c)&&128==(192&l)&&(h=(15&d)<<18|(63&o)<<12|(63&c)<<6|63&l)>65535&&h<1114112&&(f=h)}null===f?(f=65533,m=1):f>65535&&(f-=65536,r.push(f>>>10&1023|55296),f=56320|1023&f),r.push(f),i+=m}return function(t){var e=t.length;if(e<=4096)return String.fromCharCode.apply(String,t);var n="",i=0;for(;i<e;)n+=String.fromCharCode.apply(String,t.slice(i,i+=4096));return n}(r)}e.Buffer=d,e.SlowBuffer=function(t){+t!=t&&(t=0);return d.alloc(+t)},e.INSPECT_MAX_BYTES=50,d.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=l(),d.poolSize=8192,d._augment=function(t){return t.__proto__=d.prototype,t},d.from=function(t,e,n){return f(null,t,e,n)},d.TYPED_ARRAY_SUPPORT&&(d.prototype.__proto__=Uint8Array.prototype,d.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&d[Symbol.species]===d&&Object.defineProperty(d,Symbol.species,{value:null,configurable:!0})),d.alloc=function(t,e,n){return function(t,e,n,r){return m(e),e<=0?h(t,e):void 0!==n?"string"==typeof r?h(t,e).fill(n,r):h(t,e).fill(n):h(t,e)}(null,t,e,n)},d.allocUnsafe=function(t){return v(null,t)},d.allocUnsafeSlow=function(t){return v(null,t)},d.isBuffer=function(b){return!(null==b||!b._isBuffer)},d.compare=function(a,b){if(!d.isBuffer(a)||!d.isBuffer(b))throw new TypeError("Arguments must be Buffers");if(a===b)return 0;for(var t=a.length,e=b.length,i=0,n=Math.min(t,e);i<n;++i)if(a[i]!==b[i]){t=a[i],e=b[i];break}return t<e?-1:e<t?1:0},d.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(t,e){if(!c(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return d.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=d.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var o=t[i];if(!d.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,r),r+=o.length}return n},d.byteLength=w,d.prototype._isBuffer=!0,d.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<t;i+=2)S(this,i,i+1);return this},d.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<t;i+=4)S(this,i,i+3),S(this,i+1,i+2);return this},d.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<t;i+=8)S(this,i,i+7),S(this,i+1,i+6),S(this,i+2,i+5),S(this,i+3,i+4);return this},d.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?D(this,0,t):_.apply(this,arguments)},d.prototype.equals=function(b){if(!d.isBuffer(b))throw new TypeError("Argument must be a Buffer");return this===b||0===d.compare(this,b)},d.prototype.inspect=function(){var t="",n=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(t+=" ... ")),"<Buffer "+t+">"},d.prototype.compare=function(t,e,n,r,o){if(!d.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===o&&(o=this.length),e<0||n>t.length||r<0||o>this.length)throw new RangeError("out of range index");if(r>=o&&e>=n)return 0;if(r>=o)return-1;if(e>=n)return 1;if(this===t)return 0;for(var c=(o>>>=0)-(r>>>=0),l=(n>>>=0)-(e>>>=0),h=Math.min(c,l),f=this.slice(r,o),m=t.slice(e,n),i=0;i<h;++i)if(f[i]!==m[i]){c=f[i],l=m[i];break}return c<l?-1:l<c?1:0},d.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},d.prototype.indexOf=function(t,e,n){return M(this,t,e,n,!0)},d.prototype.lastIndexOf=function(t,e,n){return M(this,t,e,n,!1)},d.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"==typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var o=this.length-e;if((void 0===n||n>o)&&(n=o),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var c=!1;;)switch(r){case"hex":return T(this,t,e,n);case"utf8":case"utf-8":return A(this,t,e,n);case"ascii":return C(this,t,e,n);case"latin1":case"binary":return R(this,t,e,n);case"base64":return I(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,e,n);default:if(c)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),c=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function L(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function k(t,e,n){var r="";n=Math.min(t.length,n);for(var i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function P(t,e,n){var r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);for(var o="",i=e;i<n;++i)o+=X(t[i]);return o}function F(t,e,n){for(var r=t.slice(e,n),o="",i=0;i<r.length;i+=2)o+=String.fromCharCode(r[i]+256*r[i+1]);return o}function B(t,e,n){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function z(t,e,n,r,o,c){if(!d.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>o||e<c)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function U(t,e,n,r){e<0&&(e=65535+e+1);for(var i=0,o=Math.min(t.length-n,2);i<o;++i)t[n+i]=(e&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function V(t,e,n,r){e<0&&(e=4294967295+e+1);for(var i=0,o=Math.min(t.length-n,4);i<o;++i)t[n+i]=e>>>8*(r?i:3-i)&255}function G(t,e,n,r,o,c){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function H(t,e,n,r,c){return c||G(t,0,n,4),o.write(t,e,n,r,23,4),n+4}function j(t,e,n,r,c){return c||G(t,0,n,8),o.write(t,e,n,r,52,8),n+8}d.prototype.slice=function(t,e){var n,r=this.length;if((t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t),d.TYPED_ARRAY_SUPPORT)(n=this.subarray(t,e)).__proto__=d.prototype;else{var o=e-t;n=new d(o,void 0);for(var i=0;i<o;++i)n[i]=this[i+t]}return n},d.prototype.readUIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r},d.prototype.readUIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t+--e],o=1;e>0&&(o*=256);)r+=this[t+--e]*o;return r},d.prototype.readUInt8=function(t,e){return e||B(t,1,this.length),this[t]},d.prototype.readUInt16LE=function(t,e){return e||B(t,2,this.length),this[t]|this[t+1]<<8},d.prototype.readUInt16BE=function(t,e){return e||B(t,2,this.length),this[t]<<8|this[t+1]},d.prototype.readUInt32LE=function(t,e){return e||B(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},d.prototype.readUInt32BE=function(t,e){return e||B(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},d.prototype.readIntLE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var r=this[t],o=1,i=0;++i<e&&(o*=256);)r+=this[t+i]*o;return r>=(o*=128)&&(r-=Math.pow(2,8*e)),r},d.prototype.readIntBE=function(t,e,n){t|=0,e|=0,n||B(t,e,this.length);for(var i=e,r=1,o=this[t+--i];i>0&&(r*=256);)o+=this[t+--i]*r;return o>=(r*=128)&&(o-=Math.pow(2,8*e)),o},d.prototype.readInt8=function(t,e){return e||B(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},d.prototype.readInt16LE=function(t,e){e||B(t,2,this.length);var n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt16BE=function(t,e){e||B(t,2,this.length);var n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},d.prototype.readInt32LE=function(t,e){return e||B(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},d.prototype.readInt32BE=function(t,e){return e||B(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},d.prototype.readFloatLE=function(t,e){return e||B(t,4,this.length),o.read(this,t,!0,23,4)},d.prototype.readFloatBE=function(t,e){return e||B(t,4,this.length),o.read(this,t,!1,23,4)},d.prototype.readDoubleLE=function(t,e){return e||B(t,8,this.length),o.read(this,t,!0,52,8)},d.prototype.readDoubleBE=function(t,e){return e||B(t,8,this.length),o.read(this,t,!1,52,8)},d.prototype.writeUIntLE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||z(this,t,e,n,Math.pow(2,8*n)-1,0);var o=1,i=0;for(this[e]=255&t;++i<n&&(o*=256);)this[e+i]=t/o&255;return e+n},d.prototype.writeUIntBE=function(t,e,n,r){(t=+t,e|=0,n|=0,r)||z(this,t,e,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[e+i]=255&t;--i>=0&&(o*=256);)this[e+i]=t/o&255;return e+n},d.prototype.writeUInt8=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,1,255,0),d.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},d.prototype.writeUInt16LE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},d.prototype.writeUInt16BE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,2,65535,0),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},d.prototype.writeUInt32LE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):V(this,t,e,!0),e+4},d.prototype.writeUInt32BE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,4,4294967295,0),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},d.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);z(this,t,e,n,o-1,-o)}var i=0,c=1,sub=0;for(this[e]=255&t;++i<n&&(c*=256);)t<0&&0===sub&&0!==this[e+i-1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},d.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e|=0,!r){var o=Math.pow(2,8*n-1);z(this,t,e,n,o-1,-o)}var i=n-1,c=1,sub=0;for(this[e+i]=255&t;--i>=0&&(c*=256);)t<0&&0===sub&&0!==this[e+i+1]&&(sub=1),this[e+i]=(t/c>>0)-sub&255;return e+n},d.prototype.writeInt8=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,1,127,-128),d.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},d.prototype.writeInt16LE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):U(this,t,e,!0),e+2},d.prototype.writeInt16BE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,2,32767,-32768),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):U(this,t,e,!1),e+2},d.prototype.writeInt32LE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,4,2147483647,-2147483648),d.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):V(this,t,e,!0),e+4},d.prototype.writeInt32BE=function(t,e,n){return t=+t,e|=0,n||z(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),d.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):V(this,t,e,!1),e+4},d.prototype.writeFloatLE=function(t,e,n){return H(this,t,e,!0,n)},d.prototype.writeFloatBE=function(t,e,n){return H(this,t,e,!1,n)},d.prototype.writeDoubleLE=function(t,e,n){return j(this,t,e,!0,n)},d.prototype.writeDoubleBE=function(t,e,n){return j(this,t,e,!1,n)},d.prototype.copy=function(t,e,n,r){if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);var i,o=r-n;if(this===t&&n<e&&e<r)for(i=o-1;i>=0;--i)t[i+e]=this[i+n];else if(o<1e3||!d.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)t[i+e]=this[i+n];else Uint8Array.prototype.set.call(t,this.subarray(n,n+o),e);return o},d.prototype.fill=function(t,e,n,r){if("string"==typeof t){if("string"==typeof e?(r=e,e=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===t.length){var code=t.charCodeAt(0);code<256&&(t=code)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!d.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;var i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"==typeof t)for(i=e;i<n;++i)this[i]=t;else{var o=d.isBuffer(t)?t:Y(new d(t,r).toString()),c=o.length;for(i=0;i<n-e;++i)this[i+e]=o[i%c]}return this};var W=/[^+\/0-9A-Za-z-_]/g;function X(t){return t<16?"0"+t.toString(16):t.toString(16)}function Y(t,e){var n;e=e||1/0;for(var r=t.length,o=null,c=[],i=0;i<r;++i){if((n=t.charCodeAt(i))>55295&&n<57344){if(!o){if(n>56319){(e-=3)>-1&&c.push(239,191,189);continue}if(i+1===r){(e-=3)>-1&&c.push(239,191,189);continue}o=n;continue}if(n<56320){(e-=3)>-1&&c.push(239,191,189),o=n;continue}n=65536+(o-55296<<10|n-56320)}else o&&(e-=3)>-1&&c.push(239,191,189);if(o=null,n<128){if((e-=1)<0)break;c.push(n)}else if(n<2048){if((e-=2)<0)break;c.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;c.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;c.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return c}function K(t){return r.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(W,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function J(t,e,n,r){for(var i=0;i<r&&!(i+n>=e.length||i>=t.length);++i)e[i+n]=t[i];return i}}).call(this,n(27))},119:function(t,e,n){"use strict";e.a=function(t,e){return e=e||{},new Promise((function(n,r){var s=new XMLHttpRequest,o=[],u=[],i={},a=function(){return{ok:2==(s.status/100|0),statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(JSON.parse(s.responseText))},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:a,headers:{keys:function(){return o},entries:function(){return u},get:function(t){return i[t.toLowerCase()]},has:function(t){return t.toLowerCase()in i}}}};for(var c in s.open(e.method||"get",t,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,(function(t,e,n){o.push(e=e.toLowerCase()),u.push([e,n]),i[e]=i[e]?i[e]+","+n:n})),n(a())},s.onerror=r,s.withCredentials="include"==e.credentials,e.headers)s.setRequestHeader(c,e.headers[c]);s.send(e.body||null)}))}},121:function(t,e,n){"use strict";var r=function(t){return function(t){return!!t&&"object"==typeof t}(t)&&!function(t){var e=Object.prototype.toString.call(t);return"[object RegExp]"===e||"[object Date]"===e||function(t){return t.$$typeof===o}(t)}(t)};var o="function"==typeof Symbol&&Symbol.for?Symbol.for("react.element"):60103;function c(t,e){return!1!==e.clone&&e.isMergeableObject(t)?m((n=t,Array.isArray(n)?[]:{}),t,e):t;var n}function l(t,source,e){return t.concat(source).map((function(element){return c(element,e)}))}function h(t){return Object.keys(t).concat(function(t){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(t).filter((function(symbol){return t.propertyIsEnumerable(symbol)})):[]}(t))}function d(object,t){try{return t in object}catch(t){return!1}}function f(t,source,e){var n={};return e.isMergeableObject(t)&&h(t).forEach((function(r){n[r]=c(t[r],e)})),h(source).forEach((function(r){(function(t,e){return d(t,e)&&!(Object.hasOwnProperty.call(t,e)&&Object.propertyIsEnumerable.call(t,e))})(t,r)||(d(t,r)&&e.isMergeableObject(source[r])?n[r]=function(t,e){if(!e.customMerge)return m;var n=e.customMerge(t);return"function"==typeof n?n:m}(r,e)(t[r],source[r],e):n[r]=c(source[r],e))})),n}function m(t,source,e){(e=e||{}).arrayMerge=e.arrayMerge||l,e.isMergeableObject=e.isMergeableObject||r,e.cloneUnlessOtherwiseSpecified=c;var n=Array.isArray(source);return n===Array.isArray(t)?n?e.arrayMerge(t,source,e):f(t,source,e):c(source,e)}m.all=function(t,e){if(!Array.isArray(t))throw new Error("first argument should be an array");return t.reduce((function(t,n){return m(t,n,e)}),{})};var v=m;t.exports=v},122:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(1),o=function(){function t(t){r.A.call(this,t),this.dracoLoader=null,this.ddsLoader=null,this.pluginCallbacks=[],this.register((function(t){return new h(t)}))}function e(){var t={};return{get:function(e){return t[e]},add:function(e,object){t[e]=object},remove:function(e){delete t[e]},removeAll:function(){t={}}}}t.prototype=Object.assign(Object.create(r.A.prototype),{constructor:t,load:function(t,e,n,o){var c,l=this;c=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.B.extractUrlBase(t),l.manager.itemStart(t);var h=function(e){o?o(e):console.error(e),l.manager.itemError(t),l.manager.itemEnd(t)},d=new r.k(l.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),"use-credentials"===l.crossOrigin&&d.setWithCredentials(!0),d.load(t,(function(data){try{l.parse(data,c,(function(n){e(n),l.manager.itemEnd(t)}),h)}catch(t){h(t)}}),n,h)},setDRACOLoader:function(t){return this.dracoLoader=t,this},setDDSLoader:function(t){return this.ddsLoader=t,this},register:function(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this},unregister:function(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this},parse:function(data,path,t,e){var content,h={},f={};if("string"==typeof data)content=data;else if(r.B.decodeText(new Uint8Array(data,0,4))===d){try{h[n.KHR_BINARY_GLTF]=new v(data)}catch(t){return void(e&&e(t))}content=h[n.KHR_BINARY_GLTF].content}else content=r.B.decodeText(new Uint8Array(data));var m=JSON.parse(content);if(void 0===m.asset||m.asset.version[0]<2)e&&e(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var w=new K(m,{path:path||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager});w.fileLoader.setRequestHeader(this.requestHeader);for(var i=0;i<this.pluginCallbacks.length;i++){var M=this.pluginCallbacks[i](w);f[M.name]=M,h[M.name]=!0}if(m.extensionsUsed)for(i=0;i<m.extensionsUsed.length;++i){var E=m.extensionsUsed[i],T=m.extensionsRequired||[];switch(E){case n.KHR_LIGHTS_PUNCTUAL:h[E]=new c(m);break;case n.KHR_MATERIALS_UNLIT:h[E]=new l;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:h[E]=new _;break;case n.KHR_DRACO_MESH_COMPRESSION:h[E]=new y(m,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:h[E]=new o(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:h[E]=new x;break;case n.KHR_MESH_QUANTIZATION:h[E]=new S;break;default:T.indexOf(E)>=0&&void 0===f[E]&&console.warn('THREE.GLTFLoader: Unknown extension "'+E+'".')}}w.setExtensions(h),w.setPlugins(f),w.parse(t,e)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function o(t){if(!t)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=t}function c(t){this.name=n.KHR_LIGHTS_PUNCTUAL;var e=t.extensions&&t.extensions[n.KHR_LIGHTS_PUNCTUAL]||{};this.lightDefs=e.lights||[]}function l(){this.name=n.KHR_MATERIALS_UNLIT}function h(t){this.parser=t,this.name=n.KHR_MATERIALS_CLEARCOAT}c.prototype.loadLight=function(t){var e,n=this.lightDefs[t],o=new r.h(16777215);void 0!==n.color&&o.fromArray(n.color);var c=void 0!==n.range?n.range:0;switch(n.type){case"directional":(e=new r.i(o)).target.position.set(0,0,-1),e.add(e.target);break;case"point":(e=new r.R(o)).distance=c;break;case"spot":(e=new r.eb(o)).distance=c,n.spot=n.spot||{},n.spot.innerConeAngle=void 0!==n.spot.innerConeAngle?n.spot.innerConeAngle:0,n.spot.outerConeAngle=void 0!==n.spot.outerConeAngle?n.spot.outerConeAngle:Math.PI/4,e.angle=n.spot.outerConeAngle,e.penumbra=1-n.spot.innerConeAngle/n.spot.outerConeAngle,e.target.position.set(0,0,-1),e.add(e.target);break;default:throw new Error('THREE.GLTFLoader: Unexpected light type, "'+n.type+'".')}return e.position.set(0,0,0),e.decay=2,void 0!==n.intensity&&(e.intensity=n.intensity),e.name=n.name||"light_"+t,Promise.resolve(e)},l.prototype.getMaterialType=function(){return r.G},l.prototype.extendParams=function(t,e,n){var o=[];t.color=new r.h(1,1,1),t.opacity=1;var c=e.pbrMetallicRoughness;if(c){if(Array.isArray(c.baseColorFactor)){var l=c.baseColorFactor;t.color.fromArray(l),t.opacity=l[3]}void 0!==c.baseColorTexture&&o.push(n.assignTexture(t,"map",c.baseColorTexture))}return Promise.all(o)},h.prototype.getMaterialType=function(){return r.H},h.prototype.extendMaterialParams=function(t,e){var n=this.parser,o=n.json.materials[t];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();var c=[],l=o.extensions[this.name];if(void 0!==l.clearcoatFactor&&(e.clearcoat=l.clearcoatFactor),void 0!==l.clearcoatTexture&&c.push(n.assignTexture(e,"clearcoatMap",l.clearcoatTexture)),void 0!==l.clearcoatRoughnessFactor&&(e.clearcoatRoughness=l.clearcoatRoughnessFactor),void 0!==l.clearcoatRoughnessTexture&&c.push(n.assignTexture(e,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),void 0!==l.clearcoatNormalTexture&&(c.push(n.assignTexture(e,"clearcoatNormalMap",l.clearcoatNormalTexture)),void 0!==l.clearcoatNormalTexture.scale)){var h=l.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new r.kb(h,h)}return Promise.all(c)};var d="glTF",f=1313821514,m=5130562;function v(data){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(data,0,12);if(this.header={magic:r.B.decodeText(new Uint8Array(data.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==d)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var e=new DataView(data,12),o=0;o<e.byteLength;){var c=e.getUint32(o,!0);o+=4;var l=e.getUint32(o,!0);if(o+=4,l===f){var h=new Uint8Array(data,12+o,c);this.content=r.B.decodeText(h)}else if(l===m){var v=12+o;this.body=data.slice(v,v+c)}o+=c}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function y(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}function x(){this.name=n.KHR_TEXTURE_TRANSFORM}function w(t){r.I.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var e=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),o=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),c=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 );// 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),h={specular:{value:(new r.h).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=h,this.onBeforeCompile=function(t){for(var r in h)t.uniforms[r]=h[r];t.fragmentShader=t.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;"),t.fragmentShader=t.fragmentShader.replace("uniform float metalness;","uniform float glossiness;"),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_pars_fragment>",e),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_pars_fragment>",n),t.fragmentShader=t.fragmentShader.replace("#include <roughnessmap_fragment>",o),t.fragmentShader=t.fragmentShader.replace("#include <metalnessmap_fragment>",c),t.fragmentShader=t.fragmentShader.replace("#include <lights_physical_fragment>",l)},Object.defineProperties(this,{specular:{get:function(){return h.specular.value},set:function(t){h.specular.value=t}},specularMap:{get:function(){return h.specularMap.value},set:function(t){h.specularMap.value=t}},glossiness:{get:function(){return h.glossiness.value},set:function(t){h.glossiness.value=t}},glossinessMap:{get:function(){return h.glossinessMap.value},set:function(t){h.glossinessMap.value=t,t?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_ROUGHNESSMAP=""):(delete this.defines.USE_ROUGHNESSMAP,delete this.defines.USE_GLOSSINESSMAP)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(t)}function _(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return w},extendParams:function(t,e,n){var o=e.extensions[this.name];t.color=new r.h(1,1,1),t.opacity=1;var c=[];if(Array.isArray(o.diffuseFactor)){var l=o.diffuseFactor;t.color.fromArray(l),t.opacity=l[3]}if(void 0!==o.diffuseTexture&&c.push(n.assignTexture(t,"map",o.diffuseTexture)),t.emissive=new r.h(0,0,0),t.glossiness=void 0!==o.glossinessFactor?o.glossinessFactor:1,t.specular=new r.h(1,1,1),Array.isArray(o.specularFactor)&&t.specular.fromArray(o.specularFactor),void 0!==o.specularGlossinessTexture){var h=o.specularGlossinessTexture;c.push(n.assignTexture(t,"glossinessMap",h)),c.push(n.assignTexture(t,"specularMap",h))}return Promise.all(c)},createMaterial:function(t){var e=new w(t);return e.fog=!0,e.color=t.color,e.map=void 0===t.map?null:t.map,e.lightMap=null,e.lightMapIntensity=1,e.aoMap=void 0===t.aoMap?null:t.aoMap,e.aoMapIntensity=1,e.emissive=t.emissive,e.emissiveIntensity=1,e.emissiveMap=void 0===t.emissiveMap?null:t.emissiveMap,e.bumpMap=void 0===t.bumpMap?null:t.bumpMap,e.bumpScale=1,e.normalMap=void 0===t.normalMap?null:t.normalMap,e.normalMapType=r.fb,t.normalScale&&(e.normalScale=t.normalScale),e.displacementMap=null,e.displacementScale=1,e.displacementBias=0,e.specularMap=void 0===t.specularMap?null:t.specularMap,e.specular=t.specular,e.glossinessMap=void 0===t.glossinessMap?null:t.glossinessMap,e.glossiness=t.glossiness,e.alphaMap=null,e.envMap=void 0===t.envMap?null:t.envMap,e.envMapIntensity=1,e.refractionRatio=.98,e}}}function S(){this.name=n.KHR_MESH_QUANTIZATION}function M(t,e,n,o){r.q.call(this,t,e,n,o)}y.prototype.decodePrimitive=function(t,e){var n=this.json,r=this.dracoLoader,o=t.extensions[this.name].bufferView,c=t.extensions[this.name].attributes,l={},h={},d={};for(var f in c){var m=P[f]||f.toLowerCase();l[m]=c[f]}for(f in t.attributes){m=P[f]||f.toLowerCase();if(void 0!==c[f]){var v=n.accessors[t.attributes[f]],y=O[v.componentType];d[m]=y,h[m]=!0===v.normalized}}return e.getDependency("bufferView",o).then((function(t){return new Promise((function(e){r.decodeDracoFile(t,(function(t){for(var n in t.attributes){var r=t.attributes[n],o=h[n];void 0!==o&&(r.normalized=o)}e(t)}),l,d)}))}))},x.prototype.extendTexture=function(t,e){return t=t.clone(),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),void 0!==e.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.needsUpdate=!0,t},w.prototype=Object.create(r.I.prototype),w.prototype.constructor=w,w.prototype.copy=function(source){return r.I.prototype.copy.call(this,source),this.specularMap=source.specularMap,this.specular.copy(source.specular),this.glossinessMap=source.glossinessMap,this.glossiness=source.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},M.prototype=Object.create(r.q.prototype),M.prototype.constructor=M,M.prototype.copySampleValue_=function(t){for(var e=this.resultBuffer,n=this.sampleValues,r=this.valueSize,o=t*r*3+r,i=0;i!==r;i++)e[i]=n[o+i];return e},M.prototype.beforeStart_=M.prototype.copySampleValue_,M.prototype.afterEnd_=M.prototype.copySampleValue_,M.prototype.interpolate_=function(t,e,n,r){for(var o=this.resultBuffer,c=this.sampleValues,l=this.valueSize,h=2*l,d=3*l,td=r-e,p=(n-e)/td,f=p*p,m=f*p,v=t*d,y=v-d,x=-2*m+3*f,w=m-f,_=1-x,S=w-f+p,i=0;i!==l;i++){var M=c[y+i+l],E=c[y+i+h]*td,T=c[v+i+l],A=c[v+i]*td;o[i]=_*M+S*E+x*T+w*A}return o};var E=0,T=1,A=2,C=3,R=4,I=5,N=6,O={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},D={9728:r.K,9729:r.x,9984:r.M,9985:r.z,9986:r.L,9987:r.y},L={33071:r.g,33648:r.J,10497:r.Y},k={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},P={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},F={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},B={CUBICSPLINE:void 0,LINEAR:r.s,STEP:r.r},z="OPAQUE",U="MASK",V="BLEND",G={"image/png":r.W,"image/jpeg":r.X};function H(t,path){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(path)&&/^\//.test(t)&&(path=path.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:path+t)}function j(t,object,e){for(var n in e.extensions)void 0===t[n]&&(object.userData.gltfExtensions=object.userData.gltfExtensions||{},object.userData.gltfExtensions[n]=e.extensions[n])}function W(object,t){void 0!==t.extras&&("object"==typeof t.extras?Object.assign(object.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function X(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(var i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){var r=e.extras.targetNames;if(t.morphTargetInfluences.length===r.length){t.morphTargetDictionary={};for(i=0,n=r.length;i<n;i++)t.morphTargetDictionary[r[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Y(t){for(var e="",n=Object.keys(t).sort(),i=0,r=n.length;i<r;i++)e+=n[i]+":"+t[n[i]]+";";return e}function K(t,n){this.json=t||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new e,this.associations=new Map,this.primitiveCache={},"undefined"!=typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new r.n(this.options.manager):this.textureLoader=new r.gb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.k(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function J(t,e,n){var o=e.attributes,c=[];function l(e,r){return n.getDependency("accessor",e).then((function(e){t.setAttribute(r,e)}))}for(var h in o){var d=P[h]||h.toLowerCase();d in t.attributes||c.push(l(o[h],d))}if(void 0!==e.indices&&!t.index){var f=n.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));c.push(f)}return W(t,e),function(t,e,n){var o=e.attributes,c=new r.c;if(void 0!==o.POSITION){var l=(x=n.json.accessors[o.POSITION]).min,h=x.max;if(void 0!==l&&void 0!==h){c.set(new r.lb(l[0],l[1],l[2]),new r.lb(h[0],h[1],h[2]));var d=e.targets;if(void 0!==d){for(var f=new r.lb,m=new r.lb,i=0,v=d.length;i<v;i++){var y=d[i];if(void 0!==y.POSITION){var x;l=(x=n.json.accessors[y.POSITION]).min,h=x.max;void 0!==l&&void 0!==h?(m.setX(Math.max(Math.abs(l[0]),Math.abs(h[0]))),m.setY(Math.max(Math.abs(l[1]),Math.abs(h[1]))),m.setZ(Math.max(Math.abs(l[2]),Math.abs(h[2]))),f.max(m)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}c.expandByVector(f)}t.boundingBox=c;var w=new r.db;c.getCenter(w.center),w.radius=c.min.distanceTo(c.max)/2,t.boundingSphere=w}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(t,e,n),Promise.all(c).then((function(){return void 0!==e.targets?function(t,e,n){for(var r=!1,o=!1,i=0,c=e.length;i<c;i++){if(void 0!==(d=e[i]).POSITION&&(r=!0),void 0!==d.NORMAL&&(o=!0),r&&o)break}if(!r&&!o)return Promise.resolve(t);var l=[],h=[];for(i=0,c=e.length;i<c;i++){var d=e[i];if(r){var f=void 0!==d.POSITION?n.getDependency("accessor",d.POSITION):t.attributes.position;l.push(f)}if(o){f=void 0!==d.NORMAL?n.getDependency("accessor",d.NORMAL):t.attributes.normal;h.push(f)}}return Promise.all([Promise.all(l),Promise.all(h)]).then((function(e){var n=e[0],c=e[1];return r&&(t.morphAttributes.position=n),o&&(t.morphAttributes.normal=c),t.morphTargetsRelative=!0,t}))}(t,e.targets,n):t}))}function Z(t,e){var n=t.getIndex();if(null===n){var o=[],c=t.getAttribute("position");if(void 0===c)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(var i=0;i<c.count;i++)o.push(i);t.setIndex(o),n=t.getIndex()}var l=n.count-2,h=[];if(e===r.ib)for(i=1;i<=l;i++)h.push(n.getX(0)),h.push(n.getX(i)),h.push(n.getX(i+1));else for(i=0;i<l;i++)i%2==0?(h.push(n.getX(i)),h.push(n.getX(i+1)),h.push(n.getX(i+2))):(h.push(n.getX(i+2)),h.push(n.getX(i+1)),h.push(n.getX(i)));h.length/3!==l&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var d=t.clone();return d.setIndex(h),d}return K.prototype.setExtensions=function(t){this.extensions=t},K.prototype.setPlugins=function(t){this.plugins=t},K.prototype.parse=function(t,e){var n=this,r=this.json,o=this.extensions;this.cache.removeAll(),this.markDefs(),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(e){var c={scene:e[0][r.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:r.asset,parser:n,userData:{}};j(o,c,r),W(c,r),t(c)})).catch(e)},K.prototype.markDefs=function(){for(var t=this.json.nodes||[],e=this.json.skins||[],n=this.json.meshes||[],r={},o={},c=0,l=e.length;c<l;c++)for(var h=e[c].joints,i=0,d=h.length;i<d;i++)t[h[i]].isBone=!0;for(var f=0,m=t.length;f<m;f++){var v=t[f];void 0!==v.mesh&&(void 0===r[v.mesh]&&(r[v.mesh]=o[v.mesh]=0),r[v.mesh]++,void 0!==v.skin&&(n[v.mesh].isSkinnedMesh=!0))}this.json.meshReferences=r,this.json.meshUses=o},K.prototype._invokeOne=function(t){var e=Object.values(this.plugins);e.push(this);for(var i=0;i<e.length;i++){var n=t(e[i]);if(n)return n}},K.prototype._invokeAll=function(t){var e=Object.values(this.plugins);e.unshift(this);for(var n=[],i=0;i<e.length;i++)n.push(t(e[i]));return Promise.all(n)},K.prototype.getDependency=function(t,e){var r=t+":"+e,o=this.cache.get(r);if(!o){switch(t){case"scene":o=this.loadScene(e);break;case"node":o=this.loadNode(e);break;case"mesh":o=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":o=this.loadAccessor(e);break;case"bufferView":o=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":o=this.loadBuffer(e);break;case"material":o=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":o=this.loadTexture(e);break;case"skin":o=this.loadSkin(e);break;case"animation":o=this.loadAnimation(e);break;case"camera":o=this.loadCamera(e);break;case"light":o=this.extensions[n.KHR_LIGHTS_PUNCTUAL].loadLight(e);break;default:throw new Error("Unknown type: "+t)}this.cache.add(r,o)}return o},K.prototype.getDependencies=function(t){var e=this.cache.get(t);if(!e){var n=this,defs=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(defs.map((function(e,r){return n.getDependency(t,r)}))),this.cache.add(t,e)}return e},K.prototype.loadBuffer=function(t){var e=this.json.buffers[t],r=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var o=this.options;return new Promise((function(t,n){r.load(H(e.uri,o.path),t,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))},K.prototype.loadBufferView=function(t){var e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){var n=e.byteLength||0,r=e.byteOffset||0;return t.slice(r,r+n)}))},K.prototype.loadAccessor=function(t){var e=this,n=this.json,o=this.json.accessors[t];if(void 0===o.bufferView&&void 0===o.sparse)return Promise.resolve(null);var c=[];return void 0!==o.bufferView?c.push(this.getDependency("bufferView",o.bufferView)):c.push(null),void 0!==o.sparse&&(c.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),c.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(c).then((function(t){var c,l,h=t[0],d=k[o.type],f=O[o.componentType],m=f.BYTES_PER_ELEMENT,v=m*d,y=o.byteOffset||0,x=void 0!==o.bufferView?n.bufferViews[o.bufferView].byteStride:void 0,w=!0===o.normalized;if(x&&x!==v){var _=Math.floor(y/x),S="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+_+":"+o.count,M=e.cache.get(S);M||(c=new f(h,_*x,o.count*x/m),M=new r.o(c,x/m),e.cache.add(S,M)),l=new r.p(M,d,y%x/m,w)}else c=null===h?new f(o.count*d):new f(h,y,o.count*d),l=new r.d(c,d,w);if(void 0!==o.sparse){var E=k.SCALAR,T=O[o.sparse.indices.componentType],A=o.sparse.indices.byteOffset||0,C=o.sparse.values.byteOffset||0,R=new T(t[1],A,o.sparse.count*E),I=new f(t[2],C,o.sparse.count*d);null!==h&&(l=new r.d(l.array.slice(),l.itemSize,l.normalized));for(var i=0,N=R.length;i<N;i++){var D=R[i];if(l.setX(D,I[i*d]),d>=2&&l.setY(D,I[i*d+1]),d>=3&&l.setZ(D,I[i*d+2]),d>=4&&l.setW(D,I[i*d+3]),d>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return l}))},K.prototype.loadTexture=function(t){var source,e=this,o=this.json,c=this.options,l=this.textureLoader,h=self.URL||self.webkitURL,d=o.textures[t],f=d.extensions||{},m=(source=f[n.MSFT_TEXTURE_DDS]?o.images[f[n.MSFT_TEXTURE_DDS].source]:o.images[d.source]).uri,v=!1;return void 0!==source.bufferView&&(m=e.getDependency("bufferView",source.bufferView).then((function(t){v=!0;var e=new Blob([t],{type:source.mimeType});return m=h.createObjectURL(e)}))),Promise.resolve(m).then((function(t){var o=c.manager.getHandler(t);return o||(o=f[n.MSFT_TEXTURE_DDS]?e.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:l),new Promise((function(e,n){var l=e;!0===o.isImageBitmapLoader&&(l=function(t){e(new r.f(t))}),o.load(H(t,c.path),l,void 0,n)}))})).then((function(n){!0===v&&h.revokeObjectURL(m),n.flipY=!1,d.name&&(n.name=d.name),source.mimeType in G&&(n.format=G[source.mimeType]);var c=(o.samplers||{})[d.sampler]||{};return n.magFilter=D[c.magFilter]||r.x,n.minFilter=D[c.minFilter]||r.y,n.wrapS=L[c.wrapS]||r.Y,n.wrapT=L[c.wrapT]||r.Y,e.associations.set(n,{type:"textures",index:t}),n}))},K.prototype.assignTexture=function(t,e,o){var c=this;return this.getDependency("texture",o.index).then((function(l){if(!l.isCompressedTexture)switch(e){case"aoMap":case"emissiveMap":case"metalnessMap":case"normalMap":case"roughnessMap":l.format=r.X}if(void 0===o.texCoord||0==o.texCoord||"aoMap"===e&&1==o.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+o.texCoord+" for texture "+e+" not yet supported."),c.extensions[n.KHR_TEXTURE_TRANSFORM]){var h=void 0!==o.extensions?o.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(h){var d=c.associations.get(l);l=c.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(l,h),c.associations.set(l,d)}}t[e]=l}))},K.prototype.assignFinalMaterial=function(t){var e=t.geometry,n=t.material,o=void 0!==e.attributes.tangent,c=void 0!==e.attributes.color,l=void 0===e.attributes.normal,h=!0===t.isSkinnedMesh,d=Object.keys(e.morphAttributes).length>0,f=d&&void 0!==e.morphAttributes.normal;if(t.isPoints){var m="PointsMaterial:"+n.uuid,v=this.cache.get(m);v||(v=new r.T,r.C.prototype.copy.call(v,n),v.color.copy(n.color),v.map=n.map,v.sizeAttenuation=!1,this.cache.add(m,v)),n=v}else if(t.isLine){m="LineBasicMaterial:"+n.uuid;var y=this.cache.get(m);y||(y=new r.u,r.C.prototype.copy.call(y,n),y.color.copy(n.color),this.cache.add(m,y)),n=y}if(o||c||l||h||d){m="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(m+="specular-glossiness:"),h&&(m+="skinning:"),o&&(m+="vertex-tangents:"),c&&(m+="vertex-colors:"),l&&(m+="flat-shading:"),d&&(m+="morph-targets:"),f&&(m+="morph-normals:");var x=this.cache.get(m);x||(x=n.clone(),h&&(x.skinning=!0),o&&(x.vertexTangents=!0),c&&(x.vertexColors=!0),l&&(x.flatShading=!0),d&&(x.morphTargets=!0),f&&(x.morphNormals=!0),this.cache.add(m,x),this.associations.set(x,this.associations.get(n))),n=x}n.aoMap&&void 0===e.attributes.uv2&&void 0!==e.attributes.uv&&e.setAttribute("uv2",e.attributes.uv),n.normalScale&&!o&&(n.normalScale.y=-n.normalScale.y),n.clearcoatNormalScale&&!o&&(n.clearcoatNormalScale.y=-n.clearcoatNormalScale.y),t.material=n},K.prototype.getMaterialType=function(){return r.I},K.prototype.loadMaterial=function(t){var e,o=this,c=this.json,l=this.extensions,h=c.materials[t],d={},f=h.extensions||{},m=[];if(f[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var v=l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];e=v.getMaterialType(),m.push(v.extendParams(d,h,o))}else if(f[n.KHR_MATERIALS_UNLIT]){var y=l[n.KHR_MATERIALS_UNLIT];e=y.getMaterialType(),m.push(y.extendParams(d,h,o))}else{var x=h.pbrMetallicRoughness||{};if(d.color=new r.h(1,1,1),d.opacity=1,Array.isArray(x.baseColorFactor)){var _=x.baseColorFactor;d.color.fromArray(_),d.opacity=_[3]}void 0!==x.baseColorTexture&&m.push(o.assignTexture(d,"map",x.baseColorTexture)),d.metalness=void 0!==x.metallicFactor?x.metallicFactor:1,d.roughness=void 0!==x.roughnessFactor?x.roughnessFactor:1,void 0!==x.metallicRoughnessTexture&&(m.push(o.assignTexture(d,"metalnessMap",x.metallicRoughnessTexture)),m.push(o.assignTexture(d,"roughnessMap",x.metallicRoughnessTexture))),e=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),m.push(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,d)})))}!0===h.doubleSided&&(d.side=r.j);var S=h.alphaMode||z;return S===V?(d.transparent=!0,d.depthWrite=!1):(d.transparent=!1,S===U&&(d.alphaTest=void 0!==h.alphaCutoff?h.alphaCutoff:.5)),void 0!==h.normalTexture&&e!==r.G&&(m.push(o.assignTexture(d,"normalMap",h.normalTexture)),d.normalScale=new r.kb(1,1),void 0!==h.normalTexture.scale&&d.normalScale.set(h.normalTexture.scale,h.normalTexture.scale)),void 0!==h.occlusionTexture&&e!==r.G&&(m.push(o.assignTexture(d,"aoMap",h.occlusionTexture)),void 0!==h.occlusionTexture.strength&&(d.aoMapIntensity=h.occlusionTexture.strength)),void 0!==h.emissiveFactor&&e!==r.G&&(d.emissive=(new r.h).fromArray(h.emissiveFactor)),void 0!==h.emissiveTexture&&e!==r.G&&m.push(o.assignTexture(d,"emissiveMap",h.emissiveTexture)),Promise.all(m).then((function(){var c;return c=e===w?l[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(d):new e(d),h.name&&(c.name=h.name),c.map&&(c.map.encoding=r.ob),c.emissiveMap&&(c.emissiveMap.encoding=r.ob),W(c,h),o.associations.set(c,{type:"materials",index:t}),h.extensions&&j(l,c,h),c}))},K.prototype.loadGeometries=function(t){var e=this,o=this.extensions,c=this.primitiveCache;function l(t){return o[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(n){return J(n,t,e)}))}for(var h,d,f=[],i=0,m=t.length;i<m;i++){var v,y=t[i],x=(d=void 0,(d=(h=y).extensions&&h.extensions[n.KHR_DRACO_MESH_COMPRESSION])?"draco:"+d.bufferView+":"+d.indices+":"+Y(d.attributes):h.indices+":"+Y(h.attributes)+":"+h.mode),w=c[x];if(w)f.push(w.promise);else v=y.extensions&&y.extensions[n.KHR_DRACO_MESH_COMPRESSION]?l(y):J(new r.e,y,e),c[x]={primitive:y,promise:v},f.push(v)}return Promise.all(f)},K.prototype.loadMesh=function(t){for(var e,n=this,o=this.json.meshes[t],c=o.primitives,l=[],i=0,h=c.length;i<h;i++){var d=void 0===c[i].material?(void 0===(e=this.cache).DefaultMaterial&&(e.DefaultMaterial=new r.I({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.l})),e.DefaultMaterial):this.getDependency("material",c[i].material);l.push(d)}return l.push(n.loadGeometries(c)),Promise.all(l).then((function(e){for(var l=e.slice(0,e.length-1),h=e[e.length-1],d=[],i=0,f=h.length;i<f;i++){var m,v=h[i],y=c[i],x=l[i];if(y.mode===R||y.mode===I||y.mode===N||void 0===y.mode)!0!==(m=!0===o.isSkinnedMesh?new r.cb(v,x):new r.F(v,x)).isSkinnedMesh||m.geometry.attributes.skinWeight.normalized||m.normalizeSkinWeights(),y.mode===I?m.geometry=Z(m.geometry,r.jb):y.mode===N&&(m.geometry=Z(m.geometry,r.ib));else if(y.mode===T)m=new r.w(v,x);else if(y.mode===C)m=new r.t(v,x);else if(y.mode===A)m=new r.v(v,x);else{if(y.mode!==E)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+y.mode);m=new r.S(v,x)}Object.keys(m.geometry.morphAttributes).length>0&&X(m,o),m.name=o.name||"mesh_"+t,h.length>1&&(m.name+="_"+i),W(m,o),n.assignFinalMaterial(m),d.push(m)}if(1===d.length)return d[0];var w=new r.m;for(i=0,f=d.length;i<f;i++)w.add(d[i]);return w}))},K.prototype.loadCamera=function(t){var e,n=this.json.cameras[t],o=n[n.type];if(o)return"perspective"===n.type?e=new r.Q(r.D.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):"orthographic"===n.type&&(e=new r.P(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),n.name&&(e.name=n.name),W(e,n),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")},K.prototype.loadSkin=function(t){var e=this.json.skins[t],n={joints:e.joints};return void 0===e.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",e.inverseBindMatrices).then((function(t){return n.inverseBindMatrices=t,n}))},K.prototype.loadAnimation=function(t){for(var e=this.json.animations[t],n=[],o=[],c=[],l=[],h=[],i=0,d=e.channels.length;i<d;i++){var f=e.channels[i],m=e.samplers[f.sampler],v=f.target,y=void 0!==v.node?v.node:v.id,input=void 0!==e.parameters?e.parameters[m.input]:m.input,output=void 0!==e.parameters?e.parameters[m.output]:m.output;n.push(this.getDependency("node",y)),o.push(this.getDependency("accessor",input)),c.push(this.getDependency("accessor",output)),l.push(m),h.push(v)}return Promise.all([Promise.all(n),Promise.all(o),Promise.all(c),Promise.all(l),Promise.all(h)]).then((function(n){for(var o=n[0],c=n[1],l=n[2],h=n[3],d=n[4],f=[],i=0,m=o.length;i<m;i++){var v=o[i],y=c[i],x=l[i],w=h[i],_=d[i];if(void 0!==v){var S;switch(v.updateMatrix(),v.matrixAutoUpdate=!0,F[_.path]){case F.weights:S=r.N;break;case F.rotation:S=r.V;break;case F.position:case F.scale:default:S=r.mb}var E=v.name?v.name:v.uuid,T=void 0!==w.interpolation?B[w.interpolation]:r.s,A=[];F[_.path]===F.weights?v.traverse((function(object){!0===object.isMesh&&object.morphTargetInfluences&&A.push(object.name?object.name:object.uuid)})):A.push(E);var C=x.array;if(x.normalized){var R;if(C.constructor===Int8Array)R=1/127;else if(C.constructor===Uint8Array)R=1/255;else if(C.constructor==Int16Array)R=1/32767;else{if(C.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");R=1/65535}for(var I=new Float32Array(C.length),N=0,O=C.length;N<O;N++)I[N]=C[N]*R;C=I}for(N=0,O=A.length;N<O;N++){var track=new S(A[N]+"."+F[_.path],y.array,C,T);"CUBICSPLINE"===w.interpolation&&(track.createInterpolant=function(t){return new M(this.times,this.values,this.getValueSize()/3,t)},track.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),f.push(track)}}}var D=e.name?e.name:"animation_"+t;return new r.a(D,void 0,f)}))},K.prototype.loadNode=function(t){var e,o=this.json,c=this.extensions,l=this,h=o.meshReferences,d=o.meshUses,f=o.nodes[t];return(e=[],void 0!==f.mesh&&e.push(l.getDependency("mesh",f.mesh).then((function(t){var e;if(h[f.mesh]>1){var n=d[f.mesh]++;(e=t.clone()).name+="_instance_"+n}else e=t;return void 0!==f.weights&&e.traverse((function(t){if(t.isMesh)for(var i=0,e=f.weights.length;i<e;i++)t.morphTargetInfluences[i]=f.weights[i]})),e}))),void 0!==f.camera&&e.push(l.getDependency("camera",f.camera)),f.extensions&&f.extensions[n.KHR_LIGHTS_PUNCTUAL]&&void 0!==f.extensions[n.KHR_LIGHTS_PUNCTUAL].light&&e.push(l.getDependency("light",f.extensions[n.KHR_LIGHTS_PUNCTUAL].light)),Promise.all(e)).then((function(e){var n;if((n=!0===f.isBone?new r.b:e.length>1?new r.m:1===e.length?e[0]:new r.O)!==e[0])for(var i=0,o=e.length;i<o;i++)n.add(e[i]);if(f.name&&(n.userData.name=f.name,n.name=r.U.sanitizeNodeName(f.name)),W(n,f),f.extensions&&j(c,n,f),void 0!==f.matrix){var h=new r.E;h.fromArray(f.matrix),n.applyMatrix4(h)}else void 0!==f.translation&&n.position.fromArray(f.translation),void 0!==f.rotation&&n.quaternion.fromArray(f.rotation),void 0!==f.scale&&n.scale.fromArray(f.scale);return l.associations.set(n,{type:"nodes",index:t}),n}))},K.prototype.loadScene=function(){function t(e,n,o,c){var l=o.nodes[e];return c.getDependency("node",e).then((function(t){return void 0===l.skin?t:c.getDependency("skin",l.skin).then((function(t){for(var n=[],i=0,r=(e=t).joints.length;i<r;i++)n.push(c.getDependency("node",e.joints[i]));return Promise.all(n)})).then((function(n){return t.traverse((function(t){if(t.isMesh){for(var o=[],c=[],l=0,h=n.length;l<h;l++){var d=n[l];if(d){o.push(d);var f=new r.E;void 0!==e.inverseBindMatrices&&f.fromArray(e.inverseBindMatrices.array,16*l),c.push(f)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[l])}t.bind(new r.bb(o,c),t.matrixWorld)}})),t}));var e})).then((function(e){n.add(e);var r=[];if(l.children)for(var h=l.children,i=0,d=h.length;i<d;i++){var f=h[i];r.push(t(f,e,o,c))}return Promise.all(r)}))}return function(e){var n=this.json,o=this.extensions,c=this.json.scenes[e],l=new r.m;c.name&&(l.name=c.name),W(l,c),c.extensions&&j(o,l,c);for(var h=c.nodes||[],d=[],i=0,f=h.length;i<f;i++)d.push(t(h[i],l,n,this));return Promise.all(d).then((function(){return l}))}}(),t}()},123:function(t,e,n){"use strict";n.d(e,"a",(function(){return S}));var r=n(0),o=n(93);const c=t=>({startEndTensor:t,startPoint:Object(r.nc)(t,[0,0],[-1,2]),endPoint:Object(r.nc)(t,[0,2],[-1,2])}),l={strides:[8,16],anchors:[2,6]};function h(t,e){let s,n,o;if(t.topLeft instanceof r.c&&t.bottomRight instanceof r.c){const[i,c]=Object(r.Hc)(()=>[Object(r.C)([Object(r.Ac)(e-1,t.topLeft.slice(0,1)),t.topLeft.slice(1,1)]),Object(r.C)([Object(r.Ac)(e-1,t.bottomRight.slice(0,1)),t.bottomRight.slice(1,1)])]);s=i,n=c,null!=t.landmarks&&(o=Object(r.Hc)(()=>{const s=Object(r.Ac)(Object(r.Fc)([e-1,0]),t.landmarks),n=Object(r.Fc)([1,-1]);return Object(r.Gb)(s,n)}))}else{const[i,r]=t.topLeft,[a,c]=t.bottomRight;s=[e-1-i,r],n=[e-1-a,c],null!=t.landmarks&&(o=t.landmarks.map(t=>[e-1-t[0],t[1]]))}const i={topLeft:s,bottomRight:n};return null!=o&&(i.landmarks=o),null!=t.probability&&(i.probability=t.probability instanceof r.c?t.probability.clone():t.probability),i}function d(t,e){return Object(r.Hc)(()=>{let s;return s=t.hasOwnProperty("box")?t.box:t,((t,e)=>{const s=Object(r.Gb)(t.startPoint,e),n=Object(r.Gb)(t.endPoint,e),o=Object(r.D)([s,n],1);return c(o)})(s,e).startEndTensor.squeeze()})}class f{constructor(t,e,s,n,o,i){this.blazeFaceModel=t,this.width=e,this.height=s,this.maxFaces=n,this.anchorsData=function(t,e,s){const n=[];for(let r=0;r<s.strides.length;r++){const i=s.strides[r],o=Math.floor((e+i-1)/i),a=Math.floor((t+i-1)/i),c=s.anchors[r];for(let t=0;t<o;t++){const e=i*(t+.5);for(let t=0;t<a;t++){const s=i*(t+.5);for(let t=0;t<c;t++)n.push([s,e])}}}return n}(e,s,l),this.anchors=Object(r.Gc)(this.anchorsData),this.inputSizeData=[e,s],this.inputSize=Object(r.Fc)([e,s]),this.iouThreshold=o,this.scoreThreshold=i}async getBoundingBoxes(t,e,s=!0){const[n,o,i]=Object(r.Hc)(()=>{const e=t.resizeBilinear([this.width,this.height]),s=Object(r.Gb)(Object(r.Ac)(e.div(255),.5),2),n=this.blazeFaceModel.predict(s).squeeze(),o=function(t,e,s){const n=Object(r.nc)(t,[0,1],[-1,2]),o=Object(r.g)(n,e),i=Object(r.nc)(t,[0,3],[-1,2]),c=Object(r.M)(i,s),a=Object(r.M)(o,s),l=Object(r.M)(c,2),h=Object(r.Ac)(a,l),d=Object(r.g)(a,l),f=Object(r.Gb)(h,s),u=Object(r.Gb)(d,s);return Object(r.D)([f,u],1)}(n,this.anchors,this.inputSize),i=Object(r.nc)(n,[0,0],[-1,1]);return[n,o,Object(r.jc)(i).squeeze()]}),l=console.warn;console.warn=()=>{};const a=r.ib.nonMaxSuppression(o,i,this.maxFaces,this.iouThreshold,this.scoreThreshold);console.warn=l;const h=await a.array();a.dispose();let d=h.map(t=>Object(r.nc)(o,[t,0],[1,-1]));e||(d=await Promise.all(d.map(async t=>{const e=await t.array();return t.dispose(),e})));const f=t.shape[1],m=t.shape[2];let u;u=e?Object(r.M)([m,f],this.inputSize):[m/this.inputSizeData[0],f/this.inputSizeData[1]];const p=[];for(let t=0;t<d.length;t++){const o=d[t],l=Object(r.Hc)(()=>{const l=c(o instanceof r.c?o:Object(r.Gc)(o));if(!s)return l;const a=h[t];let d;return d=e?this.anchors.slice([a,0],[1,2]):this.anchorsData[a],{box:l,landmarks:Object(r.nc)(n,[a,5],[1,-1]).squeeze().reshape([6,-1]),probability:Object(r.nc)(i,[a],[1]),anchor:d}});p.push(l)}return o.dispose(),i.dispose(),n.dispose(),{boxes:p,scaleFactor:u}}async estimateFaces(t,e=!1,s=!1,n=!0){const[,o]=function(t){return t instanceof r.c?[t.shape[0],t.shape[1]]:[t.height,t.width]}(t),i=Object(r.Hc)(()=>(t instanceof r.c||(t=r.w.fromPixels(t)),t.toFloat().expandDims(0))),{boxes:c,scaleFactor:a}=await this.getBoundingBoxes(i,e,n);return i.dispose(),e?c.map(t=>{const e=d(t,a);let i={topLeft:e.slice([0],[2]),bottomRight:e.slice([2],[2])};if(n){const{landmarks:e,probability:s,anchor:n}=t,r=e.add(n).mul(a);i.landmarks=r,i.probability=s}return s&&(i=h(i,o)),i}):Promise.all(c.map(async t=>{const e=d(t,a);let i;if(n){const[s,n,r]=await Promise.all([t.landmarks,e,t.probability].map(async t=>t.array())),o=t.anchor,[c,l]=a,h=s.map(t=>[(t[0]+o[0])*c,(t[1]+o[1])*l]);i={topLeft:n.slice(0,2),bottomRight:n.slice(2),landmarks:h,probability:r},(t=>{t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose()})(t.box),t.landmarks.dispose(),t.probability.dispose()}else{const t=await e.array();i={topLeft:t.slice(0,2),bottomRight:t.slice(2)}}return e.dispose(),s&&(i=h(i,o)),i}))}}const m={silhouette:[10,338,297,332,284,251,389,356,454,323,361,288,397,365,379,378,400,377,152,148,176,149,150,136,172,58,132,93,234,127,162,21,54,103,67,109],lipsUpperOuter:[61,185,40,39,37,0,267,269,270,409,291],lipsLowerOuter:[146,91,181,84,17,314,405,321,375,291],lipsUpperInner:[78,191,80,81,82,13,312,311,310,415,308],lipsLowerInner:[78,95,88,178,87,14,317,402,318,324,308],rightEyeUpper0:[246,161,160,159,158,157,173],rightEyeLower0:[33,7,163,144,145,153,154,155,133],rightEyeUpper1:[247,30,29,27,28,56,190],rightEyeLower1:[130,25,110,24,23,22,26,112,243],rightEyeUpper2:[113,225,224,223,222,221,189],rightEyeLower2:[226,31,228,229,230,231,232,233,244],rightEyeLower3:[143,111,117,118,119,120,121,128,245],rightEyebrowUpper:[156,70,63,105,66,107,55,193],rightEyebrowLower:[35,124,46,53,52,65],leftEyeUpper0:[466,388,387,386,385,384,398],leftEyeLower0:[263,249,390,373,374,380,381,382,362],leftEyeUpper1:[467,260,259,257,258,286,414],leftEyeLower1:[359,255,339,254,253,252,256,341,463],leftEyeUpper2:[342,445,444,443,442,441,413],leftEyeLower2:[446,261,448,449,450,451,452,453,464],leftEyeLower3:[372,340,346,347,348,349,350,357,465],leftEyebrowUpper:[383,300,293,334,296,336,285,417],leftEyebrowLower:[265,353,276,283,282,295],midwayBetweenEyes:[168],noseTip:[1],noseBottom:[2],noseRightCorner:[98],noseLeftCorner:[327],rightCheek:[205],leftCheek:[425]};function v(t){null!=t&&null!=t.startPoint&&(t.startEndTensor.dispose(),t.startPoint.dispose(),t.endPoint.dispose())}function y(t,e,s){return{startEndTensor:t,startPoint:null!=e?e:Object(r.nc)(t,[0,0],[-1,2]),endPoint:null!=s?s:Object(r.nc)(t,[0,2],[-1,2])}}function x(t){return Object(r.Hc)(()=>{const e=Object(r.Ac)(t.endPoint,t.startPoint);return Object(r.d)(e)})}function w(t,e=1.5){return Object(r.Hc)(()=>{const s=function(t){return Object(r.Hc)(()=>{const e=Object(r.M)(Object(r.Ac)(t.endPoint,t.startPoint),2);return Object(r.g)(t.startPoint,e)})}(t),n=x(t),o=Object(r.Gb)(Object(r.M)(n,2),e),i=Object(r.Ac)(s,o),c=Object(r.g)(s,o);return y(Object(r.D)([i,c],1),i,c)})}class _{constructor(t,e,s,n,r,i){this.regionsOfInterest=[],this.runsWithoutFaceDetector=0,this.boundingBoxDetector=t,this.meshDetector=e,this.meshWidth=s,this.meshHeight=n,this.maxContinuousChecks=r,this.maxFaces=i}async predict(t){if(this.shouldUpdateRegionsOfInterest()){const e=!0,s=!1,{boxes:n,scaleFactor:o}=await this.boundingBoxDetector.getBoundingBoxes(t,e,s);if(0===n.length)return o.dispose(),this.clearAllRegionsOfInterest(),null;const i=n.map(t=>w(function(t,e){const s=Object(r.Gb)(t.startPoint,e),n=Object(r.Gb)(t.endPoint,e);return y(Object(r.D)([s,n],1))}(t,o)));n.forEach(v),this.updateRegionsOfInterest(i),this.runsWithoutFaceDetector=0}else this.runsWithoutFaceDetector++;return Object(r.Hc)(()=>this.regionsOfInterest.map((e,s)=>{const n=function(t,e,s){const n=e.shape[1],o=e.shape[2],i=t.startEndTensor;return Object(r.Hc)(()=>{const t=Object(r.D)([i.slice([0,1],[-1,1]),i.slice([0,0],[-1,1]),i.slice([0,3],[-1,1]),i.slice([0,2],[-1,1])],0),c=Object(r.M)(t.transpose(),[n,o,n,o]);return r.ib.cropAndResize(e,c,[0],s)})}(e,t,[this.meshHeight,this.meshWidth]).div(255),[,o,i]=this.meshDetector.predict(n),c=Object(r.Yb)(i,[-1,3]),a=Object(r.M)(x(e),[this.meshWidth,this.meshHeight]),l=Object(r.Gb)(c,a.concat(Object(r.Gc)([1],[1,1]),1)).add(e.startPoint.concat(Object(r.Gc)([0],[1,1]),1)),h=this.calculateLandmarksBoundingBox(l);return v(this.regionsOfInterest[s]),this.regionsOfInterest[s]=h,{coords:c,scaledCoords:l,box:h,flag:o.squeeze()}}))}updateRegionsOfInterest(t){for(let e=0;e<t.length;e++){const s=t[e],n=this.regionsOfInterest[e];let r=0;if(n&&n.startPoint){const[t,e,i,o]=s.startEndTensor.arraySync()[0],[a,c,l,h]=n.startEndTensor.arraySync()[0],d=Math.max(t,a),u=Math.max(e,c),p=(Math.min(i,l)-d)*(Math.min(o,h)-u);r=p/((i-t)*(o-e)+(l-a)*(h-e)-p)}r>.25?v(s):(this.regionsOfInterest[e]=s,v(n))}for(let e=t.length;e<this.regionsOfInterest.length;e++)v(this.regionsOfInterest[e]);this.regionsOfInterest=this.regionsOfInterest.slice(0,t.length)}clearRegionOfInterest(t){null!=this.regionsOfInterest[t]&&(v(this.regionsOfInterest[t]),this.regionsOfInterest=[...this.regionsOfInterest.slice(0,t),...this.regionsOfInterest.slice(t+1)])}clearAllRegionsOfInterest(){for(let t=0;t<this.regionsOfInterest.length;t++)v(this.regionsOfInterest[t]);this.regionsOfInterest=[]}shouldUpdateRegionsOfInterest(){const t=this.regionsOfInterest.length,e=0===t;return 1===this.maxFaces||e?e:t!==this.maxFaces&&this.runsWithoutFaceDetector>=this.maxContinuousChecks}calculateLandmarksBoundingBox(t){const e=t.slice([0,0],[468,1]),s=t.slice([0,1],[468,1]);return w(y(Object(r.yc)([e.min(),s.min(),e.max(),s.max()]).expandDims(0)))}}async function S({maxContinuousChecks:t=5,detectionConfidence:e=.9,maxFaces:s=10,iouThreshold:n=.3,scoreThreshold:r=.75}={}){const[i,o]=await Promise.all([M(s,n,r),E()]);return new A(i,o,t,e,s)}async function M(t,e,s){return async function({maxFaces:t=10,inputWidth:e=128,inputHeight:s=128,iouThreshold:n=.3,scoreThreshold:r=.75}={}){const i=await Object(o.a)("https://tfhub.dev/tensorflow/tfjs-model/blazeface/1/default/1",{fromTFHub:!0});return new f(i,e,s,t,n,r)}({maxFaces:t,iouThreshold:e,scoreThreshold:s})}async function E(){return Object(o.a)("https://tfhub.dev/mediapipe/tfjs-model/facemesh/1/default/1",{fromTFHub:!0})}function T(t,e){if(t.mesh instanceof r.c){const[s,n,o,i]=Object(r.Hc)(()=>{const s=Object(r.Fc)([e-1,0,0]),n=Object(r.Fc)([1,-1,1]);return Object(r.Hc)(()=>[Object(r.C)([Object(r.Ac)(e-1,t.boundingBox.topLeft.slice(0,1)),t.boundingBox.topLeft.slice(1,1)]),Object(r.C)([Object(r.Ac)(e-1,t.boundingBox.bottomRight.slice(0,1)),t.boundingBox.bottomRight.slice(1,1)]),Object(r.Ac)(s,t.mesh).mul(n),Object(r.Ac)(s,t.scaledMesh).mul(n)])});return Object.assign({},t,{boundingBox:{topLeft:s,bottomRight:n},mesh:o,scaledMesh:i})}return Object.assign({},t,{boundingBox:{topLeft:[e-1-t.boundingBox.topLeft[0],t.boundingBox.topLeft[1]],bottomRight:[e-1-t.boundingBox.bottomRight[0],t.boundingBox.bottomRight[1]]},mesh:t.mesh.map(t=>{const s=t.slice(0);return s[0]=e-1-t[0],s}),scaledMesh:t.scaledMesh.map(t=>{const s=t.slice(0);return s[0]=e-1-t[0],s})})}class A{constructor(t,e,s,n,r){this.pipeline=new _(t,e,192,192,s,r),this.detectionConfidence=n}static getAnnotations(){return m}async estimateFaces(t,e=!1,s=!1){const[,n]=function(t){return t instanceof r.c?[t.shape[0],t.shape[1]]:[t.height,t.width]}(t),o=Object(r.Hc)(()=>(t instanceof r.c||(t=r.w.fromPixels(t)),t.toFloat().expandDims(0))),i=Object(r.Q)().get("WEBGL_PACK_DEPTHWISECONV");Object(r.Q)().set("WEBGL_PACK_DEPTHWISECONV",!0);const c=await this.pipeline.predict(o);return Object(r.Q)().set("WEBGL_PACK_DEPTHWISECONV",i),o.dispose(),null!=c&&c.length>0?Promise.all(c.map(async(t,r)=>{const{coords:i,scaledCoords:o,box:a,flag:c}=t;let l=[c];e||(l=l.concat([i,o,a.startPoint,a.endPoint]));const h=await Promise.all(l.map(async t=>t.array())),d=h[0];if(c.dispose(),d<this.detectionConfidence&&this.pipeline.clearRegionOfInterest(r),e){const t={faceInViewConfidence:d,mesh:i,scaledMesh:o,boundingBox:{topLeft:a.startPoint.squeeze(),bottomRight:a.endPoint.squeeze()}};return s?T(t,n):t}const[u,p,f,v]=h.slice(1);o.dispose(),i.dispose();let g={faceInViewConfidence:d,boundingBox:{topLeft:f,bottomRight:v},mesh:u,scaledMesh:p};s&&(g=T(g,n));const b={};for(const t in m)b[t]=m[t].map(t=>g.scaledMesh[t]);return g.annotations=b,g})):[]}}},124:function(t,e,n){"use strict";(function(t,r){n.d(e,"a",(function(){return ut}));var o,c,b,l,h,d,f,g,m,v,y,x,w,_,S,M,E,T,A,C,R,I,N,O,D,L,k,P,q,F,B,z,U=n(0),V=n(125),G=n.n(V),H=n(126),j=n.n(H);function W(t){var a;Object(U.Wb)({kernelName:t,backendName:"wasm",setupFunc:function(e){a=e.wasm.cwrap(t,null,["number","number"])},kernelFunc:function(t){var e=t.backend,n=t.inputs.x,u=e.dataIdMap.get(n.dataId).id,i=e.makeOutput(n.shape,n.dtype),r=e.dataIdMap.get(i.dataId).id;return 0===U.Nc.sizeFromShape(i.shape)||a(u,r),i}})}function X(a,t,u){var i;Object(U.Wb)({kernelName:a,backendName:"wasm",setupFunc:function(t){i=t.wasm.cwrap(a,null,["number","array","number","number","array","number","number","number"])},kernelFunc:function(e){var n=e.backend,s=e.inputs,r=s.a,p=s.b,c=n.dataIdMap.get(r.dataId).id,l=n.dataIdMap.get(p.dataId).id,h=null!=u?u:r.dtype,b=U.t.assertAndGetBroadcastShape(r.shape,p.shape),d=n.makeOutput(b,h);if(0===U.Nc.sizeFromShape(b))return d;var f=new Uint8Array(new Int32Array(r.shape).buffer),m=new Uint8Array(new Int32Array(p.shape).buffer),v=n.dataIdMap.get(d.dataId).id,y=function(){return i(c,f,r.shape.length,l,m,p.shape.length,o[r.dtype],v)};if(t)return y(),d;var g=U.t.getBroadcastDims(r.shape,b),x=U.t.getBroadcastDims(p.shape,b),w=g.every((function(t,e){return t===e})),_=x.every((function(t,e){return t===e}));if(w&&_)return y(),d;throw new Error("Broadcasting along outer dims is not yet supported for "+a+".")}})}function Y(t){var e=t.inputs.x,n=t.attrs.dtype,a=t.backend,r=a.makeOutput(e.shape,n),u=a.typedArrayFromHeap(e);return a.typedArrayFromHeap(r).set(u),r}function K(t,e){var n=new Int32Array(t.wasm.HEAPU8.buffer,e,3),a=n[0],r=n[1],u=n[2];return t.wasm._free(e),{pSelectedIndices:a,selectedSize:r,pSelectedScores:u}}function J(t){var e=t.inputs.x,a=t.attrs,n=a.begin,r=a.size,s=t.backend,o=U.oc.isSliceContinous(e.shape,n,r),p=s.typedArrayFromHeap(e),c=s.makeOutput(r,e.dtype),l=s.typedArrayFromHeap(c),h=U.Nc.computeStrides(e.shape);if(o){var d=U.oc.computeFlatOffset(n,h);return l.set(p.subarray(d,d+U.Nc.sizeFromShape(r))),c}var b=e.shape.length;return 2===b?function(t,e,n,a,r){for(var u=0,i=a[0],o=a[1],s=i+r[0],c=i;c<s;c++){var p=c*e+o;n.set(t.subarray(p,p+r[1]),u),u+=r[1]}}(p,h[0],l,n,r):3===b?function(t,e,n,a,r,u){for(var i=0,o=r[0],s=r[1],c=r[2],p=o+u[0],l=s+u[1],h=o;h<p;h++)for(var d=s;d<l;d++){var f=h*e+d*n+c;a.set(t.subarray(f,f+u[2]),i),i+=u[2]}}(p,h[0],h[1],l,n,r):4===b?function(t,e,n,a,r,u,i){for(var o=0,s=u[0],c=u[1],p=u[2],l=s+i[0],h=c+i[1],d=p+i[2],f=u[3],b=s;b<l;b++)for(var m=c;m<h;m++)for(var v=p;v<d;v++){var y=b*e+m*n+v*a+f;r.set(t.subarray(y,y+i[3]),o),o+=i[3]}}(p,h[0],h[1],h[2],l,n,r):function(t,e,n,a,r){for(var u=Object(U.x)(r,e.dtype,n),o=Object(U.x)(e.shape,e.dtype,t),s=0;s<u.size;++s){var c=u.indexToLoc(s).map((function(t,e){return t+a[e]}));n[s]=o.get.apply(o,c)}}(p,e,l,n,r),c}(l=o||(o={}))[l.float32=0]="float32",l[l.int32=1]="int32",l[l.bool=2]="bool",l[l.string=3]="string",l[l.complex64=4]="complex64",function(t){t[t.linear=0]="linear",t[t.relu=1]="relu",t[t.relu6=2]="relu6",t[t.prelu=3]="prelu"}(c||(c={})),Object(U.Wb)({kernelName:"_FusedMatMul",backendName:"wasm",setupFunc:function(t){b=t.wasm.cwrap("_FusedMatMul",null,["number","array","number","number","array","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.backend,a=t.attrs,r=e.a,u=e.b,i=e.bias,o=e.preluActivationWeights;if("float32"!==r.dtype||"float32"!==u.dtype)throw new Error("_FusedMatMul for non non-float32 tensors not yet supported.");var s=a.transposeA,l=a.transposeB,p=a.activation,h=n.dataIdMap.get(r.dataId).id,d=n.dataIdMap.get(u.dataId).id,f=0;if(null!=i){var m=n.dataIdMap.get(i.dataId);if(1!==m.shape.length)throw new Error("_FusedMatMul only supports rank-1 bias but got rank "+m.shape.length+".");f=m.id}var v=null==o?0:n.dataIdMap.get(o.dataId).id,y=c[p];if(null==y)throw new Error(p+" activation not yet supported for FusedConv2D in the wasm backend.");var x=s?r.shape[2]:r.shape[1],w=l?u.shape[1]:u.shape[2],g=r.shape[0],_=n.makeOutput([g,x,w],r.dtype),S=n.dataIdMap.get(_.dataId).id,M=new Uint8Array(new Int32Array(r.shape).buffer),E=new Uint8Array(new Int32Array(u.shape).buffer);return b(h,M,r.shape.length,d,E,u.shape.length,s,l,y,f,v,S),_}}),W("Abs"),X("Add",!0),Object(U.Wb)({kernelName:"AddN",backendName:"wasm",setupFunc:function(t){h=t.wasm.cwrap("AddN",null,["array","number","number","number"])},kernelFunc:function(t){var e=t.inputs,a=t.backend,n=a.makeOutput(e[0].shape,e[0].dtype);if(0===U.Nc.sizeFromShape(n.shape))return n;var u=e.map((function(t){return a.dataIdMap.get(t.dataId).id})),i=new Uint8Array(new Int32Array(u).buffer),r=a.dataIdMap.get(n.dataId).id;return h(i,u.length,o[n.dtype],r),n}}),Object(U.Wb)({kernelName:"ArgMax",backendName:"wasm",kernelFunc:function(t){var e=t.inputs.x,a=t.backend,n=t.attrs.axis,u=e.shape.slice(0,-1),i=a.makeOutput(u,"int32"),r=a.dataIdMap.get(e.dataId).id,s=a.dataIdMap.get(i.dataId).id,c=U.Nc.sizeFromShape(i.shape),p=e.shape[n];return d(r,o[e.dtype],c,p,s),i},setupFunc:function(t){d=t.wasm.cwrap("ArgMax",null,["number","number","number","number","number"])}}),Object(U.Wb)({kernelName:"AvgPool",backendName:"wasm",setupFunc:function(t){f=t.wasm.cwrap("AvgPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n,u=e.x,i=a.dataIdMap.get(u.dataId).id,o=r.filterHeight,s=r.filterWidth,c=r.padInfo.top,p=r.padInfo.right,l=r.padInfo.bottom,h=r.padInfo.left,d=r.strideHeight,m=r.strideWidth,b=r.inChannels;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");if(1!==r.dilationWidth||1!==r.dilationHeight)throw new Error("was backend only supports average pooling with dilation = [1, 1], got ["+r.dilationHeight+", "+r.dilationWidth+"].");var v=a.makeOutput(r.outShape,"float32"),y=a.dataIdMap.get(v.dataId).id;return f(i,u.shape[0],u.shape[1],u.shape[2],o,s,c,p,l,h,d,m,b,y),v}}),Object(U.Wb)({kernelName:"BatchMatMul",backendName:"wasm",setupFunc:function(t){g=t.wasm.cwrap("BatchMatMul",null,["number","array","number","number","array","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.backend,a=t.attrs,r=e.a,u=e.b;if("float32"!==r.dtype||"float32"!==u.dtype)throw new Error("BatchMatMul for non non-float32 tensors not yet supported.");var i=a.transposeA,o=a.transposeB,s=n.dataIdMap.get(r.dataId).id,c=n.dataIdMap.get(u.dataId).id,p=i?r.shape[2]:r.shape[1],l=o?u.shape[1]:u.shape[2],h=r.shape[0],d=n.makeOutput([h,p,l],r.dtype),f=n.dataIdMap.get(d.dataId).id,b=new Uint8Array(new Int32Array(r.shape).buffer),m=new Uint8Array(new Int32Array(u.shape).buffer);return g(s,b,r.shape.length,c,m,u.shape.length,i,o,f),d}}),Object(U.Wb)({kernelName:"Cast",backendName:"wasm",kernelFunc:Y}),Object(U.Wb)({kernelName:"ClipByValue",backendName:"wasm",setupFunc:function(t){m=t.wasm.cwrap("ClipByValue",null,["number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.backend,a=t.attrs,r=e.x,u=a.min,i=a.max,o=n.dataIdMap.get(r.dataId).id,s=n.makeOutput(r.shape,"float32"),c=n.dataIdMap.get(s.dataId).id;return m(o,u,i,c),s}}),Object(U.Wb)({kernelName:"Concat",backendName:"wasm",kernelFunc:function(t){for(var a=t.inputs,e=t.backend,u=t.attrs.axis,i=U.t.computeOutShape(a.map((function(t){return t.shape})),u),n=e.makeOutput(i,a[0].dtype),s=U.Nc.sizeFromShape(a[0].shape.slice(0,u)),r=0,p=a.map((function(t){var e=U.Nc.sizeFromShape(t.shape.slice(u));return r+=e,e})),o=a.map((function(t){return e.typedArrayFromHeap(t)})),c=e.typedArrayFromHeap(n),l=0;l<s;l++)for(var h=l*r,b=0;b<o.length;b++){var d=p[b],f=l*d,m=o[b].subarray(f,f+d);c.set(m,h),h+=d}return n}}),Object(U.Wb)({kernelName:"Conv2D",backendName:"wasm",setupFunc:function(t){v=t.wasm.cwrap("Conv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n,u=e.x,i=e.filter,o=a.dataIdMap.get(u.dataId).id,s=a.dataIdMap.get(i.dataId).id,c=r.filterHeight,p=r.filterWidth,l=r.padInfo.top,h=r.padInfo.right,d=r.padInfo.bottom,f=r.padInfo.left,b=r.dilationHeight,m=r.dilationWidth,y=r.strideHeight,x=r.strideWidth,w=r.inChannels,_=r.outChannels,g="SAME"===r.padInfo.type?1:0;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend Conv2D does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");var S=a.makeOutput(r.outShape,"float32"),M=a.dataIdMap.get(S.dataId).id;return v(o,u.shape[0],u.shape[1],u.shape[2],s,c,p,l,h,d,f,g,b,m,y,x,w,_,M),S}}),W("Cos"),function(t){t[t.bilinear=0]="bilinear",t[t.nearest=1]="nearest"}(y||(y={})),Object(U.Wb)({kernelName:"CropAndResize",backendName:"wasm",setupFunc:function(t){x=t.wasm.cwrap("CropAndResize",null,["number","number","number","number","array","number","number","number","number","number"])},kernelFunc:function(t){var e,n=t.backend,a=t.inputs,r=t.attrs,u=r.method,i=r.extrapolationValue,o=r.cropSize,s=a.images,c=a.boxes,p=a.boxInd,l=c.shape[0],h=o,d=h[0],f=h[1],b=[l,d,f,s.shape[3]],m=n.dataIdMap.get(s.dataId);"float32"!==s.dtype&&(e=Y({backend:n,inputs:{x:s},attrs:{dtype:"float32"}}),m=n.dataIdMap.get(e.dataId));var v=m.id,w=n.dataIdMap.get(c.dataId).id,_=n.dataIdMap.get(p.dataId).id,S=n.makeOutput(b,"float32"),g=n.dataIdMap.get(S.dataId).id,M=new Uint8Array(new Int32Array(s.shape).buffer);return x(v,w,_,l,M,d,f,y[u],i,g),null!=e&&n.disposeData(e.dataId),S}}),Object(U.Wb)({kernelName:"DepthwiseConv2dNative",backendName:"wasm",setupFunc:function(t){w=t.wasm.cwrap("DepthwiseConv2dNative",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n,u=e.x,i=e.filter,o=a.dataIdMap.get(u.dataId).id,s=a.dataIdMap.get(i.dataId).id,c=r.filterHeight,p=r.filterWidth,l=r.padInfo.top,h=r.padInfo.right,d=r.padInfo.bottom,f=r.padInfo.left,b=r.dilationHeight,m=r.dilationWidth,v=r.strideHeight,y=r.strideWidth,x=r.inChannels,_=r.outChannels,g="SAME"===r.padInfo.type?1:0;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend DepthwiseConv2dNative does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");var S=a.makeOutput(r.outShape,"float32"),M=a.dataIdMap.get(S.dataId).id;return w(o,u.shape[0],u.shape[1],u.shape[2],s,c,p,l,h,d,f,g,b,m,v,y,x,_,M),S}}),X("Div",!1),W("Exp"),X("FloorDiv",!1),Object(U.Wb)({kernelName:"FusedBatchNorm",backendName:"wasm",setupFunc:function(t){_=t.wasm.cwrap("FusedBatchNorm",null,["number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.backend,a=t.inputs,n=t.attrs.varianceEpsilon,u=a.x,i=a.mean,r=a.variance,s=a.offset,o=a.scale,p=e.dataIdMap.get(u.dataId).id,c=e.dataIdMap.get(i.dataId).id,l=e.dataIdMap.get(r.dataId).id,h=null!=s?e.dataIdMap.get(s.dataId).id:0,d=null!=o?e.dataIdMap.get(o.dataId).id:0,b=e.makeOutput(u.shape,u.dtype);if(0===U.Nc.sizeFromShape(u.shape))return b;var f=e.dataIdMap.get(b.dataId).id;return _(p,c,l,h,d,n,f),b}}),Object(U.Wb)({kernelName:"FusedConv2D",backendName:"wasm",setupFunc:function(t){S=t.wasm.cwrap("FusedConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n.convInfo,u=n.activation,i=c[u];if(null==i)throw new Error(u+" activation not yet supported for FusedConv2D in the wasm backend.");var o=e.x,s=e.filter,l=e.bias,p=e.preluActivationWeights,h=a.dataIdMap.get(o.dataId).id,d=a.dataIdMap.get(s.dataId).id,f=r.outChannels,b=0;if(null!=l){var m=a.dataIdMap.get(l.dataId);if(1!==m.shape.length)throw new Error("FusedConv2D only supports rank-1 bias but got rank "+m.shape.length+".");if(m.shape[0]!==f)throw new Error("FusedConv2D bias shape ("+m.shape+") does not match the number of output channels ("+f+")");b=m.id}var v=r.filterHeight,y=r.filterWidth,x=r.padInfo.top,w=r.padInfo.right,g=r.padInfo.bottom,_=r.padInfo.left,M=r.dilationHeight,E=r.dilationWidth,T=r.strideHeight,A=r.strideWidth,C=r.inChannels,R="SAME"===r.padInfo.type?1:0,I=r.batchSize,N=r.inHeight,O=r.inWidth;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend FusedConv2D does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");var D=a.makeOutput(r.outShape,"float32"),L=a.dataIdMap.get(D.dataId).id,k=null==p?0:a.dataIdMap.get(p.dataId).id;return S(h,I,N,O,d,v,y,b,x,w,g,_,R,M,E,T,A,C,f,i,k,L),D}}),Object(U.Wb)({kernelName:"FusedDepthwiseConv2D",backendName:"wasm",setupFunc:function(t){M=t.wasm.cwrap("FusedDepthwiseConv2D",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n.convInfo,u=n.activation,i=c[u];if(null==i)throw new Error(u+" activation not yet supported for FusedDepthwiseConv2D in the wasm backend.");var o=e.x,s=e.filter,l=e.bias,p=e.preluActivationWeights,h=a.dataIdMap.get(o.dataId).id,d=a.dataIdMap.get(s.dataId).id,f=r.outChannels,b=0;if(null!=l){var m=a.dataIdMap.get(l.dataId);if(1!==m.shape.length)throw new Error("FusedDepthwiseConv2D only supports rank-1 bias but got rank "+m.shape.length+".");if(m.shape[0]!==f)throw new Error("FusedDepthwiseConv2D bias shape ("+m.shape+") does not match the number of output channels ("+f+")");b=m.id}var v=r.filterHeight,y=r.filterWidth,x=r.padInfo.top,w=r.padInfo.right,g=r.padInfo.bottom,_=r.padInfo.left,S=r.dilationHeight,E=r.dilationWidth,T=r.strideHeight,A=r.strideWidth,C=r.inChannels,R="SAME"===r.padInfo.type?1:0,I=r.batchSize,N=r.inHeight,O=r.inWidth;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend FusedDepthwiseConv2D does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");var D=a.makeOutput(r.outShape,"float32"),L=a.dataIdMap.get(D.dataId).id,k=null==p?0:a.dataIdMap.get(p.dataId).id;return M(h,I,N,O,d,v,y,b,x,w,g,_,R,S,E,T,A,C,f,i,k,L),D}}),Object(U.Wb)({kernelName:"Gather",backendName:"wasm",setupFunc:function(t){E=t.wasm.cwrap("Gather",null,["number","number","array","number","number","number","array","number"])},kernelFunc:function(t){var e=t.backend,a=t.inputs,n=t.attrs,u=a.x,i=a.indices,r=n.axis,s=u.shape.slice();s[r]=U.Nc.sizeFromShape(i.shape);var c=u.shape.length-1,p=e.makeOutput(s,u.dtype);if(0===U.Nc.sizeFromShape(u.shape))return p;var l=e.dataIdMap.get(u.dataId).id,h=e.dataIdMap.get(i.dataId).id,d=e.dataIdMap.get(p.dataId).id,b=new Uint8Array(new Int32Array(U.Nc.computeStrides(u.shape)).buffer),f=new Uint8Array(new Int32Array(U.Nc.computeStrides(s)).buffer);return E(l,o[u.dtype],b,c,h,r,f,d),p}}),Object(U.Wb)({kernelName:"GatherNd",backendName:"wasm",setupFunc:function(t){T=t.wasm.cwrap("GatherNd",null,["number","number","number","number","number","number","array","number"])},kernelFunc:function(t){var e=t.backend,n=t.inputs,r=n.x,u=n.indices,i=U.db.prepareAndValidate(r,u),c=i[0],s=i[1],l=i[2],p=i[3],h=e.makeOutput(c,r.dtype);if(0===s)return h;var d=u.shape,f=d[d.length-1],b=e.dataIdMap.get(r.dataId).id,m=e.dataIdMap.get(u.dataId).id,v=new Uint8Array(new Int32Array(p).buffer),y=e.dataIdMap.get(h.dataId).id;return T(b,o[r.dtype],m,s,f,l,v,y),h}}),X("Greater",!1,"bool"),X("GreaterEqual",!1,"bool"),X("Less",!1,"bool"),X("LessEqual",!1,"bool"),W("Log"),X("LogicalAnd",!1,"bool"),Object(U.Wb)({kernelName:"Max",backendName:"wasm",setupFunc:function(t){A=t.wasm.cwrap("Max",null,["number, number, number"])},kernelFunc:function(t){var a=t.backend,e=t.inputs,u=t.attrs.axes,i=e.x,n=a.dataIdMap.get(i.dataId).id;U.t.assertAxesAreInnerMostDims("max",u,i.shape.length);var s=U.t.computeOutAndReduceShapes(i.shape,u),r=s[0],p=s[1],o=U.Nc.sizeFromShape(p),c=a.makeOutput(r,i.dtype);if(0===U.Nc.sizeFromShape(i.shape))return c;var l=a.dataIdMap.get(c.dataId).id;return A(n,o,l),c}}),X("Maximum",!1),Object(U.Wb)({kernelName:"MaxPool",backendName:"wasm",setupFunc:function(t){C=t.wasm.cwrap("MaxPool",null,["number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.attrs,a=t.backend,r=n,u=e.x,i=a.dataIdMap.get(u.dataId).id,o=r.filterHeight,s=r.filterWidth,c=r.padInfo.top,p=r.padInfo.right,l=r.padInfo.bottom,h=r.padInfo.left,d=r.dilationHeight,f=r.dilationWidth,b=r.strideHeight,m=r.strideWidth,v=r.inChannels,y=r.outChannels;if("channelsLast"!==r.dataFormat)throw new Error("wasm backend does not support dataFormat:'"+r.dataFormat+"'. Please use 'channelsLast'.");var x=a.makeOutput(r.outShape,"float32"),w=a.dataIdMap.get(x.dataId).id;return C(i,u.shape[0],u.shape[1],u.shape[2],o,s,c,p,l,h,d,f,b,m,v,y,w),x}}),Object(U.Wb)({kernelName:"Min",backendName:"wasm",setupFunc:function(t){R=t.wasm.cwrap("Min",null,["number, number, number"])},kernelFunc:function(t){var a=t.backend,e=t.inputs,u=t.attrs.axes,i=e.x,n=a.dataIdMap.get(i.dataId).id;U.t.assertAxesAreInnerMostDims("min",u,i.shape.length);var s=U.t.computeOutAndReduceShapes(i.shape,u),r=s[0],p=s[1],o=U.Nc.sizeFromShape(p),c=a.makeOutput(r,i.dtype);if(0===U.Nc.sizeFromShape(i.shape))return c;var l=a.dataIdMap.get(c.dataId).id;return R(n,o,l),c}}),X("Minimum",!1),X("Mul",!0),W("Neg"),Object(U.Wb)({kernelName:"NonMaxSuppressionV3",backendName:"wasm",setupFunc:function(t){I=t.wasm.cwrap("NonMaxSuppressionV3","number",["number","number","number","number","number"])},kernelFunc:function(t){var e=t.backend,n=t.inputs,a=t.attrs,r=a.iouThreshold,u=a.maxOutputSize,i=a.scoreThreshold,o=n.boxes,s=n.scores,c=e.dataIdMap.get(o.dataId).id,p=e.dataIdMap.get(s.dataId).id,l=K(e,I(c,p,u,r,i)),h=l.pSelectedIndices,d=l.selectedSize,f=l.pSelectedScores;return e.wasm._free(f),e.makeOutput([d],"int32",h)}}),Object(U.Wb)({kernelName:"NonMaxSuppressionV5",backendName:"wasm",setupFunc:function(t){N=t.wasm.cwrap("NonMaxSuppressionV5","number",["number","number","number","number","number","number"])},kernelFunc:function(t){var e=t.backend,n=t.inputs,a=t.attrs,r=a.iouThreshold,u=a.maxOutputSize,i=a.scoreThreshold,o=a.softNmsSigma,s=n.boxes,c=n.scores,p=e.dataIdMap.get(s.dataId).id,l=e.dataIdMap.get(c.dataId).id,h=K(e,N(p,l,u,r,i,o)),d=h.pSelectedIndices,f=h.selectedSize,b=h.pSelectedScores;return[e.makeOutput([f],"int32",d),e.makeOutput([f],"float32",b)]}}),X("NotEqual",!1,"bool"),Object(U.Wb)({kernelName:"OnesLike",backendName:"wasm",kernelFunc:function(t){var e=t.inputs.x,n=t.backend,a=n.makeOutput(e.shape,e.dtype);return n.typedArrayFromHeap(a).fill(1),a}}),Object(U.Wb)({kernelName:"PadV2",backendName:"wasm",kernelFunc:function(t){var e=t.inputs.x,n=t.backend,a=t.attrs,r=a.paddings,u=a.constantValue,i=r.map((function(t,n){return t[0]+e.shape[n]+t[1]})),c=n.dataIdMap.get(e.dataId).id,s=n.makeOutput(i,e.dtype),l=n.dataIdMap.get(s.dataId).id,p=new Uint8Array(new Int32Array(e.shape).buffer),h=[].concat.apply([],r),d=new Uint8Array(new Int32Array(h).buffer);return O(c,p,e.shape.length,o[e.dtype],d,u,l),s},setupFunc:function(t){O=t.wasm.cwrap("PadV2",null,["number","array","number","number","array","number","number"])}}),X("Pow",!1),Object(U.Wb)({kernelName:"Prelu",backendName:"wasm",setupFunc:function(t){D=t.wasm.cwrap("Prelu",null,["number","number","number"])},kernelFunc:function(t){var e=t.inputs,n=t.backend,a=e.x,r=e.alpha,u=n.dataIdMap.get(a.dataId).id,i=n.dataIdMap.get(r.dataId).id,o=n.makeOutput(a.shape,"float32"),s=n.dataIdMap.get(o.dataId).id;return D(u,i,s),o}}),W("Relu"),W("Relu6"),Object(U.Wb)({kernelName:"Reshape",backendName:"wasm",kernelFunc:function(t){var e=t.inputs.x,n=t.attrs.shape;return{dataId:e.dataId,shape:n,dtype:e.dtype}}}),Object(U.Wb)({kernelName:"ResizeBilinear",backendName:"wasm",setupFunc:function(t){L=t.wasm.cwrap("ResizeBilinear",null,["number","number","number","number","number","number","number","number","number"])},kernelFunc:function(t){var e,a=t.backend,n=t.inputs,u=t.attrs,i=n.x,r=u.alignCorners,s=u.newHeight,o=u.newWidth,p=i.shape,c=p[0],l=p[1],h=p[2],d=p[3],b=[c,s,o,d],f=a.dataIdMap.get(i.dataId);"float32"!==f.dtype&&(e=Y({backend:a,inputs:{x:i},attrs:{dtype:"float32"}}),f=a.dataIdMap.get(e.dataId));var m=f.id,v=a.makeOutput(b,"float32");if(0===U.Nc.sizeFromShape(i.shape))return v;var y=a.dataIdMap.get(v.dataId).id;return L(m,c,l,h,d,s,o,r?1:0,y),null!=e&&a.disposeData(e.dataId),v}}),W("Rsqrt"),Object(U.Wb)({kernelName:"ScatterNd",backendName:"wasm",setupFunc:function(t){k=t.wasm.cwrap("ScatterNd",null,["number","number","number","number","number","number","array","number","number"])},kernelFunc:function(t){var e=t.backend,a=t.inputs,u=t.attrs,i=a.indices,n=a.updates,s=u.shape,r=e.makeOutput(s,n.dtype);if(0===U.Nc.sizeFromShape(s))return r;var p=U.fc.calculateShapes(n,i,s),c=p.sliceRank,l=p.numUpdates,h=p.sliceSize,b=p.strides,d=p.outputSize,f=e.dataIdMap.get(i.dataId).id,m=e.dataIdMap.get(n.dataId).id,v=new Uint8Array(new Int32Array(b).buffer),y=e.dataIdMap.get(r.dataId).id;return k(f,m,o[n.dtype],c,l,h,v,d,y),r}}),Object(U.Wb)({kernelName:"Sigmoid",backendName:"wasm",setupFunc:function(t){P=t.wasm.cwrap("Sigmoid",null,["number","number"])},kernelFunc:function(t){var e=t.backend,a=t.inputs.x,n=e.dataIdMap.get(a.dataId).id,u=e.makeOutput(a.shape,a.dtype),i=e.dataIdMap.get(u.dataId).id;return 0===U.Nc.sizeFromShape(u.shape)||P(n,i),u}}),W("Sin"),Object(U.Wb)({kernelName:"Slice",backendName:"wasm",kernelFunc:J}),Object(U.Wb)({kernelName:"Softmax",backendName:"wasm",setupFunc:function(t){q=t.wasm.cwrap("Softmax",null,["number","number","number","number"])},kernelFunc:function(t){var e=t.backend,a=t.inputs.logits,n=t.attrs.dim,u=e.dataIdMap.get(a.dataId).id,i=e.makeOutput(a.shape,a.dtype),r=e.dataIdMap.get(i.dataId).id,s=a.shape[n],o=U.Nc.sizeFromShape(a.shape)/s;return 0===U.Nc.sizeFromShape(i.shape)||q(u,r,s,o),i}}),W("Square"),X("Sub",!0),Object(U.Wb)({kernelName:"Sum",backendName:"wasm",setupFunc:function(t){F=t.wasm.cwrap("Sum",null,["number, number, number"])},kernelFunc:function(t){var a=t.backend,e=t.inputs,u=t.attrs.axes,i=e.x,n=a.dataIdMap.get(i.dataId).id;U.t.assertAxesAreInnerMostDims("sum",u,i.shape.length);var s=U.t.computeOutAndReduceShapes(i.shape,u),r=s[0],p=s[1],o=U.Nc.sizeFromShape(p),c=a.makeOutput(r,i.dtype);if(0===U.Nc.sizeFromShape(i.shape))return c;var l=a.dataIdMap.get(c.dataId).id;return F(n,o,l),c}}),W("Tanh"),Object(U.Wb)({kernelName:"Tile",backendName:"wasm",setupFunc:function(t){B=t.wasm.cwrap("Tile",null,["number","array","number","array","number","number"])},kernelFunc:function(t){for(var e=t.inputs,n=t.backend,a=t.attrs,r=e.x,u=n.dataIdMap.get(r.dataId).id,i=a.reps,c=new Array(r.shape.length),s=0;s<c.length;s++)c[s]=r.shape[s]*i[s];var l=new Uint8Array(new Int32Array(r.shape).buffer),p=new Uint8Array(new Int32Array(c).buffer),h=n.makeOutput(c,r.dtype),d=n.dataIdMap.get(h.dataId).id;return B(u,l,r.shape.length,p,c.length,o[h.dtype],d),h}}),Object(U.Wb)({kernelName:"Transpose",backendName:"wasm",kernelFunc:function(t){for(var e=t.inputs,n=t.backend,a=t.attrs,r=function(t,e){for(var n=[],a=[],r=0;r<t.length;++r)1!==t[r]&&n.push(t[r]),1!==t[e[r]]&&a.push(e[r]);for(r=0;r<a.length;++r){for(var u=-1,i=0;i<a.length;++i)a[i]>=r&&(-1===u||a[u]>a[i])&&(u=i);a[u]=r}return[n,a]}(e.x.shape,a.perm),u=r[0],i=r[1],c={dataId:e.x.dataId,shape:u,dtype:e.x.dtype},s=!0,l=0;l<i.length;l++)i[l]!==l&&(s=!1);var p=function(t,e){for(var n=new Array(t.length),a=0;a<n.length;a++)n[a]=t[e[a]];return n}(e.x.shape,a.perm);if(s)return{dataId:c.dataId,shape:p,dtype:c.dtype};var h=n.makeOutput(p,c.dtype),d=n.dataIdMap.get(c.dataId).id,f=n.dataIdMap.get(h.dataId).id,b=new Uint8Array(new Int32Array(i).buffer),m=new Uint8Array(new Int32Array(c.shape).buffer);return z(d,m,c.shape.length,o[c.dtype],f,b,i.length),h},setupFunc:function(t){z=t.wasm.cwrap("Transpose",null,["number","array","number","number","number","array","number"])}}),Object(U.Wb)({kernelName:"Unpack",backendName:"wasm",kernelFunc:function(t){for(var e=t.inputs.x,n=t.backend,a=t.attrs.axis,r=e.shape[a],u=e.shape.length,i=new Array(u-1),o=0,s=0;s<u;s++)s!==a&&(i[o++]=e.shape[s]);var c=new Array(r),p=new Array(u).fill(0),l=e.shape.slice();for(l[a]=1,s=0;s<c.length;s++)p[a]=s,c[s]=J({inputs:{x:e},attrs:{begin:p,size:l},backend:n});return c.map((function(t){return{dataId:t.dataId,dtype:t.dtype,shape:i}}))}}),Object(U.Wb)({kernelName:"ZerosLike",backendName:"wasm",kernelFunc:function(t){var e=t.inputs.x,n=t.backend,a=n.makeOutput(e.shape,e.dtype);return n.typedArrayFromHeap(a).fill(0),a}});var Z=function(t,e){return(Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Q(t,e,n,a){return new(n||(n=Promise))((function(r,u){function i(t){try{s(a.next(t))}catch(t){u(t)}}function o(t){try{s(a.throw(t))}catch(t){u(t)}}function s(t){t.done?r(t.value):new n((function(e){e(t.value)})).then(i,o)}s((a=a.apply(t,e||[])).next())}))}function $(t,e){var n,a,r,u,i={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return u={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(u[Symbol.iterator]=function(){return this}),u;function o(u){return function(o){return function(u){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,a&&(r=2&u[0]?a.return:u[0]?a.throw||((r=a.return)&&r.call(a),0):a.next)&&!(r=r.call(a,u[1])).done)return r;switch(a=0,r&&(u=[2&u[0],r.value]),u[0]){case 0:case 1:r=u;break;case 4:return i.label++,{value:u[1],done:!1};case 5:i.label++,a=u[1],u=[0];continue;case 7:u=i.ops.pop(),i.trys.pop();continue;default:if(!(r=(r=i.trys).length>0&&r[r.length-1])&&(6===u[0]||2===u[0])){i=0;continue}if(3===u[0]&&(!r||u[1]>r[0]&&u[1]<r[3])){i.label=u[1];break}if(6===u[0]&&i.label<r[1]){i.label=r[1],r=u;break}if(r&&i.label<r[2]){i.label=r[2],i.ops.push(u);break}r[2]&&i.ops.pop(),i.trys.pop();continue}u=e.call(t,i)}catch(t){u=[6,t],a=0}finally{n=r=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([u,o])}}}var tt,et=(function(e,n){var o,a=(o="undefined"!=typeof document&&document.currentScript?document.currentScript.src:void 0,function(e){var n,u,i,c,s,a=void 0!==(e=e||{})?e:{},l={};for(n in a)a.hasOwnProperty(n)&&(l[n]=a[n]);u="object"==typeof window,i="function"==typeof importScripts,c="object"==typeof t&&"object"==typeof t.versions&&"string"==typeof t.versions.node&&!u&&!i,s=!u&&!c&&!i;var h,p,d,f,b="";c?(b=r+"/",h=function(t,e){var n;return d||(d=G.a),f||(f=j.a),t=f.normalize(t),n=d.readFileSync(t),e?n:n.toString()},p=function(t){var e=h(t,!0);return e.buffer||(e=new Uint8Array(e)),_(e.buffer),e},t.argv.length>1&&t.argv[1].replace(/\\/g,"/"),t.argv.slice(2),t.on("uncaughtException",(function(t){if(!(t instanceof ct))throw t})),t.on("unhandledRejection",K),a.inspect=function(){return"[Emscripten Module object]"}):s?("undefined"!=typeof read&&(h=function(t){return read(t)}),p=function(t){var e;return"function"==typeof readbuffer?new Uint8Array(readbuffer(t)):(_("object"==typeof(e=read(t,"binary"))),e)},"undefined"!=typeof scriptArgs&&scriptArgs,"undefined"!=typeof print&&("undefined"==typeof console&&(console={}),console.log=print,console.warn=console.error="undefined"!=typeof printErr?printErr:print)):(u||i)&&(i?b=self.location.href:document.currentScript&&(b=document.currentScript.src),o&&(b=o),b=0!==b.indexOf("blob:")?b.substr(0,b.lastIndexOf("/")+1):"",h=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.send(null),e.responseText},i&&(p=function(t){var e=new XMLHttpRequest;return e.open("GET",t,!1),e.responseType="arraybuffer",e.send(null),new Uint8Array(e.response)}));var m,v,y=a.print||console.log.bind(console),x=a.printErr||console.warn.bind(console);for(n in l)l.hasOwnProperty(n)&&(a[n]=l[n]);l=null,a.arguments&&a.arguments,a.thisProgram&&a.thisProgram,a.quit&&a.quit,a.wasmBinary&&(m=a.wasmBinary),a.noExitRuntime&&a.noExitRuntime,"object"!=typeof WebAssembly&&x("no native wasm support detected");var g=new WebAssembly.Table({initial:112,maximum:112,element:"anyfunc"}),w=!1;function _(t,e){t||K("Assertion failed: "+e)}function S(t){var e=a["_"+t];return _(e,"Cannot call unknown function "+t+", make sure it is exported"),e}function M(t,e,n,a,r){var u={string:function(t){var e=0;if(null!=t&&0!==t){var n=1+(t.length<<2);!function(t,e,n){!function(t,e,n,a){if(!(a>0))return 0;for(var u=n+a-1,i=0;i<t.length;++i){var r=t.charCodeAt(i);if(r>=55296&&r<=57343&&(r=65536+((1023&r)<<10)|1023&t.charCodeAt(++i)),r<=127){if(n>=u)break;e[n++]=r}else if(r<=2047){if(n+1>=u)break;e[n++]=192|r>>6,e[n++]=128|63&r}else if(r<=65535){if(n+2>=u)break;e[n++]=224|r>>12,e[n++]=128|r>>6&63,e[n++]=128|63&r}else{if(n+3>=u)break;e[n++]=240|r>>18,e[n++]=128|r>>12&63,e[n++]=128|r>>6&63,e[n++]=128|63&r}}e[n]=0}(t,A,e,n)}(t,e=st(n),n)}return e},array:function(t){var e=st(t.length);return function(t,e){T.set(t,e)}(t,e),e}},i=S(t),o=[],s=0;if(a)for(var c=0;c<a.length;c++){var p=u[n[c]];p?(0===s&&(s=at()),o[c]=p(a[c])):o[c]=a[c]}var l=i.apply(null,o);return l=function(t){return"string"===e?N(t):"boolean"===e?Boolean(t):t}(l),0!==s&&ut(s),l}var E,T,A,C,R="undefined"!=typeof TextDecoder?new TextDecoder("utf8"):void 0;function I(t,e,n){for(var a=e+n,r=e;t[r]&&!(r>=a);)++r;if(r-e>16&&t.subarray&&R)return R.decode(t.subarray(e,r));for(var u="";e<r;){var i=t[e++];if(128&i){var o=63&t[e++];if(192!=(224&i)){var s=63&t[e++];if((i=224==(240&i)?(15&i)<<12|o<<6|s:(7&i)<<18|o<<12|s<<6|63&t[e++])<65536)u+=String.fromCharCode(i);else{var c=i-65536;u+=String.fromCharCode(55296|c>>10,56320|1023&c)}}else u+=String.fromCharCode((31&i)<<6|o)}else u+=String.fromCharCode(i)}return u}function N(t,e){return t?I(A,t,e):""}function O(t,e){return t%e>0&&(t+=e-t%e),t}function D(t){E=t,a.HEAP8=T=new Int8Array(t),a.HEAP16=new Int16Array(t),a.HEAP32=C=new Int32Array(t),a.HEAPU8=A=new Uint8Array(t),a.HEAPU16=new Uint16Array(t),a.HEAPU32=new Uint32Array(t),a.HEAPF32=new Float32Array(t),a.HEAPF64=new Float64Array(t)}"undefined"!=typeof TextDecoder&&new TextDecoder("utf-16le");var L=a.TOTAL_MEMORY||16777216;function k(t){for(;t.length>0;){var e=t.shift();if("function"!=typeof e){var n=e.func;"number"==typeof n?void 0===e.arg?a.dynCall_v(n):a.dynCall_vi(n,e.arg):n(void 0===e.arg?null:e.arg)}else e()}}(v=a.wasmMemory?a.wasmMemory:new WebAssembly.Memory({initial:L/65536}))&&(E=v.buffer),L=E.byteLength,D(E),C[2540]=5253200;var q=[],P=[],F=[],B=[];function z(t){q.unshift(t)}function U(t){B.unshift(t)}var V=Math.ceil,H=Math.floor,W=0,X=null,Y=null;function K(t){throw a.onAbort&&a.onAbort(t),y(t+=""),x(t),w=!0,t="abort("+t+"). Build with -s ASSERTIONS=1 for more info.",new WebAssembly.RuntimeError(t)}a.preloadedImages={},a.preloadedAudios={};var J="data:application/octet-stream;base64,";function Z(t){return String.prototype.startsWith?t.startsWith(J):0===t.indexOf(J)}var Q="tfjs-backend-wasm.wasm";function $(){try{if(m)return new Uint8Array(m);if(p)return p(Q);throw"both async and sync fetching of the wasm failed"}catch(t){K(t)}}Z(Q)||(Q=function(t){return a.locateFile?a.locateFile(t,b):b+t}(Q)),P.push({func:function(){ot()}});var tt={buffers:[null,[],[]],printChar:function(t,e){var n=tt.buffers[t];0===e||10===e?((1===t?y:x)(I(n,0)),n.length=0):n.push(e)},varargs:0,get:function(t){return tt.varargs+=4,C[tt.varargs-4>>2]},getStr:function(){return N(tt.get())},get64:function(){var t=tt.get();return tt.get(),t},getZero:function(){tt.get()}},et={a:function(){K()},d:function(t,e,n){A.set(A.subarray(e,e+n),t)},e:function(t){var e=T.length;if(t>2147418112)return!1;for(var n=Math.max(e,16777216);n<t;)n=n<=536870912?O(2*n,65536):Math.min(O((3*n+2147483648)/4,65536),2147418112);return!!function(t){try{return v.grow(t-E.byteLength+65535>>16),D(v.buffer),1}catch(t){}}(n)},f:function(t){try{return 0}catch(t){return"undefined"!=typeof FS&&t instanceof FS.ErrnoError||K(t),t.errno}},c:function(t,e,n,a,r){try{return 0}catch(t){return"undefined"!=typeof FS&&t instanceof FS.ErrnoError||K(t),t.errno}},g:function(t,e,n,a){try{for(var r=0,u=0;u<n;u++){for(var i=C[e+8*u>>2],o=C[e+(8*u+4)>>2],s=0;s<o;s++)tt.printChar(t,A[i+s]);r+=o}return C[a>>2]=r,0}catch(t){return"undefined"!=typeof FS&&t instanceof FS.ErrnoError||K(t),t.errno}},memory:v,b:function(t){return(t=+t)>=0?+H(t+.5):+V(t-.5)},table:g},nt=function(){var t={env:et,wasi_unstable:et};function e(t,e){var n=t.exports;a.asm=n,function(t){if(W--,a.monitorRunDependencies&&a.monitorRunDependencies(W),0==W&&(null!==X&&(clearInterval(X),X=null),Y)){var e=Y;Y=null,e()}}()}function n(t){e(t.instance)}function r(e){return(m||!u&&!i||"function"!=typeof fetch?new Promise((function(t,e){t($())})):fetch(Q,{credentials:"same-origin"}).then((function(t){if(!t.ok)throw"failed to load wasm binary file at '"+Q+"'";return t.arrayBuffer()})).catch((function(){return $()}))).then((function(e){return WebAssembly.instantiate(e,t)})).then(e,(function(t){x("failed to asynchronously prepare wasm: "+t),K(t)}))}if(W++,a.monitorRunDependencies&&a.monitorRunDependencies(W),a.instantiateWasm)try{return a.instantiateWasm(t,e)}catch(t){return x("Module.instantiateWasm callback failed with error: "+t),!1}return function(){if(m||"function"!=typeof WebAssembly.instantiateStreaming||Z(Q)||"function"!=typeof fetch)return r(n);fetch(Q,{credentials:"same-origin"}).then((function(e){return WebAssembly.instantiateStreaming(e,t).then(n,(function(t){x("wasm streaming compile failed: "+t),x("falling back to ArrayBuffer instantiation"),r(n)}))}))}(),{}}();a.asm=nt;var it,ot=a.___wasm_call_ctors=function(){return a.asm.h.apply(null,arguments)},at=(a._init=function(){return a.asm.i.apply(null,arguments)},a._register_tensor=function(){return a.asm.j.apply(null,arguments)},a._dispose_data=function(){return a.asm.k.apply(null,arguments)},a._dispose=function(){return a.asm.l.apply(null,arguments)},a._Abs=function(){return a.asm.m.apply(null,arguments)},a._Add=function(){return a.asm.n.apply(null,arguments)},a._AddN=function(){return a.asm.o.apply(null,arguments)},a._ArgMax=function(){return a.asm.p.apply(null,arguments)},a._AvgPool=function(){return a.asm.q.apply(null,arguments)},a._BatchMatMul=function(){return a.asm.r.apply(null,arguments)},a._ClipByValue=function(){return a.asm.s.apply(null,arguments)},a._Conv2D=function(){return a.asm.t.apply(null,arguments)},a._Cos=function(){return a.asm.u.apply(null,arguments)},a._CropAndResize=function(){return a.asm.v.apply(null,arguments)},a._DepthwiseConv2dNative=function(){return a.asm.w.apply(null,arguments)},a._Div=function(){return a.asm.x.apply(null,arguments)},a._Exp=function(){return a.asm.y.apply(null,arguments)},a._FloorDiv=function(){return a.asm.z.apply(null,arguments)},a._FusedBatchNorm=function(){return a.asm.A.apply(null,arguments)},a._FusedConv2D=function(){return a.asm.B.apply(null,arguments)},a._FusedDepthwiseConv2D=function(){return a.asm.C.apply(null,arguments)},a._Gather=function(){return a.asm.D.apply(null,arguments)},a._GatherNd=function(){return a.asm.E.apply(null,arguments)},a._Greater=function(){return a.asm.F.apply(null,arguments)},a._GreaterEqual=function(){return a.asm.G.apply(null,arguments)},a._Less=function(){return a.asm.H.apply(null,arguments)},a._LessEqual=function(){return a.asm.I.apply(null,arguments)},a._Log=function(){return a.asm.J.apply(null,arguments)},a._LogicalAnd=function(){return a.asm.K.apply(null,arguments)},a._Max=function(){return a.asm.L.apply(null,arguments)},a._MaxPool=function(){return a.asm.M.apply(null,arguments)},a._Maximum=function(){return a.asm.N.apply(null,arguments)},a._Min=function(){return a.asm.O.apply(null,arguments)},a._Minimum=function(){return a.asm.P.apply(null,arguments)},a._Mul=function(){return a.asm.Q.apply(null,arguments)},a._Neg=function(){return a.asm.R.apply(null,arguments)},a._NonMaxSuppressionV3=function(){return a.asm.S.apply(null,arguments)},a._NonMaxSuppressionV5=function(){return a.asm.T.apply(null,arguments)},a._NotEqual=function(){return a.asm.U.apply(null,arguments)},a._PadV2=function(){return a.asm.V.apply(null,arguments)},a._Pow=function(){return a.asm.W.apply(null,arguments)},a._Prelu=function(){return a.asm.X.apply(null,arguments)},a._Relu=function(){return a.asm.Y.apply(null,arguments)},a._Relu6=function(){return a.asm.Z.apply(null,arguments)},a._ResizeBilinear=function(){return a.asm._.apply(null,arguments)},a._Rsqrt=function(){return a.asm.$.apply(null,arguments)},a._ScatterNd=function(){return a.asm.aa.apply(null,arguments)},a._Sigmoid=function(){return a.asm.ba.apply(null,arguments)},a._Sin=function(){return a.asm.ca.apply(null,arguments)},a._Softmax=function(){return a.asm.da.apply(null,arguments)},a._Square=function(){return a.asm.ea.apply(null,arguments)},a._Sub=function(){return a.asm.fa.apply(null,arguments)},a._Sum=function(){return a.asm.ga.apply(null,arguments)},a._Tanh=function(){return a.asm.ha.apply(null,arguments)},a._Tile=function(){return a.asm.ia.apply(null,arguments)},a._Transpose=function(){return a.asm.ja.apply(null,arguments)},a.__FusedMatMul=function(){return a.asm.ka.apply(null,arguments)},a._malloc=function(){return a.asm.la.apply(null,arguments)},a._free=function(){return a.asm.ma.apply(null,arguments)},a.stackSave=function(){return a.asm.na.apply(null,arguments)}),st=a.stackAlloc=function(){return a.asm.oa.apply(null,arguments)},ut=a.stackRestore=function(){return a.asm.pa.apply(null,arguments)};function ct(t){this.name="ExitStatus",this.message="Program terminated with exit("+t+")",this.status=t}function lt(t){function e(){it||(it=!0,w||(k(P),k(F),a.onRuntimeInitialized&&a.onRuntimeInitialized(),function(){if(a.postRun)for("function"==typeof a.postRun&&(a.postRun=[a.postRun]);a.postRun.length;)U(a.postRun.shift());k(B)}()))}W>0||(function(){if(a.preRun)for("function"==typeof a.preRun&&(a.preRun=[a.preRun]);a.preRun.length;)z(a.preRun.shift());k(q)}(),W>0||(a.setStatus?(a.setStatus("Running..."),setTimeout((function(){setTimeout((function(){a.setStatus("")}),1),e()}),1)):e()))}if(a.dynCall_vi=function(){return a.asm.qa.apply(null,arguments)},a.dynCall_v=function(){return a.asm.ra.apply(null,arguments)},a.asm=nt,a.cwrap=function(t,e,n,a){var r=(n=n||[]).every((function(t){return"number"===t}));return"string"!==e&&r&&!a?S(t):function(){return M(t,e,n,arguments)}},a.then=function(t){if(it)t(a);else{var e=a.onRuntimeInitialized;a.onRuntimeInitialized=function(){e&&e(),t(a)}}return a},Y=function t(){it||lt(),it||(Y=t)},a.run=lt,a.preInit)for("function"==typeof a.preInit&&(a.preInit=[a.preInit]);a.preInit.length>0;)a.preInit.pop()();return lt(),e});e.exports=a}(tt={exports:{}}),tt.exports),nt=function(t){function e(e){var n=t.call(this)||this;return n.wasm=e,n.dataIdNextNumber=1,n.wasm.tfjs.init(),n.dataIdMap=new U.a(n,Object(U.P)()),n}return function(t,e){function n(){this.constructor=t}Z(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.write=function(t,e,n){var a={};return this.move(a,t,e,n),a},e.prototype.numDataIds=function(){return this.dataIdMap.numDataIds()},e.prototype.time=function(t){return Q(this,void 0,void 0,(function(){var e;return $(this,(function(a){return e=U.Nc.now(),t(),[2,{kernelMs:U.Nc.now()-e}]}))}))},e.prototype.move=function(t,e,a,n){var u=this.dataIdNextNumber++;if("string"!==n){var i=U.Nc.sizeFromShape(a),r=i*U.Nc.bytesPerElement(n),s=this.wasm._malloc(r);this.dataIdMap.set(t,{id:u,memoryOffset:s,shape:a,dtype:n}),this.wasm.tfjs.registerTensor(u,i,s),null!=e&&this.wasm.HEAPU8.set(new Uint8Array(e.buffer,0,r),s)}else{var o=e;this.dataIdMap.set(t,{id:u,stringBytes:o,shape:a,dtype:n,memoryOffset:null})}},e.prototype.read=function(t){return Q(this,void 0,void 0,(function(){return $(this,(function(e){return[2,this.readSync(t)]}))}))},e.prototype.readSync=function(t){var e=this.dataIdMap.get(t),a=e.memoryOffset,n=e.dtype,u=e.shape,i=e.stringBytes;return"string"===n?i:function(t,e){switch(e){case"float32":return new Float32Array(t);case"int32":return new Int32Array(t);case"bool":return new Uint8Array(t);default:throw new Error("Unknown dtype "+e)}}(this.wasm.HEAPU8.slice(a,a+U.Nc.sizeFromShape(u)*U.Nc.bytesPerElement(n)).buffer,n)},e.prototype.disposeData=function(t){var e=this.dataIdMap.get(t);this.wasm._free(e.memoryOffset),this.wasm.tfjs.disposeData(e.id),this.dataIdMap.delete(t)},e.prototype.floatPrecision=function(){return 32},e.prototype.getMemoryOffset=function(t){return this.dataIdMap.get(t).memoryOffset},e.prototype.dispose=function(){this.wasm.tfjs.dispose(),this.wasm=null},e.prototype.memory=function(){return{unreliable:!1}},e.prototype.makeOutput=function(t,e,a){var n;if(null==a)n=this.write(null,t,e);else{n={};var u=this.dataIdNextNumber++;this.dataIdMap.set(n,{id:u,memoryOffset:a,shape:t,dtype:e});var i=U.Nc.sizeFromShape(t);this.wasm.tfjs.registerTensor(u,i,a)}return{dataId:n,shape:t,dtype:e}},e.prototype.typedArrayFromHeap=function(t){var e=t.shape,a=t.dtype,n=t.dataId,u=this.wasm.HEAPU8.buffer,i=this.dataIdMap.get(n).memoryOffset,r=U.Nc.sizeFromShape(e);switch(a){case"float32":return new Float32Array(u,i,r);case"int32":return new Int32Array(u,i,r);case"bool":return new Uint8Array(u,i,r);default:throw new Error("Uknown dtype "+a)}},e}(U.b);function it(){return Q(this,void 0,void 0,(function(){return $(this,(function(t){return[2,new Promise((function(t,e){var a={};null!=ot&&(a.locateFile=function(t,e){return t.endsWith(".wasm")?ot:e+t},st&&(a.instantiateWasm=function(t){return function(e,a){return U.Nc.fetch(t,{credentials:"same-origin"}).then((function(n){n.ok||e.env.a("failed to load wasm binary file at '"+t+"'"),n.arrayBuffer().then((function(t){WebAssembly.instantiate(t,e).then((function(t){a(t.instance)}))}))})),{}}}(ot)));var n=et(a);n.tfjs={init:n.cwrap("init",null,[]),registerTensor:n.cwrap("register_tensor",null,["number","number","number"]),disposeData:n.cwrap("dispose_data",null,["number"]),dispose:n.cwrap("dispose",null,[])};var u=!1;n.onRuntimeInitialized=function(){u=!0,at=!1,t({wasm:n})},n.onAbort=function(){u||at||(at=!0,e({message:"Make sure the server can serve the `.wasm` file relative to the bundled js file. For more details see https://github.com/tensorflow/tfjs/blob/master/tfjs-backend-wasm/README.md#using-bundlers"}))}}))]}))}))}Object(U.Vb)("wasm",(function(){return Q(void 0,void 0,void 0,(function(){var t;return $(this,(function(e){switch(e.label){case 0:return[4,it()];case 1:return t=e.sent().wasm,[2,new nt(t)]}}))}))}),2);var ot=null,at=!1,st=!1;function ut(t,e){if(void 0===e&&(e=!1),at)throw new Error("The WASM backend was already initialized. Make sure you call `setWasmPath()` before you call `tf.setBackend()` or `tf.ready()`");ot=t,st=e}}).call(this,n(89),"/")},127:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.version="1.7.4"},129:function(t,e,n){"use strict";function r(t,p){return(r=Object.setPrototypeOf||function(t,p){return t.__proto__=p,t})(t,p)}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}n.d(e,"a",(function(){return o}))},130:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(26);function o(t,e){return!e||"object"!==Object(r.a)(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}},182:function(t,e,n){"use strict";e.byteLength=function(t){var e=h(t),n=e[0],r=e[1];return 3*(n+r)/4-r},e.toByteArray=function(t){var e,i,n=h(t),r=n[0],l=n[1],d=new c(function(t,e,n){return 3*(e+n)/4-n}(0,r,l)),f=0,m=l>0?r-4:r;for(i=0;i<m;i+=4)e=o[t.charCodeAt(i)]<<18|o[t.charCodeAt(i+1)]<<12|o[t.charCodeAt(i+2)]<<6|o[t.charCodeAt(i+3)],d[f++]=e>>16&255,d[f++]=e>>8&255,d[f++]=255&e;2===l&&(e=o[t.charCodeAt(i)]<<2|o[t.charCodeAt(i+1)]>>4,d[f++]=255&e);1===l&&(e=o[t.charCodeAt(i)]<<10|o[t.charCodeAt(i+1)]<<4|o[t.charCodeAt(i+2)]>>2,d[f++]=e>>8&255,d[f++]=255&e);return d},e.fromByteArray=function(t){for(var e,n=t.length,o=n%3,c=[],i=0,l=n-o;i<l;i+=16383)c.push(d(t,i,i+16383>l?l:i+16383));1===o?(e=t[n-1],c.push(r[e>>2]+r[e<<4&63]+"==")):2===o&&(e=(t[n-2]<<8)+t[n-1],c.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"="));return c.join("")};for(var r=[],o=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,l=code.length;i<l;++i)r[i]=code[i],o[code.charCodeAt(i)]=i;function h(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");return-1===n&&(n=e),[n,n===e?0:4-n%4]}function d(t,e,n){for(var o,c,output=[],i=e;i<n;i+=3)o=(t[i]<<16&16711680)+(t[i+1]<<8&65280)+(255&t[i+2]),output.push(r[(c=o)>>18&63]+r[c>>12&63]+r[c>>6&63]+r[63&c]);return output.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},183:function(t,e){e.read=function(t,e,n,r,o){var c,l,h=8*o-r-1,d=(1<<h)-1,f=d>>1,m=-7,i=n?o-1:0,v=n?-1:1,s=t[e+i];for(i+=v,c=s&(1<<-m)-1,s>>=-m,m+=h;m>0;c=256*c+t[e+i],i+=v,m-=8);for(l=c&(1<<-m)-1,c>>=-m,m+=r;m>0;l=256*l+t[e+i],i+=v,m-=8);if(0===c)c=1-f;else{if(c===d)return l?NaN:1/0*(s?-1:1);l+=Math.pow(2,r),c-=f}return(s?-1:1)*l*Math.pow(2,c-r)},e.write=function(t,e,n,r,o,c){var l,h,d,f=8*c-o-1,m=(1<<f)-1,v=m>>1,rt=23===o?Math.pow(2,-24)-Math.pow(2,-77):0,i=r?0:c-1,y=r?1:-1,s=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(h=isNaN(e)?1:0,l=m):(l=Math.floor(Math.log(e)/Math.LN2),e*(d=Math.pow(2,-l))<1&&(l--,d*=2),(e+=l+v>=1?rt/d:rt*Math.pow(2,1-v))*d>=2&&(l++,d/=2),l+v>=m?(h=0,l=m):l+v>=1?(h=(e*d-1)*Math.pow(2,o),l+=v):(h=e*Math.pow(2,v-1)*Math.pow(2,o),l=0));o>=8;t[n+i]=255&h,i+=y,h/=256,o-=8);for(l=l<<o|h,f+=o;f>0;t[n+i]=255&l,i+=y,l/=256,f-=8);t[n+i-y]|=128*s}},184:function(t,e){var n={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==n.call(t)}},24:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n.d(e,"a",(function(){return r}))},25:function(t,e,n){"use strict";function r(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function o(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}n.d(e,"a",(function(){return o}))},26:function(t,e,n){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}n.d(e,"a",(function(){return r}))},44:function(t,e,n){"use strict";var r={name:"NoSsr",functional:!0,props:{placeholder:String,placeholderTag:{type:String,default:"div"}},render:function(t,e){var n=e.parent,r=e.slots,o=e.props,c=r(),l=c.default;void 0===l&&(l=[]);var h=c.placeholder;return n._isMounted?l:(n.$once("hook:mounted",(function(){n.$forceUpdate()})),o.placeholderTag&&(o.placeholder||h)?t(o.placeholderTag,{class:["no-ssr-placeholder"]},o.placeholder||h):l.length>0?l.map((function(){return t(!1)})):t(!1))}};t.exports=r},50:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function o(t,i){return function(t){if(Array.isArray(t))return t}(t)||function(t,i){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){var e=[],n=!0,r=!1,o=void 0;try{for(var c,l=t[Symbol.iterator]();!(n=(c=l.next()).done)&&(e.push(c.value),!i||e.length!==i);n=!0);}catch(t){r=!0,o=t}finally{try{n||null==l.return||l.return()}finally{if(r)throw o}}return e}}(t,i)||function(t,e){if(t){if("string"==typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}(t,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n.d(e,"a",(function(){return o}))},52:function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var content=function(t,e){var content=t[1]||"",n=t[3];if(!n)return content;if(e&&"function"==typeof btoa){var r=(c=n,l=btoa(unescape(encodeURIComponent(JSON.stringify(c)))),data="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(l),"/*# ".concat(data," */")),o=n.sources.map((function(source){return"/*# sourceURL=".concat(n.sourceRoot||"").concat(source," */")}));return[content].concat(o).concat([r]).join("\n")}var c,l,data;return[content].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(content,"}"):content})).join("")},e.i=function(t,n,r){"string"==typeof t&&(t=[[null,t,""]]);var o={};if(r)for(var i=0;i<this.length;i++){var c=this[i][0];null!=c&&(o[c]=!0)}for(var l=0;l<t.length;l++){var h=[].concat(t[l]);r&&o[h[0]]||(n&&(h[2]?h[2]="".concat(n," and ").concat(h[2]):h[2]=n),e.push(h))}},e}},53:function(t,e,n){"use strict";function r(t,e){for(var n=[],r={},i=0;i<e.length;i++){var o=e[i],c=o[0],l={id:t+":"+i,css:o[1],media:o[2],sourceMap:o[3]};r[c]?r[c].parts.push(l):n.push(r[c]={id:c,parts:[l]})}return n}n.r(e),n.d(e,"default",(function(){return y}));var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var c={},head=o&&(document.head||document.getElementsByTagName("head")[0]),l=null,h=0,d=!1,f=function(){},m=null,v="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function y(t,e,n,o){d=n,m=o||{};var l=r(t,e);return x(l),function(e){for(var n=[],i=0;i<l.length;i++){var o=l[i];(h=c[o.id]).refs--,n.push(h)}e?x(l=r(t,e)):l=[];for(i=0;i<n.length;i++){var h;if(0===(h=n[i]).refs){for(var d=0;d<h.parts.length;d++)h.parts[d]();delete c[h.id]}}}}function x(t){for(var i=0;i<t.length;i++){var e=t[i],n=c[e.id];if(n){n.refs++;for(var r=0;r<n.parts.length;r++)n.parts[r](e.parts[r]);for(;r<e.parts.length;r++)n.parts.push(_(e.parts[r]));n.parts.length>e.parts.length&&(n.parts.length=e.parts.length)}else{var o=[];for(r=0;r<e.parts.length;r++)o.push(_(e.parts[r]));c[e.id]={id:e.id,refs:1,parts:o}}}}function w(){var t=document.createElement("style");return t.type="text/css",head.appendChild(t),t}function _(t){var e,n,r=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(r){if(d)return f;r.parentNode.removeChild(r)}if(v){var o=h++;r=l||(l=w()),e=E.bind(null,r,o,!1),n=E.bind(null,r,o,!0)}else r=w(),e=T.bind(null,r),n=function(){r.parentNode.removeChild(r)};return e(t),function(r){if(r){if(r.css===t.css&&r.media===t.media&&r.sourceMap===t.sourceMap)return;e(t=r)}else n()}}var S,M=(S=[],function(t,e){return S[t]=e,S.filter(Boolean).join("\n")});function E(t,e,n,r){var o=n?"":r.css;if(t.styleSheet)t.styleSheet.cssText=M(e,o);else{var c=document.createTextNode(o),l=t.childNodes;l[e]&&t.removeChild(l[e]),l.length?t.insertBefore(c,l[e]):t.appendChild(c)}}function T(t,e){var n=e.css,r=e.media,o=e.sourceMap;if(r&&t.setAttribute("media",r),m.ssrId&&t.setAttribute("data-vue-ssr-id",e.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}},6:function(t,e,n){"use strict";function r(t,e,n,r,o,c,l){try{var h=t[c](l),d=h.value}catch(t){return void n(t)}h.done?e(d):Promise.resolve(d).then(r,o)}function o(t){return function(){var e=this,n=arguments;return new Promise((function(o,c){var l=t.apply(e,n);function h(t){r(l,o,c,h,d,"next",t)}function d(t){r(l,o,c,h,d,"throw",t)}h(void 0)}))}}n.d(e,"a",(function(){return o}))},69:function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,"a",(function(){return r}))},91:function(t,e,n){"use strict";var r={name:"ClientOnly",functional:!0,props:{placeholder:String,placeholderTag:{type:String,default:"div"}},render:function(t,e){var n=e.parent,r=e.slots,o=e.props,c=r(),l=c.default;void 0===l&&(l=[]);var h=c.placeholder;return n._isMounted?l:(n.$once("hook:mounted",(function(){n.$forceUpdate()})),o.placeholderTag&&(o.placeholder||h)?t(o.placeholderTag,{class:["client-only-placeholder"]},o.placeholder||h):l.length>0?l.map((function(){return t(!1)})):t(!1))}};t.exports=r},92:function(t,e,n){"use strict";function r(t){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}n.d(e,"a",(function(){return r}))},93:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return mt}));var r,o,c,l=n(0),h=function(){return(h=Object.assign||function(t){for(var e,a=1,n=arguments.length;a<n;a++)for(var r in e=arguments[a])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};function d(t,e,a,n){return new(a||(a=Promise))((function(r,s){function o(t){try{u(n.next(t))}catch(t){s(t)}}function p(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){t.done?r(t.value):new a((function(e){e(t.value)})).then(o,p)}u((n=n.apply(t,e||[])).next())}))}function f(t,e){var a,n,r,s,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return s={next:p(0),throw:p(1),return:p(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function p(s){return function(p){return function(s){if(a)throw new TypeError("Generator is already executing.");for(;o;)try{if(a=1,n&&(r=2&s[0]?n.return:s[0]?n.throw||((r=n.return)&&r.call(n),0):n.next)&&!(r=r.call(n,s[1])).done)return r;switch(n=0,r&&(s=[2&s[0],r.value]),s[0]){case 0:case 1:r=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,n=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!r||s[1]>r[0]&&s[1]<r[3])){o.label=s[1];break}if(6===s[0]&&o.label<r[1]){o.label=r[1],r=s;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(s);break}r[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(t){s=[6,t],n=0}finally{a=r=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,p])}}}(c=r||(r={}))[c.DT_INVALID=0]="DT_INVALID",c[c.DT_FLOAT=1]="DT_FLOAT",c[c.DT_DOUBLE=2]="DT_DOUBLE",c[c.DT_INT32=3]="DT_INT32",c[c.DT_UINT8=4]="DT_UINT8",c[c.DT_INT16=5]="DT_INT16",c[c.DT_INT8=6]="DT_INT8",c[c.DT_STRING=7]="DT_STRING",c[c.DT_COMPLEX64=8]="DT_COMPLEX64",c[c.DT_INT64=9]="DT_INT64",c[c.DT_BOOL=10]="DT_BOOL",c[c.DT_QINT8=11]="DT_QINT8",c[c.DT_QUINT8=12]="DT_QUINT8",c[c.DT_QINT32=13]="DT_QINT32",c[c.DT_BFLOAT16=14]="DT_BFLOAT16",c[c.DT_FLOAT_REF=101]="DT_FLOAT_REF",c[c.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",c[c.DT_INT32_REF=103]="DT_INT32_REF",c[c.DT_UINT8_REF=104]="DT_UINT8_REF",c[c.DT_INT16_REF=105]="DT_INT16_REF",c[c.DT_INT8_REF=106]="DT_INT8_REF",c[c.DT_STRING_REF=107]="DT_STRING_REF",c[c.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",c[c.DT_INT64_REF=109]="DT_INT64_REF",c[c.DT_BOOL_REF=110]="DT_BOOL_REF",c[c.DT_QINT8_REF=111]="DT_QINT8_REF",c[c.DT_QUINT8_REF=112]="DT_QUINT8_REF",c[c.DT_QINT32_REF=113]="DT_QINT32_REF",c[c.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",function(t){!function(t){t[t.LEGACY=0]="LEGACY",t[t.V1=1]="V1",t[t.V2=2]="V2"}(t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(o||(o={}));var m={};function v(t){return m[t]}function y(t,e,a,n){var r=e.inputParams[t];if(r&&void 0!==r.inputIndexStart){var s=r.inputIndexStart,o=0===r.inputIndexEnd?void 0:void 0===r.inputIndexEnd?s+1:r.inputIndexEnd;if("tensor"===r.type)return x(e.inputNames[r.inputIndexStart],a,n);if("tensors"===r.type)return e.inputNames.slice(s,o).map((function(t){return x(t,a,n)}));var p=Array.prototype.slice.call(x(e.inputNames.slice(s)[0],a,n).dataSync());return"number"===r.type?p[0]:p}var u=e.attrParams[t];return u&&u.value}function x(t,e,a){var n=S(t),r=n[0],s=n[1],o=a.currentContextIds.find((function(t){return!!e[_(r,t)]}));return void 0!==o?e[_(r,o)][s]:void 0}function w(t,e){var a=S(t),n=a[0],r=a[1];return[_(n,e&&e.currentContextId),r]}function _(t,e){return e?t+"-"+e:t}function S(t){var e=t.lastIndexOf(":");return-1===e?[t,0]:[t.substring(0,e),Number(t.substring(e+1))]}function M(t,e){for(var a=[],n=0;n<t.length;n+=e)a.push(t.slice(n,n+e));return a}var E=Object.freeze({json:[{tfOpName:"Add",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddV2",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AddN",category:"arithmetic",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"BiasAdd",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sub",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"RealDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Div",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"DivNoNan",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorDiv",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mul",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Maximum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Minimum",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}]},{tfOpName:"Pow",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SquaredDifference",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Mod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"FloorMod",category:"arithmetic",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),T=Object.freeze({json:[{tfOpName:"Abs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atan2",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ceil",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ClipByValue",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"clip_value_min",name:"clipValueMin",type:"number"},{tfName:"clip_value_max",name:"clipValueMax",type:"number"}]},{tfOpName:"Complex",category:"basic_math",inputs:[{start:0,name:"real",type:"tensor"},{start:1,name:"imag",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ComplexAbs",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cos",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Cosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Elu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Exp",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Floor",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Imag",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Neg",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Real",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"Tout",name:"outputType",type:"dtype",notSupported:!0}]},{tfOpName:"Prelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"alpha",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Relu6",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"clipValueMin",name:"clipValueMin",type:"number",defaultValue:0},{tfName:"clipValueMax",name:"clipValueMax",type:"number",defaultValue:6}]},{tfOpName:"Selu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sigmoid",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sin",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Rsqrt",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Square",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tan",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Tanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Sign",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Round",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Expm1",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Log1p",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Reciprocal",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Softplus",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Asinh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Acosh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Atanh",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Erf",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Prod",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axes",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LeakyRelu",category:"basic_math",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"alpha",name:"alpha",type:"number",defaultValue:.2},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),A=Object.freeze({json:[{tfOpName:"LoopCond",category:"control",inputs:[{start:0,name:"pred",type:"tensor"}]},{tfOpName:"Switch",category:"control",inputs:[{start:0,name:"data",type:"tensor"},{start:1,name:"pred",type:"tensor"}]},{tfOpName:"Merge",category:"control",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}]},{tfOpName:"Enter",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"frame_name",name:"frameName",type:"string"},{tfName:"is_constant",name:"isConstant",type:"bool"}]},{tfOpName:"Exit",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NextIteration",category:"control",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayV3",category:"control",inputs:[{start:0,name:"size",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"},{tfName:"dynamic_size",name:"dynamicSize",type:"bool"},{tfName:"clear_after_read",name:"clearAfterRead",type:"bool"},{tfName:"identical_element_shapes",name:"identicalElementShapes",type:"bool"},{tfName:"tensor_array_name",name:"name",type:"string"}]},{tfOpName:"TensorArrayWriteV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayReadV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"index",type:"number"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"TensorArrayGatherV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape",name:"elementShape",type:"shape"}]},{tfOpName:"TensorArrayScatterV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"indices",type:"number[]"},{start:2,name:"tensor",type:"tensor"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArrayConcatV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"element_shape_except0",name:"elementShapeExcept0",type:"shape",notSupported:!0}]},{tfOpName:"TensorArraySplitV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"tensor",type:"tensor"},{start:2,name:"lengths",type:"number[]"},{start:3,name:"flowIn",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"TensorArraySizeV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"},{start:1,name:"flowIn",type:"number"}]},{tfOpName:"TensorArrayCloseV3",category:"control",inputs:[{start:0,name:"tensorArrayId",type:"number"}]}]}),C=Object.freeze({json:[{tfOpName:"AvgPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPoolWithArgmax",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"include_batch_in_index",name:"includeBatchInIndex",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"AvgPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MaxPool3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0},{tfName:"ksize",name:"kernelSize",type:"number[]"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Conv1D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"stride",name:"stride",type:"number"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NWC"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"dilation",name:"dilation",type:"number",defaultValue:1}]},{tfOpName:"Conv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"useCudnnOnGpu",name:"useCudnnOnGpu",type:"bool"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"_FusedConv2D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"explicit_paddings",name:"explicitPaddings",type:"number[]",defaultValue:[]},{tfName:"use_cudnn_on_gpu",name:"useCudnnOnGpu",type:"bool",defaultValue:!0},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4}]},{tfOpName:"Conv2DBackpropInput",category:"convolution",inputs:[{start:2,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:0,name:"outputShape",type:"number[]"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"DepthwiseConv2d",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"DepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"input",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]},{tfOpName:"FusedDepthwiseConv2dNative",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0},{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]",defaultValue:[1,1,1,1]},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]}]},{tfOpName:"Conv3D",category:"convolution",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"filter",type:"tensor"}],attrs:[{tfName:"strides",name:"strides",type:"number[]"},{tfName:"padding",name:"pad",type:"string"},{tfName:"data_format",name:"dataFormat",type:"string",defaultValue:"NHWC"},{tfName:"dilations",name:"dilations",type:"number[]"}]}]}),R=Object.freeze({json:[{tfOpName:"Fill",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"},{start:1,name:"value",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"LinSpace",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"num",type:"number"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"OneHot",category:"creation",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"depth",type:"number"},{start:2,name:"onValue",type:"number",defaultValue:1},{start:3,name:"offValue",type:"number",defaultValue:0}],attrs:[{tfName:"axis",name:"axis",type:"number",notSupported:!0},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Ones",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"OnesLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"RandomUniform",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"minval",name:"minval",type:"number",defaultValue:0},{tfName:"maxval",name:"maxval",type:"number",defaultValue:1},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"seed",name:"seed",type:"number",defaultValue:0},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Range",category:"creation",inputs:[{start:0,name:"start",type:"number"},{start:1,name:"stop",type:"number"},{start:2,name:"step",type:"number",defaultValue:0}],attrs:[{tfName:"Tidx",name:"dtype",type:"dtype"}]},{tfOpName:"TruncatedNormal",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"means",name:"mean",type:"number",defaultValue:0},{tfName:"stddev",name:"stdDev",type:"number",defaultValue:1},{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number",defaultValue:0,notSupported:!0},{tfName:"dtype",name:"dtype",type:"dtype"},{tfName:"T",name:"T",type:"number",notSupported:!0}]},{tfOpName:"Zeros",category:"creation",inputs:[{start:0,name:"shape",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"ZerosLike",category:"creation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype"}]},{tfOpName:"Multinomial",category:"creation",inputs:[{start:0,name:"logits",type:"tensor"},{start:1,name:"numSamples",type:"number"}],attrs:[{tfName:"seed",name:"seed",type:"number"},{tfName:"seed2",name:"seed2",type:"number"},{tfName:"T",name:"dtype",type:"dtype"},{tfName:"output_dtype",name:"output_dtype",type:"dtype"}]}]}),I=Object.freeze({json:[{tfOpName:"NonMaxSuppressionV2",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV3",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"}]},{tfOpName:"NonMaxSuppressionV5",category:"dynamic",inputs:[{start:0,name:"boxes",type:"tensor"},{start:1,name:"scores",type:"tensor"},{start:2,name:"maxOutputSize",type:"number"},{start:3,name:"iouThreshold",type:"number"},{start:4,name:"scoreThreshold",type:"number"},{start:5,name:"softNmsSigma",type:"number"}]},{tfOpName:"Where",category:"dynamic",inputs:[{start:0,name:"condition",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ListDiff",category:"dynamic",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"y",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),N=Object.freeze({json:[{tfOpName:"TopKV2",category:"evaluation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"k",type:"number"}],attrs:[{tfName:"sorted",name:"sorted",type:"bool"}]}]}),O=Object.freeze({json:[{tfOpName:"PlaceholderWithDefault",category:"graph",inputs:[{start:0,name:"default",type:"tensor"}],attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Placeholder",category:"graph",attrs:[{tfName:"shape",name:"shape",type:"shape"},{tfName:"dtype",name:"dtype",type:"dtype"}]},{tfOpName:"Const",category:"graph"},{tfOpName:"Identity",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IdentityN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Snapshot",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Rank",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Size",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"Shape",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"ShapeN",category:"graph",inputs:[{start:0,end:0,name:"x",type:"tensors"}]},{tfOpName:"Print",category:"graph",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"data",type:"tensors"}],attrs:[{tfName:"message",name:"message",type:"string"},{tfName:"first_n",name:"firstN",type:"number",notSupported:!0},{tfName:"summarize",name:"summarize",type:"number",defaultValue:3}]},{tfOpName:"NoOp",category:"graph",inputs:[]},{tfOpName:"StopGradient",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"FakeQuantWithMinMaxVars",category:"graph",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"min",name:"min",type:"number"},{tfName:"max",name:"max",type:"number"}]}]}),D=Object.freeze({json:[{tfOpName:"ResizeBilinear",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"ResizeNearestNeighbor",category:"image",inputs:[{start:0,name:"images",type:"tensor"},{start:1,name:"size",type:"number[]"}],attrs:[{tfName:"align_corners",name:"alignCorners",type:"bool"},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"CropAndResize",category:"image",inputs:[{start:0,name:"image",type:"tensor"},{start:1,name:"boxes",type:"tensor"},{start:2,name:"boxInd",type:"tensor"},{start:3,name:"cropSize",type:"number[]"}],attrs:[{tfName:"method",name:"method",type:"string"},{tfName:"extrapolation_value",name:"extrapolationValue",type:"number"}]}]}),L=Object.freeze({json:[{tfOpName:"Equal",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"NotEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Greater",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"GreaterEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Less",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LessEqual",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalAnd",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalNot",category:"logical",inputs:[{start:0,name:"a",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"LogicalOr",category:"logical",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Select",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"SelectV2",category:"logical",inputs:[{start:0,name:"condition",type:"tensor"},{start:1,name:"a",type:"tensor"},{start:2,name:"b",type:"tensor"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),k=Object.freeze({json:[{tfOpName:"_FusedMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"},{start:2,end:0,name:"args",type:"tensors"}],attrs:[{tfName:"num_args",name:"numArgs",type:"number"},{tfName:"fused_ops",name:"fusedOps",type:"string[]",defaultValue:[]},{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:1e-4},{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"MatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"transpose_a",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"transpose_b",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMul",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"BatchMatMulV2",category:"matrices",inputs:[{start:0,name:"a",type:"tensor"},{start:1,name:"b",type:"tensor"}],attrs:[{tfName:"adj_x",name:"transposeA",type:"bool",defaultValue:!1},{tfName:"adj_y",name:"transposeB",type:"bool",defaultValue:!1},{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]},{tfOpName:"Transpose",category:"matrices",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"perm",type:"number[]"}],attrs:[{tfName:"T",name:"dtype",type:"dtype",notSupported:!0}]}]}),P=Object.freeze({json:[{tfOpName:"FusedBatchNorm",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV2",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"FusedBatchNormV3",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"scale",type:"tensor"},{start:2,name:"offset",type:"tensor"},{start:3,name:"mean",type:"tensor"},{start:4,name:"variance",type:"tensor"}],attrs:[{tfName:"epsilon",name:"epsilon",type:"number",defaultValue:.001},{tfName:"data_format",name:"dataFormat",type:"string",notSupported:!0}]},{tfOpName:"LRN",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"depth_radius",name:"radius",type:"number",defaultValue:5},{tfName:"bias",name:"bias",type:"number",defaultValue:1},{tfName:"alpha",name:"alpha",type:"number",defaultValue:1},{tfName:"beta",name:"beta",type:"number",defaultValue:.5}]},{tfOpName:"Softmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"LogSoftmax",category:"normalization",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"SparseToDense",category:"normalization",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!0,notSupported:!0}]}]}),F=Object.freeze({json:[{tfOpName:"Max",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Mean",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Min",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Sum",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"All",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"Any",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]},{tfOpName:"ArgMax",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"ArgMin",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Prod",category:"reduction",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}],attrs:[{tfName:"keep_dims",name:"keepDims",type:"bool"}]}]}),B=Object.freeze({json:[{tfOpName:"ConcatV2",category:"slice_join",inputs:[{start:0,end:-1,name:"tensors",type:"tensors"},{start:-1,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"Concat",category:"slice_join",inputs:[{start:1,end:0,name:"tensors",type:"tensors"},{start:0,name:"axis",type:"number"}],attrs:[{tfName:"N",name:"n",type:"number",defaultValue:2}]},{tfOpName:"GatherV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Gather",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"validate_indices",name:"validateIndices",type:"bool",notSupported:!0}]},{tfOpName:"Reverse",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"dims",type:"bool",notSupported:!0}]},{tfOpName:"ReverseV2",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number[]"}]},{tfOpName:"Slice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"size",type:"number[]"}]},{tfOpName:"StridedSlice",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"begin",type:"number[]"},{start:2,name:"end",type:"number[]"},{start:3,name:"strides",type:"number[]"}],attrs:[{tfName:"begin_mask",name:"beginMask",type:"number",defaultValue:0},{tfName:"end_mask",name:"endMask",type:"number",defaultValue:0},{tfName:"new_axis_mask",name:"newAxisMask",type:"number",defaultValue:0},{tfName:"ellipsis_mask",name:"ellipsisMask",type:"number",defaultValue:0},{tfName:"shrink_axis_mask",name:"shrinkAxisMask",type:"number",defaultValue:0}]},{tfOpName:"Pack",category:"slice_join",inputs:[{start:0,end:0,name:"tensors",type:"tensors"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0}]},{tfOpName:"Unpack",category:"slice_join",inputs:[{start:0,name:"tensor",type:"tensor"}],attrs:[{tfName:"axis",name:"axis",type:"number",defaultValue:0},{tfName:"num",name:"num",type:"number",defaultValue:0,notSupported:!0}]},{tfOpName:"Tile",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"reps",type:"number[]"}]},{tfOpName:"Split",category:"slice_join",inputs:[{start:0,name:"axis",type:"number",defaultValue:0},{start:1,name:"x",type:"tensor"}],attrs:[{tfName:"num_split",name:"numOrSizeSplits",type:"number",defaultValue:1}]},{tfOpName:"SplitV",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"numOrSizeSplits",type:"number[]"},{start:2,name:"axis",type:"number",defaultValue:0}]},{tfOpName:"ScatterNd",category:"slice_join",inputs:[{start:0,name:"indices",type:"tensor"},{start:1,name:"values",type:"tensor"},{start:2,name:"shape",type:"number[]"}]},{tfOpName:"GatherNd",category:"slice_join",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"indices",type:"tensor"}]},{tfOpName:"SparseToDense",category:"slice_join",inputs:[{start:0,name:"sparseIndices",type:"tensor"},{start:1,name:"outputShape",type:"number[]"},{start:2,name:"sparseValues",type:"tensor"},{start:3,name:"defaultValue",type:"tensor"}],attrs:[{tfName:"validate_indices",name:"validateIndices",type:"bool",defaultValue:!1,notSupported:!0}]}]}),z=Object.freeze({json:[{tfOpName:"FFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"IFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"}]},{tfOpName:"RFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]},{tfOpName:"IRFFT",category:"spectral",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"fft_length",type:"number",notSupported:!0}]}]}),U=Object.freeze({json:[{tfOpName:"Cast",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"SrcT",name:"sdtype",type:"dtype",notSupported:!0},{tfName:"DstT",name:"dtype",type:"dtype"}]},{tfOpName:"ExpandDims",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"axis",type:"number"}]},{tfOpName:"Pad",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"}],attrs:[{tfName:"constant_value",name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"PadV2",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"padding",type:"number[]"},{start:2,name:"constantValue",type:"number",defaultValue:0}]},{tfOpName:"Reshape",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"shape",type:"number[]"}]},{tfOpName:"Squeeze",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"axis",tfDeprecatedName:"squeeze_dims",name:"axis",type:"number[]"}]},{tfOpName:"SpaceToBatchND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"paddings",type:"number[]"}]},{tfOpName:"BatchToSpaceND",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"},{start:1,name:"blockShape",type:"number[]"},{start:2,name:"crops",type:"number[]"}]},{tfOpName:"DepthToSpace",category:"transformation",inputs:[{start:0,name:"x",type:"tensor"}],attrs:[{tfName:"block_size",name:"blockSize",type:"number"},{tfName:"data_format",name:"dataFormat",type:"string"}]}]}),V=function(){function t(){var t=[E,T,A,C,R,I,N,L,D,O,k,P,F,B,z,U],e=[].concat.apply([],t.map((function(t){return t.json})));this.opMappers=e.reduce((function(t,e){return t[e.tfOpName]=e,t}),{})}return Object.defineProperty(t,"Instance",{get:function(){return this._instance||(this._instance=new this)},enumerable:!0,configurable:!0}),t.prototype.transformGraph=function(t,e){var a=this;void 0===e&&(e={});var n=[],r=[],s=t.node.reduce((function(t,e){return t[e.name]=a.mapNode(e),e.op.startsWith("Placeholder")&&n.push(t[e.name]),"Const"===e.op&&r.push(t[e.name]),t}),{}),o=[],p=[],u={},i={};null!=e&&(u=this.mapSignatureEntries(e.inputs),i=this.mapSignatureEntries(e.outputs));var c=Object.keys(s);return c.forEach((function(t){var e=s[t];e.inputNames.forEach((function(t){var a=w(t)[0];e.inputs.push(s[a]),s[a].children.push(e)}))})),0===Object.keys(i).length?c.forEach((function(t){var e=s[t];0===e.children.length&&p.push(e)})):Object.keys(i).forEach((function(t){var e=w(t)[0],a=s[e];null!=a&&(a.signatureKey=i[t],p.push(a))})),Object.keys(u).length>0?Object.keys(u).forEach((function(t){var e=w(t)[0],a=s[e];a&&(a.signatureKey=u[t],o.push(a))})):o=n,{nodes:s,inputs:o,outputs:p,weights:r,placeholders:n,signature:e}},t.prototype.mapSignatureEntries=function(t){return Object.keys(t||{}).reduce((function(e,a){return e[t[a].name]=a,e}),{})},t.prototype.mapNode=function(t){var e=v(t.op)||this.opMappers[t.op]||{};null==t.attr&&(t.attr={});var a={name:t.name,op:t.op,category:e.category,inputNames:(t.input||[]).map((function(t){return t.startsWith("^")?t.substr(1):t})),inputs:[],children:[],inputParams:{},attrParams:{},rawAttrs:t.attr};return null!=e.inputs&&(a.inputParams=e.inputs.reduce((function(t,e){return t[e.name]={type:e.type,inputIndexStart:e.start,inputIndexEnd:e.end},t}),{})),null!=e.attrs&&(a.attrParams=e.attrs.reduce((function(e,a){var n=a.type,r=void 0;switch(a.type){case"string":void 0===(r=H(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=H(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"string[]":void 0===(r=$(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=$(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"number":void 0===(r=W(t.attr,a.tfName,a.defaultValue||0))&&a.tfDeprecatedName&&(r=W(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"number[]":void 0===(r=Q(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=Q(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool":void 0===(r=j(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=j(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"bool[]":void 0===(r=et(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=et(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape":void 0===(r=Z(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=Z(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"shape[]":void 0===(r=tt(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=tt(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype":void 0===(r=Y(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=Y(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"dtype[]":void 0===(r=K(t.attr,a.tfName,a.defaultValue))&&a.tfDeprecatedName&&(r=K(t.attr,a.tfDeprecatedName,a.defaultValue));break;case"tensor":case"tensors":break;default:throw new Error("Unsupported param type: "+a.type+" for op: "+t.op)}return e[a.name]={value:r,type:n},e}),{})),a},t}();function G(e,n){var a=Array.isArray(e)?String.fromCharCode.apply(null,e):function(e){var n=Object(l.Q)().global;if(void 0!==n.atob)return n.atob(e);if(void 0!==t)return new t(e,"base64").toString();throw new Error("Unable to decode base64 in this environment. Missing built-in atob() or Buffer()")}(e);return n?a:a.toLowerCase()}function H(t,e,a,n){void 0===n&&(n=!1);var r=t[e];return null!=r?G(r.s,n):a}function j(t,e,a){var n=t[e];return n?n.b:a}function W(t,e,a){var n=t[e]||{},r=null!=n.i?n.i:null!=n.f?n.f:a;return"number"==typeof r?r:parseInt(r,10)}function X(t){switch("string"==typeof t&&(t=r[t]),t){case r.DT_FLOAT:return"float32";case r.DT_INT32:case r.DT_INT64:case r.DT_INT8:case r.DT_UINT8:return"int32";case r.DT_BOOL:return"bool";case r.DT_DOUBLE:return"float32";case r.DT_STRING:return"string";default:return null}}function Y(t,e,a){var n=t[e];return n&&n.type?X(n.type):a}function K(t,e,a){var n=t[e];return n&&n.list&&n.list.type?n.list.type.map((function(t){return X(t)})):a}function J(t){if(!t.unknownRank)return null!=t.dim?t.dim.map((function(t){return"number"==typeof t.size?t.size:parseInt(t.size,10)})):[]}function Z(t,e,a){var n=t[e];return n&&n.shape?J(n.shape):a}function Q(t,e,a){var n=t[e];return n?((n.list.f&&n.list.f.length?n.list.f:n.list.i)||[]).map((function(t){return"number"==typeof t?t:parseInt(t,10)})):a}function $(t,e,a,n){void 0===n&&(n=!1);var r=t[e];return r&&r.list&&r.list.s?r.list.s.map((function(t){return G(t,n)})):a}function tt(t,e,a){var n=t[e];return n&&n.list&&n.list.shape?n.list.shape.map((function(t){return J(t)})):a}function et(t,e,a){var n=t[e];return n&&n.list&&n.list.b?n.list.b:a}var nt=function(){function t(t,e,a){var n=this;this.node=t,this.tensorMap=e,this.context=a,this.inputs=[],this.attrs={},this.inputs=t.inputNames.map((function(t){return n.getInput(t)})),null!=t.rawAttrs&&(this.attrs=Object.keys(t.rawAttrs).reduce((function(t,e){return t[e]=n.getAttr(e),t}),{}))}return t.prototype.getInput=function(t){return x(t,this.tensorMap,this.context)},t.prototype.getAttr=function(t,e){var a=this.node.rawAttrs[t];if(null!=a.tensor)return x(t,this.tensorMap,this.context);if(null!=a.i||null!=a.f)return W(this.node.rawAttrs,t,e);if(null!=a.s)return H(this.node.rawAttrs,t,e);if(null!=a.b)return j(this.node.rawAttrs,t,e);if(null!=a.shape)return Z(this.node.rawAttrs,t,e);if(null!=a.type)return Y(this.node.rawAttrs,t,e);if(null!=a.list){if(null!=a.list.i||null!=a.list.f)return Q(this.node.rawAttrs,t,e);if(null!=a.list.s)return $(this.node.rawAttrs,t,e);if(null!=a.list.shape)return tt(this.node.rawAttrs,t,e);if(null!=a.list.b)return et(this.node.rawAttrs,t,e);if(null!=a.list.type)return K(this.node.rawAttrs,t,e)}return e},t}(),it=function(){function t(e,a,n,r,s,o,p){this.name=e,this.dtype=a,this.maxSize=n,this.elementShape=r,this.identicalElementShapes=s,this.dynamicSize=o,this.clearAfterRead=p,this.tensors=[],this.closed_=!1,this.id=t.nextId++}return Object.defineProperty(t.prototype,"closed",{get:function(){return this.closed_},enumerable:!0,configurable:!0}),t.prototype.clearAndClose=function(){this.tensors.forEach((function(t){return t.tensor.dispose()})),this.tensors=[],this.closed_=!0},t.prototype.size=function(){return this.tensors.length},t.prototype.read=function(t){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||t>=this.tensors.length)throw new Error("Tried to read from index "+t+", but array size is: "+this.tensors.length);var e=this.tensors[t];if(e.cleared)throw new Error("TensorArray "+this.name+": Could not read index "+t+" twice because it was cleared after a previous read (perhaps try setting clear_after_read = false?).");return this.clearAfterRead&&(e.cleared=!0),e.read=!0,e.tensor},t.prototype.readMany=function(t){var e=this;return t.map((function(t){return e.read(t)}))},t.prototype.write=function(t,e){if(this.closed_)throw new Error("TensorArray "+this.name+" has already been closed.");if(t<0||!this.dynamicSize&&t>=this.maxSize)throw new Error("Tried to write to index "+t+", but array is not resizeable and size is: "+this.maxSize);var a=this.tensors[t]||{};if(e.dtype!==this.dtype)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+",\n          because the value dtype is "+e.dtype+", but TensorArray dtype is "+this.dtype+".");if(0!==this.size()||null!=this.elementShape&&0!==this.elementShape.length||(this.elementShape=e.shape),this.assertShapesMatchAllowUndefinedSize(this.elementShape,e.shape,"TensorArray "+this.name+": Could not write to TensorArray index "+t+"."),a&&a.read)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been read.");if(a&&a.written)throw new Error("TensorArray "+this.name+": Could not write to TensorArray index "+t+", because it has already been written.");a.tensor=e,a.written=!0,this.tensors[t]=a},t.prototype.writeMany=function(t,e){var a=this;if(t.length!==e.length)throw new Error("TensorArray "+this.name+": could not write multiple tensors,because the index size: "+t.length+" is not the same as tensors size: "+e.length+".");t.forEach((function(t,n){return a.write(t,e[n])}))},t.prototype.gather=function(t,e){if(e&&e!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but gather requested dtype "+e);if(!t){t=[];for(var a=0;a<this.size();a++)t.push(a)}if(0===t.length)return Object(l.Ec)([],[0].concat(this.elementShape));var n=this.readMany(t);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,"TensorArray shape mismatch: "),Object(l.yc)(n,0)},t.prototype.concat=function(t){if(t&&t!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but concat requested dtype "+t);if(0===this.size())return Object(l.Ec)([],[0].concat(this.elementShape));for(var e=[],a=0;a<this.size();a++)e.push(a);var n=this.readMany(e);return this.assertShapesMatchAllowUndefinedSize(this.elementShape,n[0].shape,"TensorArray shape mismatch: tensor array shape ("+this.elementShape+") vs first tensor shape ("+n[0].shape+")"),Object(l.C)(n,0)},t.prototype.scatter=function(t,e){if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);if(t.length!==e.shape[0])throw new Error("Expected len(indices) == tensor.shape[0], but saw: "+t.length+" vs. "+e.shape[0]);var a=Math.max.apply(Math,t);if(!this.dynamicSize&&a>=this.maxSize)throw new Error("Max index must be < array size ("+a+"  vs. "+this.maxSize+")");this.writeMany(t,Object(l.Mc)(e,0))},t.prototype.split=function(t,e){var a=this;if(e.dtype!==this.dtype)throw new Error("TensorArray dtype is "+this.dtype+" but tensor has dtype "+e.dtype);var n=0,r=t.map((function(t){return n+=t}));if(n!==e.shape[0])throw new Error("Expected sum of lengths to be equal to\n          tensor.shape[0], but sum of lengths is\n        "+n+", and tensor's shape is: "+e.shape);if(!this.dynamicSize&&t.length!==this.maxSize)throw new Error("TensorArray's size is not equal to the size of lengths ("+this.maxSize+" vs. "+t.length+"), and the TensorArray is not marked as dynamically resizeable");var s=0===n?0:e.size/n,o=[];Object(l.Hc)((function(){e=e.reshape([1,n,s]);for(var p=0;p<t.length;++p){var u=[0,0===p?0:r[p-1],0],i=[1,t[p],s];o[p]=Object(l.nc)(e,u,i).reshape(a.elementShape)}return o}));for(var p=[],u=0;u<t.length;u++)p[u]=u;this.writeMany(p,o)},t.prototype.assertShapesMatchAllowUndefinedSize=function(t,e,a){void 0===a&&(a=""),l.Nc.assert(this.shapesEqualAllowUndefinedSize(t,e),(function(){return a+" Shapes "+t+" and "+e+" must match"}))},t.prototype.shapesEqualAllowUndefinedSize=function(t,e){if(t.length!==e.length)return!1;for(var a=0;a<t.length;a++)if(-1!==t[a]&&-1!==e[a]&&t[a]!==e[a])return!1;return!0},t.nextId=0,t}();function ot(t,e,a){var n=function(t,e,a){switch(t.category){case"arithmetic":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"BiasAdd":case"AddV2":case"Add":return[Object(l.g)(y("a",t,e,a),y("b",t,e,a))];case"AddN":return[Object(l.h)(y("tensors",t,e,a))];case"FloorMod":case"Mod":return[Object(l.Fb)(y("a",t,e,a),y("b",t,e,a))];case"Mul":return[Object(l.Gb)(y("a",t,e,a),y("b",t,e,a))];case"RealDiv":case"Div":return[Object(l.M)(y("a",t,e,a),y("b",t,e,a))];case"DivNoNan":return[Object(l.N)(y("a",t,e,a),y("b",t,e,a))];case"FloorDiv":return[Object(l.Z)(y("a",t,e,a),y("b",t,e,a))];case"Sub":return[Object(l.Ac)(y("a",t,e,a),y("b",t,e,a))];case"Minimum":return[Object(l.Eb)(y("a",t,e,a),y("b",t,e,a))];case"Maximum":return[Object(l.Bb)(y("a",t,e,a),y("b",t,e,a))];case"Pow":return[Object(l.Ob)(y("a",t,e,a),y("b",t,e,a))];case"SquaredDifference":return[Object(l.wc)(y("a",t,e,a),y("b",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"basic_math":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Abs":case"ComplexAbs":return[Object(l.d)(y("x",t,e,a))];case"Acos":return[Object(l.e)(y("x",t,e,a))];case"Acosh":return[Object(l.f)(y("x",t,e,a))];case"Asin":return[Object(l.m)(y("x",t,e,a))];case"Asinh":return[Object(l.n)(y("x",t,e,a))];case"Atan":return[Object(l.o)(y("x",t,e,a))];case"Atan2":return[Object(l.p)(y("x",t,e,a),y("y",t,e,a))];case"Atanh":return[Object(l.q)(y("x",t,e,a))];case"Ceil":return[Object(l.z)(y("x",t,e,a))];case"Complex":return[Object(l.B)(y("real",t,e,a),y("imag",t,e,a))];case"Cos":return[Object(l.I)(y("x",t,e,a))];case"Cosh":return[Object(l.J)(y("x",t,e,a))];case"Elu":return[Object(l.O)(y("x",t,e,a))];case"Erf":return[Object(l.S)(y("x",t,e,a))];case"Exp":return[Object(l.T)(y("x",t,e,a))];case"Expm1":return[Object(l.V)(y("x",t,e,a))];case"Floor":return[Object(l.Y)(y("x",t,e,a))];case"Log":return[Object(l.qb)(y("x",t,e,a))];case"Log1p":return[Object(l.rb)(y("x",t,e,a))];case"Imag":return[Object(l.hb)(y("x",t,e,a))];case"Neg":return[Object(l.Ib)(y("x",t,e,a))];case"Reciprocal":return[Object(l.Ub)(y("x",t,e,a))];case"Real":return[Object(l.Tb)(y("x",t,e,a))];case"Relu":return[Object(l.Xb)(y("x",t,e,a))];case"Round":return[Object(l.bc)(y("x",t,e,a))];case"Selu":return[Object(l.gc)(y("x",t,e,a))];case"Sigmoid":return[Object(l.jc)(y("x",t,e,a))];case"Sin":return[Object(l.lc)(y("x",t,e,a))];case"Sign":return[Object(l.kc)(y("x",t,e,a))];case"Sinh":return[Object(l.mc)(y("x",t,e,a))];case"Softplus":return[Object(l.qc)(y("x",t,e,a))];case"Sqrt":return[Object(l.uc)(y("x",t,e,a))];case"Square":return[Object(l.vc)(y("x",t,e,a))];case"Tanh":return[Object(l.Dc)(y("x",t,e,a))];case"Tan":return[Object(l.Cc)(y("x",t,e,a))];case"Relu6":case"ClipByValue":return[Object(l.A)(y("x",t,e,a),y("clipValueMin",t,e,a),y("clipValueMax",t,e,a))];case"Rsqrt":return[Object(l.cc)(x(t.inputNames[0],e,a))];case"Prod":return[Object(l.Qb)(y("x",t,e,a),y("axes",t,e,a))];case"LeakyRelu":return[Object(l.lb)(y("x",t,e,a),y("alpha",t,e,a))];case"Prelu":return[Object(l.Pb)(y("x",t,e,a),y("alpha",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"control":return function(t,e,a){return d(void 0,void 0,void 0,(function(){var n,r,s,o,p,u,i,c,h,d,m,v,w,g,_,S,M,E,b,T,A,C,R,I,N,O,D,L,k,P,F,B,z,U,V;return f(this,(function(f){switch(f.label){case 0:switch(t.op){case"LoopCond":return[3,1];case"Switch":return[3,2];case"Merge":return[3,4];case"Enter":return[3,5];case"Exit":return[3,6];case"NextIteration":return[3,7];case"TensorArrayV3":return[3,8];case"TensorArrayWriteV3":return[3,9];case"TensorArrayReadV3":return[3,10];case"TensorArrayGatherV3":return[3,11];case"TensorArrayScatterV3":return[3,12];case"TensorArrayConcatV3":return[3,13];case"TensorArraySplitV3":return[3,14];case"TensorArraySizeV3":return[3,15];case"TensorArrayCloseV3":return[3,16]}return[3,17];case 1:return[2,[y("pred",t,e,a).clone()]];case 2:return n=y("pred",t,e,a),r=y("data",t,e,a),[4,n.data()];case 3:return[2,f.sent()[0]?[void 0,r.clone()]:[r.clone(),void 0]];case 4:return[2,(s=t.inputNames.find((function(t){return void 0!==x(t,e,a)})))?[x(s,e,a).clone()]:void 0];case 5:return o=y("frameName",t,e,a),p=y("tensor",t,e,a),a.enterFrame(o),[2,[p.clone()]];case 6:return u=y("tensor",t,e,a),a.exitFrame(),[2,[u.clone()]];case 7:return i=y("tensor",t,e,a),a.nextIteration(),[2,[i.clone()]];case 8:return c=y("size",t,e,a),h=y("dtype",t,e,a),d=y("elementShape",t,e,a),m=y("dynamicSize",t,e,a),v=y("clearAfterRead",t,e,a),w=y("identicalElementShapes",t,e,a),g=y("name",t,e,a),_=new it(g,h,c,d,w,m,v),a.addTensorArray(_),[2,[Object(l.dc)(_.id),Object(l.dc)(1)]];case 9:return S=y("tensorArrayId",t,e,a),M=y("index",t,e,a),E=y("tensor",t,e,a),a.getTensorArray(S).write(M,E),[2,[Object(l.dc)(1)]];case 10:return b=y("tensorArrayId",t,e,a),T=y("index",t,e,a),[2,[a.getTensorArray(b).read(T)]];case 11:return A=y("tensorArrayId",t,e,a),C=y("indices",t,e,a),R=y("dtype",t,e,a),[2,[a.getTensorArray(A).gather(C,R)]];case 12:return I=y("tensorArrayId",t,e,a),N=y("indices",t,e,a),O=y("tensor",t,e,a),a.getTensorArray(I).scatter(N,O),[2,[Object(l.dc)(1)]];case 13:return D=y("tensorArrayId",t,e,a),L=a.getTensorArray(D),k=y("dtype",t,e,a),[2,[L.concat(k)]];case 14:return P=y("tensorArrayId",t,e,a),F=y("tensor",t,e,a),B=y("lengths",t,e,a),a.getTensorArray(P).split(B,F),[2,[Object(l.dc)(1)]];case 15:return z=y("tensorArrayId",t,e,a),U=a.getTensorArray(z),[2,[Object(l.dc)(U.size(),"int32")]];case 16:return V=y("tensorArrayId",t,e,a),a.getTensorArray(V).clearAndClose(),[2,[Object(l.dc)(0)]];case 17:throw TypeError("Node type "+t.op+" is not implemented")}}))}))}(t,e,a);case"convolution":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Conv1D":var n=y("stride",t,e,a),r=y("pad",t,e,a),s=y("dataFormat",t,e,a).toUpperCase(),o=y("dilation",t,e,a);return[Object(l.E)(y("x",t,e,a),y("filter",t,e,a),n,r,s,o)];case"Conv2D":n=y("strides",t,e,a),r=y("pad",t,e,a),s=y("dataFormat",t,e,a).toUpperCase();var p=y("dilations",t,e,a);return[Object(l.F)(y("x",t,e,a),y("filter",t,e,a),[n[1],n[2]],r,s,[p[1],p[2]])];case"_FusedConv2D":case"FusedDepthwiseConv2dNative":var u=y("fusedOps",t,e,a),i=u[0],c=u[1],h="biasadd"===i,d="prelu"===c,f="fusedbatchnorm"===i,m=y("numArgs",t,e,a);if(h){if(d&&2!==m)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!d&&1!==m)throw new Error("FusedConv2d and DepthwiseConv2d with BiasAdd must have one extra argument: bias.")}if(f)throw new Error("FusedConv2d and DepthwiseConv2d with FusedBatchNorm is not supported.");n=y("strides",t,e,a),r=y("pad",t,e,a),s=y("dataFormat",t,e,a).toUpperCase(),p=y("dilations",t,e,a);var v=y("args",t,e,a),g=v[0],x=v[1];return[("_FusedConv2D"===t.op?l.ab.conv2d:l.ab.depthwiseConv2d)({x:y("x",t,e,a),filter:y("filter",t,e,a),strides:[n[1],n[2]],pad:r,dataFormat:s,dilations:[p[1],p[2]],bias:g,activation:c,preluActivationWeights:x})];case"Conv2DBackpropInput":case"Conv2dTranspose":var w=y("outputShape",t,e,a);return n=y("strides",t,e,a),r=y("pad",t,e,a),[Object(l.G)(y("x",t,e,a),y("filter",t,e,a),w,[n[1],n[2]],r)];case"DepthwiseConv2dNative":case"DepthwiseConv2d":return n=y("strides",t,e,a),r=y("pad",t,e,a),p=y("dilations",t,e,a),s=y("dataFormat",t,e,a).toUpperCase(),[Object(l.L)(y("input",t,e,a),y("filter",t,e,a),[n[1],n[2]],r,s,[p[1],p[2]])];case"Conv3D":return n=y("strides",t,e,a),r=y("pad",t,e,a),s=y("dataFormat",t,e,a).toUpperCase(),p=y("dilations",t,e,a),[Object(l.H)(y("x",t,e,a),y("filter",t,e,a),[n[1],n[2],n[3]],r,s,[p[1],p[2],p[3]])];case"AvgPool":n=y("strides",t,e,a),r=y("pad",t,e,a);var _=y("kernelSize",t,e,a);return[Object(l.r)(y("x",t,e,a),[_[1],_[2]],[n[1],n[2]],r)];case"MaxPool":return n=y("strides",t,e,a),r=y("pad",t,e,a),_=y("kernelSize",t,e,a),[Object(l.yb)(y("x",t,e,a),[_[1],_[2]],[n[1],n[2]],r)];case"MaxPoolWithArgmax":n=y("strides",t,e,a),r=y("pad",t,e,a),_=y("kernelSize",t,e,a);var S=y("includeBatchInIndex",t,e,a),b=Object(l.Ab)(y("x",t,e,a),[_[1],_[2]],[n[1],n[2]],r,S);return[b.result,b.indexes];case"AvgPool3D":return n=y("strides",t,e,a),r=y("pad",t,e,a),_=y("kernelSize",t,e,a),[Object(l.s)(y("x",t,e,a),[_[1],_[2],_[3]],[n[1],n[2],n[3]],r)];case"MaxPool3D":return n=y("strides",t,e,a),r=y("pad",t,e,a),_=y("kernelSize",t,e,a),[Object(l.zb)(y("x",t,e,a),[_[1],_[2],_[3]],[n[1],n[2],n[3]],r)];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"creation":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Fill":var n=y("shape",t,e,a),r=y("dtype",t,e,a),s=y("value",t,e,a);return[Object(l.X)(n,s,r)];case"LinSpace":var o=y("start",t,e,a),p=y("stop",t,e,a),u=y("num",t,e,a);return[Object(l.ob)(o,p,u)];case"Multinomial":var i=y("logits",t,e,a),c=y("numSamples",t,e,a),h=y("seed",t,e,a);return[Object(l.Hb)(i,c,h)];case"OneHot":var d=y("indices",t,e,a),f=y("depth",t,e,a),m=y("onValue",t,e,a),v=y("offValue",t,e,a);return[Object(l.Kb)(d,f,m,v)];case"Ones":return[Object(l.Lb)(y("shape",t,e,a),y("dtype",t,e,a))];case"OnesLike":return[Object(l.Mb)(y("x",t,e,a))];case"RandomUniform":return[Object(l.Rb)(y("shape",t,e,a),y("minval",t,e,a),y("maxval",t,e,a),y("dtype",t,e,a))];case"Range":o=y("start",t,e,a);var g=y("stop",t,e,a),x=y("step",t,e,a);return[Object(l.Sb)(o,g,x,y("dtype",t,e,a))];case"TruncatedNormal":n=y("shape",t,e,a);var w=y("mean",t,e,a),_=y("stdDev",t,e,a);return h=y("seed",t,e,a),[Object(l.Lc)(n,w,_,y("dtype",t,e,a),h)];case"Zeros":return[Object(l.Qc)(y("shape",t,e,a),y("dtype",t,e,a))];case"ZerosLike":return[Object(l.Rc)(y("x",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"dynamic":return function(t,e,a){return d(void 0,void 0,void 0,(function(){var n,r,s,o,p,u,i,c;return f(this,(function(h){switch(h.label){case 0:switch(t.op){case"NonMaxSuppressionV5":case"NonMaxSuppressionV3":case"NonMaxSuppressionV2":return[3,1];case"Where":return[3,5];case"ListDiff":return[3,7]}return[3,8];case 1:return n=y("boxes",t,e,a),r=y("scores",t,e,a),s=y("maxOutputSize",t,e,a),o=y("iouThreshold",t,e,a),p=y("scoreThreshold",t,e,a),"NonMaxSuppressionV5"!==t.op?[3,3]:(u=y("softNmsSigma",t,e,a),[4,l.ib.nonMaxSuppressionWithScoreAsync(n,r,s,o,p,u)]);case 2:return[2,[(c=h.sent()).selectedIndices,c.selectedScores]];case 3:return[4,l.ib.nonMaxSuppressionAsync(n,r,s,o,p)];case 4:return[2,[h.sent()]];case 5:return i=y("condition",t,e,a).asType("bool"),[4,Object(l.Pc)(i)];case 6:return c=[h.sent()],i.dispose(),[2,c];case 7:return[2,Object(l.ic)(y("x",t,e,a),y("y",t,e,a))];case 8:throw TypeError("Node type "+t.op+" is not implemented")}}))}))}(t,e,a);case"evaluation":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"TopKV2":var n=y("x",t,e,a),r=y("k",t,e,a),s=y("sorted",t,e,a),o=Object(l.Jc)(n,r,s);return[o.values,o.indices];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"image":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"ResizeBilinear":var n=y("images",t,e,a),r=y("size",t,e,a),s=y("alignCorners",t,e,a);return[l.ib.resizeBilinear(n,[r[0],r[1]],s)];case"ResizeNearestNeighbor":return n=y("images",t,e,a),r=y("size",t,e,a),s=y("alignCorners",t,e,a),[l.ib.resizeNearestNeighbor(n,[r[0],r[1]],s)];case"CropAndResize":var o=y("image",t,e,a),p=y("boxes",t,e,a),u=y("boxInd",t,e,a),i=y("cropSize",t,e,a),c=y("method",t,e,a),h=y("extrapolationValue",t,e,a);return[l.ib.cropAndResize(o,p,u,i,c,h)];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"graph":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Const":return e[t.name];case"PlaceholderWithDefault":var n=y("default",t,e,a);return[x(t.name,e,a)||n];case"Placeholder":return[x(t.name,e,a)];case"Identity":case"StopGradient":case"FakeQuantWithMinMaxVars":return[y("x",t,e,a).clone()];case"IdentityN":return y("x",t,e,a).map((function(t){return t.clone()}));case"Snapshot":return[y("x",t,e,a).clone()];case"Shape":return[Object(l.Fc)(y("x",t,e,a).shape,"int32")];case"ShapeN":return y("x",t,e,a).map((function(t){return Object(l.Fc)(t.shape)}));case"Size":return[Object(l.dc)(y("x",t,e,a).size,"int32")];case"Rank":return[Object(l.dc)(y("x",t,e,a).rank,"int32")];case"NoOp":return[Object(l.dc)(1)];case"Print":var r=y("x",t,e,a),s=y("data",t,e,a),o=y("message",t,e,a),p=y("summarize",t,e,a);console.warn("The graph has a tf.print() operation,usually used for debugging, which slows down performance."),console.log(o);for(var u=0;u<s.length;u++)console.log(Array.prototype.slice.call(s[u].dataSync()).slice(0,p));return[r];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"logical":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Equal":return[Object(l.R)(y("a",t,e,a),y("b",t,e,a))];case"NotEqual":return[Object(l.Jb)(y("a",t,e,a),y("b",t,e,a))];case"Greater":return[Object(l.eb)(y("a",t,e,a),y("b",t,e,a))];case"GreaterEqual":return[Object(l.fb)(y("a",t,e,a),y("b",t,e,a))];case"Less":return[Object(l.mb)(y("a",t,e,a),y("b",t,e,a))];case"LessEqual":return[Object(l.nb)(y("a",t,e,a),y("b",t,e,a))];case"LogicalAnd":return[Object(l.tb)(y("a",t,e,a),y("b",t,e,a))];case"LogicalNot":return[Object(l.ub)(y("a",t,e,a))];case"LogicalOr":return[Object(l.vb)(y("a",t,e,a),y("b",t,e,a))];case"Select":case"SelectV2":return[Object(l.Oc)(y("condition",t,e,a),y("a",t,e,a),y("b",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"matrices":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"BatchMatMul":case"BatchMatMulV2":case"MatMul":return[Object(l.wb)(y("a",t,e,a),y("b",t,e,a),y("transposeA",t,e,a),y("transposeB",t,e,a))];case"Transpose":return[Object(l.Kc)(y("x",t,e,a),y("perm",t,e,a))];case"_FusedMatMul":var n=y("fusedOps",t,e,a),r=n[0],s=n[1],o="biasadd"===r,p="prelu"===s,u=y("numArgs",t,e,a);if(o){if(p&&2!==u)throw new Error("Fused MatMul with BiasAdd and Prelu must have two extra arguments: bias and alpha.");if(!p&&1!==u)throw new Error("Fused MatMul with BiasAdd must have one extra argument: bias.")}var i=y("args",t,e,a),c=i[0],h=i[1];return[l.ab.matMul({a:y("a",t,e,a),b:y("b",t,e,a),transposeA:y("transposeA",t,e,a),transposeB:y("transposeB",t,e,a),bias:c,activation:s,preluActivationWeights:h})];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"normalization":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"FusedBatchNorm":case"FusedBatchNormV2":case"FusedBatchNormV3":return[Object(l.u)(y("x",t,e,a),y("mean",t,e,a),y("variance",t,e,a),y("offset",t,e,a),y("scale",t,e,a),y("epsilon",t,e,a))];case"LRN":return[Object(l.pb)(y("x",t,e,a),y("radius",t,e,a),y("bias",t,e,a),y("alpha",t,e,a),y("beta",t,e,a))];case"Softmax":return[Object(l.pc)(y("x",t,e,a))];case"LogSoftmax":return[Object(l.sb)(y("x",t,e,a))];case"SparseToDense":return[Object(l.sc)(y("sparseIndices",t,e,a),y("outputShape",t,e,a),y("sparseValues",t,e,a),y("defaultValue",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"reduction":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Max":var n=y("axis",t,e,a),r=y("keepDims",t,e,a);return[Object(l.xb)(y("x",t,e,a),n,r)];case"Mean":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.Cb)(y("x",t,e,a),n,r)];case"Min":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.Db)(y("x",t,e,a),n,r)];case"Sum":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.Bc)(y("x",t,e,a),n,r)];case"All":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.i)(y("x",t,e,a),n,r)];case"Any":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.j)(y("x",t,e,a),n,r)];case"ArgMax":return n=y("axis",t,e,a),[Object(l.k)(y("x",t,e,a),n)];case"ArgMin":return n=y("axis",t,e,a),[Object(l.l)(y("x",t,e,a),n)];case"Prod":return n=y("axis",t,e,a),r=y("keepDims",t,e,a),[Object(l.Qb)(y("x",t,e,a),n,r)];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"slice_join":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"ConcatV2":case"Concat":var n=y("n",t,e,a),r=y("axis",t,e,a),s=y("tensors",t,e,a);return s=s.slice(0,n),[Object(l.C)(s,r)];case"GatherV2":case"Gather":r=y("axis",t,e,a);var o=y("x",t,e,a),p=y("indices",t,e,a);return[Object(l.bb)(o,p.asType("int32"),r)];case"ReverseV2":case"Reverse":return r=y("axis",t,e,a),o=y("x",t,e,a),[Object(l.Zb)(o,r)];case"Slice":var u=y("begin",t,e,a),i=y("size",t,e,a);return[Object(l.nc)(y("x",t,e,a),u,i)];case"StridedSlice":u=y("begin",t,e,a);var c=y("end",t,e,a),h=y("strides",t,e,a),d=y("beginMask",t,e,a),f=y("endMask",t,e,a),m=y("ellipsisMask",t,e,a),v=y("newAxisMask",t,e,a),g=y("shrinkAxisMask",t,e,a),x=y("x",t,e,a);if(1===u.length&&x.shape.length>1)for(var w=1;w<x.shape.length;w++)u.push(0),c.push(x.shape[w]),h.push(h[0]);return[Object(l.zc)(x,u,c,h,d,f,m,v,g)];case"Pack":return Object(l.Hc)((function(){var n=y("axis",t,e,a),r=y("tensors",t,e,a),s=r[0].shape,o=r[0].squeeze().shape,p=r.map((function(t){var e=l.Nc.arraysEqual(t.shape,s);if(!e&&!l.Nc.arraysEqual(t.squeeze().shape,o))throw new Error("the input tensors shape does not match");return e?t:t.reshape(s)}));return[Object(l.yc)(p,n)]}));case"Unpack":return Object(l.Hc)((function(){var n=y("axis",t,e,a),r=y("tensor",t,e,a);return Object(l.Mc)(r,n)}));case"Tile":var _=y("reps",t,e,a);return[Object(l.Ic)(y("x",t,e,a),_)];case"Split":case"SplitV":r=y("axis",t,e,a);var S=y("numOrSizeSplits",t,e,a);return Object(l.tc)(y("x",t,e,a),S,r);case"ScatterNd":p=y("indices",t,e,a);var b=y("values",t,e,a),M=y("shape",t,e,a);return[Object(l.ec)(p,b,M)];case"GatherNd":var E=y("x",t,e,a);return p=y("indices",t,e,a),[Object(l.cb)(E,p)];case"SparseToDense":p=y("sparseIndices",t,e,a),M=y("outputShape",t,e,a);var T=y("sparseValues",t,e,a),A=y("defaultValue",t,e,a);return[Object(l.sc)(p,T,M,T.dtype===A.dtype?A:A.asType(T.dtype))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"spectral":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"FFT":return[Object(l.W)(y("x",t,e,a))];case"IFFT":return[Object(l.gb)(y("x",t,e,a))];case"RFFT":return[Object(l.ac)(y("x",t,e,a))];case"IRFFT":return[Object(l.kb)(y("x",t,e,a))];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"transformation":return Object(l.Hc)((function(){return function(t,e,a){switch(t.op){case"Cast":return[Object(l.y)(y("x",t,e,a),y("dtype",t,e,a))];case"ExpandDims":var n=y("axis",t,e,a);return[Object(l.U)(y("x",t,e,a),n)];case"Squeeze":return n=y("axis",t,e,a),[Object(l.xc)(y("x",t,e,a),n)];case"Reshape":return[Object(l.Yb)(y("x",t,e,a),y("shape",t,e,a))];case"PadV2":case"Pad":return[Object(l.Nb)(y("x",t,e,a),M(y("padding",t,e,a),2),y("constantValue",t,e,a))];case"SpaceToBatchND":var r=y("blockShape",t,e,a),s=M(y("paddings",t,e,a),2);return[Object(l.rc)(y("x",t,e,a),r,s)];case"BatchToSpaceND":r=y("blockShape",t,e,a);var o=M(y("crops",t,e,a),2);return[Object(l.v)(y("x",t,e,a),r,o)];case"DepthToSpace":var p=y("blockSize",t,e,a),u=y("dataFormat",t,e,a).toUpperCase();return[Object(l.K)(y("x",t,e,a),p,u)];default:throw TypeError("Node type "+t.op+" is not implemented")}}(t,e,a)}));case"custom":var n=v(t.op);if(n&&n.customExecutor)return n.customExecutor(new nt(t,e,a));throw TypeError("Custom op "+t.op+" is not registered.");default:throw TypeError("Unknown op '"+t.op+"'. File an issue at https://github.com/tensorflow/tfjs/issues so we can add it, or register a custom execution with tf.registerOp()")}}(t,e,a);return n instanceof Promise?n.then((function(t){return[].concat(t)})):[].concat(n)}var at=function(){function t(t,e){this.weightMap=t,this.tensorArrayMap=e,this.rootContext={id:0,frameName:"",iterationId:0},this.contexts=[this.rootContext],this.lastId=0,this.generateCurrentContextIds()}return t.prototype.newFrame=function(t,e){return{id:t,frameName:e,iterationId:0}},Object.defineProperty(t.prototype,"currentContext",{get:function(){return this.contexts},set:function(t){this.contexts!==t&&(this.contexts=t,this.generateCurrentContextIds())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextId",{get:function(){return this._currentContextIds[0]},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"currentContextIds",{get:function(){return this._currentContextIds},enumerable:!0,configurable:!0}),t.prototype.generateCurrentContextIds=function(){for(var t=[],e=0;e<this.contexts.length-1;e++){var a=this.contexts.slice(0,this.contexts.length-e);t.push(this.contextIdforContexts(a))}t.push(""),this._currentContextIds=t},t.prototype.contextIdforContexts=function(t){return t?t.map((function(t){return 0===t.id&&0===t.iterationId?"":t.frameName+"-"+t.iterationId})).join("/"):""},t.prototype.enterFrame=function(t){this.contexts&&(this.lastId++,this.contexts=this.contexts.slice(),this.contexts.push(this.newFrame(this.lastId,t)),this._currentContextIds.unshift(this.contextIdforContexts(this.contexts)))},t.prototype.exitFrame=function(){if(!(this.contexts&&this.contexts.length>1))throw new Error("Cannot exit frame, the context is empty");this.contexts=this.contexts.slice(),this.contexts.splice(-1),this.currentContextIds.shift()},t.prototype.nextIteration=function(){if(!(this.contexts&&this.contexts.length>0))throw new Error("Cannot increase frame iteration, the context is empty");this.contexts=this.contexts.slice(),this.lastId++;var t=Object.assign({},this.contexts[this.contexts.length-1]);t.iterationId+=1,t.id=this.lastId,this.contexts.splice(-1,1,t),this._currentContextIds.splice(0,1,this.contextIdforContexts(this.contexts))},t.prototype.getWeight=function(t){return this.weightMap[t]},t.prototype.addTensorArray=function(t){this.tensorArrayMap[t.id]=t},t.prototype.getTensorArray=function(t){return this.tensorArrayMap[t]},t}();function st(t,e,a){for(var n=new Set,r=[],s=null,o=null,p=new Set,u=Object.keys(t).map((function(t){return S(t)[0]})),i=e.slice();i.length>0;){var c=i.pop();(lt(c)||ht(c))&&null==s&&(o=(s=c).children.map((function(t){return t.name})).filter((function(t){return n.has(t)}))),n.add(c.name),null==a[c.name]&&-1===u.indexOf(c.name)&&(0!==c.inputs.length?c.inputs.forEach((function(t){p.has(t.name)||(p.add(t.name),i.push(t))})):r.push(c.name))}return{inputs:t,outputs:e,usedNodes:n,missingInputs:r,dynamicNode:s,syncInputs:o}}var ut=["Switch","Merge","Enter","Exit","NextIteration"],ct=["NonMaxSuppressionV2","NonMaxSuppressionV3","NonMaxSuppressionV5","Where"];function lt(t){return ut.indexOf(t.op)>=0}function ht(t){return ct.indexOf(t.op)>=0}var pt=function(){function t(t){this.graph=t,this.compiledMap=new Map,this._weightMap={},this.SEPERATOR=",",this._outputs=t.outputs,this._inputs=t.inputs,this._signature=t.signature}return Object.defineProperty(t.prototype,"weightMap",{get:function(){return this._weightMap},set:function(t){var e=Object.keys(t).map((function(e){return t[e].map((function(t){return t.id}))}));this.weightIds=[].concat.apply([],e),this._weightMap=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this._inputs.map((function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this._outputs.map((function(t){return{name:t.name,shape:t.attrParams.shape?t.attrParams.shape.value:void 0,dtype:t.attrParams.dtype?t.attrParams.dtype.value:void 0}}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this._inputs.map((function(t){return t.signatureKey||t.name}))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this._outputs.map((function(t){return t.signatureKey||t.name}))},enumerable:!0,configurable:!0}),t.prototype.getCompilationKey=function(t,e){var a=t.map((function(t){return t.name})).sort(),n=e.map((function(t){return t.name})).sort();return a.join(this.SEPERATOR)+"--"+n.join(this.SEPERATOR)},t.prototype.compile=function(t,e){var a=st(t,e,this.weightMap),n=a.missingInputs,r=a.dynamicNode,s=a.syncInputs;if(null!=r)throw new Error("This execution contains the node '"+r.name+"', which has the dynamic op '"+r.op+"'. Please use model.executeAsync() instead. Alternatively, to avoid the dynamic ops, specify the inputs ["+s+"]");if(n.length>0){var o=e.map((function(t){return t.name})),p=Object.keys(t);throw new Error("Cannot compute the outputs ["+o+"] from the provided inputs ["+p+"]. Missing the following inputs: ["+n+"]")}return function(t,e,a){var n=a.usedNodes,r=a.inputs,s=[];Object.keys(r).map((function(t){return S(t)[0]})).map((function(e){return t.nodes[e]})).forEach((function(t){n.has(t.name)&&s.push(t)})),t.weights.forEach((function(t){n.has(t.name)&&s.push(t)}));for(var o=new Set,p=[];s.length>0;){var u=s.pop();o.add(u.name),e[u.name]||p.push(u),u.children.forEach((function(t){!o.has(t.name)&&n.has(t.name)&&t.inputs.every((function(t){return o.has(t.name)}))&&s.push(t)}))}return p}(this.graph,this.weightMap,a)},t.prototype.execute=function(t,e){var a=this;t=this.mapInputs(t);var n=Object.keys(t).sort();this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e);var r=n.map((function(t){return a.graph.nodes[S(t)[0]]})),s=e.map((function(t){return a.graph.nodes[S(t)[0]]})),o=this.getCompilationKey(r,s),p=this.compiledMap.get(o);null==p&&(p=this.compile(t,s),this.compiledMap.set(o,p));var u={};return Object(l.Hc)((function(){var n=new at(a._weightMap,u),r=h({},a.weightMap);Object.keys(t).forEach((function(e){var a=S(e),n=a[0],s=[];s[a[1]]=t[e],r[n]=s}));for(var s=a.getFrozenTensorIds(r),o={},i=0;i<p.length;i++){var c=p[i];if(!r[c.name]){var l=ot(c,r,n);if(l instanceof Promise)throw new Error("The execution of the op '"+c.op+"' returned a promise. Please use model.executeAsync() instead.");r[c.name]=l,a.checkTensorForDisposal(c.name,c,r,n,s,e,o)}}return e.map((function(t){return x(t,r,n)}))}))},t.prototype.getFrozenTensorIds=function(t){var e=[].concat.apply([],Object.keys(t).map((function(e){return t[e]})).map((function(t){return t.map((function(t){return t.id}))})));return new Set(e)},t.prototype.checkTensorForDisposal=function(t,e,a,n,r,s,o){"control"!==e.category&&-1===s.indexOf(t)&&(a[t].forEach((function(t){null!=t&&(o[t.id]=(o[t.id]||0)+e.children.length)})),e.inputs.forEach((function(t){if("control"!==t.category){var e=function(t,e,a){return e[_(t,a.currentContextId)]}(t.name,a,n);null!=e&&e.forEach((function(t){if(t&&!r.has(t.id)){var e=o[t.id];1===e?(t.dispose(),delete o[t.id]):null!=e&&o[t.id]--}}))}})))},t.prototype.executeAsync=function(t,e){return d(this,void 0,void 0,(function(){var a,n,r,s,o,p,u=this;return f(this,(function(i){switch(i.label){case 0:return t=this.mapInputs(t),this.checkInputs(t),this.checkInputShapeAndType(t),e=this.mapOutputs(e),this.checkOutputs(e),a={},n=new at(this._weightMap,a),[4,this.executeWithControlFlow(t,n,e)];case 1:return r=i.sent(),s=e.map((function(t){return x(t,r,n)})),o=new Set(s.map((function(t){return t.id}))),p=new Set(Object.keys(t).map((function(e){return t[e].id}))),Object.keys(r).forEach((function(t){r[t].forEach((function(t){!t||t.isDisposed||o.has(t.id)||p.has(t.id)||-1!==u.weightIds.indexOf(t.id)||t.dispose()}))})),[2,s]}}))}))},t.prototype.executeWithControlFlow=function(t,e,a){return d(this,void 0,void 0,(function(){var n,r,s,o,p,u,i,c,l,d,m,v,y,g,w,_,M=this;return f(this,(function(f){switch(f.label){case 0:n=Object.keys(t),r=n.map((function(t){return M.graph.nodes[S(t)[0]]})),s=a.map((function(t){return M.graph.nodes[S(t)[0]]})),o=st(t,s,this.weightMap),p=o.usedNodes,u=o.missingInputs,i=o.dynamicNode,c=o.syncInputs,l=r.concat(this.graph.weights).map((function(t){return{node:t,contexts:e.currentContext}})),d=h({},this.weightMap),Object.keys(t).forEach((function(e){var a=S(e),n=a[0],r=[];r[a[1]]=t[e],d[n]=r})),m={},v=this.getFrozenTensorIds(d),y={},f.label=1;case 1:return l.length>0?(g=this.processStack(r,l,e,d,y,v,a,m,p),[4,Promise.all(g)]):[3,3];case 2:return f.sent(),[3,1];case 3:if(null==i&&console.warn("This model execution did not contain any nodes with control flow or dynamic output shapes. You can use model.execute() instead."),(w=s.filter((function(t){return!lt(t)&&!x(t.name,d,e)})).map((function(t){return t.name}))).length>0)throw _="",null!=i&&(_="Alternatively, to avoid the dynamic ops, use model.execute() and specify the inputs ["+c+"]"),new Error("Cannot compute the outputs ["+w+"] from the provided inputs ["+n+"]. Consider providing the following inputs: ["+u+"]. "+_);return[2,d]}}))}))},t.prototype.processStack=function(t,e,a,n,r,s,o,p,u){for(var i=this,c=[],l=function(){var l=e.pop();a.currentContext=l.contexts;var d="";if("Enter"===l.node.op&&y("isConstant",l.node,n,a)&&(d=w(l.node.name,a)[0]),-1===t.indexOf(l.node)){var f=ot(l.node,n,a);d||(d=w(l.node.name,a)[0]);var m=a.currentContext;f instanceof Promise?c.push(f.then((function(t){return n[d]=t,a.currentContext=m,i.checkTensorForDisposal(d,l.node,n,a,s,o,p),i.processChildNodes(l.node,e,a,n,r,u),t}))):(n[d]=f,h.checkTensorForDisposal(d,l.node,n,a,s,o,p),h.processChildNodes(l.node,e,a,n,r,u))}else h.processChildNodes(l.node,e,a,n,r,u)},h=this;e.length>0;)l();return c},t.prototype.processChildNodes=function(t,e,a,n,r,s){t.children.forEach((function(t){var o=w(t.name,a)[0];!r[o]&&s.has(t.name)&&("Merge"===t.op?t.inputNames.some((function(t){return!!x(t,n,a)}))&&(r[o]=!0,e.push({contexts:a.currentContext,node:t})):t.inputNames.every((function(t){return!!x(t,n,a)}))&&(r[o]=!0,e.push({contexts:a.currentContext,node:t})))}))},t.prototype.dispose=function(){var t=this;Object.keys(this.weightMap).forEach((function(e){return t.weightMap[e].forEach((function(t){return t.dispose()}))}))},t.prototype.checkInputShapeAndType=function(t){var e=this;Object.keys(t).forEach((function(a){var n=t[a],r=S(a)[0],s=e.graph.nodes[r];if(s.attrParams.shape&&s.attrParams.shape.value){var o=s.attrParams.shape.value,p=o.length===n.shape.length&&n.shape.every((function(t,e){return-1===o[e]||o[e]===t}));l.Nc.assert(p,(function(){return"The shape of dict['"+s.name+"'] provided in model.execute(dict) must be ["+o+"], but was ["+n.shape+"]"}))}s.attrParams.dtype&&s.attrParams.dtype.value&&l.Nc.assert(n.dtype===s.attrParams.dtype.value,(function(){return"The dtype of dict['"+s.name+"'] provided in model.execute(dict) must be "+s.attrParams.dtype.value+", but was "+n.dtype}))}))},t.prototype.mapInputs=function(t){var e={};for(var a in t)null!=this._signature&&null!=this._signature.inputs&&null!=this._signature.inputs[a]?e[this._signature.inputs[a].name]=t[a]:e[a]=t[a];return e},t.prototype.checkInputs=function(t){var e=this,a=Object.keys(t).filter((function(t){var a=S(t)[0];return null==e.graph.nodes[a]}));if(a.length>0)throw new Error("The dict provided in model.execute(dict) has keys: ["+a+"] that are not part of graph")},t.prototype.mapOutputs=function(t){var e=this;return t.map((function(t){return null!=e._signature&&null!=e._signature.outputs&&null!=e._signature.outputs[t]?e._signature.outputs[t].name:t}),{})},t.prototype.checkOutputs=function(t){var e=this;t.forEach((function(t){var a=S(t)[0];if(!e.graph.nodes[a])throw new Error("The output '"+t+"' is not found in the graph")}))},t}(),ft=function(){function t(t,e){void 0===e&&(e={}),this.modelUrl=t,this.loadOptions=e,this.version="n/a",null==e&&(this.loadOptions={})}return Object.defineProperty(t.prototype,"modelVersion",{get:function(){return this.version},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputNodes",{get:function(){return this.executor.inputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputNodes",{get:function(){return this.executor.outputNodes},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"inputs",{get:function(){return this.executor.inputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outputs",{get:function(){return this.executor.outputs},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"weights",{get:function(){return this.executor.weightMap},enumerable:!0,configurable:!0}),t.prototype.findIOHandler=function(){var t=this.modelUrl;if(null!=t.load)this.handler=t;else if(null!=this.loadOptions.requestInit)this.handler=l.jb.browserHTTPRequest(t,this.loadOptions);else{var e=l.jb.getLoadHandlers(t,this.loadOptions.onProgress);if(0===e.length)e.push(l.jb.browserHTTPRequest(t,this.loadOptions));else if(e.length>1)throw new Error("Found more than one ("+e.length+") load handlers for URL '"+[t]+"'");this.handler=e[0]}},t.prototype.load=function(){return d(this,void 0,void 0,(function(){var t,e,a,n;return f(this,(function(r){switch(r.label){case 0:if(this.findIOHandler(),null==this.handler.load)throw new Error("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");return t=this,[4,this.handler.load()];case 1:return t.artifacts=r.sent(),e=this.artifacts.modelTopology,a={},null!=this.artifacts.userDefinedMetadata&&(a=this.artifacts.userDefinedMetadata.signature),this.version=e.versions.producer+"."+e.versions.minConsumer,n=l.jb.decodeWeights(this.artifacts.weightData,this.artifacts.weightSpecs),this.executor=new pt(V.Instance.transformGraph(e,a)),this.executor.weightMap=this.convertTensorMapToTensorsMap(n),[2,!0]}}))}))},t.prototype.save=function(t,e){return d(this,void 0,void 0,(function(){var e;return f(this,(function(a){if("string"==typeof t){if(0===(e=l.jb.getSaveHandlers(t)).length)throw new Error("Cannot find any save handlers for URL '"+t+"'");if(e.length>1)throw new Error("Found more than one ("+e.length+") save handlers for URL '"+t+"'");t=e[0]}if(null==t.save)throw new Error("GraphModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");return[2,t.save(this.artifacts)]}))}))},t.prototype.predict=function(t,e){return this.execute(t,this.outputNodes)},t.prototype.normalizeInputs=function(t){if(!(t instanceof l.c||Array.isArray(t)))return t;if((t=Array.isArray(t)?t:[t]).length!==this.inputNodes.length)throw new Error("Input tensor count mismatch,the graph model has "+this.inputNodes.length+" placeholders, while there are "+t.length+" input tensors.");return this.inputNodes.reduce((function(e,a,n){return e[a]=t[n],e}),{})},t.prototype.normalizeOutputs=function(t){return t=t||this.outputNodes,Array.isArray(t)?t:[t]},t.prototype.execute=function(t,e){t=this.normalizeInputs(t),e=this.normalizeOutputs(e);var a=this.executor.execute(t,e);return a.length>1?a:a[0]},t.prototype.executeAsync=function(t,e){return d(this,void 0,void 0,(function(){var a;return f(this,(function(n){switch(n.label){case 0:return t=this.normalizeInputs(t),e=this.normalizeOutputs(e),[4,this.executor.executeAsync(t,e)];case 1:return[2,(a=n.sent()).length>1?a:a[0]]}}))}))},t.prototype.convertTensorMapToTensorsMap=function(t){return Object.keys(t).reduce((function(e,a){return e[a]=[t[a]],e}),{})},t.prototype.dispose=function(){this.executor.dispose()},t}();function mt(t,e){return void 0===e&&(e={}),d(this,void 0,void 0,(function(){var a;return f(this,(function(n){switch(n.label){case 0:if(null==t)throw new Error("modelUrl in loadGraphModel() cannot be null. Please provide a url or an IOHandler that loads the model");return null==e&&(e={}),e.fromTFHub&&null==t.load&&(t.endsWith("/")||(t+="/"),t+="model.json?tfjs-format=file"),[4,(a=new ft(t,e)).load()];case 1:return n.sent(),[2,a]}}))}))}}).call(this,n(118).Buffer)}}]);